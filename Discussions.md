# With the introduction of 5.x.x, can we filter using related models?

---------------

Author: @duranmla
Upvotes: 1
Comments: 0

Having two models like:

```graphql
type Project
  @model
  @auth(
    rules: [
      { allow: private }
      { allow: public, operations: [read], provider: apiKey }
      # This allow lambda to make CRUD operations
      { allow: private, provider: iam }
    ]
  ) {
  id: ID!
  name: String!
  description: String!
  location: String!
  problem: String!
  solution: String!
  mediaHTML: String!
  image: String!
  launchPlan: String!
  status: ProjectStatus! @default(value: "DRAFT")
  tags: [Tag] @manyToMany(relationName: "ProjectTagConnection")
  organisers: [Organiser] @manyToMany(relationName: "ProjectOrganiserConnection")
  participants: [Participant]
    @manyToMany(relationName: "ProjectParticipantConnection")
  posts: [Post] @hasMany(indexName: "byProject", fields: ["id"])
  totalLove: Int @default(value: "0")
  totalCred: Int @default(value: "0")
}
```

and 

```graphql
type Tag
  @model
  @auth(
    rules: [
      { allow: private }
      # This allow lambda to make CRUD operations
      { allow: private, provider: iam }
      { allow: public, operations: [read], provider: apiKey }
    ]
  ) {
  id: ID!
  name: String!
  image: String!
  projects: [Project] @manyToMany(relationName: "ProjectTagConnection")
  # Tag with lower number will be shown first
  priority: Int @default(value: "1000")
}
```

After making the update to `aws-amplify` version 5.x.x I see that types allow me to write something like:

```ts
const projects = await DataStore.query(Project, (p) => p.tags.tag.name.eq('desertification'))
```

**But that does not work**, I am miss understanding the types? Is there any way to make this work _(filter projects by tags in a single query with DataStore?)_

> Side note: the other approach is to filter using the join table but as it is auto generated I am not able to sync that table when guest users use the application _(it fails as it tries to use amazon cognito pool)_ then that lead me to create a manual model for a join table but I already have data in production which I guess will get deleted if I do the manual setup of the model. What I am doing now is to use graphQL to ge the join table data _(explicitly selecting the authMode to 'API_KEY',)_ and then go from there.

---------------

---------------

# GraphQL Pagination with nexttoken from nested entity (2nd-level)

---------------

Author: @knuspertante
Upvotes: 3
Comments: 1

Hey guys, 

currently I've the following query (generated by amplify cli).

```graphql
export const taskByOutCompany = /* GraphQL */ `
  query TaskByOutCompany(
    $outCompanyID: ID
    $createdAt: ModelStringKeyConditionInput
    $sortDirection: ModelSortDirection
    $filter: ModelTaskFilterInput
    $limit: Int
    $nextToken: String
  ) {
    taskByOutCompany(
      outCompanyID: $outCompanyID
      createdAt: $createdAt
      sortDirection: $sortDirection
      filter: $filter
      limit: $limit
      nextToken: $nextToken
    ) {
      items {
        id
        inCompanyID
        inCompany {
          id
          address
          name
          type
          patternInCompany {
            nextToken
          }
          patternOutCompany {
            nextToken
          }
          taskInCompany {
            nextToken
          }
          taskOutCompany {
            nextToken
          }
          createdAt
          updatedAt
        }
        outCompanyID
        outCompany {
          id
          address
          name
          type
          patternInCompany {
            nextToken
          }
          patternOutCompany {
            nextToken
          }
          taskInCompany {
            nextToken
          }
          taskOutCompany {
            nextToken
          }
          createdAt
          updatedAt
        }
        files {
          items {
            URI
            type
            patternID
            taskID
            groupsCanAccess
            status
            amountOfPositions
            order
            createdAt
            updatedAt
          }
          nextToken
        }
        tags
        status
        cache
        groupsCanAccess
        reference
        createdAt
        updatedAt
        version
      }
      nextToken
    }
  }
`;
```


Now my question when the "2nd-Level-Query" files have a nextToken how can I query more files? Actually I do not found any documentation about this here https://docs.aws.amazon.com/appsync/latest/devguide/aws-appsync-real-time-enhanced-filtering.html and here https://docs.amplify.aws/lib/graphqlapi/query-data/q/platform/js/#paginating-queries
## Comment

---------------

Author: @funes79

Hi, I had the same issue/question. Here is how you can do that. Write a custom query and add parameter to the files section, like this:

```
export const taskByOutCompany = /* GraphQL */ `
  query TaskByOutCompany(
    $outCompanyID: ID
    $createdAt: ModelStringKeyConditionInput
    $sortDirection: ModelSortDirection
    $filter: ModelTaskFilterInput
    $limit: Int
    $nextToken: String,
    $nextFileToken: String,
  ) {
...
...
       files(nextToken: $nextFileToken) {
          items {
            URI
            type
            patternID
            taskID
            groupsCanAccess
            status
            amountOfPositions
            order
            createdAt
            updatedAt
          }
          nextToken
        }
```

---------------

---------------

# How to add Dropdown list into formFields

---------------

Author: @kyosukedev
Upvotes: 1
Comments: 0

I have a question about creating a registration web page using 'react'.
I want to change the input fields in formFields to dropdown list selection. Can you tell me how to implement this?

-------------------------------------------
```import { Authenticator} from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';
import React from 'react';
import {Amplify} from 'aws-amplify';
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);

const formFields = {
  signUp: {
    given_name: {
      placeholder: 'Enter your given name',
    },
    password: {
      order: 
    }
  },  
 };
 

export default function App() {
  return (
    <Authenticator 
    formFields={formFields}
    >
      {({ signOut, user }) => (
        <main>
          <h1>Hello {user.username}</h1>
          <button onClick={signOut}>Sign out</button>
        </main>
      )}
    </Authenticator>
  );
}

```

---------------

---------------

# How to add google-recapcha to Amplify,react

---------------

Author: @kyosukedev
Upvotes: 1
Comments: 0

What kind of code should we write to introduce 'recapcha' for the implementation of the member registration page using 'Amplify'?

'Amplify' has the ability to optionally create a lambda about google recapcha, but I don't know how to achieve this with 'Authentificator'.
Does anyone have an idea to make this happen?



--------------------------------------------------------
import { Authenticator} from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';
import React from 'react';
import {Amplify} from 'aws-amplify';
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);

const formFields = {
signUp: {
name: {
placeholder: 'Enter your name',
order: 1
},
email: {
placeholder: 'Enter your email adress',
order:4
},
password: {
order: 5
},
confirm_password: {
order: 6
},

},
};

export default function App() {
  return (
    <Authenticator 
    formFields={formFields}
    initialState="signIn"
    loginMechanisms={['email']}
    >

      {({ signOut, user }) => (
        <main>
          <h1>Hello {user.username}</h1>
          <button onClick={signOut}>Sign out</button>
        </main>
      )}
    </Authenticator>
  );
}

<img width="895" alt="62326685-018ff980-b4af-11e9-82a8-fc98a54a7a04" src="https://user-images.githubusercontent.com/119325537/205780510-45cdf7fd-d588-4faf-9f3e-1a103fdf40b4.png">

---------------

---------------

# Amplify push/pull overwrites manual API configuration

---------------

Author: @cmason9
Upvotes: 2
Comments: 2

Im not sure if this is a bug or not or whether i have just not done the steps correctly. I have followed this guide (https://docs.amplify.aws/lib/restapi/existing-resources/q/platform/ios/) on Amplify docs to configure an existing API Gateway into my iOS Swift app manually. I have successfully added the api JSON block to the amplifyconfiguration.json file and configured it with my iOS app and it is working as expected. 

The problem I am facing is if i do an amplify push or an amplify pull in the terminal my amplifyconfiguration.json gets overwritten and the api json block is no longer in the file and therefore is no longer configured within my app so I am unable to hit the endpoints I need to unless i configure it again. 

I there a way in which i can push the api configuration that I have set up in the amplifyconfiguration.json file to the amplify backend hosted on AWS? 

Any help great appreciated. 

Thanks 
## Comment

---------------

Author: @ChristianTrummer99

Ever find an answer to this? I have the same question. 
## Comment

---------------

Author: @haverchuck

@cmason9 @ChristianTrummer99  - I've created an [issue](https://github.com/aws-amplify/amplify-cli/issues/11534) based on this discussion and transferred it to the amplify-cli repository.

---------------

---------------

# Correct way to work with a many-to-many relationship in Amplify. Unable to make mutation with provided code.

---------------

Author: @belfortf
Upvotes: 1
Comments: 0

I have modelled a many-to-many relationship in Amplify between Product and Order. However, I cannot pass a productID when creating an Order. I get the error :

> The variables input contains a field name 'products' that is not defined for input object type 'CreateOrderInput'

### Product Model

`type Product @model @auth(rules: [{allow: public}]) {
  id: ID!
  name: String
  price: Int
  Orders: [Order] @manyToMany(relationName: "ProductOrder")
}`

### Order Model

`type Order @model @auth(rules: [{allow: public}]) {
  id: ID!
  totalprice: Int
  products: [Product] @manyToMany(relationName: "ProductOrder")
}`

As per documentation, amplify creates a join table "ProductOrder" in dynamodb.

### createProduct according to Amplify

Amplify tells me that I can create a product with:

`const newProduct = await API.graphql({
    query: createProduct,
    variables: {
        input: {
        "name": "Lorem ipsum dolor sit amet",
        "price": 1020,
        "Orders": [],
    }
    }
});`

As I don't have any orders yet, I create a product without linking it to an order. All working fine.

### createOrder according to Amplify

`const newOrder = await API.graphql({
    query: createOrder,
    variables: {
        input: {
        "totalprice": 1020,
        "products": [],
    }
    }
});
`
So, when I want to create an order (and already have a product), I'm getting the error message I've mentioned above.

I analyze 'CreateOrderInput' and indeed it looks like this:

`input CreateOrderInput {
    id: ID
    totalprice: Int!
}`

So, basically what is the correct way of creating a new Order and passing a productID with it? Do I have to create the Order and then manually call createProductOrder and manually create a record in the join table (ProductOrder) ?



---------------

---------------

# amplify storage add/update - NoSQL - can't get more than the partition key into DynamoDB : - (

---------------

Author: @tsteelematc
Upvotes: 2
Comments: 2

Anybody else having this problem?

The CLI seems to *not* put any additional attributes into the template...

Even if I manually add one, it doesn't make its way into DynamoDB.

![image](https://user-images.githubusercontent.com/21085175/83343670-23226300-a2c3-11ea-8d37-ef82f4e79b7c.png)


## Comment

---------------

Author: @tsteelematc

Same result, only the partition key column if I create DB via...

amplify api add

Wonder what I'm missing?

Thanks.
## Comment

---------------

Author: @hhcalder92

Same, I just did an upgrade of amplify on an existing project and ran into this with hosting bucket and DynamoDB templates. Not sure what version I was on, but I am on `10.5.1` now. 

---------------

---------------

# UI Component AmplifyS3Image from @aws-amplify/ui-react/legacy gone?

---------------

Author: @ecc7220
Upvotes: 1
Comments: 1

Hi all,

I was using AmplifyS3Image from "@aws-amplify/ui-react/legacy" but it seems not to be there anymore in amplify-js 5.0.4?
I found also this in the most recent docs: [Link to doc with reference to AmplifyS3Image](https://docs.amplify.aws/ui/storage/tracking-events/q/framework/react/)

I need urgently a solution to this, can somebody please point me into the right direction?

Thank you in advance.
## Comment

---------------

Author: @cwomack

Hello, @ecc7220 👋.  The legacy ui-react/legacy was deprecated with v5+ of Amplify (see [here](https://github.com/aws-amplify/amplify-js/releases/tag/aws-amplify%405.0.0#:~:text=%40aws%2Damplify/ui%2Dreact%40%22%3C%201.x%22)).  Was this page referenced in the docs somewhere? Or possibly bookmarked from previous use? Curious to know how you came across it. 

---------------

---------------

# AWS, Cognito, forgotPassword. Is that true that the user must try once with wrong password?

---------------

Author: @XinyueZ
Upvotes: 1
Comments: 1

I've tried to call `forgotPassword` flow directly without any Cognito login behavior. I did not get any exception after calling `forgotPassword` and got **nothing** returned and **NO SMS** to my device.

When I did one login with a wrong password, after I called forgotPassword, I got the return info of API defined and saw the SMS on my device.

Is that true that AWS allows the `forgotPassword` **flow** only when the user experiences one false login attempt?

thank you.
## Comment

---------------

Author: @tannerabread

Hi @XinyueZ, you are using the Amplify auth method `forgotPassword` like [shown here](https://docs.amplify.aws/lib/auth/manageusers/q/platform/js/#forgot-password)? I don't believe it should require you to make a wrong login first 

---------------

---------------

# DataStore save operation blocked until sync is completed

---------------

Author: @tomaszkiewicz
Upvotes: 1
Comments: 0

Hi, 

I'm developing an application that is based on AWS Amplify Datastore, the "selling point" for Datastore was it's speed when accessing data, however I encountered some problem after I started working with more items in my Datastore.

The behavior I observe is especially visible on mobile devices (probably due to network & cpu) and is as follows:

- when app is loaded it displays some items from Datastore
- user can also add new items to Datastore from simple text field
- however, saving that new item is blocked until sync operations is completed
- after the sync is completed (I observe it using Hub events) the saving works as expected and it it instant

I wonder is it by design that sync operations block saving? 
For me it's a real issue as the user has to wait sometimes dozen seconds for sync to be completed before he can add anything new.

Best regards

Łukasz Tomaszkiewicz

---------------

---------------

# Datastore custom Id usage question

---------------

Author: @amirmishani
Upvotes: 1
Comments: 0

With the new updates to Amplify and Appsync I have a few questions:

1. Datastore now accepts [custom Ids](https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/) by adding the `@primaryKey` directive to a field. Does this mean that we can now pass the custom Id's value to `DataStore.save()` and set that ourself?
 
2. [Datastore docs](https://docs.amplify.aws/lib/datastore/advanced-workflows/q/platform/js/#determine-when-the-primary-key-field-is-auto-populated-upon-record-creation) also mention that in the following scenario with the existence of explicit `id` field in sort key, the "primary key" is auto-populated, is this correct? Because in this scenario it makes more sense that we pass the primary key and have Datastore auto-generate the sort key (id field).

```graphql
type Customer@model {  
  country: String! @primaryKey
    (sortKeyFields: ["id"])
  id: ID!
  firstName: String
  lastName: String
}
```

3. GraphQL, [the docs](https://docs.amplify.aws/cli/graphql/custom-business-logic/) mention 3 ways to set custom logic: Lambda function, HTTP and VTL. However Appsync now offer direct DynamoDB [Javascript resolvers](https://aws.amazon.com/about-aws/whats-new/2022/11/aws-appsync-javascript-graphql-api-resolvers/) (similar to VTL). Does Amplify support that? Any plans to support it and any plans to switch from VTL to Javascript resolvers?

---------------

---------------

# Should Password Reset Work When User is in FORCE_CHANGE_PASSWORD State

---------------

Author: @Rajan-Gupta1
Upvotes: 1
Comments: 0

When a user is registered with Cognito and its one time password has expired, user is unable to come to Amplify and Reset Password when Account Status is FORCE_CHANGE_PASSWORD

How is a user expected to reset a password if the original temporary password expired?

---------------

---------------

# How to add Sort Key to Tables created (in Models) with Amplify Studio?

---------------

Author: @rosayos
Upvotes: 1
Comments: 1

Hello 👋
I'm new to AWS Amplify. Today I have been reading about best practices for DynamoDB design.
I have 2 questions about creating a Model (which creates a DynamoDB Table) with Amplify Studio.
- How do I change the name of the Partition Key? It looks like by default it calls "id".
- How do I add Sort Key to this table? I have read that I need to specify the Sort Key before creating a Dynamo Table (I can't do it afterwards), but when I create a model through Amplify Studio, there's no option, just add field name.
## Comment

---------------

Author: @chrisbonifacio

Amplify Studio creates the GraphQL API with DataStore enabled. Unfortunately neither custom nor composite primary keys are supported by DataStore yet. This is a feature that is currently being developed and planned for release in the near future.

Please stay tuned for updates!

In the meantime, in order to use custom primary keys and sort keys you would have to disable DataStore/Conflict Detection via the Amplify CLI by running `amplify update api`. Then, you can edit the local schema in the amplify/api/<apiName> folder.

Now with this non-DataStore GraphQL API you can change the name of the primary key field and add sort keys as you need them, at least until the feature is released for DataStore which you can then re-enable if you need the offline capabilities.

---------------

---------------

# aws-configure not working properly

---------------

Author: @qxy180009
Upvotes: 1
Comments: 2

I has installed the latest version of amplify-cli in my WIN10. I run `amplify configure`, everything is good until I was asked to type in my new created IAM access key id and my secret access key. I copied them from the csv I downloaded but it shows me the error that `You did NOT enter valid keys. New user setup failed.` The error message is quite simple and I don't know how to solve it.
![image](https://user-images.githubusercontent.com/50066931/80870813-7676a680-8c6e-11ea-83b1-0f501d632fb0.png)
The key and id are correct. So I suppose it may be because I used another IAM role to access before and that causes the conflict. Does anyone meet this problem before?
## Comment

---------------

Author: @ChristianMarchetta

I have the exact same problem. 
Did you manage to solve this problem? If so, could you please share your solution?
## Comment

---------------

Author: @amhinson

This appears to be an issue with the Amplify CLI. I'd suggest opening an issue on [their repo](https://github.com/aws-amplify/amplify-cli), since this one is just for the JavaScript libraries.

---------------

---------------

# App analytics to an existing (non amplify) backend

---------------

Author: @Kfirhuja
Upvotes: 1
Comments: 0

Hi,
I have an App written in react-native in FE that uses amplify library to connect/authenticate against an existing BE, that was generated using aws-cdk and not amplify. 
Existing BE consist of: Cognito, Appsync, Lambda, Pinpoint.

I want to connect the App to analytics using the existing BE services and start see sign-in sign-ups, failure to authenticate, sessions event and of course adding my own one.

I've tried adding: aws_mobile_analytics_app_id, aws_mobile_analytics_app_region to aws-exports.ts and even configured congnito client to integrate with pinpoint project, but don't see any activity in pinpoint's project analytics.

Also, didn't find documentation regarding how an App register and endpoint to and existing pinpoint/cognito services.

Thanks in advance.
Kfir
<img width="1492" alt="image" src="https://user-images.githubusercontent.com/22073232/201897216-4175682a-e374-47b6-877e-5bdf101e6912.png">


---------------

---------------

# Terminate session after some times without any action

---------------

Author: @saraank
Upvotes: 1
Comments: 0

Hi,
I use amplify to log into my react app.
I have a requirement that if the user has been inactive for 15 minutes his session will be terminated and he will have to log in again.
how can I do that?
When I use await Auth.currentSession() it refreshes the token automatically and I can't figure out that the access token has expired

---------------

---------------

# Updating table with lambda function not working - Possible Bug

---------------

Author: @ranjeev75
Upvotes: 3
Comments: 2

I have created a DynamoDB table with amplify:

`type Tags @model {
    id: ID!
    count: Int
    name: String!
}`

I wanted to see if I could use a lambda to increment the count value and created a function(hello world) with amplify:

```
const aws = require('aws-sdk');
const region = process.env.REGION;
const docClient = new aws.DynamoDB.DocumentClient({ region });

exports.handler = async (event, context) => {
    const { tags } = event.arguments;
    const TableName = `Tags-dsfe3rm-${process.env.ENV}`;
    const params = {
        TableName,
        Key: { id: '1234567890' },
        UpdateExpression: 'SET count = count + :incr',
        ExpressionAttributeValues: {
            ':incr': { N: '1' },
        },
    };

    try {
        docClient.update(params, (err, data) => {
            if (err) console.log('Error updating item =>', err);
            else console.log('Successfully updated item =>', data);
        });
    } catch (e) {
        console.error(e);
    }
    context.done(null, `Success - ${JSON.stringify(tags)}`);
};
``` 

From the cloudWatch logs I can see the function running but the item is not updated with the incremented value and I don't see any of the console logs being hit in cloudWatch.

I'm not sure what I'm doing wrong/ missing but how can I essentially 'wire' up the lambda so it does update the table?
## Comment

---------------

Author: @BrianHHough

Has anyone (or @ranjeev75) been able to figure this one out? I've read some stack overflow posts but they were from '16, so not sure how relevant they would be here. I'll reply back if I figure out any updates on this.
## Comment

---------------

Author: @BrianHHough

@ranjeev75 — figured out the issue with the above! So the new dynamodb.DocumentClient() means you don't have to specify the type for the input. In the `ExpressionAttributeValues` you can specific this simply like this `":inc": 1`. Also, you were calling the async function inside of the exports.handler which might have had some unintended issues with the promise you get back from DynamoDB. @mtliendo has a great blog post on DynamoDB Streams in Lambda in case this might fit your use-case: https://blog.focusotter.com/serverless-contact-form-using-aws-amplify

I've added updates to your code which I tested on my end and works well for anyone trying to make a counter. Hopefully this is helpful for you or anyone facing this type of requirement! 

cc: @david-mcafee @chrisbonifacio @undefobj @BrianHHough 

```javascript
const aws = require('aws-sdk');
const region = process.env.REGION;
const docClient = new aws.DynamoDB.DocumentClient({ region });

async function runUpdateCounter(){
    const { tags } = event.arguments;
    // const TableName = `Tags-dsfe3rm-${process.env.ENV}`;
    const number = 1;

    try {
        var params = {
                TableName: `Tags-dsfe3rm-${process.env.ENV}`,
                Key: { 
                        id: '1234567890' 
                },
                UpdateExpression: 'SET #count = #count + :incr',
                ExpressionAttributeValues: {
                    ':incr':  number,
                },
                ExpressionAttributeNames: {
                    '#count':  'count',
                },
                ReturnValues: "UPDATED_NEW"
    };
        var result = await docClient.update(params, function(err, data) {
            if (err) console.log('Error updating item =>', err);
            else console.log('Successfully updated item =>', data);
        }).promise();
        return console.log(JSON.stringify(result));
    } catch (error) { 
        console.log(error);
    }
}


exports.handler = async (event, context) => {
    try {
        const result = await runUpdateCounter();
    } catch (e) {
        console.error(e);
    }
    return Promise.resolve('Successfully processed Lambda <> DynamoDB');
};
```

---------------

---------------

# CognitoUserSession is not valid because idToken is null.

---------------

Author: @YawarOsman
Upvotes: 2
Comments: 1

I'm trying to login to AWS Amplify in flutter it works perfectly on IOS simulator and my real phone but when i want to login in `android emulator` it shows this error below:


```
D/AWSMobileClient(10755): Inspecting user state details
D/AWSMobileClient(10755): waitForSignIn: userState:SIGNED_OUT
W/CognitoUserSession(10755): CognitoUserSession is not valid because idToken is null.
D/AWSMobileClient(10755): Sending password.
D/AWSMobileClient(10755): Using USER_SRP_AUTH for flow type.
E/amplify:flutter:auth_cognito(10755): AuthException
I/flutter (10755): Sign in failed
```

I login with `await Amplify.Auth.signIn(
                    username: 'xxxx@gmail.com,
                    password: 'xxxxxxx',
                  );`.

I've chosen `email` in the configuration that is why i put `email` instead of `usename` it's no problem


**Additional Context:**

-   amplify_flutter: ^0.6.5
-   amplify_auth_cognito: ^0.6.5
-   amplify_datastore: ^0.6.5
-   amplify_storage_s3: ^0.6.5
## Comment

---------------

Author: @sammyodiagbe

Were you able to fix this error because I am also running into the same issue

---------------

---------------

# GraphQL @auth - Combine owner and groups authorization rules

---------------

Author: @mdwt
Upvotes: 1
Comments: 0

I have a multi tenant application in AWS Amplify, I'm using the Custom-attribute-based multi-tenancy described [here](https://docs.aws.amazon.com/cognito/latest/developerguide/custom-attribute-based-multi-tenancy.html)

All models have a composite key with "company" being the unique tenant ID, and the Cognito user pool has a custom attribute `custom:company` which links the user to the tenant data.

Example type below:

```
type Customer @model
    @key(fields: ["company", "id"])
    @auth(rules: [
         { allow: owner, ownerField: "company", identityClaim: "custom:company"},
         { allow: groups, groups: ["Member"], operations: [read] },
         { allow: groups, groups: ["Admin"]},
    ])
{
  company: ID!
  id: ID!
  ...
}
```

I want to add user groups to Cognito to manage the operations that different users can perform - e.g. `Admin` users can perform all operations, but `Member` users can only perform read

The problem is the first `owner` auth rule will match for anyone with the matching `custom:company` attribute, regardless of their Group.

Is there a way to combine owner and group @auth rules - i.e. both owner and groups need to pass to have access to an item?

For example - users of the `Member` group are only allowed to *read* when their `custom:company` attribute matches the company of the model

Another example - anyone with a matching `custom:company` attribute has read access to an item, but only `Admin` have write access

---------------

---------------

# How to add cors filter to graphql endpoint?

---------------

Author: @bls-lehoai
Upvotes: 1
Comments: 0

we are developing an amplify app, using js client library, client is written in VueJS and hosted on S3. Now we wanna secure our site by adding cors, which allow only our site can request graphql api. There is no configuration to do it.
Please help, thanks.

---------------

---------------

# api resolvers context

---------------

Author: @filipmicanek98
Upvotes: 1
Comments: 0

I am using the following models below and I need to perform some custom logic in one of the generated resolvers using this [approach](https://docs.amplify.aws/cli/graphql/custom-business-logic/#override-amplify-generated-resolvers) The user model is not being tied to user in cognito, but its ID is saved in a custom attribute.  Is there a way to somehow access the ID through context in `getEvent` resolver template without passing any arguments, besides eventId?
```
type User @model {
  id: ID!
 ...other attributes
}
```
```
type Event @model {
  id: ID!
  participants: [ID]
 ...other attributes
}
```

---------------

---------------

# Where I can find answer to understand `Lazy` preffix on models with amplify 10.4.0

---------------

Author: @duranmla
Upvotes: 1
Comments: 0

I made an update to my cli and on the next push all my models have a `Lazy` version of the models. This of course is not something bad as it is auto generated code, but where I can find information about it? I have done a quick search on amplify docs and release notes at Github and I can't see anything. 

Thanks for the work! 🙌

---------------

---------------

# DataStore - Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`?

---------------

Author: @YoussefAlmardini
Upvotes: 4
Comments: 3

Please help, i spent 2 days trying simply to use Datastore of amplify. Am building NPM package to wrap an Amplify project backend. Auth works good but datastore not.
Am testing code with ts-node and Jest. It is package so i do not have a framework.


When i call the save function it does not work and throw this warning:

<!-- begin snippet: js hide: false console: true babel: false -->

<!-- language: lang-js -->

    [WARN] 24:08.886 DataStore - Data won't be synchronized. No GraphQL endpoint configured. Did you forget `Amplify.configure(awsconfig)`? {
      config: {
        authProviders: undefined,
        maxRecordsToSync: 10000,
        syncPageSize: 1000
      }
    }


<!-- end snippet -->

My api endpoint is 100% correct, also the api-key. The backend works in another project built with react. But in my case (NPM package) it does not work.


The script am trying to run:

<!-- begin snippet: js hide: false console: true babel: false -->

<!-- language: lang-js -->

    import { DataStore } from '@aws-amplify/datastore';
    import { AccountDetails }  from '@/models';
    import { SignUp } from "@/Authentication/SignUp";
    import InvalidAccountRequirementsException from "@/Exceptions/InvalidAccountRequirementsException";
    import "@/app.config";

    /**
     * @name CreateAccount
     * @description:
     *      build the correct pattern to check specific string type.
     *
     * @type function
     * @param email
     * @param password
     * @param hasOwnCompany
     * @param optInMarketingEmail
     * @param tacAgreed
     * @constructor
     * @return {Promise<AccountDetails>}
     */
    const CreateAccount = async (
        email: string,
        password: string,
        hasOwnCompany: boolean,
        optInMarketingEmail: boolean,
        tacAgreed: boolean,
    ): Promise<AccountDetails> => {

        if (!tacAgreed) {
            throw new InvalidAccountRequirementsException('Terms and conditions mus be agreed');
        }

        const user = await SignUp(email, password);

        return await DataStore.save(
            new AccountDetails({
                cognitoSubId: user.userSub,
                email: email,
                optInMarketingEmail: optInMarketingEmail,
                tacAgreed: tacAgreed,
                hasOwnCompany: hasOwnCompany,
            })
        );
    }

    export default CreateAccount;


<!-- end snippet -->

app.conf.ts

<!-- begin snippet: js hide: false console: true babel: false -->

<!-- language: lang-js -->

    import Amplify from 'aws-amplify';
    import awsExports from '@/aws-exports';

    Amplify.configure(awsExports);


<!-- end snippet -->

package.json

<!-- begin snippet: js hide: false console: true babel: false -->

<!-- language: lang-js -->

    {
        "name": "@financiallease/driver-seat-amplify-api",
        "version": "1.0.0",
        "description": "",
        "author": "itsupport@financiallease.nl",
        "main": "dist/financiallease.cjs.js",
        "module": "dist/financiallease.es.js",
        "browser": "dist/financiallease.js",
        "license": "ISC",
        "scripts": {
            "build": "rollup -c",
            "lint": "eslint --config eslint.config.js '{src,test}/**/*.ts' --no-ignore",
            "autoformat": "eslint --config eslint.config.js '{src,test}/**/*.ts' --no-ignore --fix",
            "test": "jest -c jest.config.ts",
            "coverage": "jest --collectCoverage --coverageDirectory=\"./coverage\" --ci --reporters=default --reporters=jest-junit --watchAll=false",
            "docs:generate": "typedoc --readme README.md --entryPoints src --entryPointStrategy expand --out docs --theme hierarchy --name \"Driver Seat Amplify Api - docs\" --includeVersion",
            "amplify-modelgen": "node amplify/scripts/amplify-modelgen.js",
            "amplify-push": "node amplify/scripts/amplify-push.js"
        },
        "publishConfig": {
            "@financiallease:registry": "https://gitlab.com/api/v4/projects/35071033/packages/npm/"
        },
        "dependencies": {
            "@aws-amplify/core": "^4.5.1",
            "@aws-amplify/datastore": "^3.11.0",
            "@rollup/plugin-alias": "^3.1.9",
            "aws-amplify": "^4.3.19",
            "dotenv": "^16.0.0",
            "ts-node": "^10.7.0",
            "typescript": "^4.6.3"
        },
        "devDependencies": {
            "@babel/core": "^7.17.9",
            "@babel/preset-env": "^7.16.11",
            "@babel/preset-typescript": "^7.16.7",
            "@rollup/plugin-babel": "^5.3.1",
            "@rollup/plugin-commonjs": "^21.0.3",
            "@rollup/plugin-node-resolve": "^13.1.3",
            "@rollup/plugin-typescript": "^8.3.1",
            "@types/amplify": "^1.1.25",
            "@types/jest": "^27.4.1",
            "@types/node": "^17.0.30",
            "@typescript-eslint/eslint-plugin": "^5.18.0",
            "@typescript-eslint/parser": "^5.18.0",
            "babel-jest": "^28.0.3",
            "babel-plugin-module-resolver": "^4.1.0",
            "eslint": "^8.12.0",
            "eslint-import-resolver-alias": "^1.1.2",
            "eslint-plugin-react": "^7.29.4",
            "esm": "^3.2.25",
            "jest": "^27.5.1",
            "jest-junit": "^13.2.0",
            "jsdoc": "^3.6.10",
            "nodemon": "^2.0.16",
            "rollup": "^2.70.1",
            "rollup-plugin-terser": "^7.0.2",
            "ts-jest": "^27.1.4",
            "tsconfig-paths": "^3.14.1",
            "tslib": "^2.3.1",
            "typedoc": "^0.22.15",
            "typedoc-theme-hierarchy": "^1.1.1",
            "ini": "^1.3.5",
            "inquirer": "^6.5.1"
        }
    }

<!-- end snippet -->

Any ideas?
## Comment

---------------

Author: @tomyates

I'm getting this error too.
I have a ReactJS app and a React Native app and the React Native app gives me this warning.
I'm using aws-amplify version 4.3.21.
## Comment

---------------

Author: @svidgen

Try upgrading to the latest version (`4.3.24`) and remove the superfluous deps:

```
        "@aws-amplify/core": "^4.5.1",
        "@aws-amplify/datastore": "^3.11.0",
```

Then wipe your `node_modules` and reinstall, please. Including the core `aws-amplify` package *and* individual packages can sometimes cause instability.

The latest version should may give you a little more logging to help troubleshoot.
## Comment

---------------

Author: @youssef-almardini

Well, I just deleted the amplify directory in my base code and run:
`amplify pull --appId <APP_ID> --envName <ENV>`
After that everything works again

---------------

---------------

# currentUserCredentials vs currentCredentials

---------------

Author: @codermpl
Upvotes: 2
Comments: 0

Hello, what's the difference between currentUserCredentials and currentCredentials and when should I use each one? I haven't found anything in the documentation that goes over when to use each. Looking through the code currentCredentials seems to get new credentials if the credentials are expired. While currentUserCredentials has different logic and gets new credentials every time for me.

---------------

---------------

# DataStore : Cascading Delete Flag for Delete - Enable/Disable Deleting Child Element for Relational Data

---------------

Author: @wahidzzz
Upvotes: 0
Comments: 0

I am working on Web App that has multi-relational data, I want understand is there a way to disable cascading delete? 

Based on this comment : https://github.com/aws-amplify/amplify-js/issues/9553#issuecomment-1030285612

"When deleting the parent in a Has One relationship the current expected behavior, for our JS implementation of DataStore, is for the child to get deleted as well, similar to Many-to-many relationships."

I want to keep the Child once parent is been deleted.



---------------

---------------

# Prevent XSS attack for CookieStorage - amazon-cognito-identity-js

---------------

Author: @akterstack
Upvotes: 1
Comments: 0

We are using `CookieStorage` to store auth tokens of logged in users. But later we found that this library store token as client side cookie without `HttpOnly` flag. So we are very scared about XSS at this moment. 

Should we stop using this library or is there any approach to safe the users token/sessions.

---------------

---------------

# [Amplify Auth][Cognito] How to persist user session from authenticateUser() to authorize endpoint

---------------

Author: @fredcool
Upvotes: 1
Comments: 0

Trying to resolve this issue for few weeks but still no luck. Really appreciated for any hints or solutions.
I have built a web application utilized Cognito and amazon-cognito-identity-js SDK for user registrations and user sign-in.
In this web application, I have integrated a 3rd party SASS in the iframe which used OIDC flow (https://docs.aws.amazon.com/cognito/latest/developerguide/authorization-endpoint.html) to authenticate users.
Here is the flow which caused the issue:
1. Users signed in through my web application. I used authenticateUser() from amazon-cognito-identity-js. I am certain that the users have signed in and able to get id token, access token and refresh token. Therefore, I assumed the Cognito should have this user in the session.
2. Users accessed the 3rd party SASS. It redirected users to my Cognito authorize endpoint and then it redirected users to login page (but the users already signed in from my web application). Here is the point. I assumed this user already in the session so it should automatically return the authorization code without sign in again. Initially I thought it could be the iframe, so I have the same OIDC flow set up on my web application. But even I signed in from the step 1, the authorize endpoint still redirected me to the login page.

Is there a way to sync the session to the authorize endpoint? Really appreciated! 

---------------

---------------

# Where can i find and translate confirmsignup message

---------------

Author: @shopizer-ecommerce
Upvotes: 1
Comments: 3

When i an creating a new user with verification email the UI displays a text that seems to be hard to find and can not figure out a way to translate it

Here is the text displayed

Your code is on the way. To log in, enter the code we emailed to ..@ . It may take a minute to arrive.

Any idea on his i can have this translated using
I18n.putVocabularies

or anything else

Thanks
## Comment

---------------

Author: @tannerabread

It should just be hiding the email. 
e.g. test@test.com becomes `..@..` or something similar.

Is this what you were asking about?
## Comment

---------------

Author: @shopizer-ecommerce

As a cliarification need to translate the paragraph from 

Your code is on the way. To log in, enter the code we emailed to cd...@yahoo.com
in an other language. 

I18n.putVocabularies requires the exact sentence and the email stuff
## Comment

---------------

Author: @kennu

Looks like the actual strings (for React UI) are defined here: https://github.com/aws-amplify/amplify-ui/blob/477a005935f242b49e776d42054810bc5d115857/packages/react/src/components/Authenticator/ConfirmSignUp/ConfirmSignUp.tsx#L39

```
  const emailMessage = translate(
    'Your code is on the way. To log in, enter the code we emailed to'
  );
  ...
  const minutesMessage = translate('It may take a minute to arrive.');
```


---------------

---------------

# Using amazon-cognito-identity-js in a Service Worker

---------------

Author: @BroMattMiller
Upvotes: 1
Comments: 1

In the browser I want to serve all Cognito auth tokens from a service worker, both for security and for ease of automatically adding tokens into Authorization request headers. However, I see that localStorage is used to hold all this stuff, and localStorage is disallowed in a service worker. Should I just change the cache storage functions to use a service worker cache, or am I missing some easier way?
## Comment

---------------

Author: @BroMattMiller

I see now that the api doesn't rely on localStorage, but just uses memory if localStorage isn't available. So, this isn't an issue. And, it ended up making more sense to operate the service worker in between the Cognito api and the fetches it makes to the back end, so it's really a non-issue.

---------------

---------------

# GraphQL subscription: filtering not working

---------------

Author: @pptavozl
Upvotes: 1
Comments: 0

Hello, i was reading documentation about GraphQL [subscription filtering ](https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/js/#using-amplify-graphql-client)

example code: 

```
// Only subscribe to creation of Todo, if the todo "type" is "Personal"
const subscription = API.graphql(
    graphqlOperation(subscriptions.onCreateTodo, {
      filter: {
        type: { eq: "Personal" }
      }
    })
).subscribe({
    next: ({ provider, value }) => console.log({ provider, value }),
    error: error => console.warn(error)
});
```


im using similar code, but AppSync onCreateMyTableData not giving me filter parameters,


schema I'm using:
```
type MyTableData  @model @auth(rules: [{ allow: public }]) {
	id: ID!
	feedbackId: String!
		@index(
			name: "byFeedback"
			queryField: "feedbackMessagesByFeedback"
			sortKeyFields: ["createdAt"]
		)
	message: String!
	user: String!
	createdAt: AWSDateTime
}
```


Not filtering code I'm using:
```
const observer = API.graphql(
			graphqlOperation(onCreateMyTableData, {
				filter: {
					feedbackId: { eq: feedbackId }
				}
			})
		).subscribe({
    next: ({ provider, value }) => console.log({ provider, value }),
    error: error => console.warn(error)
});
```


Anyone knows if i need to add something else to Schema?


Thanks for reading

---------------

---------------

# subscribe to user info on page load

---------------

Author: @stefanomiccoli
Upvotes: 1
Comments: 2

The scenario: we want to store user info (cognito groups, token etc) as soon as this is available after loading the angular application. We have therefore two cases:
1. previously unauthenticated user loads the page, is shown the login form, authenticates, authenticated section of the application is loaded
2. previously authenticated user loads the page, authenticated section of the application is shown

Our need: as soon as user info is available, store it in a custom service, that will be responsible to fetch user preferences and other stuff. Before updating to amplify@4 I remember ending up with the function `onAuthUIStateChange` to listen to auth state changes after realizing that `Hub.listen` would not trigger any event when loading a page as already logged in (use case 2 above)

Our problem: I followed the very [concise documentation](https://ui.docs.amplify.aws/angular/connected-components/authenticator/configuration) for angular. I get the login component for unauthenticate users and the protected content for the authenticated users. So far so good. But now I have to listen to user changes. Unfortunately `AuthenticatorService` does not expose any method or property to subscribe to an observable for the user status as one would reasonably expected by an angular library, `Hub.listen` does not trigger any event when loading the page as already authenticated (consistent with previous behavior, still doesnt make sense to me) and `onAuthUIStateChange` is not invoked at all (although being part of the library and not deprecated).

So, what is the official/standard way of listening for changes to the user status in angular using the latest version of the amplify library?
## Comment

---------------

Author: @abdallahshaban557

Hi @stefanomiccoli  - do you want to listen to all user profile changes? or are you looking for it after the user has been registered or created? 
## Comment

---------------

Author: @stefanomiccoli

any feedback?

---------------

---------------

# Cognito Hosted UI - Passwordless Option

---------------

Author: @SFaraji
Upvotes: 1
Comments: 0

Hi team, 

Please allow passwordless option for Hosted UI by allowing to remove the mandatory password field from both sign up and sign in form.

This is a must feature to support.

Thanks,

---------------

---------------

# User pool client xxxx does not exist.

---------------

Author: @Arnav7501
Upvotes: 1
Comments: 0

if i try to use Auth.signup or Auth.signin, it gives me this error

---------------

---------------

# oauth2/token endpoint gives invalid_client error

---------------

Author: @Nivethan-Ar
Upvotes: 1
Comments: 0

after signing in the user using hosted ui i get the code then i send the post request like  following to get the access token
![image](https://user-images.githubusercontent.com/63112138/196002838-ad8c3ef0-a15f-41fd-8199-815deeb240c6.png)

**headers**
![image](https://user-images.githubusercontent.com/63112138/196002844-ed643381-1694-4cb0-97d8-0d842161e3e9.png)

i created this pool without client secret so the Authorization header is just in "Basic App_client_id" format

what mistake i'm making? why i'm not getting the access token?

---------------

---------------

# retrieve tokens from local storage then set as cookies

---------------

Author: @joaovitorzv
Upvotes: 1
Comments: 0

I have a remix app setup with amplify auth and headless Authentication from `@aws-amplify/ui-react`, I can sign in and out successfully and make SSR requests with the `withSSRContext` with no problems.

problem is when the user closes the browser and re-opens it again i would like to keep the user logged in, it partially happens since the user tokens are kept stored in the local storage but the cookies aren't, based on [this issue comment](https://github.com/aws-amplify/amplify-js/issues/8011#issuecomment-1012025277) i've been trying to restore the cookies from the local storage by calling the `Auth.currentAuthenticatedUser()` on **client first** then redirecting, but had no success. Is this the correct way to fix this problem or am i missing something here?

---------------

---------------

# Forgot password resend code.

---------------

Author: @BohdanShuliaka
Upvotes: 1
Comments: 0

Hello everyone! Ive faced an issue with "forgot password" functionality. Im reusing Auth API in order to create custom auth flow, and I want to recreate my own forgot pass screen but I cannot find any API call or method for "resend code" which is present in the hosted UI.
How can I cower that? I googled everything and I see that there is no solution yet. I hope Im wrong 🙂
![image](https://user-images.githubusercontent.com/32823029/195799020-28c34d04-031e-4ab7-bfc7-195d3cb7c8b1.png)

---------------

---------------

# Federated Sign-In with `amazon-cognito-identity-js`

---------------

Author: @nolde
Upvotes: 5
Comments: 1

Hello!

I am using a Cognito User Pool for my application, along with Google as an identify provider configured against it. I am not using Amplify in any way, other than using the [`amazon-cognito-identity-js`](https://github.com/aws-amplify/amplify-js/tree/master/packages/amazon-cognito-identity-js) library that is part of this repository.

When handling direct login, all works fine, using the examples provided [here](https://github.com/aws-amplify/amplify-js/tree/master/packages/amazon-cognito-identity-js), simple calling `authenticateUser` and away I go. However, the library does not seem to have any specific methods to handle external identity providers.

So far, I have used the same endpoints used by Cognito's hosted UI to login using Google, and this works to some extent, as I can get redirect to my app with the tokens being carried over with hash parameters, but then I do not know how to create a user session using these tokens. If I just try to `new CognitoUserSession`, I get failures (`this.accessToken.getIssuedAt is not a function at CognitoUserSession2.calculateClockDrift"`). And I can't seem to find any specific methods I should be using for that... what am I missing?

The reason I am trying to do that is for built-in features, like editing user details, or refreshing tokens.

I've found two related questions here:

- https://github.com/aws-amplify/amplify-js/discussions/9589
    + no response
- https://github.com/aws-amplify/amplify-js/discussions/5554
    + kind of similar to what I want, using amplify auth without setting up Amplify... but I am NOT using Amplify in any way, and it it seems like a Cognito Identify Pool is required... which I don't use, I just have the User Pool with Identity Providers attached.

Anyone did something similar?

Thanks in advance.
## Comment

---------------

Author: @nolde

Ok, for anyone tyring to do the same, there are two options:

1. You can use just the auth part of amplify with no obvious problems. Although their docs make it seem like an Identity Pool is required, that is not actually true. You can use just the User Pool and still have proper federated login support.

2. If you do not want the bloat of Amplify stuff you do not need, you can use just 'amazon-cognito-identity-js'. After you exchange the code for the tokens, you can do the following:
    ```js
    const session = new CognitoUserSession({
      IdToken: new CognitoIdToken({ IdToken: response.id_token }),
      RefreshToken: new CognitoRefreshToken({ RefreshToken: response.refresh_token }),
      AccessToken: new CognitoAccessToken({ AccessToken: response.access_token })
    })
    const username = session.getIdToken().decodePayload()['cognito:username']
    const user = new CognitoUser({ Username: username, Pool: userPool })
    user.setAuthenticationFlowType('USER_SRP_AUTH') // optional
    user.setSignInUserSession(session)
    ```
    The last method seems to properly save the session into the store, and update the `LastAuthUser` to the correct one, allowing you to `userPool.getCurrentUser()` correctly. There is still an issue with the session not being prefilled when you get the user from this method; you can retrieve it by using `user.getSession((err, session) => user.setSignInUserSession(session))`.

Hopefully one these options works for you. I might publish a repo with a test app for people in need of examples.

---------------

---------------

# How to call GraphQL API mutations within a Lambda?

---------------

Author: @vadimmelnicuk
Upvotes: 1
Comments: 3

Hey, I cannot get my head around the proper way of calling GraphQL API mutations from AWS Lambdas. I am using the method decribed in the official documentation [https://docs.amplify.aws/cli/function#signing-a-request-from-lambda](https://docs.amplify.aws/cli/function#signing-a-request-from-lambda), please see below:

```
const updateTodo = `
mutation updateTodo($input: UpdateTodoInput!) {
  updateTodo(input: $input) {
    id
    active
  }
}`

let req = new AWS.HttpRequest(process.env.API_APINAME_GRAPHQLAPIENDPOINTOUTPUT, process.env.REGION)
req.method = 'POST'
req.path = '/graphql'
req.headers.host = new urlParse(process.env.API_APINAME_GRAPHQLAPIENDPOINTOUTPUT).hostname.toString()
req.headers['Content-Type'] = 'application/json'
req.body = JSON.stringify({
  query: updateTodo,
  operationName: 'updateTodo',
  variables: {
    input: {
      id: todo.Item.id,
      active: true
    }
  }
})

let signer = new AWS.Signers.V4(req, 'appsync', true);
signer.addAuthorization(AWS.config.credentials, AWS.util.date.getDate())

const data = await new Promise((resolve, reject) => {
  let httpRequest = https.request({...req, host: req.headers.host}, (result) => {
    result.on('data', (data) => {
      resolve(JSON.parse(data.toString()));
    })
  })
  httpRequest.write(req.body)
  httpRequest.end()
})
```

However, I tend to get the following error as a response to my mutations:
```
errors: [
  {
    errorType: 'UnauthorizedException',
    message: 'Permission denied'
  }
]
```

Also, here is my GraphQL Schema:

```
type Todo
@model(subscriptions: {level: public})
@auth (rules: [
  {allow: groups, groups: ["Admin"]},
  {allow: owner},
  {allow: private, operations: [read]},
  {allow: public, operations: [read], provider: iam}
])
{
  id: ID!
  active: Boolean
}
```

Please note, I have enabled CRUD access to my GprahQL API for my lambda function. My AppSync auth methods are set to primary Cognitor User Pools and secondary IAM.

What am I doing wrong?
## Comment

---------------

Author: @eliecer2000

Hello, I think you need to add `create/update` to your `iam` rule.

` {allow: public, operations: [read, create, update], provider: iam}`
## Comment

---------------

Author: @robsaffi

Hi Eliecer,
Thank you for looking into this further. Where should I add that code to add create/update to my iam rule? Is that on the User model on my schema.graphql?

Thanks,
Rob

> On Apr 19, 2022, at 12:45 PM, Eliecer Rangel ***@***.***> wrote:
> 
> 
> Hello, I think you need to add create/update to your iam rule.
> 
> {allow: public, operations: [read, create, update], provider: iam}
> 
> —
> Reply to this email directly, view it on GitHub <https://github.com/aws-amplify/amplify-js/discussions/7854#discussioncomment-2594783>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/AIQWYA5MEVW3QEIXFFCCR2LVF3PJ3ANCNFSM4YPGNFZQ>.
> You are receiving this because you commented.
> 

## Comment

---------------

Author: @robsaffi

Thank you for clarifying that. Unfortunately, I’m getting the same result, even with that additional auth rule.

When I create a new User, the “owner” field is still not automatically filled with the logged in cognito user name, as it does when I create a user through the iOS Amplify CreateUser function.

Anything else I should be doing to make sure the user name is passed to the GraphQL API to fill that value?

Thanks,
Rob

> On Apr 19, 2022, at 1:36 PM, Eliecer Rangel ***@***.***> wrote:
> 
> 
> If you have to place it in your model, it should be like this.
> 
> type Todo
> @model(subscriptions: {level: public})
> @auth (rules: [
>   {allow: groups, groups: ["Admin"]},
>   {allow: owner},
>   {allow: private, operations: [read]},
>   {allow: public, operations: [read, create, update], provider: iam}
> ])
> {
>   id: ID!
>   active: Boolean
> }
> Sorry for not being more specific.
> 
> —
> Reply to this email directly, view it on GitHub <https://github.com/aws-amplify/amplify-js/discussions/7854#discussioncomment-2595134>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/AIQWYAYJOTSKEWBQTQACG33VF3VIFANCNFSM4YPGNFZQ>.
> You are receiving this because you commented.
> 


---------------

---------------

# can amazon-cognito be used strictly in the backend?

---------------

Author: @solomolo1
Upvotes: 1
Comments: 2

Hi all, 

I am just trying to implement cognito in my app, specifically using the `amazon-cognito-identity-js` library. I managed to set up cognito (including sign up, login, change password, sign out) strictly in the backend (nodejs/express). And when I log in on my front end, I am able to do so successfully and the session persists across pages, even though I am never passing `localstorage` cognito tokens to the backend and I am never storing any of the tokens in the frontend either (obviously because `localstorage` doesn't exist in the backend).Is this happening because all of the session data is stored server side? So Cognito is able to recognize the session purely in the backend as I have implemented it? Is this a good approach to follow? 

Any help is greatly appreciated. Thanks so much!
## Comment

---------------

Author: @achinthaprem

Hi,

I know I'm late to the discussion.

I also have an application with the `amazon-cognito-identity-js` library in a node js backend. There was no issue until we were going to implement TOTP MFA. The issue arises when you have to make 2 requests (1st to obtain the QR code data and 2nd to verify the TOTP code) to set up MFA initially for a user. The library can't preserve the session between the 2 requests and cannot set up MFA and throws NotAuthorizedException.
## Comment

---------------

Author: @rain89146

So, I just discovered it today, they are using a variable to cache the result in the backend, which means if u have two client browsers open side by side, once u logged in one, and the other one becomes logged in as well. I even tried it on different types of browsers. I also tried on custom storage class, but no luck from there too. I guess aws-sdk is still a better solution.

---------------

---------------

# SSG CI/CD nextjs deployement on Amplify

---------------

Author: @Datascientistzxcv
Upvotes: 1
Comments: 0

I am trying to deploy SSG nextjs application on Amplify all stages passing successfully when i tried to open the URL getting 404 error 
do i need to include any rewrite rules

this is the amplify.yml file
![image](https://user-images.githubusercontent.com/55860087/194743618-5f83b991-fba9-4e4d-a867-48b9300b06ec.png)

getting this error after deployment
![image](https://user-images.githubusercontent.com/55860087/194743585-b41c553e-c60f-48de-a173-857edf1bd5cf.png)

---------------

---------------

# Amplify GraphQL No Crendentials Error in NextJs Application

---------------

Author: @anni1236012
Upvotes: 1
Comments: 0

NextJs Application is working perfectly fine locally but after pushing the fronted to AWS I'm getting the run time error  **No Credentials** in _**callback.js**_ api 


No Build time error so I assume aws-exports.js file is built correctly during the build but I don't know if it is built with the required details like API key on AWS. 

I have already tried multiple suggestions like disable Analytics: true  as suggested in couple of other discussions but none of them worked for me. Build my project multiple times from scratch by re-installing all the dependencies but no luck. 

**callback.js API**
```
import { API, graphqlOperation } from 'aws-amplify';
import {getAuth} from "../../../../src/graphql/queries"
import {createAuth} from "../../../../src/graphql/mutations"

export default async function callback(req, res) {
      const record = await API.graphql(graphqlOperation(getAuth, {emailId: "abc@gmail.com"}))
      res.status(200).json({ record });
}
```
**aws-exports.js**
```
/* eslint-disable */
// WARNING: DO NOT EDIT. This file is automatically generated by AWS Amplify. It will be overwritten.

const awsmobile = {
    "aws_project_region": "us-east-1",
    "aws_appsync_graphqlEndpoint": "https://dummyUrl.appsync-api.us-east-1.amazonaws.com/graphql",
    "aws_appsync_region": "us-east-1",
    "aws_appsync_authenticationType": "API_KEY",
    "aws_appsync_apiKey": "da2-************"
};

export default awsmobile;
```

**_app.js**
```

import {Amplify} from 'aws-amplify';
import config from "../aws-exports"
Amplify.configure(config)

function MyApp({ Component, pageProps: { session, ...pageProps } }) {
 // App logic

})

```

**GraphQL Schema**
```
type Auth @model @auth(rules: [{ allow: public }])  {
  emailId: ID! @primaryKey
  name: String
  screen_name: String
  profile_img: String
  userSession: String
  tokenType: String
  accessToken: String
  accessSecret: String
  refreshToken: String
  accessScope: String
}
```


**Package.json**
```
"dependencies": {
    "@emoji-mart/data": "^1.0.6",
    "@emoji-mart/react": "^1.0.1",
    "aes256": "^1.1.0",
    "aws-amplify": "^4.3.37",
    "emoji-mart": "^5.2.2",
    "formidable": "^2.0.1",
    "js-cookie": "^3.0.1",
    "next": "12.3.1",
    "react": "18.2.0",
    "react-datepicker": "^4.8.0",
    "react-dom": "18.2.0",
  },
```
Amplify.yml 
```
version: 1
backend:
  phases:
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - yarn install
    build:
      commands:
        - yarn run build
  
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*

```

---------------

---------------

# Use normal Lamdba instead of Lambda@Edge

---------------

Author: @mlag
Upvotes: 2
Comments: 0

I'm using NextJS. My understanding is that all requests to /api/* go to Lambda@Edge functions. Is it possible to disable Lambda@Edge and host all lambda functions in a single region?
Our database is hosted in us-east-1. When a Lambda@Edge function is invoked in Japan there are a lot of lengthy roundtrips to the database.

---------------

---------------

# amplify cli always detects changes on amplify push

---------------

Author: @RoyalBis
Upvotes: 2
Comments: 0

I have an amplify project with a graphql API. When using the cli command, `amplify push`, changes are always detected for the API and force a build and redeploy to the console.

This occurs when issuing two `amplify push` commands back to back. 
Changes are **not** detected with the following commands:

`amplify status`
`amplify api push`

In these events, no change is detected as expected. It seems during the amplify push command something specific is causing it to appear that the API has been updated.
 

---------------

---------------

# Jest warning: No navigator object available to get browser client info

---------------

Author: @ZRunner
Upvotes: 2
Comments: 1

Hello there!

I'm trying to implement Jest tests on my React Native app, and I successfully did, but I noticed Amplify keeps warning me about this missing navigator object.

I guess this is kind of an expected behavior, as the tests run fine, and considering a Jest test environment has probably no browser available. But I would like to know if there is any way to silent this warning, or fix it if possible.

The full stack:
```console
  ● Console

    console.warn
      [WARN] 08:18.371 ClientDevice_Browser - No navigator object available to get browser client info

      at ConsoleLogger.apply [as _log] (node_modules/@aws-amplify/core/src/Logger/ConsoleLogger.ts:115:4)
      at ConsoleLogger.warn (node_modules/@aws-amplify/core/src/Logger/ConsoleLogger.ts:164:12)
      at browserClientInfo (node_modules/@aws-amplify/core/src/ClientDevice/browser.ts:33:10)
      at Object.browser_1 [as clientInfo] (node_modules/@aws-amplify/core/src/ClientDevice/browser.ts:22:9)
      at Function.clientInfo (node_modules/@aws-amplify/core/src/ClientDevice/index.ts:18:10)
      at new AWSPinpointProvider (node_modules/@aws-amplify/analytics/src/Providers/AWSPinpointProvider.ts:96:35)
      at AnalyticsClass.configure (node_modules/@aws-amplify/analytics/src/Analytics.ts:129:22)
      at AmplifyClass.register (node_modules/@aws-amplify/core/src/Amplify.ts:50:8)
```

I'm using React Native 0.68.2, jest 27.5.1, and aws-amplify 4.3.26, if that matters.
## Comment

---------------

Author: @jacobi85

hey, yes I encountered the same I solved it by mocking the Navigator and the ClientDevice_browser inside my jest.setup.js file likeso:

```
global.navigator = {
  ClientDevice_Browser: jest.fn().mockImplementation(() => Promise.resolve()),
};
```

---------------

---------------

# What's the correct way to respond to challenge with the name 'PASSWORD_VERIFIER' ?

---------------

Author: @aalok05
Upvotes: 6
Comments: 1

Upon doing _Auth.signIn_ , I am getting a challenge in response with challengeName 'PASSWORD_VERIFIER'. I was wondering what's the correct way to respond to this challenge. 
I've looked at the amplify-js docs but couldn't find the answer.

Please note that I also need to check if MFA is enabled and handle that in the code.

Thanks in advance!
## Comment

---------------

Author: @cristianCeamatuAssist

I am facing the same issue, poorly written documentation.

---------------

---------------

# Subscription UnauthorizedException warning on "update" of model. How to turn subscription off?

---------------

Author: @jdanielsyeah
Upvotes: 2
Comments: 1

I've recently updated my AWS Amplify front end (NextJS) to remove any subscriptions to a "Card" object that I've created in my schema.graphql file. For some reason I'm still getting warnings in my dev tools console telling me that there's a subscription problem concerning authorisation when performing "update" on the "Card" model. My best guess is that Datastore is still performing some kind of subscription function in the background, but I can't find any information to explain what's going on or how to act on the warning. Could anyone please help explain this one?

My schema.graphql showing the subscriptions should be turned off on Card:
```graphql
type Card
  @model(subscriptions: null) # Removed subscriptions
{...}
```
I used to have subscriptions set up in my javascript, but I have removed them too, eg:
```js
// I have deleted all code relating to subscriptions, such as the following:
  const subscription = DataStore.observe(Card).subscribe(() => fetchCards());
  return () => subscription.unsubscribe();
```

I get this warning message in my dev tools console:
```
DataStore - subscriptionError Connection failed: {
  "errors":[{
    "errorType":"UnauthorizedException",
    "message":"Permission denied"
   }
]}
```

Followed by this warning:
```
react_devtools_backend.js:4026 [WARN] 
39:46.202 DataStore 
{
  recoverySuggestion: 'Ensure app code is up to date, auth directives
  exist and are correct on each model, 
  and that server-side data has not been invalidated by a schema
  change. If the problem persists, search for or create an issue:
  https://github.com/aws-amplify/amplify-js/issues', 
  localModel: null, 
  message: 'Connection failed: 
    {
       "errors": [
         {
           "errorType":"UnauthorizedException", 
           "message":"Permission denied"
          }
        ]
}', 
  model: 'Card', operation: 'Update', 
…}
```
## Comment

---------------

Author: @duranmla

A floating comment from my side _(any guarantee this will solve the issue)_. 
I know that people is coming out from `@model(subscriptions: null)` to actually `@model(subscriptions: { level: off })`. Nonetheless, I face the same issue than you and I couldn't make it work.

Also be aware of things like this https://github.com/aws-amplify/amplify-cli/issues/7033#issuecomment-840874802 maybe not your case tho but you are not sharing the schema.

---------------

---------------

# Navigating back to the "Sign in as a different user" hosted page causes authentication issues

---------------

Author: @enrico-calzavara
Upvotes: 1
Comments: 0

Hi, 

I have an application that is using amplify and Cognito Hosted UI. Users land on the application and are redirected to the hosted ui page calling `Auth.federatedSignIn()`. After a successful sign in, they are redirected on the application and everything works correctly, with amplify calling the endpoint `oauth2/token` and successfully retrieving the token. 

At this point, if a user hits the browser back button, the browser navigates back on the hosted ui page, which now prompts the "_sign in as a different user_" action, detecting that a user is already signed in. 
Now, if the user choose to sign in as a different user, the user is redirected to the hosted sign in form, as before. But this time, when the user signs in and is redirected on the application, the call to the `oauth2/token` endpoint fails with an `invalid_request` error because the request is missing the `code_verifier` parameter. 

After a bit of debugging, I noticed that in the normal flow of events (my landing page -> hosted ui -> application) when the `Auth.federatedSignIn()` method is called to navigate on the hosted ui, it generates the data that is later used to value the `code_verifier` parameter. But when navigating back to the hosted ui page, that method is not called and the `code_verifier` data is not generated.

While debugging, I also realised that the "_sign in as a different user_" action implies a call to the `logout` endpoint (which then causes a redirection to the sign in page). The call to the the `logout` endpoint contains a `redirect_uri` containing the url of my landing page, but in this phase it's kind of not taken into account.

So, the question is: is there some right way to manage this kind of case, with a back navigation to the "_sign is as a different user_" page? I noticed, in the [logout endpoint documentation](https://docs.aws.amazon.com/cognito/latest/developerguide/logout-endpoint.html), that there's a `logout_uri` parameter that can be used to specify a location to redirect users after a sign out. But when the hosted page is loaded, the "_sign in as a different user_" action is pre-built with just a `redirect_uri` parameter. Is there a way to specify somewhere this parameter? In this way I could, for example, restart the normal flow from my application.

Thanks to everyone!

---------------

---------------

# how to stop getSession to update token when idToken is expire ( refreshSession ???)

---------------

Author: @Nut41tank
Upvotes: 1
Comments: 0

docs -> https://www.npmjs.com/package/amazon-cognito-identity-js
i'm try to implement cognito with react typescript but getSession will update my idToken when it expire but I think is should not because **in docs it said you should update local storage token with refreshSession** 

---------------

---------------

# amplify update function for Environment variable

---------------

Author: @anthony-dupont
Upvotes: 1
Comments: 0

When I add a new environment variable, we have fill in a value. 
However, it is not saved as a default value in cloudFormation which make fail the build on a different environment.
Is there a way to also put a default value from the CLI. At the moment the only way to make the build pass is to add default value manually in cloudformation file. 

---------------

---------------

# Join tables

---------------

Author: @progenaut
Upvotes: 1
Comments: 0

How to join tables in amplify?
I mean if i have

type Car @model {
  id: ID!
  name: String!
  wheels: [Wheel] @hasMany
}

type Tractor @model {
  id: ID!
  name: String!
  wheels: [Wheel] @hasMany
}

type Wheel @model {
    id: ID!
    refId: ID! (ref to car or tractor)
    pressure: String!
}

Is this somehow possible?

---------------

---------------

# Amplify Push Single Function

---------------

Author: @ErykAttoua
Upvotes: 1
Comments: 0

Is it possible to push a single function?

If so, how?
If not, is this a planned feature? 

This would be really useful! 

---------------

---------------

# TypeError: stream.pipe is not a function on Electron

---------------

Author: @vincent911001
Upvotes: 6
Comments: 0

Hi,

I have encountered error of `TypeError: stream.pipe is not a function` in Electron based application with the following codes:
```
  useEffect(() => {
    Storage.list("")
      .then((result) => console.log(result))
      .catch((error) => {
        console.log(error);
      });
  }, []);
```
FYI, I did try to do the same in a normal react web application and it did work without any error.
Thus, I would like to ask is there is any way around Electron to fix the error.

I believe it is related to [https://github.com/aws-amplify/amplify-js/issues/5504](https://github.com/aws-amplify/amplify-js/issues/5504) but since Electron is not just NodeJS, there might be solution for this error?

FYI, I am using React + Electron.
Besides, `Storage.put()` does work but still bumped into the very same error but it does not affect the file from being uploaded. Thus, S3 configuration is working.

Thanks,
Vincent

---------------

---------------

# Passing CustomState in withAuthenticator

---------------

Author: @aliwaqar981
Upvotes: 1
Comments: 0

Is it possible to pass customState to withAuthenticator? 
I wants to get some information after authentication and getting redirected back to my application. I'm using withAuthenticator HOC to do google social login which is working fine but I'm not sure how can I pass any information which I can retrieve later after redirection.

What I'm doing:
`export default withAuthenticator(App, {
  socialProviders: SocialProviders,
  variation: 'default'
});`

What I want to achieve:
`export default withAuthenticator(App, {
  socialProviders: SocialProviders,
  variation: 'default',
  state: {
  domainName: 'donna'
  }
});`

---------------

---------------

# -

---------------

Author: @
Upvotes: 1
Comments: 0

-

---------------

---------------

# It is possible to filter by multiple ids on AppSync?

---------------

Author: @duranmla
Upvotes: 2
Comments: 0

I have a model like:

```graphql
type Post
  @model
  @auth(
    rules: [
      { allow: public, operations: [read], provider: apiKey }
      { allow: private, operations: [read] }
      { allow: owner }
      {
        allow: groups
        groups: ["Admins"]
        operations: [read, create, update, delete]
      }
    ]
  ) {
  id: ID!
  owner: String
    @auth(
      rules: [
        { allow: owner, operations: [read, delete] }
        { allow: public, operations: [read], provider: apiKey }
      ]
    )
  url: String
  openGraphData: AWSJSON
  image: String
  content: String!
  authorID: ID! @index(name: "byParticipant")
  author: Participant @belongsTo(fields: ["authorID"])
  projectID: ID! @index(name: "byProject")
  project: Project! @belongsTo(fields: ["projectID"])
  totalLove: Int @default(value: "0")
  totalCred: Int @default(value: "0")
}
```

I want to be able to query this by `projectID` using DataStore I am not able to do it cause `projectID` is not on the model, and using AppSync I can do it but with a single ID like:

```graphql
query listPostsByProject {
  listPosts(filter: {projectID: {eq: "<id>"}}) {
    items {
      id
      content
      projectID
    }
  }
}
```

It is no way for me to do this?

---------------

---------------

# Amplify DataStore multi-auth not working as expected

---------------

Author: @duranmla
Upvotes: 4
Comments: 0

I am trying to get public access to my records and update/create/delete only for authenticated users using DataStore and Multi auth configured, nonetheless, DataStore always seems to use **only the default auth mode**.

> _I created an issue with more information https://github.com/aws-amplify/amplify-cli/issues/11068 just because I wasn't familiarised with Github discussions (sorry about it)_

This is a fundamental feature of dataStore so I bet I am doing something wrong but not sure what.

```graphql
type Project
  @model
  @auth(
    rules: [
      { allow: private }
      { allow: public, operations: [read], provider: apiKey }
    ]
  ) {
  id: ID!
  name: String!
  description: String!
  location: String!
  problem: String!
  solution: String!
  launchPlan: String!
  status: ProjectStatus! @default(value: "DRAFT")
  tags: [Tag] @manyToMany(relationName: "ProjectTagConnection")
  organisers: [Organiser] @manyToMany(relationName: "ProjectOrganiserConnection")
  participants: [Participant]
    @manyToMany(relationName: "ProjectParticipantConnection")
  posts: [Post] @hasMany(indexName: "byProject", fields: ["id"])
}
```

I can read the projects as guest and authenticated user but I cannot create them as it fails with _Unauthorized_

---------------

---------------

# oAuthSignOut triggered on tokenRefresh_failure

---------------

Author: @dreamfalcon
Upvotes: 2
Comments: 1

Hi,
In  part of my application I just want to know if some user is logged or not. Without asking to login if not.
But if the refresh token has expire, Amplify automatically redirects the user to logout when trying to use currentAuthenticatedUser, currentSession, currentUserInfo or currentUserPoolUser.
How could I avoid that?


```
async loadUser() {
    try {
      const userCognito = await Auth.currentAuthenticatedUser({
        bypassCache: false, // Optional, By default is false. If set to true, this call will send a request to Cognito to get the latest user data
      });
      return currentUserPoolUser;
    } catch (err) {
      return undefined;
    }
```


Thx
## Comment

---------------

Author: @jzybert

I am also seeing this same issue in my application. @dreamfalcon were you able to figure out how to fix this?

---------------

---------------

# Is there a need for local DB or global State Management when using Datastore in React Native?

---------------

Author: @amirmishani
Upvotes: 1
Comments: 0

I have a general usage question about Datastore in React Native. Is Datastore supposed to replace Local DB or State Management or both or neither? The reason I ask this is because in the "React Native" fullstack todo tutorial within the Amplify docs, Datastore is used without a local DB or any global state management. 

It makes me wonder if there's legit use for say LiteSQL or Redux in combination with Datastore? 

---------------

---------------

# Delete items from DynamoDB with REST API and Lamba

---------------

Author: @HerrNerdstromDRK
Upvotes: 1
Comments: 1

Hi,

I'm building a simple inventory management system for a project with Amplify DynamoDB, REST, and React. I followed various tutorials online, and so far get() (GET), create() (POST), and update() (POST) work fine. However, I can't seem to figure out how to delete an item from the database from my NodeJS/Javascript application. I've tried numerous permutations of the paths, and also tried using PartiQL, but to no avail.

Could someone please assist? Thanks!

Here's hopefully all of the relevant code:

Each inventory item contains the following:

```
id: string: Unique identifier built using uuidv4 and serves as the partition key (no sort key included)
name: string: Name of the item
description: string: Description of the item
createdAt: string: Date when item was created
createdBy: string: Human readable username of creator
userId: string: Cognito username of the creator (managed by Amplify Auth)
```

```
const apiName = "imsapi";
const apiDirectory = "/items";

  async function fetchInventoryItems() {
    //    console.log("fetchInventoryItems");

    const inventoryItemsFromAPI = await API.get(apiName, apiDirectory + "/id");

    setInventoryItems(
      inventoryItemsFromAPI.filter(
        (item) => item.name !== "" && item.description !== ""
      )
    );
    console.log(
      "fetchInventoryItems> JSON.stringify( apiData ):  " +
        JSON.stringify(inventoryItemsFromAPI)
    );
  }

async function createInventoryItem() {
    console.log(
      "createInventoryItem> name: " +
        inventoryItemFormData.name +
        ", description: " +
        inventoryItemFormData.description
    );

    // Ignore request if the inventoryFormData tracking variables are empty.
    if (!inventoryItemFormData.name || !inventoryItemFormData.description) {
      console.log("createInventoryItem> Blank name or description");
      return;
    }

    const restData = {
      id: uuidv4(),
      name: inventoryItemFormData.name,
      description: inventoryItemFormData.description,
      quantity: inventoryItemFormData.quantity,
      createdBy: user.getUsername(),
      createdAt: new Date().toISOString(),
    };

    await API.post(apiName, apiDirectory, {
      body: restData,
    })
      .then((result) => {
        console.log("createInventoryItem> result: " + JSON.stringify(result));
      })
      .catch((err) => {
        console.log("createInventoryItem> error: " + err);
      });

// Need help here
 async function deleteInventoryItem(inventoryItemToDelete) {
    if (
      !isAuthenticated() ||
      user.getUsername() !== inventoryItemToDelete.createdBy
    ) {
      console.log(
        "deleteInventoryItem> User " +
          user.getUsername() +
          " attempted to delete inventory item it doesn't own: " +
          JSON.stringify(inventoryItemToDelete)
      );
      return;
    }

    const params = {
      id: inventoryItemToDelete.id,
    };

    // Remove the inventory item from the database back
    await API.post(
      apiName,
      apiDirectory, 
      { body: params }
    )
      .then((result) => {
        // console.log("deleteInventoryItem> result: " + JSON.stringify(result));
      })
      .catch((err) => {
        //  console.log("deleteInventoryItem> error: " + JSON.stringify(err));
      });
}
```

## Comment

---------------

Author: @tannerabread

Have you tried using API.del instead of API.post?

https://aws-amplify.github.io/amplify-js/api/classes/apiclass.html#del

---------------

---------------

# AWS Lambda end of support for Node.js 12

---------------

Author: @funes79
Upvotes: 1
Comments: 1

AWS Amplify deployed Auth Lambda with Nodejs12, I ugpraded the amplify to version 10 but the Lambda is using still a deprecated runtime env. How should I proceeed to upgrade the Lambda runtime?
Thanks
## Comment

---------------

Author: @abdallahshaban557

Hi @funes79 - Here is a workaround for you until we can get this baked into our CLI https://github.com/aws-amplify/amplify-cli/issues/10894#issuecomment-1251564540

---------------

---------------

# Conditional withAuthenticator?

---------------

Author: @phstc
Upvotes: 1
Comments: 1

Most of my pages require authentication, but one page can be accessed by authenticated and non-authenticated users.

For example, `/record/{id}`  for authenticated users, I would show the user logo at the top (from the shared layout) and an editing menu. For non-authenticated users, I would show the record as read-only.

I want to use the same URL `/record/{id}` so users can simply copy and share. 

What would be the best step for implementing that? I'm currently using `withAuthenticator(App)`, and I couldn't find a way to make it customizable. 

I also considered creating a separated "app" and serve `/public/record/{id}` but that would introduce some complexity and potential duplication.

I want to keep the Amplify experience where Amplify automatically shows the login modal for non-authenticated users for the pages requiring authentication.

Summary of the wants (if possible): 

* Single page that can be accessed by authenticated and non-authenticated users
* All other pages require authenticated users
* Use Amplify goodness to handle showing a modal for sign-in and sign up
* Base layout page expects logged-in users, so there will be a need for `if logged in user then show this top menu with the user photo otherwise show a sign in/up link`
* Preferable to use the same URL for both experiences
## Comment

---------------

Author: @funes79

If you really want to have it public then I would suggest to remove the withAuthenticator and I think you should just test if the user is authenticated and if yes, show the edit button, if not show it disabled.
```
      const authUser = await Auth.currentAuthenticatedUser();
      console.log('identityId', authUser);
      if (authUser !== null && authUser !== undefined) {
      }
```
The access to the data is any way protected I assume by your GraphQL schema where you define if the rule that only authenticated users can create/update/read records.

---------------

---------------

# End of life Node12 AWS Lambda

---------------

Author: @funes79
Upvotes: 4
Comments: 0

Amplify created an authTrigger Lambda function with NodeJs 12.x runtime, but AWS deprecated this:

We are ending support for Node.js 12 in AWS Lambda. This follows Node.js 12 End-Of-Life (EOL) reached on April 30, 2022 [1].

I have upgraded amplify to version 10, and pushed the project, but the Lambda is still using the old runtime.

How to upgrade?

---------------

---------------

# How to bypass Cognito Hosted UI with OAuth consent screen social login In-App browser

---------------

Author: @Joshig99
Upvotes: 2
Comments: 2

Hi,
How to take user to **OAuth consent screen** directly instead of **Cognito Hosted UI** when call the **Auth.federatedSignIn()**

My Code

 `
                                                                                                                                                                                                                                 
    async function urlOpener(url, redirectUrl) 

    {
         await InAppBrowser.isAvailable();
         await InAppBrowser.closeAuth();
         const { type, url: newUrl } = await InAppBrowser.openAuth(url, redirectUrl, {
         showTitle: false,
         enableUrlBarHiding: true,
         enableDefaultShare: false,
         ephemeralWebSession: true,
          });

      if (type === 'success') {
      Linking.openURL(newUrl);
      }
    }
    Amplify.configure({
      ...config,
       oauth: {
         ...config.oauth,
         urlOpener
     }
    })
`

`
const onGoogleLogin = () => {
    Auth.federatedSignIn();
  };
`

When i call the **onGoogleLogin** function it taking user to Cognito Hosted UI but i have custom ui buttons for social login in my app, i want to take user to OAuth Consent Screen when user click on that button 

![Screen Shot 2022-04-13 at 7 15 28 PM](https://user-images.githubusercontent.com/46310246/163194502-01641fec-e4dc-490d-b2c0-3617fa73ec7a.png)

![Screen Shot 2022-04-13 at 7 21 50 PM](https://user-images.githubusercontent.com/46310246/163195780-3242e3e2-58b5-48a5-b940-877544809d34.png)


After clicking Continue with Google then it takes me to Oauth Consent screen

![Screen Shot 2022-04-13 at 7 23 53 PM](https://user-images.githubusercontent.com/46310246/163196188-6bb0cbd7-97de-43ed-8a99-b828f3727e99.png)


Please help me on this
## Comment

---------------

Author: @roryf

I think you should pass options to the `federatedSignIn` call:
```ts
Auth.federatedSignIn({ provider: 'Google' })
```
TypeScript couldn't match the `Google` string for some reason in my editor, so I changed it to
```ts
import { Auth, CognitoHostedUIIdentityProvider } from '@aws-amplify/auth'

Auth.federatedSignIn({ provider: CognitoHostedUIIdentityProvider.Google })
```
## Comment

---------------

Author: @dariodor

As specified [here](https://docs.aws.amazon.com/cognito/latest/developerguide/authorization-endpoint.html#get-authorize-request-parameters) you can bypass Cognito Hosted UI for SAML 2.0 and OIDC providers by using the name that you assigned to the identity provider in your user pool.
`Auth.federatedSignIn({ provider: 'MyIdentityProviderName' })`

![Screenshot from 2022-09-16 16-57-53](https://user-images.githubusercontent.com/8624307/190669468-fa29aaa8-5cd3-4e96-ba68-197a01d0a0a0.png)

---------------

---------------

# Angular routing issue

---------------

Author: @mahejbinm
Upvotes: 1
Comments: 0

I made angular application. all is happened good but if I try open new window at that time it is not displaying but I get "404 not found".
how to solve it

---------------

---------------

# How to Cypress test Amplify login that requires a TOTP code

---------------

Author: @anastasialanz
Upvotes: 3
Comments: 3

I've been working on a Cypress test to login to my app that requires a TOTP code. I have a test user and password in Cognito and I'm following similar steps to what is in this guide: [Running end-to-end Cypress tests for your fullstack CI/CD deployment with Amplify Console](https://aws.amazon.com/blogs/mobile/running-end-to-end-cypress-tests-for-your-fullstack-ci-cd-deployment-with-amplify-console/). This guide doesn't include a user that has Multi-Factor Authentication turned on. 

Has anyone had experience with creating a valid TOTP code in their end to end tests? I was hoping that I could make use of https://www.npmjs.com/package/totp-generator and `cy.wait` for the xhr response, but I'm not sure what part of the response is used to be able to generate the TOTP token.
## Comment

---------------

Author: @jordanranz

Hey @anastasialanz,

I have a little bit of experience looking into testing this particular use case with Cypress. Could you explain specifically how you are using Amplify (Auth API or UI Component)? Also which response are you referring to:
> I'm not sure what part of the response is used to be able to generate the TOTP token.

I personally haven't tried this module but I am interested to check it out: https://www.npmjs.com/package/cypress-otp

also here is an interesting thread related to QR codes/TOTP: https://github.com/cypress-io/cypress/issues/4929
## Comment

---------------

Author: @pimmee

I'm myself looking for a solid solution, but here's what I'm doing atm.

1. I created an `e2e@mydomain.com` user and logged the TOTP secret so I could use it in tests.

```ts
Auth.setupTOTP(user).then(secret => {console.log(secret)})
```

2. Added the following cypress command with retry mechanism.  (offset is used to avoid "already used" cognito errors when running multiple tests):

```ts
import { authenticator } from 'otplib';
import { Amplify, Auth } from 'aws-amplify';

Amplify.configure(Cypress.env('amplifyConfig'));

export function generateOTP(secret: string, offset = 0) {
  if (offset === 0) {
    return authenticator.generate(secret);
  }
  const allOptions = authenticator.allOptions();
  const delta = allOptions.step * 1000;
  authenticator.options = { epoch: Date.now() + offset * delta };
  const offsetToken = authenticator.generate(secret);
  authenticator.resetOptions();
  return offsetToken;
}

Cypress.Commands.add('loginByCognitoApi', (email: string, password: string) => {
  const log = Cypress.log({
    displayName: 'COGNITO LOGIN',
    message: [`🔐 Authenticating | ${email} `],
    autoEnd: false,
  });

  log.snapshot('before');

  const signIn = Auth.signIn({ username: email, password });

  cy.wrap(signIn, { log: false } )
    .then(async user => {
      // This retry logic seems to be kind of flaky
      let offset = 0;
      while (offset < 10) {
        try {
          const challengeSecret = 'OKBS5BUYW2FD32JASDQWLIVC5TNW7V3UZQZTG5OFVSFALQMK4LA';
          const code = generateOTP(challengeSecret, offset++);
          const result = await Auth.confirmSignIn(user, code, 'SOFTWARE_TOKEN_MFA');
          return result;
        } catch {}
      }
    })
    .then((cognitoResponse: any) => {
      const prefix = `${cognitoResponse.keyPrefix}.${cognitoResponse.username}`;
      const { idToken, accessToken, refreshToken, clockDrift } = cognitoResponse.signInUserSession;

      localStorage.setItem(`${prefix}.idToken`, idToken.jwtToken);
      localStorage.setItem(`${prefix}.accessToken`, accessToken.jwtToken);
      localStorage.setItem(`${prefix}.refreshToken`, refreshToken.token);
      localStorage.setItem(`${prefix}.clockDrift`, clockDrift);
      localStorage.setItem(`${cognitoResponse.keyPrefix}.LastAuthUser`, cognitoResponse.username);
      localStorage.setItem('amplify-signin-with-hostedUI', 'false');
      log.snapshot('after');
      log.end();
    });
});
```

3. You can then use it like so: 

```ts
  before(() => {
    cy.loginByCognitoApi(E2E_USER.email, E2E_USER.password);
    cy.visit('/');
  });
```

If anyone has a less flaky solution for signing in with amplify using TOTP in Cypress I'd like to see it also.
## Comment

---------------

Author: @senkevich33n

retry logic improvements
```
         .then(async (user) => {
            let keepTrying = true;
            let offset = 0;
            while (offset < 10 && keepTrying) {
                 try {
                    keepTrying = false;
                    return await Auth.confirmSignIn(user, generateOTP(secret, offset++), 'SOFTWARE_TOKEN_MFA');
                } catch (error) {
                    keepTrying = true;
                }
            }
        })
```

---------------

---------------

# Pass custom attribute to Federated Signin

---------------

Author: @nick-0101
Upvotes: 7
Comments: 1

I'm opening a disscusion as this issue as a continuation of issue #6913 that, like many other issues in this repo, were closed for no reason. There still doesn't seem to be a way to pass custom attributes to federated sign in.

For example, the current way to authenticate with google is: 
`Auth.federatedSignIn({ provider: "Google" })`

However, what if I wanted to pass the users preferred locale: 
```
Auth.federatedSignIn({
  provider: "Google",
  attributes: {
    locale: currentLocale
  }
});
```

Is there a way to do this?
## Comment

---------------

Author: @mikejackowski

Would be great to get this

---------------

---------------

# API working locally but nothing in server

---------------

Author: @balramxyadav
Upvotes: 1
Comments: 1

Hi, I am new amplify and i am sending a post request to the endpoint and it is giving a status of 200 but nothing happens. I have tried to run this locally ( by cd into src folder then running "node app.js" ) and it works and don't know why this isn't working in server  please help
## Comment

---------------

Author: @abdallahshaban557

Hi @balramxyadav - Can you please submit a Github issue using this [link](https://github.com/aws-amplify/amplify-js/issues/new?assignees=&labels=&template=1.bug_report.yaml). We need more information from you to be able to debug this. Another thing you can do is use our discord server to speak to see if someone from our community can help you out! https://discord.gg/5Uw8M9CW

---------------

---------------

# How to pre populate email field in Authenticator?

---------------

Author: @giulioambrogi
Upvotes: 2
Comments: 1

# What

I can't figure out how to pre populate the email field in Authenticator using the latest Amplify version, I could do that in older versions but I can't find this info in the docs.
Docs: https://ui.docs.amplify.aws/components/authenticator?platform=react 

# Desired behaviour

When the page loads I want to pre populate the Email field with a value I pass in. 


<img width="576" alt="Screenshot 2022-02-05 at 08 52 50" src="https://user-images.githubusercontent.com/11599158/152635203-d034c1b0-b265-46d6-925c-1b27a3c2689f.png">

# My code

```
<Authenticator
        initialState={initialAuthState}
        components={{
          SignUp: {
            FormFields() {
              const { validationErrors } = useAuthenticator();
  
              return (
                <>
                <Authenticator.SignUp.FormFields />
                </> 
              );
            },
          },
        }}
      />
  ```

My amplify versions:
```
    "@aws-amplify/api": "^4.0.32",
    "@aws-amplify/auth": "^4.4.1",
    "@aws-amplify/core": "^4.3.14",
    "@aws-amplify/storage": "^4.4.15",
    "@aws-amplify/ui-components": "^1.9.6",
    "@aws-amplify/ui-react": "^2.2.2",
 ```

Thanks in advance.
## Comment

---------------

Author: @bryanmorganoverbey

This worked for me:
React.useEffect(() => {
setTimeout(() => {
const input = document.querySelector('input[name="username"]');
if (input) {
input.setAttribute("value", "billybobthornton");
}
});
}, []);

---------------

---------------

# Is auth 4.6.* fine to use with core 4.7.*?

---------------

Author: @calderwoodra
Upvotes: 1
Comments: 1

Since we started using amplify (9 months ago) auth and core have maintained the same semver versions, but a few weeks ago core 4.7.0 was released while auth is still on 4.6.5.

Is it fine to upgrade to core 4.7.* or should I wait for auth 4.7 to be released as well? 
## Comment

---------------

Author: @abdallahshaban557

Hi @calderwoodra  - is there a reason you do not just use the @aws-amplify package rather than using core and Auth separately?

---------------

---------------

# Singleton Collection

---------------

Author: @sdandois
Upvotes: 1
Comments: 0

I have a collection that must have at most only one element. 

* What's the best way to make sure that the element is unique when editing?
* How do you query that element? 
* When creating the element, if there is one already presente I want to override it.

Currently I'm wiping out the collection with Predicates.ALL and then creating the element.

---------------

---------------

# DataStore is not syncing with DynamoDB

---------------

Author: @blairtaylor
Upvotes: 1
Comments: 0

My DataStore is not syncing with DynamoDB for some reason.

I've ready every issue on stackoverflow to see if I can find a resolution but no dice.
There are no errors.
Hub is showing the events firing.

Here is an example of the issue:

```
  try {
    const result = await DataStore.save(
      new Employer({
        name: 'Test Employer',
        rate: 123.45,
      }),
    )

    console.log('Employer saved successfully!')
    console.log(result)

    // const employer = await DataStore.query(Employer)
    // console.log('EMPLOYER = ')
    // console.log(employer)
  } catch (err) {
    console.log('ERROR: An error occurred during getEmployer')
    console.log('Error message was ' + JSON.stringify(err))
  }
```

DataStore nevers seems to sync with DynamoDB.
Other than that everything is fine. No issues. DataStore contains the correct data.

The only difference between my project and the code examples is that I have used Amplify Studio to build the data model and performed Amplify pull to update the project.

When I do an "amplify status" the API looks correct.

The aws-exports.js file seems to be correct.
It contains entries for Auth, API, Storage etc.
Auth is working correctly.

What am I missing? 

---------------

---------------

# Transcribe audio to text always returns {"err": "region not configured for transcription"}

---------------

Author: @raulgonzalezdev
Upvotes: 1
Comments: 0

Hello, Good Amplify community, it's a pleasure to be on this channel, I am new in the management of Amplify services I am testing the service with Predictions speechGenerator, but when I test the App generated in React-Native in the console I get an Error {"err": "region not configured for transcription"}, I have checked the microphone buffer and certainly generates data, I am testing only with the phrase "Hello Word", I have used the Basic configuration automatically generated by AWS Amplify. 

I will leave the fragments of my code, to see if it is a problem with the region where I created the Backend or something in my code that in theory is very simple.
`/* eslint-disable */
// WARNING: DO NOT EDIT. This file is automatically generated by AWS Amplify. It will be overwritten.

const awsmobile = {
    "aws_project_region": "us-east-1",
    "aws_cognito_identity_pool_id": "us-east-1:75f67dbf-*********//kkk/************",
    "aws_cognito_region": "us-east-1",
    "aws_user_pools_id": "us-east-1_*****/jjj/*******",
    "aws_user_pools_web_client_id": "*******/jjjjj**************",
    "oauth": {},
    "aws_cognito_username_attributes": [],
    "aws_cognito_social_providers": [],
    "aws_cognito_signup_attributes": [
        "EMAIL"
    ],
    "aws_cognito_mfa_configuration": "OFF",
    "aws_cognito_mfa_types": [
        "SMS"
    ],
    "aws_cognito_password_protection_settings": {
        "passwordPolicyMinLength": 8,
        "passwordPolicyCharacters": []
    },
    "aws_cognito_verification_mechanisms": [
        "EMAIL"
    ],
    "predictions": {
        "convert": {
            "speechGenerator": {
                "region": "us-east-1",
                "proxy": false,
                "defaults": {
                    "VoiceId": "Ricardo",
                    "LanguageCode": "en-US"
                }
            }
        }
    }
};


export default awsmobile;`


My Code in React-Native


`import React, {useState} from 'react';
import {
  View,
  Text,
  StyleSheet,
  TextInput,
  TouchableOpacity,
} from 'react-native';
import {Amplify} from 'aws-amplify';
import  {
    Predictions,  AmazonAIPredictionsProvider,
} from '@aws-amplify/predictions';
import awsconfig from '../../src/aws-exports';

import MicStream from 'react-native-microphone-stream';

// from https://github.com/aws-samples/amazon-transcribe-websocket-static/tree/master/lib


Amplify.configure(awsconfig);
Amplify.addPluggable(new AmazonAIPredictionsProvider());
const initialState = {name: '', description: ''};

global.Buffer = global.Buffer 

function VoiceCapture() {
  const [text, setText] = useState('');

  // from https://github.com/aws-samples/amazon-transcribe-websocket-static/tree/master/lib
  function pcmEncode(input) {
    let offset = 0;
    const buffer = new ArrayBuffer(input.length * 2);
    const view = new DataView(buffer);
    for (let i = 0; i < input.length; i++, offset += 2) {
      const s = Math.max(-1, Math.min(1, input[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  async function transcribe(bytes) {
    await Predictions.convert({
      transcription: {
        source: {
          bytes,
        },
        language: 'en-US',
      },
    })
      .then(({transcription: {fullText}}) => console.log({fullText}))
      .catch((err) => console.log({err}));
  }

  const listener = MicStream.addListener((data) => {
     console.log('Data:',data);

    // encode the mic input
    const pcmEncodedBuffer = pcmEncode(data);

    // // add the right JSON headers and structure to the message
    // let audioEventMessage = getAudioEventMessage(
    //   global.Buffer.from(pcmEncodedBuffer),
    // );

    // //convert the JSON object + headers into a binary event stream message
    // let binary = eventStreamMarshaller.marshall(audioEventMessage);

    // the docs say this takes a PCM Audio byte buffer, so i assume the wrappers above aren't necessary. Tried them anyways with no luck.
    // (https://docs.amplify.aws/lib/predictions/transcribe/q/platform/js#set-up-the-backend)
    transcribe(pcmEncodedBuffer);
  });

  function startTranscribing() {
    MicStream.init({
      bufferSize: 4096 * 32, // tried multiplying this buffer size to send longer  - still no luck
      // sampleRate: 44100,
      sampleRate: 16000,
      bitsPerChannel: 16,
      channelsPerFrame: 1,
    });

    MicStream.start();
    console.log('Started mic stream');
  }

  function stopTranscribing() {
    console.log('Stopped mic stream');
    MicStream.stop();
    listener.remove();
  }

  return (
    <View style={styles.container}>
      <View style={styles.horizontalView}>
        <TouchableOpacity
          style={styles.mediumButton}
          onPress={() => {
           // Voice.start('en_US');
            // transcribeAudio();
            startTranscribing();
          }}>
          <Text style={styles.mediumButtonText}>START</Text>
        </TouchableOpacity>

        <TouchableOpacity
          style={styles.mediumButton}
          onPress={() => {
            stopTranscribing();
          }}>
          <Text style={styles.mediumButtonText}>STOP</Text>
        </TouchableOpacity>
      </View>
      <TextInput
        style={styles.editableText}  multiline
        onChangeText={(editedText) => setText(editedText)}>
        {text}
      </TextInput>
    </View>
  );
}

const NewVoice = () => {
  return (
    <View style={styles.container}>
      <VoiceCapture />
    </View>
  );
};

export const colors = {
  primary: '#0049bd',
  white: '#ffffff',
};

export const padding = {
  sm: 8,
  md: 16,
  lg: 24,
  xl: 32,
};
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: 'white',
    padding: padding.lg,
  },
  bodyText: {
    fontSize: 16,
    height: 20,
    fontWeight: 'normal',
    fontStyle: 'normal',
  },
  mediumButtonText: {
    fontSize: 16,
    height: 20,
    fontWeight: 'normal',
    fontStyle: 'normal',
    color: colors.white,
  },
  smallBodyText: {
    fontSize: 14,
    height: 18,
    fontWeight: 'normal',
    fontStyle: 'normal',
  },
  mediumButton: {
    alignItems: 'center',
    justifyContent: 'center',
    width: 132,
    height: 48,
    padding: padding.md,
    margin: 14,
    backgroundColor: colors.primary,
    fontSize: 20,
    fontStyle: 'normal',
    elevation: 1,
    shadowOffset: {width: 1, height: 1},
    shadowOpacity: 0.2,
    shadowRadius: 2,
    borderRadius: 2,
  },
  editableText: {
    textAlign: 'left',
    textAlignVertical: 'top',
    borderColor: 'black',
    borderWidth: 2,
    padding: padding.md,
    margin: 14,
    flex: 5,
    fontSize: 16,
    height: 20,
  },
  horizontalView: {
    flex: 1,
    flexDirection: 'row',
    alignItems: 'stretch',
    justifyContent: 'center',
  },
});

export default NewVoice;

`

---------------

---------------

# Push Notification using AWS Lambda + SNS + Firebase FCM

---------------

Author: @jeffinhk
Upvotes: 1
Comments: 1

I am currently building an Instagram-like mobile app, where users upload a feed, press likes, comment, and reply. I am facing such questions regarding Push Notification:

When a user logs into my app, how will their device token be registered into AWS SNS endpoint through AWS LAMBDA? (I have succesfully manually updated to Dynamo DB, but I want them to automatically be updated to endpoint when notification authorization is granted).

When my Feed/Post receives 'likes' or 'comments', how should that be notified to the original poster (OP) ?

No need to answer both questions, and any opinions are highly appreciated in advance.

P.S. I'm using React Native and AWS Amplify, in fucntional component
## Comment

---------------

Author: @abdallahshaban557

Hi @jeffinhk - I am curious to hear why you are using SNS rather than using the push notifications category with AWS Amplify? We have support for it with React Native. https://docs.amplify.aws/lib/push-notifications/overview/q/platform/js/

---------------

---------------

# How to stop user from redirecting to callback URLs while login in with Facebook  in AWS Cognito

---------------

Author: @aliraza944
Upvotes: 2
Comments: 0

I am using AWS Cognito to log in with Facebook in react. The problem is that after successful login my web app redirects to the callback URL defined in the ***App Client Setting***.  <br/>
For example, if I am at the `http://localhost:3000/tools/` and the redirect callback URL is `http://localhost:3000/` the user will be redirected to the callback URL. I want the user to stay at my `https://localhost:3000/tools/` page.<br/>
I have a login modal that can be accessed from any page so after login the user should stay on the same page. 

---------------

---------------

# amplify import auth - Cognito user pool - aws-exports.js missing values?

---------------

Author: @petar-prog91
Upvotes: 1
Comments: 1

Hi everyone, 

I hope that you'll be able to help me out with this one as I'm banging my head whole day about this and no luck ... I've gone through so many docs and API pages and can't figure it out. Anyway here it goes:

We have an Amplify project that we started, all goes rather well, and we have to integrate federated auth with existing Cognito pool. Logically, we connected the Cognito pool to our Amplify app, and did `amplify import auth` and that part went okay, we see that Cognito pool is connected etc. Now here's the thing that's not really going well, and I can't figure out how to do it:

- In our Cognito pool we have App Client for which we want to use the Hosted UI for logging in (as Cognito is Auth with custom provider). Here's the screenshot (some values random) of Cognito App Client Hosted UI:
<img width="1354" alt="image" src="https://user-images.githubusercontent.com/4411896/186426100-eb97226d-c403-4e91-a6b1-c4f614138c34.png">

And here is the aws-exports.js file (again redacted, but some stuff left for reference):
<img width="1028" alt="image" src="https://user-images.githubusercontent.com/4411896/186426575-47188d3a-715a-40d7-91f4-f5201eaf48b4.png">

As you can see where I highlighted with arrow, oauth properties are missing completely, all of them except the domain ... If I add them manually like this, then FederatedSignIn works no problem:
<img width="723" alt="image" src="https://user-images.githubusercontent.com/4411896/186426906-b6467453-4422-49a5-910b-3a2543b2512b.png">

As this matches exactly the values from Cognito App Hosted UI properties, FederatedSignIn works ... 

Now here's the thing, what I've did is hardcoding / changing values into file that is not supposed to be manually changed. I'm wondering, what can be done to get these values properly populated based on the values that are in Cognito App Hosted UI, basically that I get in aws-exports.js exactly what I manually added, but being generated by Amplify CLI itself. 

Any ideas?
## Comment

---------------

Author: @abdallahshaban557

Hi @petar-prog91 - this appears to be an issue. Can you please submit an issue using this [link](https://github.com/aws-amplify/amplify-cli/issues/new?assignees=&labels=&template=1.bug_report.yaml) to the Amplify CLI repo?

---------------

---------------

# Is the Amplify React tutorial up-to-date?

---------------

Author: @pcanas
Upvotes: 1
Comments: 0

I have followed the [Connect API and database to the app](https://docs.amplify.aws/start/getting-started/data-model/q/integration/react/) section.
While the autogenerated files that appear in the tutorial are `graphql/queries` and `graphql/mutations` I have others (the ones appearing in the [Datastore JS page](https://docs.amplify.aws/lib/datastore/getting-started/q/platform/js/):
```
|_ models/
   |_ index.d.ts
   |_ index.js
   |_ schema.d.ts
   |_ schema.js
```
I was wondering if I am doing anything wrong or if this page is not up-to-date.

---------------

---------------

# How to pass clientMetaData to Lambda trigger when using federatedSignIn

---------------

Author: @jay3dec
Upvotes: 1
Comments: 0

I have a use case during Google Sign. I want to check if the user is signing from same ip address, hence during `federatedSignIn` I need to pass ip address as `clientMetaData`. Is it possible ?

`Auth.federatedSignIn({provider: CognitoHostedUIIdentityProvider.Google })`

I found a similar question [here](https://github.com/aws-amplify/amplify-js/issues/4662) but no solution has been concluded and the workaround doesn't apply to my case. 

---------------

---------------

# Checksums

---------------

Author: @AbdulmueezEmiola
Upvotes: 1
Comments: 0

In the AWS S3 documentation, It says It's possible to compute and store the checksum using `'x-amz-sdk-checksum-algorithm': 'SHA-256' ` . I have searched the amplify documentation on how this can be implemented, but I couldn't figure this out. Can someone point me in the right direction?

---------------

---------------

# Amplify forgot password API not flexible/bad user experience

---------------

Author: @thiagonsiq
Upvotes: 1
Comments: 1

Hi, 

We're using Cognito for the user pool used in our react native mobile application, along with the Amplify SDK for interaction with cognito. 

Implementing the Forgot Password workflow, we noticed that the Auth.forgotPasswordSubmit(username, code, new_password) forces customers to collect the verification code AND the new password in one step, and they must be submitted together.

This prevents the app designers from separating the verification of the code and the new password collection screens/actions. We cannot do this for instance:

- Send verification code to user's email
- Provide screen for user to input verification code
- Application makes call to a cognito "verifyCode" endpoint, which checks the code and returns true/false or whatever
- Then application can provide users with an input to provide new password
- Application submits new password to cognito

The way the API is written now, if the code ends up being incorrect, the user will need to type in a new code AND the password over again. Just a clunky user experience.

Is there a workaround to validate the code separately from saving the new password?

Thanks,
Thiago S.
## Comment

---------------

Author: @proevilz

You could just store the password they entered if the code came back as incorrect, and just autofill the password field. That way, the only job required of the user is to fill in the new code?

---------------

---------------

# Datastore functioning with a suspended app

---------------

Author: @cbirkenstock
Upvotes: 1
Comments: 0

I couldn't find a clear answer to this in the documentation, but I don't understand the exact way that AWS's datastore.query and real-time subscription service work in terms of a suspended app. Specifically, how do I trigger datastore to update the content when opening a suspended app (one that wasn't killed)?

I assume that if I open the app and it download three objects, and then kill it. If two more objects are added in the meantime and I open it up freshly again then it will do a delta query of the two new objects and add them right? But what happens if I close an app, but do not kill it, and then open it up again. How do I see those two new items that are added in the downtime? Do I have to depend on a subscription for this? Would that subscription not be killed when the app is suspended? Should I just call a Datastore.query every time the app is opened?

---------------

---------------

# How can I handle errors?

---------------

Author: @proevilz
Upvotes: 1
Comments: 0

If you consider the following code

```typescript 
  React.useEffect(() => {
    Auth.currentUserInfo()
      .then((data) => {
        if (data.username) {
          //do something with data
        }
      })
      .catch((error) => console.log('No logged in user'))
  }, [])
```

When I look in my console, I see all this with my console log mixed in.  
```
[ERROR] 14:14.682 AuthClass - No current user
at node_modules/@aws-amplify/core/lib-esm/Logger/ConsoleLogger.js:115:9 in prototype._log
at node_modules/@aws-amplify/core/lib-esm/Logger/ConsoleLogger.js:192:18 in <anonymous>
at node_modules/@aws-amplify/auth/lib-esm/Auth.js:2097:38 in user.confirmPassword$argument_2.onFailure

No logged in user
Error: ENOENT: no such file or directory, open '/Users/XXXXX/react-native-discord/http:/192.168.50.85:19000/node_modules/expo/AppEntry.bundle?platform=ios&dev=true&hot=false&strict=false&minify=false'
    at Object.openSync (node:fs:585:3)
    at Object.readFileSync (node:fs:453:35)
    at getCodeFrame (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:949:18)
    at Server._symbolicate (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:1022:22)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at Server._processRequest (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:429:7) {
  errno: -2,
  syscall: 'open',
  code: 'ENOENT',
  path: '/Users/XXXXX/react-native-discord/http:/192.168.50.85:19000/node_modules/expo/AppEntry.bundle?platform=ios&dev=true&hot=false&strict=false&minify=false'
}
Error: ENOENT: no such file or directory, open '/Users/XXXXX/react-native-discord/http:/192.168.50.85:19000/node_modules/expo/AppEntry.bundle?platform=ios&dev=true&hot=false&strict=false&minify=false'
    at Object.openSync (node:fs:585:3)
    at Object.readFileSync (node:fs:453:35)
    at getCodeFrame (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:949:18)
    at Server._symbolicate (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:1022:22)
    at processTicksAndRejections (node:internal/process/task_queues:96:5)
    at Server._processRequest (/Users/XXXXX/react-native-discord/node_modules/metro/src/Server.js:429:7) {
  errno: -2,
  syscall: 'open',
  code: 'ENOENT',
  path: '/Users/XXXXX/react-native-discord/http:/192.168.50.85:19000/node_modules/expo/AppEntry.bundle?platform=ios&dev=true&hot=false&strict=false&minify=false'
}
```

How do I catch the error properly without this huge stack trace being included? I tried a `try/catch` instead of `catch()` but that yielded the same result. 

<img width="583" alt="image" src="https://user-images.githubusercontent.com/16267903/185059684-adb07140-b781-4c1a-924e-f53f1e74b441.png">

Added the question here too... https://stackoverflow.com/questions/73409446/how-do-i-catch-aws-amplify-errors

---------------

---------------

# When following the docs for enabling sorting on a graphQL model, what is the point of the `type` field?

---------------

Author: @AlexChaseJones
Upvotes: 1
Comments: 1

I'm looking at this guide: https://docs.amplify.aws/guides/api-graphql/query-with-sorting/q/platform/js/#implementation. it's pretty straight forward, but I don't follow understand the implementation. Here's a snippet of the example:
```js
type Todo @model {
  id: ID!
  title: String!
  type: String! @index(name: "todosByDate", queryField: "todosByDate", sortKeyFields: ["createdAt"])
  createdAt: String!
}
```

The `type` field and index settings enable you to do
```js
query todosByDate {
  todosByDate(
    type: "Todo"
    sortDirection: ASC
  ) {
    items {
      id
      title
      createdAt
    }
  }
}
```
which would sort the items by createdAt, ASC. Which is really cool. But the extra required field is just a little odd. I'm assuming the name of the field isn't important, and its more about having an index and setting the params in it. but the `type` field just feels redundant, especially since it will for the most part always have the same value ("todo" in the example).
It just seems like you'd be able to define the sort fields as part of the model without having to create a new field. Is this is side effect of dynamoDB, or is this just a quirk of graphQL?
## Comment

---------------

Author: @AlexChaseJones

When i added the new index to the model, it created a new global secondary with the partition key set to `type` and the sort_key set to `createdAt`. So I guess it makes sense why it needs the new `type` field. still a little weird

---------------

---------------

# Error : import .graphql file in angular showing module not found

---------------

Author: @sefatanam
Upvotes: 1
Comments: 1

Actually I don't want to use any library like apollo-client or apollo-angular. So I generated a angular project with aws amplify. Then I got 3 files under src/graphql file those are mutations.graphql, queries.graphql & subscriptions.graphql. When I want to use those graphql file in my components it showing me this error constantly,

I tried to import like this,

 

    import { GetProduct } from '../../graphql/queries.graphql';

    Cannot find module '../../graphql/queries.graphql' or its corresponding type declarations.ts(2307)


I saw several solutions but nothing is workout,

here is my tsconfig.ts file:

    {
      "compileOnSave": false,
      "compilerOptions": {
        "baseUrl": "./",
        "outDir": "./dist/out-tsc",
        "forceConsistentCasingInFileNames": true,
        "strict": true,
        "noImplicitOverride": true,
        "noPropertyAccessFromIndexSignature": true,
        "noImplicitReturns": true,
        "noFallthroughCasesInSwitch": true,
        "sourceMap": true,
        "declaration": false,
        "downlevelIteration": true,
        "experimentalDecorators": true,
        "moduleResolution": "node",
        "importHelpers": true,
        "target": "es2017",
        "module": "es2020",
        "allowSyntheticDefaultImports": true,
        "typeRoots": [
          "node_modules/@types",
          "src/graphql"
        ],
        "lib": [
          "es2020",
          "dom",
          "esnext.asynciterable"
        ]
      },
      "angularCompilerOptions": {
        "enableI18nLegacyMessageIdFormat": false,
        "strictInjectionParameters": true,
        "strictInputAccessModifiers": true,
        "strictTemplates": true
      }
    }


I also tried with `skipLibCheck` but still now not working.


I want to achieve this [Check at AMPLIFY Documentation][1],


    import { Storage, API } from 'aws-amplify';
    import { getProduct } from './graphql/mutations';
    
    async function getProductById () {
      const product = await API.graphql({ query: getProduct, variables: { id: "12345" }});
      const s3Image = await Storage.get(product.data.getProduct.image);
      product.data.getProduct.s3Image = s3Image;
      console.log('product:', product);
    }


  [1]: https://docs.amplify.aws/guides/api-graphql/image-and-file-uploads/q/platform/js/#interacting-with-the-api-from-a-client-application

My only problem is I can't import `graphql` files , is there any thing that I missed to configure ? - TIA
## Comment

---------------

Author: @AlexChaseJones

in the documentation their mutation/query/subscript `./graphql/` files are most likely `.js` files and not `.graphql` files. When i generated my amplify project (i used the react native setup), it also created 3 files under src/graphql, but they were js files. I wonder if when you set up amplify in the project there was some setting you had to set..

---------------

---------------

# Sign in with Apple Error -  "Error handling auth response - invalid_grant"

---------------

Author: @wrsulliv
Upvotes: 1
Comments: 0

Hi all, when I use "Sign in with Apple" it works about 10% of the time, and the other times I get:

`Error handling auth response - invalid_grant`

I've found some other users online with the same problem, but the tickets were closed with no solution.

Any help is much appreciated.  Thank you!

---------------

---------------

# [amazon-cognito-identity-js] Appropriate usage of associateSoftwareToken

---------------

Author: @lucassilvagc
Upvotes: 1
Comments: 0

I'm trying to setup TOTP on my Angular application. I do have authentication and password reset flows working. My user pool has mandatory TOTP.

Use case 28 depicts the following code [resumed to what's interesting]:

```
cognitoUser.authenticateUser(authenticationDetails, {
     mfaSetup: function(challengeName, challengeParameters) {
          cognitoUser.associateSoftwareToken(this);
     },
}
```

Reproducing the code above (although in a similar way) on my code doesn't allow me to call the associateSoftwareToken function in any way. It returns the following:

`Argument of type 'IAuthenticationCallback' is not assignable to parameter of type '{ associateSecretCode: (secretCode: string) => void; onFailure: (err: any) => void; }'.`

My code:


```
user.authenticateUser(authDetails, {
     onSuccess: success => {
          s.next(success);
          s.complete();
     },
     mfaSetup: function(_challengeName, challengeParameters) {
          user.associateSoftwareToken(this);
     },
}
```

Any ideas how to make this work?

Thanks.

---------------

---------------

# Auth.updateUserAttributes() clear localStorage / sessionStorage

---------------

Author: @exbracer
Upvotes: 1
Comments: 0

I am writing a web-based app that uses AWS Cognito as the authentication service. I use 'aws-amplify' to implement the client-app.

I am using Auth.updateUserAttributes() to update a custom attribute of users on Cognito. However, I found that the call of this function would clear all the Cognito-related items, including idToken, refreshToken, and accessToken stored in localStorage. As a result, the web app behaves like sign-out.



Here is the code about Auth's configuration
```
Amplify.configure({
  Auth: {
    userPoolId: process.env.REACT_APP_AWS_COGNITO_USER_POOL_ID, 
    region: process.env.REACT_APP_AWS_COGNITO_REGION,
    userPoolWebClientId: process.env.REACT_APP_AWS_COGNITO_APP_CLIENT_ID,
    storage: window.localStorage, 
    authenticationFlowType: 'CUSTOM_AUTH', 
  },
});
```
and the code I wrote to update the user's attribute. (I followed the example code from the amplify docs https://docs.amplify.aws/lib/auth/manageusers/q/platform/js/#managing-user-attributes)
```
let user = await Auth.currentAuthenticatedUser(); 
console.log(JSON.stringify(localStorage)); // it outputs the localstorage with 
                                       // idToken, refreshToken, accessToken 
                                       // and other items start with 
                                       // 'CognitoIdentityServiceProvider'
const result = await Auth.updateUserAttributes(user, {
    'custom:attributes_1': '123456789',
}); 
console.log(result); // OUTPUT: SUCCESS
console.log(JSON.stringify(localStorage)); // Only 'amplify-signin-with-hostedUI'. 
                                           // idToken, refreshToken, accessToken 
                                       // and other items were gone. No key, 
                                       // no value.
```
After the last line, I could not interact with the web page anymore. If I refreshed the web page, I found I had signed out and had to sign in again.

It was still the same if I changed the storage for Auth from localStorage to sessionStorage.

Here are my questions:

1. Is this kind of behavior normal? Does Auth.updateUserAttributes() leads to a force sign-out?
2. If it's true, is there any way to avoid a mandatory sign-out?
3. If it's not, what's wrong with my code or configuration? Or should I do some specific configuration for the Cognito service?

Thanks a lot!

---------------

---------------

# I can't update password with aws-amplify/auth and Auth.changePassword()

---------------

Author: @hirasaki1985
Upvotes: 1
Comments: 2

I tried to update user password with Auth.changePassword() method.
but I had catch error.
How can I solve it?

## error info
```
code: "InvalidParameterException"
message: "2 validation errors detected: Value at 'previousPassword' failed to satisfy constraint: Member must not be null; Value at 'proposedPassword' failed to satisfy constraint: Member must not be null"
name: "InvalidParameterException"
```

## package.json 
```
 "@aws-amplify/auth": "^3.2.13",
```

## source code

```
/**
 * config
 */
Auth.configure({
  region: AppEnv.Auth.Cognito.Region,
  userPoolId: AppEnv.Auth.Cognito.UserPoolId,
  userPoolWebClientId: AppEnv.Auth.Cognito.ClientId
})

static async changePassword (nowPassword, newPassword) {
    try {
      const user = await Auth.currentAuthenticatedUser()
      return await Auth.changePassword(user, nowPassword, newPassword)
    } catch (e) {
      console.log(e)
      return false
    }
  }
```

please check it.
## Comment

---------------

Author: @hirasaki1985

I'm very sorry.
It was a mistake.
I was able to solve it.
## Comment

---------------

Author: @zanio

> ## source code
> ```
> /**
>  * config
>  */
> Auth.configure({
>   region: AppEnv.Auth.Cognito.Region,
>   userPoolId: AppEnv.Auth.Cognito.UserPoolId,
>   userPoolWebClientId: AppEnv.Auth.Cognito.ClientId
> })
> 
> static async changePassword (nowPassword, newPassword) {
>     try {
>       const user = await Auth.currentAuthenticatedUser()
>       return await Auth.changePassword(user, nowPassword, newPassword)
>     } catch (e) {
>       console.log(e)
>       return false
>     }
>   }
> ```
> 
> please check it.

The above code should work. For future readers, if you try to change the password and you follow the above code and it doesn't work then make sure your `nowPasword` and `newPassword` are correct. If the authenticate cognito user exist then the change password operation should be successful 


---------------

---------------

# Dependencies not found when deploying a Next.js app with Amplify

---------------

Author: @kimfucious
Upvotes: 1
Comments: 0

Hi there,

Following these docs [here](https://docs.amplify.aws/start/getting-started/hosting/q/integration/next/), I was battling to get my app deployed via Amplify.

The app deploys just fine on Netlify and Vercel, so I'm a bit confused.

In the build log, it looks like dependencies are not being found, specifically dependencies of top-level dependencies, for example:

```console
...
2022-08-17T00:41:57.963Z [INFO]: info  - Compiled successfully
2022-08-17T00:41:57.964Z [INFO]: info  - Collecting page data...
2022-08-17T00:41:59.315Z [WARNING]: > Build error occurred
2022-08-17T00:41:59.321Z [WARNING]: Error: Cannot find module 'sharp'
...
```
Where sharp is a dependency of plaiceholer.

After manually adding these "not found" dependencies, things work, but that doesn't quite seem right.  And I have an inkling that I'm missing a step or a configuration somewhere.

I've read about Output File Tracing, [here](https://nextjs.org/docs/advanced-features/output-file-tracing), but I'm not sure if this is the right thing to pursue.

Any helpful advice toward understanding the best way to handle this would be most appreciated.

---------------

---------------

# How can I add a custom authorization provider?

---------------

Author: @wrsulliv
Upvotes: 1
Comments: 0

I need to support Oauth with Reddit, but that doesn't appear to be provided by Amplify / Cognito.  

Is there a framework / API documented for extending the Authentication code?  

Thank you!

---------------

---------------

# Getting "Unauthorised" where It was suppose to be working

---------------

Author: @rafaelfaria
Upvotes: 1
Comments: 1

I have 2 models for saving data, one linkined to the other one through indexes.

I use Cognito, so I rely on the "owner" default field to make sure it does all the operation with just the data of each owner.

I have the following schema:


```
type PersonalGoal @model
  @auth(
    rules: [
      { allow: owner }
    ]
  )
{
  monthYear: String! @primaryKey #this will be a combination of [month][year]
  month: Int
  year: Int
  monthlyTarget: Float
  totalToTrade: Float
  amountPerDay: Float
  lossPerDay: Float
  daysToTrade: [Int]
  entries: [PersonalGoalEntry] @hasMany(indexName: "byPersonalGoal", fields: ["monthYear"])
}

type PersonalGoalEntry @model
  @auth(
    rules: [
      { allow: owner }
    ]
  )
{
  id: ID!
  monthYear: String @index(name: "byPersonalGoal", queryField: "listPersonalGoalEntriesByMonthYear")
  date: String
  month: Int
  year: Int
  tokenName: String
  totalGain: Float
}

```


However, when I perform a simple operation as below

```
const { data } = await API.graphql(
      graphqlOperation(getPersonalGoal, { monthYear })
    )
```

I then get the following error

```
data: null
errorInfo: null
errorType: "Unauthorized"
locations: [{…}]
message: "Not Authorized to access getPersonalGoal on type Query"
path: ['getPersonalGoal']
```

EVERYTHING else in my app works, so I am wondering why this is not working.
Any ideas are welcome.

Thank you.
## Comment

---------------

Author: @rafaelfaria

Ok. I think i just figure it out. I am using the primaryKey as monthYear and the id needs to be unique for ALL users, not just for themselves. So I need to use a combination of a id: ID! and using monthYear as a sort key.

---------------

---------------

# AWS Cognito user able to sign in, but API “Does not exist” when using I can access using access token on console?

---------------

Author: @wordisthebird
Upvotes: 1
Comments: 14

Hey guys,

Im a bit lost here and would love some help. I am trying to connect my React Native app to a basic Lambda function.

I have no bother Registering a user, Confirming a user or Signing in. I can see all of these things in the Cognito Console.

I also am able to test the access to the API with the Authorizers part of the API Gateway and get a Response Code: 200 with the correct email and other details from cognito.

**Expected behavior**
I want to get a response from the API but instead I get ' API_NAME does not exist'

**Code Snippet**

Imports:

`import { API, Auth } from 'aws-amplify';`
 ```
async signIn(email: string, password: string) {
        try {
          //sign in the user
          const user = await Auth.signIn(email, password);
    
          AlertHelper.show('info', 'Signed in!', user)
    
          const token = user.signInUserSession.idToken.jwtToken
    
          console.log('token:', token )
    
          const requestInfo = {
           headers: {
            Authorization: token
           }
    
//get the Data Here
        const data = await API.get('API_NAME','/hello',requestInfo)
        console.log('Data: ',data )
      }
     
        }
        catch(error){
          console.log('Error: ', error)      
        }
    
      }
```

**What is Configured?**
```
const awsmobile = {
    "aws_project_region": "eu-west-1",
    "aws_cognito_identity_pool_id": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
    "aws_cognito_region": "eu-west-1",
    "aws_user_pools_id": "eu-west-1_xxxxxxxxx",
    "aws_user_pools_web_client_id": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
    "oauth": {},
    "aws_cloud_logic_custom": [
        {
            "name": "API_NAME",
            "endpoint": "https://endpoint",
            "region": "eu-west-1"
        }
    ]
};


Here is the index.js from the function

exports.handler = async (event) => {
    // TODO implement


    if(event.requestContext.authorizer){
        console.log('Claims: ',event.requestContext.authorizer.claims)
    }

    const response = {
        statusCode: 200,
    //  Uncomment below to enable CORS requests
     headers: {
         "Access-Control-Allow-Origin": "*",
         "Access-Control-Allow-Headers": "*"
     }, 
        body: JSON.stringify('Hello from Lambda!'),
    };
    return response;
};




```
**Smartphone (please complete the following information):**

Iphone 11

and 

Android Samsung A20E

**Additional context**
## Comment

---------------

Author: @amhinson

Can you describe what steps you took to create the Lambda function? Was it with `amplify add api`?
## Comment

---------------

Author: @wordisthebird

Hi there,
I used `amplify add api`

Then added the name of the API

Then I added `/hello` for the path

Then I used a lambda function previously created

Then I restricted the access to Authenticated/guest-users

Then I didn't add more paths

## Comment

---------------

Author: @amhinson

Would you be able to double check the values you're providing for `API_NAME`? I've tried to replicate the issue you are seeing, but everything appears to be working when I create a new rest API with Lambda via the CLI.
## Comment

---------------

Author: @mikhael28

I just had the same problem - I have a mature react app running, I run amplify add api, add a rest dynamodb crud api with Node, everything gets pushed, but afterwards - my 'api does not exist' message is the same as theirs.

I ran the first operation using amplify-cli version 4.41, then deleted everything, ran it with version 4.40 - same issue. Unfortunately, it looks like something is broken with `amplify add api`.

@amhinson @wordisthebird in the future, would be very helpful if you would give the version number of the packages you are using.
## Comment

---------------

Author: @mikhael28

Specifically, the problem is with the REST api creation. I created a graphql api 3-4 weeks ago, no problems. Same dep versions.
## Comment

---------------

Author: @wordisthebird

Hi @amhinson, thank you for your reply. I get the `API_NAME` from the AWS-exports.js file under the `name:` category which is an auto generated file. The name of the API is the same on the Aws console.

I really cant think of what else I could be doing wrong, any ideas.  How are you re creating the issue as maybe I am doing something wrong here.
## Comment

---------------

Author: @wordisthebird

> Specifically, the problem is with the REST api creation. I created a graphql api 3-4 weeks ago, no problems. Same dep versions.

Hi @mikhael28 thank you very much for your response! would you have a link to any good tutorials / documentation on how to link up a graphql to a react native app
## Comment

---------------

Author: @wordisthebird

Update:

I can test the api on the console and also get a 200 response with the basic 'Hello from Lambda' message. What am I missing?? @amhinson 
![Screenshot 2021-02-03 at 10 28 18](https://user-images.githubusercontent.com/23181835/106734266-b9551880-660a-11eb-92a7-2c4002a20a00.png)
## Comment

---------------

Author: @mikhael28

The problem appears to be, from my vantage point, not a problem with the

creation of the API itself. It appears to be an error with the
initialization logic of the aws-amplify/core library. When it's running

Amplify.configure of the aws-exports object, there appears to be some
problem with how it is making those API's available to the 'global
state', as it were, accessible for the `aws-amplify/api` library.


On February 2, 2021, Steve Denton <notifications@github.com> wrote:
> Update:
>
> I can test the api on the console and also get a 200 response with the

> basic 'Hello from Lambda' message. What am I missing??
>  
>

>  
> —
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/aws-amplify/amplify-js/issues/7670#issuecomment-

> 772403894>, or unsubscribe
> <https://github.com/notifications/unsubscribe-
> auth/ADUAHC6NHH3M27LTUYFDVXTS5EQSPANCNFSM4W7EJEHQ>.
>
## Comment

---------------

Author: @amhinson

@mikhael28 @wordisthebird Could you share your `package.json`? This might possibly be due to duplicate dependencies. We now only recommend using the `aws-amplify` package and not any of the modular packages directly.

> would you have a link to any good tutorials / documentation on how to link up a graphql to a react native app

The docs have a [getting started guide](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js#create-the-graphql-api) that will work for React Native as well.

## Comment

---------------

Author: @mikhael28

Here is my package.json, though I am a little confused - when did you
start not recommending the module packages? When I was doing a audit on

my bundle size, aws-amplify was adding a huge weight to the bundled js -

when I added the modular libraries and updated my imports, it went down

by 800kb. Does the base amplify package support tree shaking now?

"dependencies": {
    "@aws-amplify/api": "^3.2.17",
    "@aws-amplify/auth": "^3.4.17",
    "@aws-amplify/core": "^3.8.9",
    "@aws-amplify/pubsub": "^3.2.15",
    "@aws-amplify/storage": "^3.3.17",
    "@material-ui/core": "^4.11.2",
    "@sanity/block-content-to-react": "^2.0.6",
    "@sanity/client": "^0.141.6",
    "@sanity/image-url": "^0.140.19",
    "classnames": "^2.2.6",
    "generate-password": "^1.4.2",
    "lodash.clonedeep": "^4.5.0",
    "lodash.sortby": "^4.7.0",
    "prop-types": "^15.7.2",
    "pure-react-carousel": "^1.27.4",
    "react": "^17.0.1",
    "react-accessible-accordion": "^3.3.3",
    "react-beautiful-dnd": "^13.0.0",
    "react-bootstrap": "^0.32.4",
    "react-calendar": "^3.2.1",
    "react-dom": "^17.0.1",
    "react-icons": "^4.1.0",
    "react-loading-skeleton": "^2.1.1",
    "react-quill": "^1.3.5",
    "react-redux": "^7.1.0",
    "react-router-dom": "^5.2.0",
    "react-scripts": "^4.0.1",
    "react-spring": "^8.0.27",
    "react-stripe-elements": "^1.6.0",
    "reactour": "^1.18.0",
    "redux": "^4.0.4",
    "source-map-explorer": "^2.5.2",
    "styled-components": "^4.4.1",
    "toasted-notes": "^3.2.0",
    "uuid": "^3.3.3",
    "victory": "^35.1.1",
    "web-vitals": "^0.2.4",
    "workbox-background-sync": "^5.1.3",
    "workbox-broadcast-update": "^5.1.3",
    "workbox-cacheable-response": "^5.1.3",
    "workbox-core": "^5.1.3",
    "workbox-expiration": "^5.1.3",
    "workbox-google-analytics": "^5.1.3",
    "workbox-navigation-preload": "^5.1.3",
    "workbox-precaching": "^5.1.3",
    "workbox-range-requests": "^5.1.3",
    "workbox-routing": "^5.1.3",
    "workbox-strategies": "^5.1.3",
    "workbox-streams": "^5.1.3"
  },
  "scripts": {
    "analyze": "source-map-explorer 'build/static/js/*.js'",

    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject",
    "serve": "serve -s build"
  },
  "browserslist": [
    ">0.2%",
    "not dead",
    "not ie <= 11",
    "not op_mini all"
  ],
  "devDependencies": {
    "cypress": "^3.4.1",
    "redux-devtools": "^3.5.0"
  }

On February 8, 2021, Steve Denton <notifications@github.com> wrote:
> @mikhael28 <https://github.com/mikhael28>
> @wordisthebird <https://github.com/wordisthebird> Could you share your

> package.json? This might possibly be due to duplicate dependencies. We

> now only recommend using the aws-amplify package and not any of the
> modular packages directly.
>
> > would you have a link to any good tutorials / documentation on how

> > to link up a graphql to a react native app
> >
>
> The docs have a getting started guide
> <https://docs.amplify.aws/lib/graphqlapi/getting-
> started/q/platform/js#create-the-graphql-api> that will work for React

> Native as well.
>

—
You are receiving this because you were mentioned.
Reply to this email directly, view it on GitHub <https://github.com/aws-

amplify/amplify-js/issues/7670#issuecomment-775402697>, or unsubscribe

<https://github.com/notifications/unsubscribe-
auth/ADUAHC6N7JLHK5BJDZN3WN3S6A6SZANCNFSM4W7EJEHQ>.
## Comment

---------------

Author: @amhinson

> Does the base amplify package support tree shaking now? 

Yep, tree shaking was introduced with the last major version bump (3.0.0).
## Comment

---------------

Author: @mikhael28

My bundle size did not reflect that, though perhaps I was on 2.x for
some reason. I will give that another try when I have time, thanks for

the heads up! 

On February 8, 2021, Steve Denton <notifications@github.com> wrote:
> > Does the base amplify package support tree shaking now?
> >
>
> Yep, tree shaking was introduced with the last major version bump
> (3.0.0).
>

—
You are receiving this because you were mentioned.
Reply to this email directly, view it on GitHub <https://github.com/aws-

amplify/amplify-js/issues/7670#issuecomment-775463089>, or unsubscribe

<https://github.com/notifications/unsubscribe-
auth/ADUAHC2X54B4KQ3UNDJP323S6BHGZANCNFSM4W7EJEHQ>.
## Comment

---------------

Author: @radheyshyamideastoimpacts

Getting this error when sign up and sign in
 UserNotFoundException{message=User not found in the system., cause=com.amazonaws.services.cognitoidentityprovider.model.UserNotFoundException: User does not exist. (Service: AmazonCognitoIdentityProvider; Status Code: 400; Error Code: UserNotFoundException; Request ID: ********-****-****-****-************), recoverySuggestion=Please enter correct username.}

---------------

---------------

# Setting cache-control and pragma in request headers of Auth.signIn

---------------

Author: @natrajevertz
Upvotes: 2
Comments: 0

Hi everyone, 

I'm want to set the headers for the HTTP request that gets sent on calling Auth.signIn (https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js/#sign-in)

This are the headers I want to set
Cache-Control: no-store
Pragma: no-cache

I'm also using Amplify.configure (https://docs.amplify.aws/lib/client-configuration/configuring-amplify-categories/q/platform/js/#authentication-amazon-cognito) to configure Amplify before making the Auth.signIn call.

So how do I set these headers? Is there an option to set them in Auth.signIn or Amplify.configure?

BTW I'm using Angular.

---------------

---------------

# User session expired right after the authentication

---------------

Author: @chess-octane
Upvotes: 1
Comments: 2

Hello everyone! I am trying to debug a tricky bug in our application that is happening only in production (yes, excellent).

About ~2.5% of our users (200 out of 8000) had issues after registering on our platform. We are creating the user in our backend invoking the `AdminCreateUserCommand`.

The flow is as follows:
- User registers using a custom form - we call `AdminCreateUserCommand`. The user is required to set the permanent password.
- The user is redirected to the first login page where the user inputs the temporary password sent by Cognito - Here we call `userInstance = await Auth.signIn(username, password)`. The user returned by the `signIn` function contains the `challengeName === 'NEW_PASSWORD_REQUIRED'`. We save the `userInstance` in memory inside our store (zustand).
- The user is redirected to a form to set the permanent password - we call here `Auth.completeNewPassword(userInstance, permanentPassword)`

The `Auth.completeNewPassword` sometimes raises an exception: `Invalid session for the user, the session is expired.` and the code is `NotAuthorizedException`.

I want to understand why would this happen immediately after the user logs in and why it only happens for a few set of users. Does anyone can help us? :) 

This is how we configure Amplify:

```
const configuration: AuthOptions = {
  region: process.env.AWS_COGNITO_USER_POOL_REGION,
  userPoolId: process.env.AWS_COGNITO_USER_POOL_ID,
  userPoolWebClientId: process.env.AWS_COGNITO_USER_POOL_CLIENT_ID,
  mandatorySignIn: true,
  authenticationFlowType: 'USER_SRP_AUTH',
};

Auth.configure({ Auth: configuration });
```
## Comment

---------------

Author: @chess-octane

I found [this workshop](https://catalog.us-east-1.prod.workshops.aws/workshops/f3a3e2bd-e1d5-49de-b8e6-dac361842e76/ko-KR/basic-modules/20-vpc/api-gateway/5-apigateway) in AWS page and it has the following warning:

![image](https://user-images.githubusercontent.com/95883601/182377587-5e3ffaf8-6ed3-42f5-b242-6c4a20a9f7b8.png)

I wonder why the session expired so soon? We have configured the access token to expire in 30 minutes and ID token in 60 minutes. Users are facing this issue 1-2 minutes after the login. Some users are not that fast to get their temporary password from their email and fill it. There's something very wrong going on here.
## Comment

---------------

Author: @abdallahshaban557

Hi @chess-octane  - can you please submit a Github issue so that our team can triage this issue?

---------------

---------------

# Authourization_code flow with amazon-cognito-identity-js or amplify

---------------

Author: @shoaib30
Upvotes: 1
Comments: 0

Hi,

I am trying to use `amazon-cognito-identity-js` which is part of `amplify-js` essentially the `Auth` module of amplify in my VS Code extension. I can open the hosted UI from VSCode in the system browser and capture the `code` in the callback url by registering the `vscode://` uri. Once I have the code I see no option in the amplify/amazon-cognito-identity-js to authenticate, or get tokens with the code.

I may be missing something since amplify is able to open the hosted UI when used in a web application and perform the authentication, but I am not able to find the functions for getting tokens/session given the `code`

---------------

---------------

# Relationship for autogenerated manytomany relationship

---------------

Author: @Josephenoch
Upvotes: 1
Comments: 0

Hello, I'm in need of urgent help

I am working on a project and the relationship between two models I have, let's call them student and classroom, is many to many. I understand that a model is autogenerated, let's call that ClassroomStudent. Now, I'm trying to say a ClassroomStudent has many of another model, let's say, Classmates. Is there a way to do this in amplify? 

---------------

---------------

# Multiple domains in cookiestorage

---------------

Author: @killrazor
Upvotes: 2
Comments: 7

Looking for a way to specify multiple domains in cookiestorage. Right now we can accomplish this by using a static list and checking that against the window location for the client side code. This should be handled in package. 
## Comment

---------------

Author: @rockymeza

This is a feature that we've spent a ton of time trying to make happen at work. The way that we have been handling cross domain token storage in two ways:

1. subdomains: custom cookie storage
2. different top-level domains: token sharing through implicit oauth flow

## subdomains
The custom CookieStorage will store all of the tokens at the eLTD+1 (so `*.example.com`) and that way any subdomain has access to all of the tokens. Cognito doesn't let you have multiple redirectUris for the oauth flows, so what we've been doing is always use one subdomain for the oauth flow and sort of treating it like a proxy:

1. User goes to `https://foo.example.com`
2. They click on login with SSO button
3. We redirect to `https://special.example.com/special/path`
4. This calls `Auth.federatedSignIn`
5. User is sent to Cognito -> SSO Provider -> Back to Cognito
6. User lands on `https://special.example.com?code=...`
7. After the code flow finishes, we store the tokens in a cookie
8. The we redirect the user back to `https://foo.example.com`

This is pretty annoying and not very fast. A benefit is that now the user can navigate to any subdomain and they will be logged in already.

I don't have any other solutions for it, so that's what we've been doing. We can't use the Hosted UI because it's too limited style-wise and we also have to brand the login screen differently for different tenants.

## cross domain
So in this case, we have some properties on different eTLD+1 (`*.example.com` and some on `*.example.net`). In order to share the token over there we are taking advantage of the implicit OAuth flow and doing something like this:

1. User is on `https://foo.example.com`
2. They click link to go to `https://bar.example.net`
3. We grab the access_token & id_token and put them on the URL like this: `https://bar.example.net/#access_token=...&id_token=...`.

This has a major disadvantage of losing the `refreshToken` the user will be logged out after a while. As of yet we don't have a good solution for this. All I can hope is that we can merge all of our properties into one root domain before too long.

I would love to hear from the Amplify team on how/if they intend to support cross domain logins.
## Comment

---------------

Author: @astroanu

Any update on this ? we're also struggling with this at the moment
## Comment

---------------

Author: @idwise-team

Any update on this?
## Comment

---------------

Author: @davidboom95

Any update on this?
## Comment

---------------

Author: @namdevdivya

any update on this?
## Comment

---------------

Author: @nh83012001

Any update on this?
## Comment

---------------

Author: @ashika01

I have not personally tried this out. I will work on creating a sample or if anyone here has a sample I could use @ me. I will create an issue out of this one so we can track this.

---------------

---------------

# Unauthorized field throws instead of returns

---------------

Author: @clintfoster
Upvotes: 1
Comments: 1

I'm aware that the `GraphQLResult` returned when performing a query via `API.graphql()` can contain both `data` and `errors`. But is it normal for it to literally be thrown in the case of a partial failure rather than returned as the function call result?

I'm not sure if the specific scenario matters, but here are some additional details. In this case an `Unauthorized` error occurs because the user that attempted to access the record isn't authorized for the `notes` field, which has a field-level auth rule that overrides the one for the model. The request actually works since the User record in `data` is populated as expected, with `notes` being empty. But since this would seem to be a go-right path for many similar use cases (fields user isn't supposed to see simply shouldn't be returned) it seems odd that an exception is thrown.

I realize this wouldn't happen with custom queries that only ask for the fields a particular user is authorized to access, but I'm using the queries generated by the Amplify CLI. Creating queries for all the permutations of field-level permissions and selecting them from the code logic seems tedious. For now I'm simply catching the thrown result and proceeding the same as if it were the return value, even though it might be inefficient (or at least counterintuitive).

## Thrown GraphQLResult
```
  data: { userByEmail: { items: [blahblah], nextToken: null } },  <== items is populated
  errors: [
    {
      path: [ 'userByEmail', 'items', 0, 'notes' ],  <== lets us know notes not returned
      data: null,
      errorType: 'Unauthorized',
      errorInfo: null,
      locations: [ [Object] ],
      message: 'Not Authorized to access notes on type String'
    }
  ]
```

## Schema excerpt

```graphql
type User 
  @model
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["Admin"] }
      { allow: private, operations: [read] }
    ]
  ) {

  id: ID! @primaryKey

  email: AWSEmail
    @index(
      name: "byEmail"
      queryField: "usrByEmail")

  notes: [String]
    @auth(rules: [ # don't allow users to see internal notes about them
      { 
        allow: groups, groups: ["Admin"] 
      }
    ])
}

```
## Comment

---------------

Author: @clintfoster

This may be TMI, but in case anyone will find it interesting (or laughable) here is the boilerplate code I find myself writing everywhere to invoke `API.graphql()` using the generated types. When I first started working with Amplify almost a year ago I was coming to TypeScript from Java. What I had to do to make my code pass reasonably strict eslint checks seemed crazy. It really didn't seem like a proper TypeScript API. I figured I must not know what I was doing...

```typescript

import * as t from 'src/API'  // generated GQL types for use w/ below
import * as qry from 'src/queries'  // generated GQL queries & mutations

export async function userByEmail(
  vars: t.UserByEmail_QueryVariables
): Promise<t.UserByEmailQuery> {
  try {
    const res = await API.graphql({
      query: qry.userByEmail,
      variables: vars,
    }) as GraphQLResult<t.UserByEmailQuery>  // narrow: Observable is for sub & undefined is catch
    if (res.data && res.data.userByEmail) {
      return res.data.userByEmail
    } else {
      throw new NoDataErr(context)  // can't happen, per catch below?
    }
  // Amplify literally throws GraphQLResult if errors is populated
  } catch (exOrGraphQLResult) {  // could presumably also be an Err instance
      throw new ApiErr(context, exOrGraphQLResult)  // wrapped ex w/ context info
  }
  // never get here since testing indicates GraphQLResult is thrown if errors populated
  throw new UnexpectedApiErr(context)
}
```

I bet someone can improve on that. But, setting aside crazy code to improve TypeScript  usability, there is a problem with my "catch" clause assuming `data` is never populated when `GraphQLResult` is thrown. That's really the subject of this thread. My code (and probably most code) should treat it as "normal" if what was thrown is an instance of `GraphQLResult` _and_ `data` is populated. That's what happens when a partial result is returned due to the user not being authorized to access certain fields. The data is still returned, but with the unauthorized fields removed. That much makes sense. What doesn't make sense is throwing the result as an exception since the caller can still check the `errors` field if it wants to know data was omitted.

More broadly, from an API architecture standpoint it doesn't make sense to use `GraphQLResult` both as a return value and a thrown object, especially since it is an interface, making it messy to differentiate from other exceptions in a catch clause since `instanceof` cannot be used on an interface. Also, the fact that the same `API.graphql()` function is also used for subscriptions (which return `Observable`) makes handling the return value for queries and mutations unwieldy since narrowing is required in TS.

---------------

---------------

# Push Notification json body missing

---------------

Author: @hardikmehta88999
Upvotes: 1
Comments: 1

When I tried to send the push notification along with the JSON body (pinpoint.jsonBody) through pinpoint but when I console the notification data the JSON body is missing for the frontend (react-native). Need Help
Version : 4.3.17 (push notification)
## Comment

---------------

Author: @abdallahshaban557

Hi @hardikmehta88999  - can you please elaborate on what JSON Body means here?

---------------

---------------

# Is there a way to validate the code sent using forgotPassword and change the password only after the validatation?

---------------

Author: @zzBrunoBrito
Upvotes: 1
Comments: 1

I'm using cognito user pools for user management and using the flow of forgotPassword a confirmation code is sent to the user. For UI purposes I need to validate the code that is sent when I call the API ForgotPassword without sending the new password yet. I need like a middle step between ForgotPassword and ConfirmForgotPassword.

The function below is the one sending the code:

Auth.forgotPassword(username)

This function is resetting the password with the code sent (here I'm notified if the code is invalid)

Is it possible to only validate the code sent with the existing API's available?
## Comment

---------------

Author: @abdallahshaban557

Unfortunately, this is not currently possible. You can only confirm the code with setting the password. Why would you need to check the code without setting the password as well?

---------------

---------------

# Passing Authorization Token to Graphql Request

---------------

Author: @aaronmg241
Upvotes: 1
Comments: 0

I am trying to allow users in a cognito group to delete a User from my DynamoDB database. I am using graphql for queries, mutations, etc. I try the following graphql request:

        await API.graphql(
            { 
                query: deleteUser,
                variables: { id },
                authMode: 'AMAZON_COGNITO_USER_POOLS',
                authToken: token
            }
        )

where "token" is a jwtToken from the current logged in user. However, when I try this I get a "no current user" error. Is there any way to pass in the user or authorization parameter for a request like this?? The docs (from what I have read) only go over how to add this authentication to your schema, but I am lost when it comes to finding an answer to give the user to the request. 

I have been trying to find an answer for hours with no luck. Any help is GREATLY appreciated!

---------------

---------------

# Allowing the session to be restored for CognitoUser in amazon-cognito-identity-js

---------------

Author: @achinthaprem
Upvotes: 2
Comments: 0

I just came across a scenario where I had to restore the session for CognitoUser in the `amazon-cognito-identity-js` package. I know that the intended use for the package is using it on the client side. I'm currently working on a bit old project that uses the package in a NodeJS server.

So the scenario is that I'm tasked to develop TOTP MFA support for the project. There would be two requests to the NodeJS server from the web client. The first request is to provide the server with the username and password and then retrieve the URI to generate the QR code. The second request is to provide the TOTP code user entered after scanning the QR code. The issue arises when I try to call the verifySoftwareToken method. It just throws NotAuthorizedException because the server couldn't keep the session. So I patched the package to assign the session (which was obtained during the first request) from the constructor of CognitoUser. and then call the verifySoftwareToken method. This was successful.

What I want to know is, is there any better approach to restore the session from the `amazon-cognito-identity-js` package and the shortcomings of this patch? Please note that I can't use the `adminInitiateAuth` and `adminRespondToAuthChallenge` from `@aws-sdk/client-cognito-identity-provider` package or any methods that requires developer credentials. Thank you.

---------------

---------------

# How to troubleshoot subscription authentication issue

---------------

Author: @cdellinger
Upvotes: 1
Comments: 1

I have a React application that currently uses Amplify GraphQL APIs. I have set those APIs up so that they require using Cognito user pools for authorization. For example the following code is successfully retrieving a list of values from my Projects collection in DynamoDB

`const apiData = await API.graphql({ query: listProjects, authMode: "AMAZON_COGNITO_USER_POOLS"  });
`
Recently I have been trying to setup a subscription so that I can receive real time updates from AppSync when new entries are added to my Projects collection. This is the code that I am trying to get to work:

```
const subscription = API.graphql({query: subscriptions.onUpdateProject, authMode: "AMAZON_COGNITO_USER_POOLS"}
    ).subscribe({
    next: ({ provider, value }) => console.log({ provider, value }),
    error: error => console.warn(error)
});
```

Unfortunately, this code is failing when executed, it is causing this error to be raised:

`"Connection failed: {\"errors\":[{\"errorType\":\"Unauthorized\",\"message\":\"Not Authorized to access onUpdateProject on type Project\"}]}"
`
I am not quite sure how to troubleshoot this or resolve it, do subscriptions require a special configuration with respect to authorization? Are Cognito user pools supported with subscriptions? Any help or guidance would be greatly appreciated.
## Comment

---------------

Author: @cdellinger

I was able to resolve this by adding the a variable to specify the owner to my subscription as shown below.   I found this in another issue (https://github.com/aws-amplify/amplify-category-api/issues/456).

```
        const updateProjectSubscription = API.graphql({query: subscriptions.onUpdateProject, authMode: 'AMAZON_COGNITO_USER_POOLS', variables: {
            owner: Auth.user.attributes.sub 
        }}

```

---------------

---------------

# At least local transactions?

---------------

Author: @sdandois
Upvotes: 1
Comments: 0

Hi, what kind of transaction support does this library have? 

I'm comparing with Firebase Cloudfirestore and Realm which both have good support for transactions. I would expect at least that the SQlite adapter leverages SQLite transactions, is that the case? 

How do you deal with absence of transactions? 

---------------

---------------

# Amplify pushnotification on Android

---------------

Author: @guaaak
Upvotes: 1
Comments: 1

Hi I setup everything followed the steps for android https://docs.amplify.aws/lib/push-notifications/getting-started/q/platform/js/
When I test the push notification through ping point I can trigger the onNotification function and get notification message. However, the notification doesn't popup on the Android device. Any ideas of this issue? Thanks!
## Comment

---------------

Author: @Samaritan1011001

Hi, is your app in the foreground at the time you send it from Pinpoint? If so, only the `onNotification` callback will get fired and no message will be displayed. 

---------------

---------------

# The Lambda function associated with the CloudFront distribution is invalid

---------------

Author: @abdullahmujahidali
Upvotes: 1
Comments: 1

I am working on an SSR app and I have deployed it on my amplify, whenever I try to redirect to a page it gives me a 503 ERROR. 

> 503 ERROR
The request could not be satisfied.
The Lambda function associated with the CloudFront distribution is invalid or doesn't have the required permissions. We can't connect to the server for this app or website at this time. There might be too much traffic or a configuration error. Try again later, or contact the app or website owner.
If you provide content to customers through CloudFront, you can find steps to troubleshoot and help prevent this error by reviewing the CloudFront documentation.
Generated by cloudfront (CloudFront)
Request ID: PUV5fkcF-HXXhA5qvSfyGKjmw5QI7iD1x7x1y0xWA9rdcumb8zEzOg==

This is the error I get, I am communicating with my APIs directly there's no server in my next js app. My app is working fine if I connect it with Vercel or Netlify but fails with Amplify.
## Comment

---------------

Author: @abdullahmujahidali

There are several issues still with getting Next and Amplify to work nicely. The best two pages I found are here

https://github.com/aws-amplify/amplify-hosting/blob/main/FAQ.md#error-accessdenied-access-denied

And here

https://aws.amazon.com/blogs/mobile/host-a-next-js-ssr-app-with-real-time-data-on-aws-amplify/ (specifically the comments below the blog post)

In my case I made several key changes:

1-Install or downgrade to Next 10.0.0.8 (npm install next@10.0.8)

2-Be sure all of your Environment variables are added to Amplify’s console

3-Add this Env variable too: AMPLIFY_NEXTJS_EXPERIMENTAL_TRACE=true

4-Modify your next.config.js for the Environment Variables Workaround mentioned in the 1st article above.

Also, it doesn’t hurt to test an api/ file with bare min code to ensure there aren’t errors in your code. LambdaEdge doesn’t seem to have great logging. (At least not that I found)

---------------

---------------

# AWS Amplify GraphQL Query with Computed Field

---------------

Author: @rayshi67
Upvotes: 1
Comments: 0

I am looking to implement a query named **driversByActiveStatus** that returns only the active, inactive, or all drivers respectively for the following Driver type,

```
type Driver
  @model
  @auth(rules: [
    {allow: private}
  ])
  @key(name: "byLastName", fields: ["lastName", "id"], queryField: "driversByLastName")
  @key(name: "byActiveStatus", fields: ["active", "id"], queryField: "driversByActiveStatus") {
  
  id: ID!
  firstName: String!
  lastName: String!
  
  # computed field that is calculated based on startDate and endDate
  # true if startDate < currentDate < endDate
  # false if currentDate < startDate || current > endDate
  active: Boolean
  
  startDate: AWSDateTime!
  endDate: AWSDateTime!
}
```

The query **driversByActiveStatus** should work as follows,
 - it returns all the drivers if the **active** parameter is null
 - it returns only the active drivers if the **active** parameter is true (an active driver is a DynamoDB record where the current date is between its **startDate** and **endDate**, i.e., startDate < currentDate < endDate)
 - it returns only the inactive drivers if the **active** parameter is false

What would be the best way to achieve this in AWS Amplify?

From what I read on <https://docs.amplify.aws/cli/> it looks like it may be possible to implement the query by overwriting the auto-generated VTL resolvers **Query.driversByActiveStatus.req.vtl** and **Query.driversByActiveStatus.res.vtl**, and replacing the **active** field value with a calculated value based on **startDate** and **endDate** in the returned result set in the result mapping resolver.

Has anyone implemented something similar? If so can you please shed some lights or share the code snippet as there is only limited documentation on AppSync VTL resolvers.

---------------

---------------

# Installing In App Messaging

---------------

Author: @pratikdhody
Upvotes: 1
Comments: 1

Hi,

I've followed https://docs.amplify.aws/lib/in-app-messaging/overview/q/platform/js/ and within my React Native app, I've copied the `aws-exports.js` file which looks like below but I'm getting an error within my app `Notifications.InAppMessaging - Failed to sync messages, [Error: not implemented]`

IAM policies have also been created and assigned to appropriate roles.
Any thoughts on what I may have not done?

Cheers


```
const awsmobile = {
  aws_project_region: "ap-southeast-2",
  aws_appsync_graphqlEndpoint:
    "XXXX",
  aws_appsync_region: "ap-southeast-2",
  aws_appsync_authenticationType: "API_KEY",
  aws_appsync_apiKey: "XXXX",
  aws_cognito_identity_pool_id: "XXXX",
  aws_cognito_region: "ap-southeast-2",
  aws_user_pools_id: "XXXXX",
  aws_user_pools_web_client_id: "XXXXX",
  oauth: {},
  aws_cognito_username_attributes: [],
  aws_cognito_social_providers: [],
  aws_cognito_signup_attributes: ["EMAIL"],
  aws_cognito_mfa_configuration: "OFF",
  aws_cognito_mfa_types: ["SMS"],
  aws_cognito_password_protection_settings: {
    passwordPolicyMinLength: 8,
    passwordPolicyCharacters: [],
  },
  aws_cognito_verification_mechanisms: ["EMAIL"],
  aws_user_files_s3_bucket: "fgdata211956-dev",
  aws_user_files_s3_bucket_region: "ap-southeast-2",
  aws_mobile_analytics_app_id: "XXXXX",
  aws_mobile_analytics_app_region: "ap-southeast-2",
  Notifications: {
    InAppMessaging: {
      AWSPinpoint: {
        appId: "XXXXX",
        region: "ap-southeast-2",
      },
    },
  },
```
## Comment

---------------

Author: @Samaritan1011001

Please provide the output of the bellow command,
`npx envinfo --system --binaries --browsers --npmPackages --duplicates --npmGlobalPackages`

And can you make sure you added the right actions and ARN when following [this](https://docs.amplify.aws/lib/in-app-messaging/prerequisites/q/platform/js/#create-and-attach-iam-policy) section of the doc? 

---------------

---------------

# Datastore API set id from client

---------------

Author: @crolly
Upvotes: 2
Comments: 2

According to the amplify-cli docs, it is possible to set the primary key field `id` from the client through the graphql mutation.

With Datastore, the id however is always created server side and reassigned.

Is it possible to accomplish this with DataStore or are any changes regarding this planned?
Does somebody have a workaround maybe?
## Comment

---------------

Author: @lenarmazitov

Hi @crolly DataStore generates id on client with uuid, firstly data created on client and then sync process send it to remote storage. If you see generated resolver you will see:
```
  "id":   $util.dynamodb.toDynamoDBJson($util.defaultIfNullOrBlank($ctx.args.input.id, $util.autoId()))
```

So if you can set it manually id will be set instead of uuid, but uuid comes from client.

As workaround you can set id from other attribute like myId and redefine resolver

```
  "id":   $util.dynamodb.toDynamoDBJson($util.defaultIfNullOrBlank($ctx.args.input.myId, $util.autoId()))
```

BUT THIS IS NO GOOD IDEA, because you will get two records in DataStore cache, one with your id and one with autogenerated. And I do not know exactly but second record may wants to try sync everytime when sync process triggered.
## Comment

---------------

Author: @kolodi

It should be possible to define ID for newly created items. Otherwise, too many workarounds needed. A common use case would be: create user in Cognito and then create an item in DB with the same ID (sub). If you create item with other custom APIs or directly in DB, the DataStore client won't "know" about it for a long time as there is no mechanism to manually resync items with certain ID, which would be an awesome idea too, because, given numerous limitations of the DataStore client, there is a multitude of cases where you want you data be manipulated differently, but on the other hand you want you clients to have those updates as soon as possible and not after 5 minutes or so when DataStore decides to resync on its own. 

---------------

---------------

# Testing Site in Cypress requiring Cognito MFA

---------------

Author: @swiftzor
Upvotes: 1
Comments: 0

Hi All,

I'm trying to write E2E tests in Cypress, but its locked behind a Cognito pool with MFA on it.  This is obviously a problem as cypress cannot do anything with the request and token which means I'm blocked from the site.  Has anyone run into this?


Here is how I'm logging in:

`Cypress.Commands.add('login', (user, pass, url) => {
  cy.session([user, pass], () => {
    cy.visit(`${Cypress.env('baseUrl')}/login`)

    // Configure amplify
    Amplify.configure({
      region: Cypress.env('region'),
      userPoolId: Cypress.env('userPoolId'),
      userPoolWebClientId: Cypress.env('userPoolWebClientId'),
    });

    // perform sign in programmatically
    let authReq = new Cypress.Promise((resolve, reject) => {
      Auth.signIn(user, pass)
        .then(function(_user) {
          resolve()
        })
    });

    cy.wrap(null).then(async () => {
      await authReq;
      store.commit("logIn", {
        isLoggedIn: true,
        username: user,
        token: "...",
        isAdmin: true,
        userType: "Admin"
      });
    })


I've tried looking and looking but so far to no avail on it.  Maybe I need to do component testing instead, but I'm not 100% on that

---------------

---------------

# Is this library actively maintained?

---------------

Author: @sdandois
Upvotes: 1
Comments: 2

Is this library actively maintained? 

The latest release is 4 years old, I doubt that works with latest react-native version.
## Comment

---------------

Author: @sdandois

I guess the answer is yes, but they no longer publish release in github.
## Comment

---------------

Author: @abdallahshaban557

Yes, this library is maintained. We will be resuming the use of releases in Github soon to make sure there is no confusion about us maintaining support! 

---------------

---------------

# How can I check if an accessToken is invalid from my react app?

---------------

Author: @mariela-plaza
Upvotes: 1
Comments: 0

To give some context as to why I need this, **here is our problem:**
We are using Cognito to manage the users of our web app, built with react. When a user signs in, we retrieve the idToken, store it in AuthContext and we set a state called isAuthenticated to true (also part of the AuthContext).

When the user signs out, the isAuthenticated state is set to false.

**Here is the troublesome part:**
In the current state of the app, a single user can be signed in simultaneously from multiple places. This is something we want to avoid.

I’ve done some research and it seems the best approach is to implement a Cognito Pre-Auth trigger which logs the user out of every device whenever they authenticate.
I don’t think this approach would helps us because of the previously mentioned isAuthenticated state, which, as long as it is true, keeps the user logged in.

The other idea I saw was doing a global signout every time: (1) the user signs out and (2) before each signin as this (https://github.com/aws-amplify/amplify-flutter/issues/1206)
The issue with the isAuthenticated state persists with this approach, but by doing a global signout, the accessToken gets revoked.

That’s why I was wondering if there is a function or something I can call to verify if the accessToken is valid. In case it is not, I can logout the user by setting isAuthenticated state to false.

This is just an idea I’ve had. I haven’t come up with anything else, but if someone has a better approach to solve this issue, please comment down your solution.


All inputs and ideas will be greatly appreciated, thank you in advance!

---------------

---------------

# ERROR: Validate that amazon-cognito-identity-js has been linked

---------------

Author: @jnomeisky
Upvotes: 3
Comments: 2

I receive the following error when trying to authenticate with email and password.

Im using the following versions:
"aws-amplify": "^3.3.7",
"aws-amplify-react-native": "^4.2.8",

It's worth noting that I was using EXPO and the code worked just fine but when I "ejected" the code, this started to happen.
Can anybody help me?
## Comment

---------------

Author: @kiljee

Hi @jnomeisky 
need to run npm install aws-amplify aws-amplify-react-native amazon-cognito-identity-js @react-native-community/netinfo
and after that cd ios and pod install,
it's solved for me same issue
## Comment

---------------

Author: @pthornhi

Mine was a mismatch between the react-native package and the @react-native-community/cli package. 

I looked at this reference table: https://github.com/react-native-community/cli and made sure my install pair matched a row on that table. Now pod install works from the ios directory.

---------------

---------------

# Authenticator: Custom CSS property --container-height ignored

---------------

Author: @IggyBlob
Upvotes: 5
Comments: 3

I'm trying to set the height of Amplify Authenticator's `auth-container`. According to [the docs](https://github.com/aws-amplify/amplify-js/tree/main/packages/amplify-ui-components/src/components/amplify-authenticator#css-custom-properties), this should be trivial as `amplify-authenticator` exposes a custom CSS property `--container-height` that lets you do exactly that.

In the global `styles.scss` file of my Angular project I added the following selector:

```
:root {
  --amplify-primary-color: #ff003d;
  --amplify-secondary-color: #fff;
  --amplify-primary-tint: #fff;
  --amplify-primary-shade: #ff003d;
  --amplify-font-family: 'Open Sans', sans-serif;
  --amplify-background-color: rgba(0, 0, 0, 0.5) !important;
  --amplify-secondary-contrast: rgba(0, 0, 0, 0);
  --container-height: 300px;
}
```

The properties prefixed with `--amplify-` are picked up correctly. However, the custom property value `--container-height: 300px;` is ignored and Amplify falls back to the default value, namely `100vh`.

![screenshot](https://user-images.githubusercontent.com/20150256/109129401-e64fa380-7750-11eb-9f12-928b8f60762e.png)

What am I missing?
## Comment

---------------

Author: @24601

Did you happen to find a resolution here? W are experiencing the same thing upon updating library, just bumping a rev. 

disabling min-height on the element fixes it in the browser, but with shadow DOM, the obvious way to override it in CSS isn't working, and this var isn't working either. 
![Screen Shot 2021-03-31 at 12 24 29](https://user-images.githubusercontent.com/1157207/113203321-c401e780-9220-11eb-9340-e7abde936ffa.png)
## Comment

---------------

Author: @loco-lby

I came across this exact problem today, I setup a div around the Authenticator with a set height and it did the job.
This is inside a custom form component I made, I
```
<div style={{ height: 500 }}>
      <AmplifyAuthenticator>
        <AmplifySignUp
          slot="sign-up"
          formFields={[{ type: "email" }, { type: "password" }]}
        />
      </AmplifyAuthenticator>
    </div> 
``` 
And then I wrapped the component with a class (jss)
```
   <div className={classes.card2}>
            <LoginForm />
     </div>
```

```
card2: {
    position: 'relative',
    margin: '5% 0',
    '& div': {
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      flexDirection: 'column',
    },
  },
```
## Comment

---------------

Author: @KarinMatsuyama

Putting `--container-height` inside of `amplify-authenticator` worked for me.
I added this to my global css.

```
amplify-authenticator {
  --container-height: 100%;
}
```

---------------

---------------

# datastore websockets not working due to "unauthorized" error

---------------

Author: @drummerwolli
Upvotes: 1
Comments: 0

Hi everyone. I'm using `aws-amplify = 4.3.27`. I have an auth (cognito with social login) + api (graphql + dynamoDB) + storage setup currently. All entities are marked in the `schema.graphql` file with `allow: groups` and one string field in the entity indicating the group. The app works actually fine, I can add entities, update them and everything. Also, each user can only get the entities they are assigned to.

but i'm having a lot of datastore warnings in the console saying:

![image](https://user-images.githubusercontent.com/3867569/178292528-5a296224-391b-498d-ac9b-32197d7f1a68.png)

When checking the network tab, i can see that all graphQL calls are working fine, but the websocket connection call is full with errors, most likely causing the warnings in the console as well.

How can I get rid of these warnings and make the websockets work again properly? 


---------------

---------------

# React.js AuthError - Error: Amplify has not been configured correctly.

---------------

Author: @hyprstack
Upvotes: 3
Comments: 21

**Describe the bug**
Have tried to manually integrate amplify in an existing react-app. I have succeeded in similar projects before, but have now migrated to the @aws-amplify/auth module and keep getting an annoying, and very un-helpful, error in the console:

`[ERROR] 00:42.548 AuthError - 
            Error: Amplify has not been configured correctly. 
            The configuration object is missing required auth properties. 
            Did you run `amplify push` after adding auth via `amplify add auth`?
            See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information`

Not only that but the form is now pushed to the left although the container div has `justify-content: center`, whereas before with the exact same styling, it was centred. Not sure if this is linked to previous error, but is annoying.

<img width="1269" alt="Screenshot 2020-05-19 at 16 01 48" src="https://user-images.githubusercontent.com/5845311/82342903-16ac2980-99ea-11ea-9d8f-37722131b65b.png">

I have tried both formats of config files as shown here:

```javascript
{
  "Auth": {
      "identityPoolId": "xxxxx:xxxxxxxx",
      "region": "xxxxxx",
      "identityPoolRegion": "xxxxxx",
      "userPoolId": "eu-west-xxxxxxxx",
      "userPoolWebClientId": "xxxxxxxxxxx",
      "mandatorySignIn": "true",
      "authenticationFlowType": 'USER_PASSWORD_AUTH',
      "oauth": {
        "domain": 'https://xxxxxxxx.xxxxxx.amazoncognito.com',
        "scope": ['phone', 'email', 'profile', 'openid', 'aws.cognito.signin.user.admin'],
        "redirectSignIn": 'http://localhost:3000/',
        "redirectSignOut": 'http://localhost:3000/',
        "responseType": 'code' // or 'token', note that REFRESH token will only be generated when the responseType is code
      }
    }
}
```

and 

```javascript
{
     "aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS",
    "aws_user_pools_id": "xxxxxxx",
    "aws_user_files_s3_bucket": "xxxx",
    "aws_project_region": "xxxxx",
    "aws_cognito_region": "xxxxx",
    "aws_appsync_region": "xxxxx",
    "aws_content_delivery_bucket_region": "xxxxx",
    "aws_user_files_s3_bucket_region": "xxxxxx",
    "aws_cognito_identity_pool_id": "xxxxxx",
    "aws_user_pools_web_client_id": "xxxxxxxx"
    "oauth": {}
}
```

My package.json is as follows:

```javascript
{
  "name": "demo-app",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@aws-amplify/auth": "^3.2.7",
    "@aws-amplify/ui-react": "^0.2.6",
    "@date-io/moment": "^2.0.1",
    "@fortawesome/fontawesome-svg-core": "^1.2.26",
    "@fortawesome/free-brands-svg-icons": "^5.12.0",
    "@fortawesome/free-solid-svg-icons": "^5.12.0",
    "@fortawesome/react-fontawesome": "^0.1.8",
    "@material-ui/core": "^4.8.3",
    "@material-ui/icons": "^4.5.1",
    "@material-ui/lab": "^4.0.0-alpha.40",
    "@material-ui/pickers": "^3.2.9",
    "@testing-library/jest-dom": "^4.2.4",
    "@testing-library/react": "^9.4.0",
    "@testing-library/user-event": "^7.2.1",
    "aws-amplify": "^2.3.0",
    "aws-sdk": "^2.608.0",
    "axios": "^0.19.2",
    "local-storage": "^2.0.0",
    "lodash": "^4.17.15",
    "moment": "^2.24.0",
    "nconf": "^0.10.0",
    "react": "^16.12.0",
    "react-dom": "^16.12.0",
    "react-redux": "^7.1.3",
    "react-router-dom": "^5.1.2",
    "react-scripts": "^3.4.0",
    "redux": "^4.0.5",
    "typeface-roboto": "0.0.75",
    "uuid": "^3.4.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": "react-app"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```

I have tried deleting node_modules and packga-lock.json and re-installing without any change.

This is my app.js file:

```javascript 
import React from 'react';
import ReactDOM from 'react-dom';
import Amplify, { Auth } from 'aws-amplify';
import { AmplifyAuthenticator } from '@aws-amplify/ui-react';
import App from './App';
import './index.css';
import * as serviceWorker from './serviceWorker';

import { Provider } from 'react-redux';
import { createStore } from 'redux'
import rootReducer from './reducers'

/*global CONFIG */ --> This is {AWS: {Auth: {...}}}
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);
Amplify.configure(CONFIG.AWS) // This also fails

const store = createStore(rootReducer, []);

ReactDOM.render(
  <Provider store={store}>
    <AmplifyAuthenticator>
      <App />
    </AmplifyAuthenticator>
  </Provider>,
  document.getElementById('root')
);

serviceWorker.unregister();
```

Running `npm list | grep "amplify"` yields the following:

```javascript
├─┬ @aws-amplify/auth@3.2.7
│ ├─┬ @aws-amplify/cache@3.1.10
│ │ └── @aws-amplify/core@3.2.7 deduped
│ ├─┬ @aws-amplify/core@3.2.7
├─┬ @aws-amplify/ui-react@0.2.6
│ ├── UNMET PEER DEPENDENCY @aws-amplify/auth@^2.1.5
│ ├── UNMET PEER DEPENDENCY @aws-amplify/core@^2.2.4
│ └─┬ @aws-amplify/ui-components@0.4.1
├─┬ aws-amplify@2.3.0
│ ├─┬ @aws-amplify/analytics@2.2.8
│ │ ├─┬ @aws-amplify/cache@2.1.8
│ │ │ ├── @aws-amplify/core@2.3.0 deduped
│ │ ├─┬ @aws-amplify/core@2.3.0
│ ├─┬ @aws-amplify/api@2.2.1
│ │ ├─┬ @aws-amplify/auth@2.1.8
│ │ │ ├── @aws-amplify/cache@2.1.8 deduped
│ │ │ ├── @aws-amplify/core@2.3.0 deduped
│ │ ├─┬ @aws-amplify/cache@2.1.8
│ │ │ ├── @aws-amplify/core@2.3.0 deduped
│ │ ├─┬ @aws-amplify/core@2.3.0
│ ├─┬ @aws-amplify/auth@2.1.8
│ │ ├── @aws-amplify/cache@2.1.8 deduped
│ │ ├── @aws-amplify/core@2.3.0 deduped
│ ├─┬ @aws-amplify/cache@2.1.8
│ │ ├── @aws-amplify/core@2.3.0 deduped
│ ├─┬ @aws-amplify/core@2.3.0
│ ├─┬ @aws-amplify/datastore@1.2.0
│ │ ├── @aws-amplify/api@2.2.1 deduped
│ │ ├─┬ @aws-amplify/core@2.3.0
│ │ ├── UNMET PEER DEPENDENCY @aws-amplify/pubsub@2.1.9 deduped
│ ├─┬ @aws-amplify/interactions@2.1.8
│ │ ├─┬ @aws-amplify/core@2.3.0
│ ├─┬ @aws-amplify/predictions@2.1.8
│ │ ├─┬ @aws-amplify/core@2.3.0
│ │ ├── @aws-amplify/storage@2.2.3 deduped
│ ├─┬ UNMET PEER DEPENDENCY @aws-amplify/pubsub@2.1.9
│ │ ├─┬ @aws-amplify/auth@2.1.8
│ │ │ ├── @aws-amplify/cache@2.1.8 deduped
│ │ │ ├── @aws-amplify/core@2.3.0 deduped
│ │ ├─┬ @aws-amplify/cache@2.1.8
│ │ │ ├── @aws-amplify/core@2.3.0 deduped
│ │ ├─┬ @aws-amplify/core@2.3.0
│ ├─┬ @aws-amplify/storage@2.2.3
│ │ ├─┬ @aws-amplify/core@2.3.0
│ ├── @aws-amplify/ui@1.2.3
│ ├─┬ @aws-amplify/xr@1.1.8
│ │ ├─┬ @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @date-io/core@^1.3.6, required by @material-ui/pickers@3.2.10
npm ERR! peer dep missing: @aws-amplify/auth@^2.1.5, required by @aws-amplify/ui-components@0.4.1
npm ERR! peer dep missing: @aws-amplify/core@^2.2.4, required by @aws-amplify/ui-components@0.4.1
npm ERR! peer dep missing: @aws-amplify/pubsub@^1.2.4, required by @aws-amplify/api@2.2.1
npm ERR! peer dep missing: @aws-amplify/pubsub@^1.2.4, required by @aws-amplify/api@2.2.1
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @aws-amplify/pubsub@^1.2.4, required by @aws-amplify/api@2.2.1
npm ERR! peer dep missing: @aws-amplify/pubsub@^1.2.4, required by @aws-amplify/api@2.2.1
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: @react-native-community/netinfo@^5.5.0, required by @aws-amplify/core@2.3.0
npm ERR! peer dep missing: typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta, required by tsutils@3.17.1
npm ERR! peer dep missing: typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta, required by tsutils@3.17.1
```
## Comment

---------------

Author: @Fanner487

I'm getting the exact same issue/error too. I just rolled back my package version to use the last version from `^3.2.7` to `3.2.6` and it's now working again. Hopefully, this issue can be resolved.

Hope this helps you too!
## Comment

---------------

Author: @hyprstack

> I'm getting the exact same issue/error too. I just rolled back my package version to use the last version from `^3.2.7` to `3.2.6` and it's now working again. Hopefully, this issue can be resolved.
> 
> Hope this helps you too!

@Fanner487 This didn't resolve my issue unfortunately, but I rolled back so that my package.json looked like

```javascript
 "dependencies": {
    "@date-io/moment": "^2.0.1",
    "@fortawesome/fontawesome-svg-core": "^1.2.26",
    "@fortawesome/free-brands-svg-icons": "^5.12.0",
    "@fortawesome/free-solid-svg-icons": "^5.12.0",
    "@fortawesome/react-fontawesome": "^0.1.8",
    "@material-ui/core": "^4.8.3",
    "@material-ui/icons": "^4.5.1",
    "@material-ui/lab": "^4.0.0-alpha.40",
    "@material-ui/pickers": "^3.2.9",
    "@testing-library/jest-dom": "^4.2.4",
    "@testing-library/react": "^9.4.0",
    "@testing-library/user-event": "^7.2.1",
    "aws-amplify": "^2.2.1",
    "aws-amplify-react": "^3.1.9",
    "aws-amplify-react-native": "^2.2.3",
    "aws-sdk": "^2.608.0",
    "axios": "^0.19.2",
    "local-storage": "^2.0.0",
    "lodash": "^4.17.15",
    "moment": "^2.24.0",
    "nconf": "^0.10.0",
    "react": "^16.12.0",
    "react-dom": "^16.12.0",
    "react-redux": "^7.1.3",
    "react-router-dom": "^5.1.2",
    "react-scripts": "^3.4.0",
    "redux": "^4.0.5",
    "typeface-roboto": "0.0.75",
    "uuid": "^3.4.0"
  }
```

This has worked to resolve my immediate issue. 

However I am hoping that the Amplify team can get back to me with an answer to this issue.
## Comment

---------------

Author: @ryanhinojosa

I'm getting this exact same error while moving from Amplify 2.x to 3. Any guidance here would be enormously helpful!
## Comment

---------------

Author: @ryanhinojosa

I was able to get past this error by:
- Removing all Amplify dependencies in package.json
- Deleting package-lock.json
- Deleting node_modules
- npm install aws-amplify @aws-amplify/ui-react
- Going to this page ([https://docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application](https://docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application)) and starting with the section "Re-use existing authentication resource" since I already had a Cognito back-end set up.

Hopefully this works for you.
## Comment

---------------

Author: @manueliglesias

Hi @hyprstack 

I noticed you have this in your `package.json`:

```
    "aws-amplify": "^2.2.1",
    "aws-amplify-react": "^3.1.9",
    "aws-amplify-react-native": "^2.2.3",
```
I think you don't need both `aws-amplify-react` and `aws-amplify-react-native` in your project, typically you use one or the other depending on your platform. Also, can you try using the latest versions and make sure you remove your `node_modules` and lock files (`yarn.lock` and `package-lock.json`)?

Basically, @ryanhinojosa 's suggestions 

Let us know how it goes
## Comment

---------------

Author: @qtagtech

I found out that by mistake I had both @aws-amplify/core@3.2.7(latest) and aws-amplify@3.0.10 (one before the latest). I updated to just have aws-amplify 3.0.11 and it worked again. I say again because before in a different branch the project was with @aws-amplify/core@^3.2.7 and aws-amplify@^3.0.10. Probably it was installing both the latest versions and not having the conflict? It might just give some light into the problem.
## Comment

---------------

Author: @hyprstack

@manueliglesias I had deleted my node modules and lock file as describe above. Also please notice in my initial post, where the error is occurring, my package.json only contains "@aws-amplify/auth": "^3.2.7",  "@aws-amplify/ui-react": "^0.2.6" and "aws-amplify": "^2.3.0".
@qtagtech thanks I will give this a try and let you know.

thanks
## Comment

---------------

Author: @alexandprivate

> I was able to get past this error by:
> 
> * Removing all Amplify dependencies in package.json
> * Deleting package-lock.json
> * Deleting node_modules
> * npm install aws-amplify @aws-amplify/ui-react
> * Going to this page ([docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application](https://docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application)) and starting with the section "Re-use existing authentication resource" since I already had a Cognito back-end set up.
> 
> Hopefully this works for you.

I can confirm this works for me! Thanks @ryanhinojosa 
## Comment

---------------

Author: @hyprstack

I am still unable to replicate the fix provided by @ryanhinojosa . I have in the meantime used an entirely new laptop and tried following the solution provided above. I then tried following the docs and used the `AmplifyAuthenticator` component. With the docs from using an already existing user pool, there was no login page and the app simply seemed to proceed as if the user was logged in, although I had cleared the local storage and cache.

For now it seems I am going to keep using the previous version and logical flow.
## Comment

---------------

Author: @iaarnio

I had these amplify dependencies:
```
"@aws-amplify/api": "latest",
"@aws-amplify/auth": "^3.2.13",
"@aws-amplify/pubsub": "latest",
"aws-amplify": "^3.0.7",
"aws-amplify-react": "^4.1.6",
```
Hard locking the versions to few days older versions (and removing node_modules and the lock file) fixed the issue for me:
```
"@aws-amplify/api": "3.1.15",
"@aws-amplify/auth": "3.2.12",
"@aws-amplify/pubsub": "3.0.16",
"aws-amplify": "3.0.16",
"aws-amplify-react": "4.1.15",
```
## Comment

---------------

Author: @JohanAltamar

> I was able to get past this error by:
> 
> * Removing all Amplify dependencies in package.json
> * Deleting package-lock.json
> * Deleting node_modules
> * npm install aws-amplify @aws-amplify/ui-react
> * Going to this page (https://docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application) and starting with the section "Re-use existing authentication resource" since I already had a Cognito back-end set up.
> 
> Hopefully this works for you.

Still working :)
## Comment

---------------

Author: @ashika01

@hyprstack Usually this happens in case one dependencies not being linked to each other properly. Either use all latest version or using all pinned version should help you fix this issue. 

In cases of migrating from 2.x to 3.x, @ryanhinojosa suggestion is spot on. In most cases, a need to delete anything cached and reinstalling should solve it for you. 

Let me know if this solves the problem.
## Comment

---------------

Author: @imhashir

Tried everything above but none worked. Updated versions as below and it started working fine:

```
"aws-amplify": "3.3.3",
"aws-amplify-react-native": "4.2.7",
```
## Comment

---------------

Author: @wei

As @ashika01 said. It is mostly likely caused by mismatching versions between the amplify ui-component package and `aws-amplify` package. I get this when I upgrade `aws-amplify` but forgot to update amplify ui-component or vise-versa.

Please install the latest using
```
yarn add aws-amplify@latest
yarn add @aws-amplify/ui-react@latest  # or any other amplify ui component package
```
and it should work fine. If not, remove `node_modules` first before attempting it again.
## Comment

---------------

Author: @nubpro

Can't believe I hit this error too. I was simply following along the basic tutorial to setup a React project. https://docs.amplify.aws/start/getting-started/installation/q/integration/react

Come on, make this easier for beginners please. I'd really wonder how many of them spend more than a couple of hours trying to figure out why their app is not working, they'd probably stuck and gave up. They are punished for not looking through the console logs.
## Comment

---------------

Author: @ktmdan

For anyone that is still getting the error the solution was to add this Auth.configure(awsconfig); after your Amplify.configure(awsconfig);.  
## Comment

---------------

Author: @IanPhilips

When I reimported `Auth` in different files the configuration I made in `App.js` wasn't propagating, so I stored the `Auth` post configuration in my React context a la:   
```import Amplify, { Auth } from 'aws-amplify';
import awsmobile from '../src/aws-exports';
Amplify.configure(awsmobile);
Auth.configure(awsmobile);

const initialState = {
    amplifyAuth:Auth,
};
const store = createContext(initialState);
```  

then accessed it later via `useContext(store)`, check out [React Context](https://reactjs.org/docs/context.html)  

There are other ways to access the Auth object after configuring it though, so do whatever makes sense for you. I'm new to React contexts so I may be hammering a screw here.
## Comment

---------------

Author: @cloud-github

Make sure package version is right!

This package combination don't work.

`"aws-amplify": "^4.0.3",
    "aws-amplify-react": "^5.0.1",`

This package combination works fine.
`"aws-amplify": "^3.3.27",
    "aws-amplify-react": "^4.2.31",`






## Comment

---------------

Author: @jrc

I ran into this using React Native. The trick is to call `Amplify.configure()`, documented in https://docs.amplify.aws/lib/auth/start/q/platform/js/#configure-your-application. This step is missing in the "Add authentication" section of the Amplify "Getting Started" tutorials at e.g. https://docs.amplify.aws/start/getting-started/auth/q/integration/react-native/.

Update: It's actually there, at the bottom of a previous page, at https://docs.amplify.aws/start/getting-started/setup/q/integration/react-native/#install-amplify-libraries

```
import Amplify from 'aws-amplify'
import config from './src/aws-exports'
Amplify.configure(config)
```
## Comment

---------------

Author: @hyprstack

I since then upgraded to `"aws-amplify": "^4.3.12"` and `"@aws-amplify/ui-react": "^2.1.8"` as shown in my `package.json` file:

```javascript
{
  "name": "demo-app",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@aws-amplify/ui-react": "^2.1.8",
    "@emotion/react": "^11.7.1",
    "@emotion/styled": "^11.6.0",
    "@material-ui/core": "^4.12.3",
    "@mui/icons-material": "^5.3.0",
    "@mui/material": "^5.2.8",
    "@testing-library/jest-dom": "^5.16.1",
    "@testing-library/react": "^12.1.2",
    "@testing-library/user-event": "^13.5.0",
    "aws-amplify": "^4.3.12",
    "exifr": "^7.1.3",
    "i18next": "^21.6.6",
    "i18next-browser-languagedetector": "^6.1.2",
    "i18next-http-backend": "^1.3.1",
    "ol": "^6.12.0",
    "pure-md5": "^0.1.13",
    "react": "^17.0.2",
    "react-dom": "^17.0.2",
    "react-i18next": "^11.15.3",
    "react-redux": "^7.2.6",
    "react-router-dom": "^6.2.1",
    "react-scripts": "5.0.0",
    "web-vitals": "^2.1.2"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "prepare": "husky install",
    "pretty": "prettier --write \"./**/*.{js,jsx,json}\""
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "husky": "^7.0.4",
    "lint-staged": "^12.1.7",
    "prettier": "^2.5.1"
  },
  "lint-staged": {
    "*.{js,css,md}": "prettier --write"
  }
}
```

I *have also* updated my config file located in the public folder:

```javascript
const CONFIG = {
  AWS: {
    aws_appsync_graphqlEndpoint:
      "https://xxxxxxxxxxxxxxxxxx.appsync-api.sa-xxxx.amazonaws.com/graphql",
    aws_appsync_region: "sa-xxxxx",
    aws_appsync_authenticationType: "AMAZON_COGNITO_USER_POOLS",
    identityPoolId: "sa-east-1:xxxxxxxxxxxxxxxxx",
    region: "sa-xxxxx",
    aws_user_files_s3_bucket_region: "sa-xxxxx",
    aws_content_delivery_bucket_region: "sa-xxxxx",
    aws_user_files_s3_bucket: "dev-content-xxxxxxxxx",
    identityPoolRegion: "sa-xxxxx",
    userPoolId: "sa-xxxxxx_xxxxxxxxx",
    userPoolWebClientId: "xxxxxxxxx",
    authenticationFlowType: "USER_PASSWORD_AUTH",
  },
};
```

With my `App.js` now looking like this:

```javascript
import React from "react";
import Router from "./router";
import { MuiThemeProvider } from "@material-ui/core/styles";
import { connect } from "react-redux";

import "./App.css";
import theme from "./themes";
import CssBaseline from "@mui/material/CssBaseline";

class App extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      loggedIn: props.loggedIn,
      ready: false,
    };
  }

  async componentDidMount() {
    const {
      props: {
        user: {
          signInUserSession: {
            accessToken: { payload },
          },
        },
      },
    } = this;

    this.setState({ ready: true });
  }

  render() {
    const { loggedIn, ready } = this.state;

    if (!loggedIn || !ready) {
      return null;
    }

    return (
      <MuiThemeProvider theme={theme}>
        <CssBaseline />
        <div className="App">
          <Router signOut={this.props.signOut} />
        </div>
      </MuiThemeProvider>
    );
  }
}

export default connect(null)(App);
```

`index.js`

```javascript
import React, { Suspense } from "react";
import ReactDOM from "react-dom";
import { Provider } from "react-redux";

import store from "./redux/store";
import AuthWrapper from "./AuthWrapper";
import "./index.css";
import reportWebVitals from "./reportWebVitals";
import "./i18n";

ReactDOM.render(
  <React.StrictMode>
    <Provider store={store}>
      <Suspense fallback={null}>
        <AuthWrapper />
      </Suspense>
    </Provider>
  </React.StrictMode>,
  document.getElementById("root")
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();
```

And `AuthWrapper.js`:

```javascript
import React, { useEffect, useState } from "react";
import Amplify, { I18n } from "aws-amplify";
import { Authenticator, View } from "@aws-amplify/ui-react";
import "@aws-amplify/ui-react/styles.css";
import { translations } from "@aws-amplify/ui";
import { connect } from "react-redux";

import LanguageSelect from "./components/languageSelect";
import { useTranslation } from "react-i18next";
import App from "./App";
import "./App.css";

/*global CONFIG */
Amplify.configure(CONFIG.AWS);

const components = {
  Header() {
    return (
      <View as="section">
        <LanguageSelect />
      </View>
    );
  },
};

const AuthWrapper = (props) => {
  const { language } = props;
  const { t } = useTranslation();
  const [lng, setLng] = useState(language);

  useEffect(() => {
    const placeholderSpanishVocab = t("awsAmplifySignIn");
    I18n.putVocabularies(translations);
    I18n.putVocabulariesForLanguage("es", placeholderSpanishVocab);
    I18n.setLanguage(language);
  });

  useEffect(() => {
    setLng(language);
  }, [language, setLng]);

  useEffect(() => {
    if (language !== lng) {
      I18n.setLanguage(language);
    }
  }, [language, lng]);

  return (
    <Authenticator components={components}>
      {(props) => {
        return <App {...props} loggedIn={true} />;
      }}
    </Authenticator>
  );
};

const mapStateToProps = (state) => {
  const { lng: language } = state;
  return { language };
};

export default connect(mapStateToProps, null)(AuthWrapper);
```

Hope this helps people coming here looking for answers ✌️ 
## Comment

---------------

Author: @styled-man

I'm getting this error now and I'm not even using auth

---------------

---------------

# How to send username and temporary password in separate messages

---------------

Author: @ggalantucc
Upvotes: 1
Comments: 0

Hi,
I'm testing Cognito as IdP and checking all available options.
I'm now working on admin users creation and on lambda functions to customize welcome email.
I was wondering if it's somehow possible to use lambda functions to send username and temporary password on separate emails or even email + sms.
I know that through AWS Cognito default Message customization as per the service design user name and temporary password are getting sent in to the same email. The custom message must contain the {username} and {####} placeholders. 
Is it possible to split for a better security uername and temporary password in 2 distinct messages ?

Thanks

---------------

---------------

# Getting user attributes related to item ownership.

---------------

Author: @Zanndorin
Upvotes: 1
Comments: 1

Hi, Copying from https://stackoverflow.com/questions/62739796/amplify-get-owner-user-attributes-from-cognito

Is it possible / Is there an easy way to access user attributes from an item owner (i.e. Cognito user id)? 

```
type Item
@model
@auth(rules: [
    { allow: owner},
    { allow: groups, groups: ["Admin"] },
    { allow: private, operations: [read] },
    { allow: public, operations: [read] }
])
{
    id: ID!
    title: String!
    description: String
}
```

```
{
  "__typename": "Item",
  "_lastChangedAt": 1593707126605,
  "_version": 1,
  "createdAt": "2020-07-02T16:25:26.582Z",
  "description": "Description",
  "id": "0592fcd8-408e-406e-84bf-9f63eb43e147",
  "owner": "2b10fb7e-4472-43c9-9bb9-54219b5027a3",
  "title": "Item",
  "updatedAt": "2020-07-02T16:25:26.582Z"
}
```
## Comment

---------------

Author: @RossWilliams

you can use a  function resolver on a 'cognitoAttributes' field. The lambda function can call admin-get-user in Cognito and return the attributes. The lambda function will receive the dynamo Item in the event.source property so you will have access to the owner id to make the call to Cognito.

```gql
type Item
@model
@auth(rules: [
    { allow: owner},
    { allow: groups, groups: ["Admin"] },
    { allow: private, operations: [read] },
    { allow: public, operations: [read] }
])
{
    id: ID!
    title: String!
    cognitoAttributes: [String]! @function('cognitoGetUserAttributes-${env})
    description: String
}
```

---------------

---------------

# In AWS Amplify, is it possible to have two separate teams (repos) working on the frontend and backend separately?

---------------

Author: @beevor
Upvotes: 1
Comments: 0

I would like to develop a React app using Amplify and two dev teams. Can one team work on the frontend exclusively, without giving them access to the backend code (the amplify folder)? The backend team can have access to both the backend and frontend code. If possible, how would I set it up?

---------------

---------------

# Not catching iOS notification when app is closed

---------------

Author: @dsws
Upvotes: 2
Comments: 1

I'm using Amplify for push notifications
https://docs.amplify.aws/lib/push-notifications/getting-started/q/platform/js/

I'm using the plugin https://github.com/react-native-push-notification/ios
Followed the instructions provided.

When the app is open in the background, the handlers PushNotification.onNotificationOpened and PushNotificationIOS.addEventListener are catching the notification

When the app is closed and I click on the IOS notification, the event is not getting caught.

Your feedback would be appreciated on how to move forward. Been stuck on this for too long :(

yarn list v1.22.19
├─ @aws-amplify/analytics@5.2.11
├─ @aws-amplify/api-graphql@2.3.8
├─ @aws-amplify/api-rest@2.0.44
├─ @aws-amplify/api@4.0.44
├─ @aws-amplify/auth@4.5.8
├─ @aws-amplify/cache@4.0.46
├─ @aws-amplify/core@4.5.8
├─ @aws-amplify/datastore@3.12.1
├─ @aws-amplify/geo@1.3.7
├─ @aws-amplify/interactions@4.0.44
├─ @aws-amplify/predictions@4.0.44
├─ @aws-amplify/pubsub@4.4.5
├─ @aws-amplify/pushnotification@4.3.23
├─ @aws-amplify/storage@4.4.27
├─ @aws-amplify/ui@2.0.5
├─ @aws-amplify/xr@3.0.44
├─ aws-amplify-react-native@6.0.5
└─ aws-amplify@4.3.26

Setting in IOS Signing and Capabilities
![Screen Shot 2022-07-04 at 11 59 33 AM](https://user-images.githubusercontent.com/60757593/177189114-539bc07d-9420-4f50-8592-bc9f207a2593.png)




#import "AppDelegate.h"
#import <React/RCTBridge.h>
#import <React/RCTBundleURLProvider.h>
#import <React/RCTRootView.h>
#import <React/RCTLinkingManager.h>
#import "RNBootSplash.h"
#import <UserNotifications/UserNotifications.h>
#import <RNCPushNotificationIOS.h>

// #ifdef FB_SONARKIT_ENABLED
// #import <FlipperKit/FlipperClient.h>
// #import <FlipperKitLayoutPlugin/FlipperKitLayoutPlugin.h>
// #import <FlipperKitUserDefaultsPlugin/FKUserDefaultsPlugin.h>
// #import <FlipperKitNetworkPlugin/FlipperKitNetworkPlugin.h>
// #import <SKIOSNetworkPlugin/SKIOSNetworkAdapter.h>
// #import <FlipperKitReactPlugin/FlipperKitReactPlugin.h>
#import <React/RCTLinkingManager.h>


// static void InitializeFlipper(UIApplication *application) {
//   FlipperClient *client = [FlipperClient sharedClient];
//   SKDescriptorMapper *layoutDescriptorMapper = [[SKDescriptorMapper alloc] initWithDefaults];
//   [client addPlugin:[[FlipperKitLayoutPlugin alloc] initWithRootNode:application withDescriptorMapper:layoutDescriptorMapper]];
//   [client addPlugin:[[FKUserDefaultsPlugin alloc] initWithSuiteName:nil]];
//   [client addPlugin:[FlipperKitReactPlugin new]];
//   [client addPlugin:[[FlipperKitNetworkPlugin alloc] initWithNetworkAdapter:[SKIOSNetworkAdapter new]]];
//   [client start];
// }
// #endif


@implementation AppDelegate

- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url
  sourceApplication:(NSString *)sourceApplication annotation:(id)annotation
{
  return [RCTLinkingManager application:application openURL:url
                      sourceApplication:sourceApplication annotation:annotation];
}

// Only if your app is using [Universal Links](https://developer.apple.com/library/prerelease/ios/documentation/General/Conceptual/AppSearch/UniversalLinks.html).
- (BOOL)application:(UIApplication *)application continueUserActivity:(NSUserActivity *)userActivity
 restorationHandler:(void (^)(NSArray * _Nullable))restorationHandler
{
 return [RCTLinkingManager application:application
                  continueUserActivity:userActivity
                    restorationHandler:restorationHandler];
}

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
// #ifdef FB_SONARKIT_ENABLED
//   InitializeFlipper(application);
// #endif

  RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self launchOptions:launchOptions];
  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge
                                                   moduleName:@"BoatLink"
                                            initialProperties:nil];

  UNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];
  center.delegate = self;

  if (@available(iOS 13.0, *)) {
      rootView.backgroundColor = [UIColor systemBackgroundColor];
  } else {
      rootView.backgroundColor = [UIColor whiteColor];
  }

  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
  UIViewController *rootViewController = [UIViewController new];
  rootViewController.view = rootView;
  self.window.rootViewController = rootViewController;
  [self.window makeKeyAndVisible];
  [RNBootSplash initWithStoryboard:@"LaunchScreen" rootView:rootView];
  return YES;
}

- (NSURL *)sourceURLForBridge:(RCTBridge *)bridge
{
#if DEBUG
  return [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@"index" fallbackResource:nil];
#else
  return [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];
#endif
}

- (BOOL)application:(UIApplication *)application
   openURL:(NSURL *)url
   options:(NSDictionary<UIApplicationOpenURLOptionsKey,id> *)options
{
  return [RCTLinkingManager application:application openURL:url options:options];
}

// Required for the register event.
- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken
{
 [RNCPushNotificationIOS didRegisterForRemoteNotificationsWithDeviceToken:deviceToken];
}
// Required for the notification event. You must call the completion handler after handling the remote notification.
- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo
fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler
{
  [RNCPushNotificationIOS didReceiveRemoteNotification:userInfo fetchCompletionHandler:completionHandler];
}
// Required for the registrationError event.
- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error
{
 [RNCPushNotificationIOS didFailToRegisterForRemoteNotificationsWithError:error];
}
// Required for localNotification event
- (void)userNotificationCenter:(UNUserNotificationCenter *)center
didReceiveNotificationResponse:(UNNotificationResponse *)response
         withCompletionHandler:(void (^)(void))completionHandler
{
  [RNCPushNotificationIOS didReceiveNotificationResponse:response];
}

-(void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions options))completionHandler
{
  completionHandler(UNNotificationPresentationOptionSound | UNNotificationPresentationOptionAlert | UNNotificationPresentationOptionBadge);
}

@end





#import <React/RCTBridgeDelegate.h>
#import <UIKit/UIKit.h>
#import <UserNotifications/UNUserNotificationCenter.h>

@interface AppDelegate : UIResponder <UIApplicationDelegate, RCTBridgeDelegate, UNUserNotificationCenterDelegate>

@property (nonatomic, strong) UIWindow *window;

@end



## Comment

---------------

Author: @dsws

So after long annoying debugging sessions, @twointo2 found the correct answer :)

When you add this function call at the top, then onNotificationOpened starts getting the notification when app was killed.

PushNotificationIOS.getInitialNoticiation()

---------------

---------------

# Amplify UI login with a custom OIDC provider

---------------

Author: @simonboland
Upvotes: 1
Comments: 1

I am building a proof of concept to allow users to sign in through a federated login with OIDC to Azure. I'm having trouble getting the React frontend with Amplify to show my OIDC login option.

**Cognito setup**
I have set up a cognito user pool outside of Amplify with the following steps:

1. Set up a Cognito user pool
2. Set up an OIDC provider with Azure and confirmed that the discovery works.  This is called AzureOIDC.  I also added Google as a Federated identity. 
3. Set up a web App Client (no secret key)
4. Under Cognito -> App integration, I set up the domain name and under App Client webclients, I added the following identity providers
- AzureOIDC 
- Google
- Cognito User Pool

![image](https://user-images.githubusercontent.com/31790674/177230235-866e258f-7650-4df3-a2c7-86f8c19e0e2e.png)

Callback and Signout URLs are simply http://localhost:3000/ for testing
OAuth 2.0 flows are Authorization Code and Implicit grants and Allowed OAuth Scopes are email, openid, aws.cognito.signin.user.admin and profile. 

When I run the hosted UI, I see:  
![image](https://user-images.githubusercontent.com/31790674/177230273-836e265c-7767-4b37-a417-1c0abd5a7c5a.png)

**Amplify setup**
Then in Amplify I set up a project and imported the Cognito user pool using the command

`amplify import auth`

When I run `yarn start`, it shows me the Google and Cognito user pool option but no Azure OIDC.    See the screenshot.

![image](https://user-images.githubusercontent.com/31790674/177230303-393eefcb-e834-4b7d-811c-a6add06152d4.png)

My aws-export.js has no reference to the AzureOIDC.   I would prefer that it redirects to the hosted UI URL. 
## Comment

---------------

Author: @simonboland

I found that the [example](https://github.com/aws-samples/aws-amplify-oidc-federation) in the `amplify-frontend` provides a good example to follow here on how to set up the UI to use a Federated login.   

---------------

---------------

# Amplify Build failed to complete successfully.

---------------

Author: @yuriyseriy
Upvotes: 10
Comments: 8

Hello

i do all the points in [this manual](https://aws.amazon.com/ru/getting-started/hands-on/build-react-app-amplify-graphql/module-three/?e=gs2020&p=build-a-react-app-two), but after step "Set up CI/CD of the front end and backend" i get error "Build failed to complete successfully."

OS: Mac OS 12.1
Amplify CLI 7.6.5


**Build log:**

```# Starting phase: build
2022-01-04T18:19:41.251Z [INFO]: Invalid feature flag configuration
2022-01-04T18:19:41.253Z [INFO]: These feature flags are defined in the "amplify/cli.json" configuration file and are unknown to the currently running Amplify CLI:
                                   - project
                                   - graphqltransformer.transformerversion
                                   - graphqltransformer.suppressschemamigrationprompt
                                   - auth.useenabledmfas
                                 This issue likely happens when the project has been pushed with a newer version of Amplify CLI, try updating to a newer version.
                                 Ensure that the CI/CD pipeline is not using an older or pinned down version of Amplify CLI.
                                 Learn more about feature flags: https://docs.amplify.aws/cli/reference/feature-flags
2022-01-04T18:19:41.261Z [ERROR]: !!! Build failed
2022-01-04T18:19:41.262Z [ERROR]: !!! Non-Zero Exit Code detected
2022-01-04T18:19:41.262Z [INFO]: # Starting environment caching...
2022-01-04T18:19:41.262Z [INFO]: # Uploading environment cache artifact...
2022-01-04T18:19:41.326Z [INFO]: # Environment caching completed
```

On page [Feature Flags](https://docs.amplify.aws/cli/reference/feature-flags/) i don't see flags:

- project
- graphqltransformer.transformerversion
- graphqltransformer.suppressschemamigrationprompt
- auth.useenabledmfas
## Comment

---------------

Author: @parthipank

Im currently having this issue. I have tried modifying the AMPLIFY CLI version to latest in the console but still getting the same error.
Its failing even when both my local and console Amplify CLI version are same. 
## Comment

---------------

Author: @martinventx

I ran in the preBuild step inside the amplify.yaml a npm update, which caused this Problem.
**npm i -g npm@8.3.0**
Try to remove it from the backend preBuild/Build in amplify.yml.
Not sure how it is on your local machine, but guess it also has something todo with the npm version.
## Comment

---------------

Author: @dodige

I had this  same error message while going throught the tutorial
After looking around i found that this was coming from the build process in AWS being run to build  my backend.
After noting the CLI version on my local machine ( 7.6.5 ) i updated the  the build config side by addiing a pre build section to install a similar CLI version as my local install and it fixed the issue. Tutorial should include this to save grief...

Anyway here the portion of my application build file that i modify  ( just before the frontend section if you are using one ) :
          
          > 
          > 
          > version: 1
          > env:
          >   variables:
          >     VERSION_AMPLIFY: 7.6.5
          > backend:
          >   phases:
          >     preBuild:
          >       commands:
          >         - npm i -g @aws-amplify/cli@${VERSION_AMPLIFY}
          >     build:
          >       commands:
          >         - '# Execute Amplify CLI with the helper script'
          >         - amplifyPush --simple
          > 


THe application build file can be found in the amplify console of your app, select the "build settings" under the "app setting" on the left hand side menu.


Regards
## Comment

---------------

Author: @sidchopp

Thanks @dodige. It worked man. Thanks a lot.
## Comment

---------------

Author: @mandeepsingh-private

I was able to fix it by rolling back the cli locally to my original version locally

`sudo npm install -g @aws-amplify/cli@7.4.0`

 and then deleting these 2 lines from file amplify/cli.json

These feature flags are defined in the "amplify/cli.json" configuration file and are unknown to the currently running Amplify CLI:
  - graphqltransformer.securityenhancementnotification
  - graphqltransformer.showfieldauthnotification
## Comment

---------------

Author: @prestonhom

@mandeepsingh-private How did you push amplify/cli.json?
Having trouble deleting those lines and then running `amplify push`. It appears that my changes don't get updated in the cloud when I do.
## Comment

---------------

Author: @fertrevino

I can confirm the problem, the solution provided by @dodige worked for me. In my case _amplify.yml_ in the build settings console had to be replaced with this:


```yaml
version: 1
env:
  variables:
    VERSION_AMPLIFY: 7.6.26
backend:
  phases:
    preBuild:
      commands:
        - npm i -g @aws-amplify/cli@${VERSION_AMPLIFY} 
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: build
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*

```
## Comment

---------------

Author: @ayllondark

A mi me funciono quitando del gitignore el archivo aws-export.js para que se subiera a mi repo de github ya que eso pide en la consola de aws amplify y por eso salía error. Aparte también tienen que tener su archivo amplify.yml que se creo o descargaste cuando creaste tu proyecto desde amplify.

---------------

---------------

# Hosting Nextjs with SSG + ISG

---------------

Author: @lucaswong98
Upvotes: 1
Comments: 0

Hi there,

My team is trying to host a next.js ecommerce app using AWS services because we have the aws credits in our account so we are thinking to utilise it. We are shifting from a fullstack C# nopcommerce app to RESTful api and a js frontend framework. The apis are ady built in and ready to go, so we are trying to use nextjs as our frontend app that provides features like seo and image optimization.

So far we come across AWS amplify service as the most commonly used service to host nextjs outside of vercel. However, we are not planning to use server side rendering and we are not building any api files in the nextjs app, as we ady a fully working api mentioned above, so the idea is to use SSG + ISG + Client side rendering only to handle the data fetched from api. 

So far we come across AWS amplify service as the most commonly used service to host nextjs outside of vercel. 

Question:
1. Does a SSG site on aws amplify still has the feature of incremental static generation (ISG) ? Because its not practical to rebuild the whole site if we have a product detail changed.
2. Does ISG requires aws lambda to work?
3. Is there any alternative to AWS amplify? We have a working EC2 VM so if possible we are trying to host our nextjs in the VM instead of using amplify

---------------

---------------

# setupTOTP state component render conditions?

---------------

Author: @TuTomasz
Upvotes: 1
Comments: 0

I'm using amplify UI in a project and various component states work correctly, except for the setupTOTP state which documentation defines in the formFields prop. How does one trigger that state? Or what are the conditions for that state to render on login or signup?

---------------

---------------

# Use refreshtoken from subdomain A to authenticate for subdomain B in Cognito

---------------

Author: @mattiLeBlanc
Upvotes: 3
Comments: 0

We are using Cognito via Amplify/Auth to handle our signup. After the signup is done (on signup.foo.com) we redirect the user to the dashboard (on app.foo.com).
Using localstorage, the session is locked to the domainname of signup.foo.com and not accessible at signup.foo.com.

We used cookieStorage with a *.foo.com domain, which worked, but we are having issues with the cookies disappearing on our mobile Webview solution, so I am looking at going back to the localstorage solution.

However, it seems to be impossible to carry over a session from one subdomain to the second, even if we use the same app client in Cognito.

I was able to get a new access token using the refresh token of the signup session using `aws cognito-idp admin-initiate-auth` via the command line, but I can't manually inject the refreshToken or accessToken in the localstorage with the correct key name.
The Auth module doesn't accept it, and it probably is because the domain is hashed into the refreshtoken.

Is there an official way to, either via Node and a valid refresh or JWT token, to get a new token that can be injected into subdomain B?

Cheers,

Mattijs

---------------

---------------

# AWS Appsync GraphQL: Resolver Request Payload does not contain "identity" in the context

---------------

Author: @tammha
Upvotes: 1
Comments: 0

Hi,
I have 2 AppSync GraphQL APIs, where one is Auth using IAM, and the other using Cognito Pools.
Both these APIs have been setup with correct roles, etc for security, because I can query and mutate data into DynamoDB.

For clients have have used:

Postman = AWS Signature (IAM using Temp STS AccessKey/SecretKey and Session Tokens)
Amplify API.graphQL API to make query calls.
Both the clients successfully interacted with the AppSync API server to query and mutate. I am accessing the Gql Endpoint as shown in the App Sync Console ==> Settings. That is:

https://.appsync-api.ap-southeast-2.amazonaws.com/graphql

However, in the cloudwatch logs, I can see that the payload in to the RequestMapping, there is no "identity" key. According to the documentation, I should get the identity property with their respective values depending on whether the Auth was AWS_IAM or AMAZON_COGNITO_USER_POOLS (https://docs.aws.amazon.com/appsync/latest/devguide/resolver-context-reference.html).

Am I missing some setting such that the identity info is not passed into the RequestMapping resolver?

---------------

---------------

# Social auth duplicate user.

---------------

Author: @rahulje9
Upvotes: 1
Comments: 2

Hi,
I have set up Social auth in my React Native application. I have added Facebook, Google Signup with Identity pool. What my issue is if a person with same email id in Facebook and Google tries to login, it is taken as two different accounts than one. is it some error on my end or is it is done like that by the package?
## Comment

---------------

Author: @techdragon

I opened an issue for this on the Amplify CLI repo a few days ago. https://github.com/aws-amplify/amplify-cli/issues/4427
## Comment

---------------

Author: @YajanaRao

Hi @rahulje9 . Can you please provide the code for google sign in ? I am getting the error with useragent:
https://github.com/aws-amplify/amplify-js/discussions/10023

---------------

---------------

# Authorisation Error in React Native Google Sign In

---------------

Author: @YajanaRao
Upvotes: 1
Comments: 0

I am using Amplify Authorization for Google Login in React Native. I am getting the following error:
![image](https://user-images.githubusercontent.com/38914337/175779208-b0281240-b653-4bf2-8296-310b4d8ec730.png)

Here is the code:
```jsx
function App() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    Hub.listen('auth', ({ payload: { event, data } }) => {
      switch (event) {
        case 'signIn':
        case 'cognitoHostedUI':
          getUser().then(userData => setUser(userData));
          break;
        case 'signOut':
          setUser(null);
          break;
        case 'signIn_failure':
        case 'cognitoHostedUI_failure':
          console.log('Sign in failure', data);
          break;
      }
    });

    getUser().then(userData => setUser(userData));
  }, []);

  function getUser() {
    return Auth.currentAuthenticatedUser()
      .then(userData => userData)
      .catch(() => console.log('Not signed in'));
  }

  return (
    <View>
      <Text>User: {user ? JSON.stringify(user.attributes) : 'None'}</Text>
      {user ? (
        <Button title="Sign Out" onPress={() => Auth.signOut()} />
      ) : (
        <Button title="Google Sign In" onPress={() => Auth.federatedSignIn({ provider: CognitoHostedUIIdentityProvider.Google })} />
      )}
    </View>
  );
}
```

Please do help. 

---------------

---------------

# Replace XMLHttpRequest with fetch in amazon-cognito-identity.js file.

---------------

Author: @IhorHudkov
Upvotes: 1
Comments: 0

Hello, I'm including the amazon-cognito-identity.js file in the server worker background file in the browser extension. The problem is that according to the version 3 manifest, I can't use XMLHttpRequest in the code. I have to use fetch. But the amazon-cognito-identity.js file uses XMLHttpRequest. How to fix it? Thank you.

---------------

---------------

# Using DataStore and AppSync without using the Amplify CLI ?

---------------

Author: @LaurentEscalier
Upvotes: 4
Comments: 2

Hey there 👋 

I've joined a project where we use DataStore to sync app data with an AppSync backend.

In the past it has been decided to not use the Amplify CLI to generate the AppSync backend and its GraphQL schema. Somehow the team has got things to work and we until now has a working sync between DataStore and AppSync.

Now, we've recently updated our `aws-amplify` dependency to a newer version in order to test a new DataStore feature (selective sync), and this new feature requires a change to the Backend (GraphQL schema and resolvers).

Without using the CLI and without proper documentation of the required changes in the Backends, we now find ourselves simply unable to apply the required changes to the AppSync backend.

Now my question is: **Is there any sense in using DataStore / AppSync without using the Amplify CLI ?**

_Note: I'm gonna investigate within my team regarding the reason behind our past decision not to use the CLI._
## Comment

---------------

Author: @ronnyroeller

We're in the same boat. We can't use amplify-cli because our resources are provisioned by serverless (which is less opaque). Yet, we would love to use the features from the frontend amplify-lib like DataStore sync'ing.
It would be great if the amplify-lib would be more separated from amplify-cli. Better documentation would certainly help - but also to support features that shouldn't require a amplify-controlled API (e.g. `amplify codegen models`).
## Comment

---------------

Author: @master-harvey

The Amplify Auth Library Documentation shows [an example](https://docs.amplify.aws/lib/auth/start/q/platform/js/#re-use-existing-authentication-resource) of reusing existing AWS resources with the Amplify API, in this case an existing cognito user pool. The method's full documentation can be found in [the API Reference](https://aws-amplify.github.io/amplify-js/api/index.html#configuration) where they also show an example of using an existing graphql endpoint.

GraphQL models and mutations should stay consistent with the schema so generating them during development with the CLI is still useful before ultimately deploying with the CDK or otherwise.

---------------

---------------

# How to make Datastore offline only mode and sync on demand?

---------------

Author: @mtcha8l
Upvotes: 1
Comments: 3

I'm trying to make a Datastore App that only privileged users can access to cloud, and yet provide local datastore for other users. Is there a way to make Datastore offline/online programmatically?
## Comment

---------------

Author: @sw-yx

probably no - but you might be able to manage a hacky workaround by listening to datastore messages: https://docs.amplify.aws/lib/utilities/hub/q/platform/js#listening-for-regular-expressions
## Comment

---------------

Author: @julie777

I would think that you could call Amplify.configure with different parameters to determine whether it works in offline only mode. Offline only is the preferred development mode.
## Comment

---------------

Author: @emilyahsu

Hi all,

I'm Emily, a UX Designer on the AWS Amplify team, and we're conducting user interviews to learn more about the use cases of offline-first vs online-only development modes. The interview will be take at most 30 minutes, and as a “thank you”, we’d love to provide you with $25 in AWS credits for your time.

If you are interested in participating, please email me at [emilyhsu@amazon.com](mailto:emilyhsu@amazon.com) and we can schedule a time. Thanks!

---------------

---------------

# Auth.federatedSignIn opens an 'undefined' domain

---------------

Author: @wrsulliv
Upvotes: 1
Comments: 1

When I call `Auth.federatedSignIn()` I'm forwarded to `https://undefined/oauth2/authorize?...`

Why is the domain `undefined`?  

I have followed instructions here for Apple integration:  https://aws.amazon.com/blogs/mobile/enable-sign-in-with-apple-on-your-app-with-aws-amplify/

If I manually replace `https://undefined` with my local server `http://localhost:19006` then I can see the generated login page.  However, the "Sign In with Apple" button forwards me to another undefined page.

The only reason I'm using Amplify is for Auth, and it would be nice if I could configure all of this manually with Cognito and bypass Amplify.  I have my own deployment system, and I don't need any of the other serverless resources.

All help is greatly appreciated =)
## Comment

---------------

Author: @temrb

Do you have the cognito URI correctly configured @ apple? I haven't used apple as a federated login though I know for google I had to add google endpoint from amplify onto google console both uri and URI redirect

---------------

---------------

# How to handle multiple simultaneous signins from the same account

---------------

Author: @mariela-plaza
Upvotes: 1
Comments: 1

We are using aws-amplify to utilize Cognito to handle our user's sessions.

Right now, our app allows multiple simultaneous signins from the same user in different devices, but this is something we want to avoid.
We want to use Cognito to either:
* Logout open sessions in other devices whenever the user logs in.
* Notify the user who's loging in on a new device that they already have an open session in other devices and ask them if they want to continue with the login process or if they want to continue with their open session in another device.

I saw this thread in the aws-amplify (flutter) package, but since our app is a web app I'm not sure the same process applies to us:
https://github.com/aws-amplify/amplify-flutter/issues/1206


Any feedback you can provide on this will be very helpful.
Thank you in advance for your responses!

## Comment

---------------

Author: @temrb

I think for that u can use lambda? 

https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-pre-authentication.html

---------------

---------------

# Default support for Brotli in Amplify Hosting

---------------

Author: @lowecg
Upvotes: 13
Comments: 3

Please can Brotli compression be enabled by default for the CloudFront hosting capability of Amplify?

Brotli can potentially achieve significantly higher compression ratios when serving text assets over the wire.

For example, in my use case, I have a single page app (SPA) that uses Amplify. The SPA bakes in a number of Amplify dependencies which adds about 4MiB to the application size, which is a fair bit of extra weight. I know there are ways to reduce this impact using Amplify's modules, but humour me for now.

gzip compression is currently supported by default in Amplify's hosting capability, and in my case, this reduces the "bytes on the wire" when the main code for my client is served to about 655k (according to my browsers network logging).

To examine the impact of using Brotli in my case, I conducted a quick experiment:

I download my SPA's main code file, `app.js`, and ran the following compression scenarios with gzip and brotli using their default compression levels. I got the following results:

```
$ gzip -k app.js 
$ brotli -k app.js
$ ls -lh app*
-rw-r--r--@ 1 lowecg  staff   4.1M  7 May 08:55 app.js
-rw-r--r--  1 lowecg  staff   468K  7 May 08:55 app.js.br                <-- much smaller
-rw-r--r--@ 1 lowecg  staff   654K  7 May 08:55 app.js.gz
```

That's a reduction of **28.4%**! Not too shabby.

For reference, I came across this discussion regarding the compression in the AWS forums and it was suggested that someone makes a feature request:

https://forums.aws.amazon.com/thread.jspa?messageID=968270
## Comment

---------------

Author: @lowecg

Here's the quote from the forum:
> Although we enable compression on the CloudFront distribution which hosts your app, we don't currently set the flag "EnableAcceptEncodingBrotli" necessary to enable Brotli according to this doc: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/ServingCompressedFiles.html
>
>We can take this as a feature request.
## Comment

---------------

Author: @salv0

Any news about this? :)
## Comment

---------------

Author: @drclementshimizu

I have this problem too.  If I try to set the content-type to br in the custom headers, it rejects that as a read only header

---------------

---------------

# [DataStore] Failed to PutOrAdd in database because not enough space for domain

---------------

Author: @cdwheatley
Upvotes: 3
Comments: 0

QuotaExceededError - "Failed to PutOrAdd in database because not enough space for domain"

iOS platform

Is there any way around this error, like to increase the quota?

What is the root cause of this error, and what is the quota?  I was not able to find any documentation on this quota, and it should likely exist somewhere since it can cause this error and it definitely impacts use cases.

I have not been able to run in to this issue on Android, so are the limits different between the OS versions?

Thanks for any help.

---------------

---------------

# Is it possible for One S3 storage to be accessed within authentication from Two client apps?

---------------

Author: @artidataio
Upvotes: 1
Comments: 1

Hi, I have one s3 storage to be used by 2 application. I want it to be accessible under authentication. There is one solution that make the bucket public instead: https://github.com/aws-amplify/amplify-js/issues/960#issuecomment-605456268. However, in my case is not ideal, as anyone with the link will be able to access and download every items in the bucket. 

Previously, I was able to do so. However, for some reason it is breaking now on the app where the s3 storage is manually imported with StatusCode: `403 Forbidden` and response:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Error><Code>AccessDenied</Code><Message>Access Denied</Message><RequestId>0TSX9EX3GX5HFZ6C</RequestId><HostId>N/lPVZtuFGgD8wxV/SUYJQ+jQ/+IySS/Je8rZRaukEHObFyAm3N3J0XMPceV8qDzSvNNF81U0aA=</HostId></Error>
```

Let me know if such scenario is possible. Thanks.
## Comment

---------------

Author: @artidataio

Yeah, it is possible.
> Previously, I was able to do so. However, for some reason it is breaking now on the app where the s3 storage is manually imported with StatusCode: 403 Forbidden and response:
I added admin queries api, and it breaks. I revert it back and remove the admin queries. It works again now. 😕 

---------------

---------------

# Auth.federatedSignIn redirect URLs for Expo Go

---------------

Author: @RocketRonz
Upvotes: 2
Comments: 0

Hi there. Is anyone using Auth.federatedSignIn (Google) with Expo?

I have it working locally by setting the redirect URIs to exp://192.168.1.73:19000/--/ but this obviously doesn't work for a published Expo app. Have tried using exp://exp.host/@user/APP_NAME/--/ but this just displays the Cognito error page in the browser, which provides no information whatsoever :(

Any help would be appreciated, thanks.

---------------

---------------

# Update data without manually property setter in DataStore using AWS Amplify with angular

---------------

Author: @sefatanam
Upvotes: 1
Comments: 1

I used aws-amplify for a very short time for my project. Recently, I'm facing a serious issue about data updating in DataStore in aws-amplify. After reading the docs from their official site I findout that, If I want to update data in DataStore it worked in Immutable way like this,

For creating data,

```
await DataStore.save(
  new Post({
    title: "My First Post",
    rating: 10,
    status: PostStatus.DRAFT
  })
);
```

and for updating data ,

```
const original = await DataStore.query(Post, "123");

await DataStore.save(
  Post.copyOf(original, updated => {
    updated.title = `Any Title`;
  })
);
```

there is no issue with creation but when I goes with update this line is a pain if you have more than 20 property in your object model. Because you have to write all those property and update with it .

```
updated.title = `Any Title`;
``` 

So, I want to update like this without writing all the property in manually,

```
const updatedTestResult = { ...this.testResult, ...this.testResultForm.value };
var result = await DataStore.save(TestResult.copyOf(this.testResult, updatedTestResult))
```

now it showing me this error,

```
TypeError: fn is not a function
    at datastore.js:376:17
    at produce (immer.esm.js:1:16034)
    at Model.copyOf (datastore.js:375:32)
    at test-result-form.component.ts:130:41
    at Generator.next (<anonymous>)
    at asyncGeneratorStep (asyncToGenerator.js:3:1)
    at _next (asyncToGenerator.js:25:1)
    at asyncToGenerator.js:32:1
    at new ZoneAwarePromise (zone.js:1427:29)
    at asyncToGenerator.js:21:1
```

or maybe there have another solution. Can you please me on that ? 

- TIA
## Comment

---------------

Author: @david-mcafee

@sefatanam - thanks for starting this discussion! I've included some examples that would provide the correct input to `copyOf`:

For updating a single property at a time, you could do the following:
```
async function updateTestResult(key, value) {
  try {
    const testResult = await DataStore.save(
      TestResult.copyOf(originalTestResult, (updated) => {
        updated[key] = value;
      })
    );

    console.log("TestResult updated:", testResult);
  } catch (error) {
    console.error("Save failed:", error);
  }
}
```

To update multiple properties at once, you could do the following:
```
async function updateTestResult(testResultForm) {
  try {
    const testResult = await DataStore.save(
      TestResult.copyOf(originalTestResult, (updated) => {
        for (const property in testResultForm) {
          updated[property] = testResultForm[property];
        }
      })
    );

    console.log("TestResult updated:", testResult);
  } catch (error) {
    console.error("Save failed:", error);
  }
}
```

Hope this helps, and let me know if you have further questions!

---------------

---------------

# AWS Amplify User Testing Opportunity

---------------

Author: @emilyahsu
Upvotes: 1
Comments: 0

Hi everyone! I’m Emily, a UX Designer at AWS Amplify, and I’m conducting user interviews to improve the data modeling experience on Amplify. The interview will take at most 1 hour, and as a “thank you”, we’d love to provide you with $100 in AWS credits for your time. If you are interested in participating, please email me at [emilyhsu@amazon.com](mailto:emilyhsu@amazon.com) or DM me on Discord (emilyhsu#6135) and we can schedule a time. Thanks!

---------------

---------------

# Dynamodb trigger Appsync Subscription from Python

---------------

Author: @rkushkuley
Upvotes: 1
Comments: 0

I am updating an item in dynamodb through python. Is there a way for datastore to observe this change? 

It looks like the _version and _lastUpdatedAt does not change when i update item so datastore does not see it as a mutation.

---------------

---------------

# How do I redirect to another URL after sign-in in angular ?

---------------

Author: @sefatanam
Upvotes: 1
Comments: 2

Hi,

I'm using the latest AWS-Amplify's authentication component. It can logged in successfully but after login I need to sent the route to another url which I can't able to achieve, it keeping the same url after logged in. BUT I need to set a custom url where it automatically redirect if a user login successfully.

Note : I'm not using `aws-amplify-angular` package I'm using these packages,
```
 "@aws-amplify/ui-angular": "^2.4.4", 
 "aws-amplify": "^4.3.21",
```
Also I checked this `import {AuthenticatorService} from '@aws-amplify/ui-angular';` service but here I didn't find any response with observable type, I think that's why I don't get any event or something instantly after user login successfully. I need to route imminently after a successful login. So I need an event so that I can do that .

My `main.ts` : 

```
import { Amplify } from 'aws-amplify'
import awsmobile from './aws-exports'
Amplify.configure(awsmobile)
```

`auth.component.html` : [ there is no code in `ts` ]

```
<amplify-authenticator [signUpAttributes]="['email']"></amplify-authenticator>
```

& the routes setup like this,

```
const routes: Routes = [
  {
    path: 'home',
    component: HomeComponent,
    canActivate: [AuthGuard]
  },
  {
    path: 'auth',
    component: AuthComponent
  },
  {
    path: '',
    redirectTo: 'home',
    pathMatch: 'full'
  }
];
```

I didn't get any good solution with using this packages. Please help with this issue or am I missed something in my configuration .
## Comment

---------------

Author: @wlee221

Oh yeah, `@aws-amplify/ui-angular` needs a much better `observable` way to track state changes. Note that `AuthenticatorService.user`, `AuthenticatorService.route` are getters -- so basic SPA usages like

```html
<div *ngIf="authenticatorService.route === 'authenticated>
  Hello!
</div>
```

will work, but routed usage like your use case wouldn't work very well. 

For immediate workaround, `AuthenticatorService` has an internal `subscribe` method that you can use:

```ts
consturctor(private router: Router, private authenticatorService: AuthenticatorService) {}

ngOnInit(): void {
  this.authenticatorService.subscribe(() => {
    const { route } = this.authenticatorService;
    
    if (route === 'authenticated') {
      this.router.navigate(['/home'])
    }
  });
}
```
## Comment

---------------

Author: @wezside

For anyone else looking for a state change event it's possible to use `Hub.listen` for this:

`
Hub.listen('auth', (data) => {
        const { payload } = data;
        console.log(data);
    });
`

---------------

---------------

# Amplify push updated the wrong App

---------------

Author: @whunter
Upvotes: 1
Comments: 0

Hi, we have several Amplify apps based on the same codebase. Yesterday I wanted to add a new backend env to one of them for testing. I pulled our repo from Github and then from the root of the project I ran `amplify pull <desired app ID>` where the "desired app ID" was found at the end of the ARN on the Amplify App Settings > General tab. The CLI then asks several questions and among them was "Which app are you working on?" So I chose the app that I wanted to update. I made my changes to the backend and ran `amplify push`. When the push completed I looked for my new backend on the app web page in the AWS console. It wasn't there but I did find it in a different app. 

Could someone let me know where I went wrong? I tried it twice with the same results. I guess I must be missing a step somewhere.

Thanks!

---------------

---------------

# How to delete unconfirmed users from Cognito ?

---------------

Author: @T-DiegoF
Upvotes: 3
Comments: 0

I need to delete the users that remain unconfirmed in the user pools. What dou you recommend?

---------------

---------------

# How can I use Amplify with service worker in Chrome extension

---------------

Author: @prli
Upvotes: 5
Comments: 0

I have a chrome extension which uses AWS Amplify for authentication. I currently have it within background.html for authentication using chrome manifest v2. Chrome will remove support for manifest v2 by 2023 and I am trying to upgrade my extension from v2 to v3. 

In manifest v3, background pages are replaced by service workers. 
https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/#service-workers

Once I changed my background page to service worker, Amplify started throwing `Not Supported` error.

I have created a sample repository that demonstrate the issue.
amplify sample that is working - https://github.com/prli/AwsAmplifySample/tree/master
amplify sample using service worker which fails - https://github.com/prli/AwsAmplifySample/tree/amplify-service-worker-example

How can I make Amplify work with service worker for chrome extension?

---------------

---------------

# DataStore Sync from Dynamo: React

---------------

Author: @rkushkuley
Upvotes: 1
Comments: 0

Hi,

My use case is i have some data and after some time a backend server updates dynamodb directly on a certail field (data). I am trying to repull that data once its updated to display on the UI.

**Is there anyway to sync from DynamoDB without :**
```
await DataStore.stop();
await DataStore.clear();
await DataStore.start();
const model= await DataStore.query(TableName, id)
setModel(model)
```

(^ I am currently doing this in a 10 second interval in my useeffect on this particular page, it works but causing some delays and db transaction issues)

**I have tried using Observe and Subscribe but that does not seem to work:**

```
async function fetchModel() {
    const model= await DataStore.query(TableName, id);
    setModel(model);
  }

useEffect(() => {
    fetchModel();
    DataStore.observe(TableName).subscribe(fetchModel);
  }, []);
```


**Versions:
datastore: 3.11
amplify: 4.3**

---------------

---------------

# APIKEY in amplify add notification

---------------

Author: @MedNabilEssefaihi
Upvotes: 1
Comments: 1

Dear Network,

I am trying to add **push notifications** but in the one of the steps it asked me about the apikey. where can I found it ? and why isn't in documentation https://docs.amplify.aws/lib/push-notifications/getting-started/q/platform/js#setup-for-android
![2](https://user-images.githubusercontent.com/74948380/123248444-d8801400-d4df-11eb-9c99-1c4faba61f25.png)



I put **Server key** from **Firebase**> **project overview**> **Cloud Messaging**> **project credentials**> **serverkey** (I copied the token)

is it right ? 
## Comment

---------------

Author: @Samaritan1011001

Yes, it is the `Server Key` from the Firebase console.

---------------

---------------

# Error React Native: Safari cannot open the page because the server cannot be found

---------------

Author: @Joshig99
Upvotes: 1
Comments: 1

Hi, I did social logins for Apple and Google.
I Followed Aws Authentication document and configured correctly for providers side and cognito side. also i configured front end correctly, added url scheme in info.plist. 
The social logins works fine with Cognito Hosted UI, but it not working in React Native app. please help me

redirect uri:
https://prodfoliolens8f2c39d0-8f2c39d0-prod.auth.us-east-1.amazoncognito.com/oauth2/authorize?redirect_uri=foliolens%3A%2F%2F&response_type=code&client_id=4mh63true7d06i7o3l70590idg&identity_provider=Google&scope=phone%20email%20openid%20profile%20aws.cognito.signin.user.admin&state=aomMPwrBP23PHD7OepoZl7GV4c2NDQiF&code_challenge=pnmnl9uXsA34iPhudWjLTkQ1SlwqjpWMW6hDA8SpGzM&code_challenge_method=S256

React Native: 0.64.2
Aws-amplify: 4.2.10

![Screenshot 2022-03-11 at 11 00 15 AM](https://user-images.githubusercontent.com/46310246/157808122-1ab128ea-758d-4ae9-b884-cd4a7e9f06ae.png)

![Screenshot 2022-03-11 at 10 53 45 AM](https://user-images.githubusercontent.com/46310246/157807754-51769571-3bb4-44dc-b5ee-e68bd5668dc0.png)

![Screenshot 2022-03-11 at 10 54 27 AM](https://user-images.githubusercontent.com/46310246/157807784-abbc8278-8f8e-4ea7-b16d-12df00d57387.png)

![Screenshot 2022-03-11 at 10 54 57 AM](https://user-images.githubusercontent.com/46310246/157807798-3dc39d37-8fba-4bb2-bec4-1f22235611bc.png)

![Screenshot 2022-03-11 at 10 56 05 AM](https://user-images.githubusercontent.com/46310246/157807811-857fad88-0498-4547-85d3-12867bc24032.png)

## Comment

---------------

Author: @codeOlam

I am Currently experiencing same issues. 

---------------

---------------

# react-native: Login fail with error NotAuthorizedException: Invalid login token. Not a valid OpenId Connect identity token

---------------

Author: @oarthursilva
Upvotes: 1
Comments: 2

I'm trying to use the federated sign in with Facebook. I've set up everything correctly, but I can't get it to work when passing the facebook token to `Auth.federatedSignIn`, The idea is to re-use the authenticated token from facebook to Cognito.

here's my code below:

```
  async function signIn() {
    LoginManager.logInWithPermissions([
      'public_profile', 'email',
    ]).then(async (result) => {
      // when login successfull
      if (result.isCancelled) {
        return;
      }

      let accessTokenData = await AccessToken.getCurrentAccessToken();

      let accessToken = accessTokenData?.accessToken;
      let expiresAt = accessTokenData?.expirationTime;

      try {
        await Auth.federatedSignIn('Facebook', { token: accessToken, expires_at: expiresAt })
          .then(credentials => {
            console.log(credentials);
          });
      } catch (error) {
        console.log('Login fail with error', error);
      }
    },
      // when login fails
      (error) => {
        console.log('Login fail with error ', error);
      },
    );
  }
```

When trying to login, the message ` Login fail with error [NotAuthorizedException: Invalid login token. Not a valid OpenId Connect identity token.]` is always raised.

Any idea ?

## Comment

---------------

Author: @oarthursilva

any?
## Comment

---------------

Author: @92Harsha

Hi afuscella

I did get through this step. Do find my steps below.

1) Change the responseType of oauth to the token in aws-exports.js 
2) Cognito:  Within AppClient Settings allow Implicit grant with OAuth 2.0
3) Add the Facebook id in Authentication providers within the Identity pool
4) Full Example of Facebook Login.

   ```
    import React, {Component} from 'react';
    import {View, Button, Alert} from 'react-native';
    import Amplify, {Auth} from 'aws-amplify';
    import {Hub} from 'aws-amplify';
    import awsExports from './aws-exports';
    Amplify.configure(awsExports);
    
    class App extends Component {
      constructor() {
        super();
        this.state = {user: null};
        Hub.listen('auth', async (data) => {
          if (data) {
            const {payload} = data;
            console.log('new event: ' + JSON.stringify(data.payload.data));
            const currentUser = await Auth.currentUserInfo();
            if (currentUser) {
              console.log(
                'A new auth event has happened: ',
                data.payload.data.username + ' has ' + data.payload.event,
              );
              this.setState({user: currentUser});
            }
          }
        });
      }
    
      async debugMessage() {
        console.log(JSON.stringify(this.state.user));
        Alert.alert(JSON.stringify(this.state.user));
      }
    
      render() {
        return (
          <View style={{marginTop: 100}}>
            <Button
              title="Facebook Login"
              onPress={() => {
                Auth.federatedSignIn({provider: 'Facebook'});
              }}
            />
            {this.state.user && (
              <Button
                title="Current User Info"
                onPress={() => this.debugMessage()}
              />
            )}
          </View>
        );
      }
    }
    export default App;
```
Good Luck.!

---------------

---------------

# Continue the authorization code grant flow process after logging in from Amplify SignIn function

---------------

Author: @rpmansion
Upvotes: 1
Comments: 0

Upon initiating an authorization code grant from a client app, it goes to the authorize endpoint, then redirect you to login with a queryparams from an example below.

`https://devapp.com/login?client_id=898fdsajkjfafagdfa3fdafsf&redirect_uri=http:%2F%2Flocalhost:4200&authorization_code=ded01....
`

When you log in, the below function will initiate.

```
try {
  const result = await this.amplifyAuth.signIn(username, password);
  this.user = result;

  this.router.navigate(['/dashboard']);

  return true;
} catch (err: any) {
}
```

Of course, once you sign in it will redirect you to the dashboard. The question is how to continue the authorization code grant process by using the `signIn()` function when there are `client_id`, `redirect_uri`, `authorization_code`, etc... to continue the flow and redirect to the client application that initiates the authentication or is there other solution to do this?

---------------

---------------

# List operation with @auth is scan operation or query operation?

---------------

Author: @apoorvmote
Upvotes: 3
Comments: 1

I have simple schema
```graphql
type Blog @model @auth(rules: [{ allow: owner }]){
  id: ID!
  title: String!
}
```
I have been running `@key` like the following
```graphql
type Blog @model 
  @key(name: "byOwnerID", fields: "owner", queryField: "blogsByOwnerID") 
  @auth(rules: [{ allow: owner }]) {
  id: ID!
  owner: String!
  title: String!
}
```

Do I need this `blogsByOwnerID`? The default generated `listBlogs` automatically returns all the blogs written by the same owner.

But in AppSync Console there is no resolver for `listBlogs` and there is no `owner GSI` for first graphql schema.

How its possible to query Dynamodb table for `owner` key without GSI? 

Are they running scan operation and filtering for `owner` from the request?
## Comment

---------------

Author: @alexkates

Coming here looking for guidance as well. I've made assumptions that I'll describe below, but I'm also looking for some definitive guidance here from the Amplify team.

In my experience, if you were to run the auto-generated `listBlogs` Query as an authenticated user, under the hood DynamoDB would be executing a scan operation on the Blog table and would filter entries where the owner is equal to the authenticated user. Also, you would receive a nextToken which would allow you to perform a subsequent scan for the next page.

In the past, I've introduced a top-level, or aggregate root type called `Customer`. A customer would be created when a user registers, and it would allow me to build a relationship to the Blog type that would provide the index. I would also set the Id of this Customer to be the `sub` or `username` of the Cognito user.

---------------

---------------

# Amplify sync model specific data

---------------

Author: @sagar14791
Upvotes: 1
Comments: 0

**I am using 2 Configurations for amplify**

              //  To save data in offline without starting sync
                     void configureOffline() async {
                        Amplify.addPlugin(AmplifyDataStore(
                          modelProvider: ModelProvider.instance,
                        ));
                        await Amplify.configure(amplifyconfig);
                      }

                // to sync offline data or new data in server
                 void configureAmplifyOnline() async {
                        await Future.wait([
                          Amplify.addPlugin(AmplifyDataStore(
                              modelProvider: ModelProvider.instance,
                              syncExpressions: [
                               // DataStoreSyncExpression(AllRetailerList.classType,
                               //     () => AllRetailerList.SALES_LIST.contains("3")), 
                                DataStoreSyncExpression(
                                    ProductData.classType, () => ProductData.STATUS.eq(1)),
                              ])),
                          Amplify.addPlugin(AmplifyAPI()),
                        ]);
                        await Amplify.configure(amplifyconfig);
                    }


i want to sync data from **ProductData** only and not to from **SALES_LIST** but configureAmplifyOnline() sync all data how to stop auto sync for specific MODELS?

---------------

---------------

# FYI - Chrome warning on future User-Agent String changes

---------------

Author: @jamessouth
Upvotes: 2
Comments: 1

Hello, I got this warning in Chrome (Iridium) re my use of `amazon-cognito-identity-js@5.2.3` and did not find it mentioned in another issue or discussion:

```
Audit usage of navigator.userAgent, navigator.appVersion, and navigator.platform

A page or script is accessing at least one of navigator.userAgent, navigator.appVersion, and navigator.platform.
In a future version of Chrome, the amount of information available in the User Agent string will be reduced.

To fix this issue, replace the usage of navigator.userAgent, navigator.appVersion, and navigator.platform with
feature detection, progressive enhancement, or migrate to navigator.userAgentData.
```
[Chrome blog post](https://blog.chromium.org/2021/05/update-on-user-agent-string-reduction.html)

Thank you!
## Comment

---------------

Author: @jrobbins-LiveData

`amazon-cognito-identity.js` appears to use `navigator.product`, `navigator.appName`, and `navigator.userAgent`. 

The code that uses `navigator.product` seems like it would work even without a `navigator` object or `navigator.product` (although I have not tested this.)  

The chromium [link](https://www.chromium.org/updates/ua-reduction/#reduced-navigatorplatform-values-for-all-versions) doesn't mention `navigator.product` so it is unclear to me what the "reduction" means for this property. It also doesn't mention `navigator.appName`, but, again (based on a superficial read of the code), it looks like the code that uses `navigator.appName` would survive the non-existence of the `navigator` object or simply the nonexistence of `navigator.appName`.

That leaves `navigator.userAgent`.  This is one of the properties mentioned at the [link](https://www.chromium.org/updates/ua-reduction/#reduced-navigatoruseragent-values), and called out in the Audit issue (`Audit usage of navigator.userAgent, navigator.appVersion, and navigator.platform`).

The code in question is

```javascript
 A = w ? navigator.userAgent : "nodejs"
```

This appears to be safe wrt the reduction.  The Audit issue recommends not using `navigator.userAgent` in favor of "...feature detection, progressive enhancement, or migrate to navigator.userAgentData."  I don't think, though, that the reduction in values for `navigator.userAgent` will break this code, so it is more an annoyance at this point than a signal of a real problem, apparently. 

That said, it would be much nicer not to have this Audit notice, as it inevitably will raise concerns.  Since the single use of `navigator.userAgent` is in [CognitoUser.js](https://github.com/aws-amplify/amplify-js/blob/1b188626afcc7f0f755ba449534236a38260e692/packages/amazon-cognito-identity-js/src/CognitoUser.js), perhaps AWS would consider switching [that line of code](https://github.com/aws-amplify/amplify-js/blob/1b188626afcc7f0f755ba449534236a38260e692/packages/amazon-cognito-identity-js/src/CognitoUser.js#L62)

```javascript
const userAgent = isBrowser ? navigator.userAgent : 'nodejs';
```

to one of the suggested alternatives, in order to remove the Audit notice?  [edited] I opened an [issue ](https://github.com/aws-amplify/amplify-js/issues/9957)on this topic.





---------------

---------------

# How to handle a 413 status call on a POST call payload?

---------------

Author: @dalekatwork
Upvotes: 0
Comments: 1

Hi, I am getting 413 status code on a POST call when I take an image from my camera as part of my payload. I want to save it as part of the request.

Where in amplify dashboard can I set `client_max_body_size` or any other way I can fix my issue.
## Comment

---------------

Author: @dalekatwork

I was able to fix the issue by increasing my server client body size. Closing this issue

---------------

---------------

# How to upload multiple images to S3 bucket (React Native Expo)

---------------

Author: @aak001
Upvotes: 0
Comments: 0

Hi, I successfully uploaded an image to my amplify s3 bucket using the prescribed method in the amplify storage docs. Is there a way to upload multiple images to the same bucket maybe using "promise.all()"? if so can I have an example?

---------------

---------------

# What are the limits of Datastore? And how does the sync limit work?

---------------

Author: @DevTGhosh
Upvotes: 7
Comments: 1

I have a One to Many relationship model. For e.g 1 Post can have many Comments.  So for my usecase a Post can have 1000's of Comments. This is running into the default Datastore limit of 10k records. If I create new post with another 1000 comment they show up in the datastore. However if I clear, stop and restart the datastore the selective sync causes only partial comments to load for each Post.

This is leading me to have the following assumptions please correct me If I am wrong:

1. If I am creating a new post with 1000's of comments I am gonna guess they replace some other data from the datastore to remain under the sync limit?

2. Since we are doing a scan of the Comments table to get comments only partial data for each Post is being fetched and stored since the Sync limit is shared across all Posts and Comments. And the rest of the comments over limit are not being saved.

Now my questions:

1. Is it possible to force fetch and save data in datastore when you are fetching Comments of a Post, while also not removing all of the already synced items of another model. So say you can remove comments from other Posts but keep the data to the Post model intact.  I know you can use a combination of  `Datastore.stop`, `Datastore.configure` & `Datastore.start` but that removes all of the already synced data. This creates an issue when offline it will clear & stop datastore and have no way of syncing new data or getting old data. 

2. What are the limits of `maxRecordsToSync` for Datastore. How many records can I realistically keep. I can have a table with tens of millions of items is that possible to sync with datastore and not face issue with sync. What are the limits to the amount of data being saved(few gb?)    How much time will it take to realistically sync the data? 
## Comment

---------------

Author: @nvnk3

@DevTGhosh did you figure out how to do force fetch  ?

---------------

---------------

# How to implement login with a dynamic redirect?

---------------

Author: @andre347
Upvotes: 1
Comments: 0

I have the following use case. I am building an internal portal and we often share links to protected pages. If a user clicks on a link and they are not authenticated they are send to the '/login' page and then send to the '/dashboard' page. However, we want the user to go the link they initially clicked on. Say someone clicks on a link to go to '/dashboard/product/product1', we want to first go to '/login' and after auth to '/dashboard/product/product1' and not to '/dashboard'. 

What is the best way to implement this with AWS Amplify and Cognito? This is for a Next.js application and I am using Amplify v^4.3.3. In getServerSideProps I check if someone is authenticated to a page, if not go to '/login' else continue.

In Auth0 there is a prop on the login method to set a dynamic redirect, which you can populate with the browser history but I can't seem to find something similar for AWS Amplify.

---------------

---------------

# How do I best use CognitoUser.completeNewPasswordChallenge?

---------------

Author: @chris-maclean
Upvotes: 2
Comments: 1

I am trying to support the `FORCE_CHANGE_PASSWORD` workflow in my web app, following Use Case 23 in the `amazon-cognito-identity-js` [README](https://github.com/aws-amplify/amplify-js/tree/main/packages/amazon-cognito-identity-js). I have a `newPasswordRequired` callback for the `CognitoUser.authenticateUser` method, and I have verified that the callback is called. However, like the OP in issue [#3043](https://github.com/aws-amplify/amplify-js/issues/3043), I want to redirect my user to a new page to fill in their new password. Use Case 23 says to save the user attributes (the first parameter to the `newPasswordRequired` callback) to a global variable, then provide it as an argument to `CognitoUser.completeNewPasswordChallenge`, like this:

```javascript
cognitoUser.authenticateUser(authenticationDetails, {
        newPasswordRequired: function(userAttributes, requiredAttributes) {
            // User was signed up by an admin and must provide new
            // password and required attributes, if any, to complete
            // authentication.

            // the api doesn't accept this field back
            delete userAttributes.email_verified;

            // store userAttributes on global variable
            sessionUserAttributes = userAttributes;
        }
    });

    // ... handle new password flow on your app
    handleNewPassword(newPassword) {
      cognitoUser.completeNewPasswordChallenge(newPassword, sessionUserAttributes);
    }
```

In my app, I accomplish this by saving the user attributes object to a Redux store and extracting it later when I'm ready to complete the new password challenge. This seems to me like it should accomplish the same thing as a saving the attributes to a global variable, like in the README. However, when my component calls `CognitoUser.completeNewPasswordChallenge`, the call fails with this fairly opaque error:

```
index.js:1 TypeError: Cannot read properties of undefined (reading 'NewDeviceMetadata')
    at CognitoUser.authenticateUserInternal (CognitoUser.js:478:1)
    at CognitoUser.js:575:1
    at Client.js:119:1
```

Also, when I inspect the user attributes object, it is quite simple and doesn't seem to include any session information. In fact, all it includes are the custom Cognito attributes assigned to the user. I don't understand how the package uses these attributes to successfully change the user's password with Cognito.

I should point out that I've also tried to same store-and-extract approach to save the CognitoUser object that makes the original `authenticateUser` call, thinking that maybe I needed the same instance of CognitoUser to complete the challenge. This approach leads to the same error.

As a test, I made the first `newPasswordRequired` callback immediately fire a `completeNewPasswordChallenge` like this:

```javascript
cognitoUser.authenticateUser(authenticationDetails, {
  newPasswordRequired(userAttributes) {
    console.log('New password required');
    cognitoUser.completeNewPasswordChallenge(
      'foobar',
      userAttributes,
      {
        onSuccess() {
          console.log('Completed the new password challenge!');
        },
        onFailure() {
          console.error('Failed to complete the new password challenge');
        },
      }
    );
  },
})
```

This successfully changes the password to `foobar`. The success of this approach tells me that it's somehow important for `completeNewPasswordChallenge` to be called from within the `newPasswordRequired` callback, but I don't understand why.

Can anyone help me understand why `completeNewPasswordChallenge` succeeds when called from within the `newPasswordRequired` callback, but fails when called elsewhere, even when I use the same CognitoUser instance and user attributes as those in the callback?
## Comment

---------------

Author: @chris-maclean

My idea for a workaround (which the OP of issue [#3043](https://github.com/aws-amplify/amplify-js/issues/3043) also arrived at) is to make the change password page re-start the authentication flow. That is, create a CognitoUser instance, call its `authenticateUser` method, and provide a `newPasswordRequired` callback which calls the `completeNewPasswordChallenge` itself. The original login component will detect the new password requirement and redirect to the change password page. Like this:

```javascript
// First login page
cognitoUser = new CognitoUser(params);
cognitoUser.authenticateUser(authenticationDetails, {
  newPasswordRequired(userAttributes) {
    console.log('New password required');
    goToChangePasswordPage();
  },
});

// Change password page
cognitoUser = new CognitoUser(params);
cognitoUser.authenticateUser(authenticationDetails, {
  newPasswordRequired(userAttributes) {
    console.log('Changing password...');
    cognitoUser.completeNewPasswordChallenge(
      newPasswordFromInputComponent,
      userAttributes,
      {
        onSuccess() {
          console.log('Completed the new password challenge!');
        },
        onFailure() {
          console.error('Failed to complete the new password challenge');
        },
      }
    );
  },
});
```

I think this will work, but it seems strange that it should be necessary. I don't understand why I can't carry the CognitoUserObject and user attributes through from the first login page to the change password page.

---------------

---------------

# Confirm an action with current users password

---------------

Author: @madlerpar
Upvotes: 1
Comments: 0

Does anyone know of a way to verify a users password when they are already logged in? My application has some sensitive actions that we have the user confirm by entering their password. Originally we were using Auth.SignIn(). This worked fine when the only MFA option was TOTP, but after adding in SMS SignIn will trigger a text message being sent to the user which we do not want. 

Current:
User enters password which is checked with Auth.SignIn(). If SMS is enabled for MFA, it also sends them a MFA code.

Desired:
User enters password which is checked somehow by amplify. It simply returns if password is correct or not, with no MFA code being sent.

If anyone has any insight in how to confirm the users password without triggering an MFA message that would be appreciated. Thanks!

---------------

---------------

# Custom storage plugin

---------------

Author: @brown2021
Upvotes: 1
Comments: 0

Hello, I would like to use my own storage. My storage APIs are in Python. How do I use the Amplify Framework to call them. For example, 

This is my get() API

`def get_image_by_id(st, id):

    query = [{
        "FindImage": {
            "constraints": {
                "_uniqueid": ["==", id]
            },
            "results": {
                "all_properties": True
            }
        }
    }]

    return query_api(query, st)`

Where the query_api is defined by 


`def query_api(query, st):

    query = dict_query_to_str(query)
    # print(repr(query))

    response = requests.post(URL, headers = {'Authorization': "Bearer " + st},
                             data    = {'json_query': query})

    # print(response.status_code)
    # print(response.text)

    # Parse response:
    json_response = json.loads(response.text)
    response      = json.loads(json_response["json"])
    blobs         = json_response["blobs"]

    return response, blobs`


How do I map that to the get function documented in Amplify?
https://docs.amplify.aws/lib/storage/getting-started/q/platform/js/#using-a-custom-plugin



---------------

---------------

# Getting "no current user" error after redirect from Cognito Hosted UI

---------------

Author: @flexelem
Upvotes: 2
Comments: 0

Hi there, I am trying to learn authentication code grant flow with Cognito Hosted UI. Everything seems working until I get redirected back to my protected page. All the /authorize, /login and /token calls are getting completed successfully. I can also confirm that I see the URL with /code parameter generated which is then redirected again. As the final step when I use `await Auth.currentAuthenticatedUser();` I get an error with "no current user". So, if I am not mistaken Amplify handles all the required OAUTH calls internally which I would then expect to get an authorized user at the end. Here are the two main files from my react app;

**App.js**

```
import './App.css';
import React from 'react'
import Amplify from 'aws-amplify';

Amplify.configure({
    Auth: {

        // REQUIRED - Amazon Cognito Region
        region: 'us-east-1',

        // OPTIONAL - Amazon Cognito User Pool ID
        userPoolId: process.env.REACT_APP_USERPOOL_ID,

        // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
        userPoolWebClientId: process.env.REACT_APP_USERPOOL_WEB_CLIENT_ID,

        // OPTIONAL - Enforce user authentication prior to accessing AWS resources or not
        mandatorySignIn: false,

        // OPTIONAL - Manually set the authentication flow type. Default is 'USER_SRP_AUTH'
        authenticationFlowType: 'USER_PASSWORD_AUTH',

        // OPTIONAL - Hosted UI configuration
        oauth: {
            domain: 'belttgvsdu.auth.us-east-1.amazoncognito.com',
            scope: ['myresourceserver/awesomeapi.read', 'myresourceserver/awesomeapi.write'],
            redirectSignIn: 'http://localhost:3000/dashboard',
            redirectSignOut: 'http://localhost:3000',
            responseType: 'code'
        }
    }
});

function App(props) {

  return (
    <div className="App">
      <h1>This is Landing page</h1>
      <a href="https://belttgvsdu.auth.us-east-1.amazoncognito.com/oauth2/authorize?client_id=3chm4jkbcn767oqu2m9icconcs&response_type=code&scope=myresourceserver%2Fawesomeapi.read+myresourceserver%2Fawesomeapi.write&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fdashboard">Login</a>
    </div>
  );
}

export default App;

```

And here is the dashboard.js to render localhost:3000/dashboard

**dashboard.js**

```
import React, {useEffect, useState} from 'react';
import '../App.css';
import {Auth} from 'aws-amplify';
import {Navigate} from "react-router-dom";

function Dashboard(props) {
    const [user, setUser] = useState();
    const [isLoading, setIsLoading] = useState(true);

    async function getCurrentUser() {
        try {
            const authUser = await Auth.currentAuthenticatedUser();
            console.log(JSON.stringify(authUser));
            setUser(authUser);
        } catch (e) {
            console.log('error happened', e);
            setUser(null);
            setIsLoading(false);
        }
    }

    useEffect(() => {
        getCurrentUser();
    }, []);

    async function handleSignOut(event) {
        event.preventDefault();
        try {
            await Auth.signOut();
        } catch (error) {
            console.log('error signing out: ', error);
        }
        setUser(null);
        setIsLoading(false);
    }

    if (!user && !isLoading) {
        return <Navigate to="/" replace={true} />
    }

    return (
        <div className="container">
            <h1>Dashboard</h1>
            <button onClick={handleSignOut} className="fluid ui button blue">Sign Out</button>
        </div>
    )
}

export default Dashboard;

```

Here I also attached a screenshot to show all the related oauth calls are ending with success.

![Screen Shot 2022-05-19 at 19 28 36](https://user-images.githubusercontent.com/6500753/169351029-f023398e-e045-4580-a955-d7c20a5026ab.png)

And this is the error I am getting;


![Screen Shot 2022-05-19 at 19 29 57](https://user-images.githubusercontent.com/6500753/169351297-ebbc4a55-0cb5-4ab1-963d-d496598c3926.png)


Thanks for the help!

---------------

---------------

# Issue to query model with @hasMany relationship using DataStore

---------------

Author: @duranmla
Upvotes: 4
Comments: 3

👋 Hi!

I am having issues with **`@hasMany`** relation. I am trying to access the related model from the source model returns empty. What is odd is that at some point I was able to query without issues since the generated types when `amplify codegen models` run used to contain `pathwayID`, currently, when I generate models the property `pathwayID` is removed.

The case of study looks like below, I have this schema:

```graphql
type Pathway @model @auth(rules: [{ allow: private }]) {
  id: ID!
  title: String!
  description: String
  thumbnail: String
  pathwayPitstops: [PathwayPitstop] @hasMany(indexName: "byPathway", fields: ["id"])
}

type PathwayPitstop @model @auth(rules: [{ allow: private }]) {
  id: ID!
  pathwayID: ID! @index(name: "byPathway")
  pathway: Pathway @belongsTo(fields: ["pathwayID"])
  pitstopID: ID!
  pitstop: Pitstop @hasOne(fields: ["pitstopID"])
  positionX: Int!
  positionY: Int!
  pathwayPitstopParentID: ID
}
```

And then this are the approaches I have donde to query:

1. **Trying to get the pathwayPitstops using the source model and then accessing to the related model using the property**
```ts
const pathwayPitstops = (await DataStore.query(Pathway, pathwayId))
      ?.pathwayPitstops
```
*Always return undefined*

2. **Trying to query all the pathwayPitstops and filter by `pathwayID`** (this used to work but since I don't have pathwayID anymore it does not.)

```ts
const pathwayPitstops = await DataStore.query(PathwayPitstop, (pp) => pp.pathwayID('eq', pathwayId))
```
*It complains that pathwayID is not a property* (at some point it was valid but now when I run `amplify codegen models` it deletes the pathwayID from the types)

**And yes, I do have a record that suppose to be returned**
[Screenshot to DynamoDB](https://user-images.githubusercontent.com/1425162/150333471-52d77710-e694-4538-9843-bd20ef35f70c.png)
## Comment

---------------

Author: @duranmla

As for now my way to move forward has been to use the GraphQL query instead. Nonetheless, it feels like bug that I am not able to query the same data using DataStore. For the sake of helping others in this endeavour this is what I have done:

```ts
const pathwayGraphQLResponse = await API.graphql(graphqlOperation(queries.getPathway, { id: pathwayId }))

// get the `pathwayPitstops` from my `pathwayGraphQLResponse` object
```
## Comment

---------------

Author: @svidgen

Thanks for submitting this! This _does_ just look like a bug to me. And in face, there's an open CLI issue to fix codegen on `belongsTo` relationships. See [amplify-codgen/349](https://github.com/aws-amplify/amplify-codegen/issues/349). Still tracking js-side as well in #9514.

That said, it's best to save models in this manner:

```
await DataStore.save(PathwayPitstop, {
  // ... fields ... 
  pitstop: your_pitstop
});
```

DataStore will manage the ID under the hood for you.

Working around the missing ID field, you can do this:

```
(await DataStore.query(PathwayPitstop)).filter(p => p.pitstop.id == SOME_ID);
```

Loading the `hasMany` side of the relationship (`pitstop. pathwayPitstops`) is not yet supported by DataStore.
## Comment

---------------

Author: @hpwtaee

@svidgen is this a bug and if so are there any timelines for a fix?

In my case I'm using DataStore and trying to selectively sync a subset of data against the id field that has 'vanished' (this bug restricts me from doing that). Would really appreciate an insight into what's going on!

---------------

---------------

# Amplify Datastore Sync Passes Session Token in URL

---------------

Author: @monscamus
Upvotes: 1
Comments: 2

We recently reviewed a prototype React application for security and noticed that a session token is passed by the Amplify offline datastore code into the graphql endpoint _in the url_. I know that jwt tokens are passed in the headers normally but I'm thinking that target urls of users are much easier to capture than encrypted headers. it looks like the following:

`GET 
/graphql?header=eyJBdXRob3JpemF0aW9uIjoiZXlKcmFXUWlPaUp4WTBGdWJGbzNVbVpFY1hkWVhDOUJjMVJ0VUVkdVpYaEd
URE0xWkdkT1dIcGNMMWhNVjFvM1kxWmphMnM5SWl3aVlXeG5Jam9pVWxNeU5UWWlmUS5leUp6ZFdJaU9pSTRNamt4WkRKall5
...c2ZHMDVtakFrZyIsImhvc3QiOiIzbGx6Z2NjcnV6YjZ4YXhkYmR6NjdmeTZ0cS5hcHBzeW5jLWFwaS5ldS13ZXN0LTIuYW1he
m9uYXdzLmNvbSJ9&payload=e30= HTTP/1.1    
Host: 3llzgccruzb6yabdbdz67fy6tq.appsync-realtime-api.eu-west-2.amazonaws.com    
Connection: Upgrade    
Pragma: no-cache    
Cache-Control: no-cache  `

Can someone explain why this is OK? Or if there are additional Amplify settings to stop this that I'm unaware of?
## Comment

---------------

Author: @david-mcafee

Created [an issue](https://github.com/aws-amplify/amplify-js/issues/9811) for this.
## Comment

---------------

Author: @david-mcafee

Hi @monscamus,

Thanks for your inquiry.

[AppSync’s subscription protocol](https://docs.aws.amazon.com/appsync/latest/devguide/real-time-websocket-client.html) uses query string parameters to establish new sessions. This is by design and secure as the entire request is encrypted end-to-end via TLS and is protected while in transit.

If you have any follow up questions, please do not hesitate to contact us at [aws-security@amazon.com](mailto:aws-security@amazon.com).

---------------

---------------

# aws.cognito.signin.user.admin scope reach

---------------

Author: @bikashgupta-zinrelo
Upvotes: 1
Comments: 0

Does aws.cognito.signin.user.admin scope allows the logged-in user to change other users' data or delete other users in the pool?

---------------

---------------

# what should be the minimum Node version for this library ?

---------------

Author: @Ramnirmal0
Upvotes: 1
Comments: 1

I am trying to enable TOTP based MFA . but most of the time i am getting following as API Response

````
message: "Code mismatch"
__type: "EnableSoftwareTokenMFAException"
````

Some times this works but most of the times i am getting the above error. why ?

  Binaries:
    Node: 8.17.0 - ~/.nvm/versions/node/v8.17.0/bin/node
    Yarn: 1.22.18 - /usr/bin/yarn
    npm: 6.13.4 - ~/.nvm/versions/node/v8.17.0/bin/npm
## Comment

---------------

Author: @david-mcafee

@Ramnirmal0 - the recommended minimum Node and NPM versions are listed [here in our docs](https://docs.amplify.aws/start/getting-started/installation/q/integration/react/). The current minimum versions are Node 12.x or later, and NPM 5.x or later. However, Node v14.x or later / NPM v6.14.4 or later are required when using [Create React App](https://create-react-app.dev/docs/getting-started)

---------------

---------------

# Any Cognito trigger is fired after email or phone verification, how to sync?

---------------

Author: @LudoLab92
Upvotes: 1
Comments: 0

Hi,

I am using PostConfirmation et PreTokenGeneration triggers but any of it get fired when a user verify its phone number or his email.
It looks like we don't have any way to stay sync with our database when this event occurs.
Can someone confirm this or share a way to do?

Thanks,

---------------

---------------

# How to return more device information | Auth.fetchDevices

---------------

Author: @samuelcastro
Upvotes: 2
Comments: 0

The `Auth.fetchDevices` fn only returns `id` and `name`, however I know that Cognito supports several other informations like `IP`, `Last Seen` etc. How can we return more information?

---------------

---------------

# How is aws_cloud_logic_custom block added inside aws-exports.js?

---------------

Author: @ranopriyo-neogy
Upvotes: 0
Comments: 0

I am setting up an existing react project in a new AWS account and trying to figure out how to get `aws_cloud_logic_custom` in `aws-exports.js`? As I didn't find a way to put that in, I manually edited the `aws-export.js` file (as shown in the code below), however with Amplify push the configuration was auto deleted.

I have the API available for aws_cloud_logic_custom, just didn't find a way to sync it with the existing amplify configuration by getting it inside `aws-exports.js`. What should I do considering  there is an existing API that I want to link to the Amplify project inside `aws_cloud_logic_custom` block. TIA

**Code**

```
const awsmobile = {
  aws_project_region: "us-east-2",
  aws_appsync_graphqlEndpoint:
    "https://abcd/graphql",
  aws_appsync_region: "us-east-2",
  aws_appsync_authenticationType: "AMAZON_COGNITO_USER_POOLS",
  aws_cognito_identity_pool_id:
    "Us-east-2:22,
  aws_cognito_region: "us-east-2",
  aws_user_pools_id: “xxxx”,
  aws_user_pools_web_client_id: “xxxxx”,
  oauth: {},
  aws_cloud_logic_custom: [
    {
      name: “apiname,
      endpoint: "https:xxx/prod",
      region: "us-east-2",
    },
  ],
};

export default awsmobile;
```

---------------

---------------

# How to retrieve the Cognito IdentityId from Post Confirmation Trigger ?

---------------

Author: @LudoLab92
Upvotes: 1
Comments: 0

Why do we need this? Here is a common use case:

1. User uploads avatar to his subfolder, enforced with a policy using identity id (since we can't do it using the user pool sub): arn:aws:s3:::mybucket/${cognito-identity.amazonaws.com:sub}/avatar.jpg
2. Users should access avatars (their own with read/write and the other ones with read), so we need to know the cognito identityId of every user in the database to be able to build the path the the avatars.

I have found an issue created more than 5 years ago here: https://github.com/amazon-archives/amazon-cognito-identity-js/issues/302 and topics on StackOverflow, there is no solution given to this issue.

Is there a way to do it in 2022 or do we still have to compose with unsecure workarounds?

Here are some solutions that in my opinion would be great:

1. Being able to declare IAM policies using the sub UserPool (so we would never have to deal with the Cognito IdentityId)
2. Being able to get the Cognito IdentityId as a parameter from the Post Confirmation lambda event (it would solve the issue and it doesn't sound too complicated to achieve)
3. Being able to fetch a Cognito IdentityId from a sub UserPool thanks to a server-to-server API call (start being weird but would be secured and could be transactionnal with the Post Confirmation trigger)

As far is i know, nothing of this is still possible, and i don't see any other reliable way.


---------------

---------------

# [doc] one doc seems to have wrong code

---------------

Author: @ZYinMD
Upvotes: 1
Comments: 0

https://docs.amplify.aws/cli/graphql/overview/ this entire page seems to show wrong signatures of `API.graphql(...)`, and I don't think the code would work. The correct signature should be either `API.graphql(graphqlOperation(query, { input }))` or `API.graphql({ query, variables })`, I think.

![image](https://user-images.githubusercontent.com/32368482/166608464-9867149b-37fa-4e5d-a2bd-531fd2f3803b.png)


---------------

---------------

# Can I create a user from a uid, similar to the "custom token" approach in Firebase, without involving password?

---------------

Author: @ZYinMD
Upvotes: 1
Comments: 0

I'm migrating a web app from firebase to Amplify. In firebase, you can silently sign-up / sign-in a user without any user interaction or password, as long as you somehow already have a unique identifier of the user. I wonder if Amplify has a equivalent flow. The process is something like this:

```ts
// backend:
function exchangeUidForToken(uid: string) {
  const jwt = await firebaseAdmin.auth.createCustomToken(uid);
  return jwt;
}

// frontend:
function authByUid(uid: string) {
  const jwt = await backendFunctions.exchangeUidForToken(uid);
  await firebase.auth.signInWithToken(jwt);
  // user is now signed in
}
```

So if you have a unique identifier from your other logic, you can auth the user. The same code can be used for both sign-up and sign-in, because all you're doing is translate a fixed uid into the corresponding user.

Is something similar available in Amplify?

---------------

---------------

# Amplify backend build is failing most of the time but some time it works

---------------

Author: @LokeshBhatt79
Upvotes: 2
Comments: 0

We have setup an amplify CI/CD pipeline with Auto-Build Enabled, but most of the times build fails while building the backend, but sometime it works. So, not sure why does it fail most if the times. There is no error provided in the failures. We tried removing --simple but it behaves same way. We are having around than 64 python lambda functions which we deploy using amplify.

Amplify CLI: Latest

Here is the last log where it stops - 
`2022-04-29T11:19:20.308Z [WARNING]: ⠙ Creating virtual environment...
2022-04-29T11:19:20.313Z [WARNING]: 
2022-04-29T11:19:20.313Z [WARNING]: ⠇ Locking...
2022-04-29T11:19:20.343Z [WARNING]: 
2022-04-29T11:19:20.343Z [WARNING]: ⠧ Creating virtual environment...
2022-04-29T11:19:20.347Z [WARNING]: 
⠇ Creating virtual environment...
2022-04-29T11:19:20.366Z [WARNING]: 
⠙ Creating virtual environment...
2022-04-29T11:19:20.381Z [WARNING]: 
⠼ Creating virtual environment...
2022-04-29T11:19:20.388Z [WARNING]: 
⠹ Creating virtual environment...
2022-04-29T11:19:20.394Z [WARNING]: 
2022-04-29T11:19:20.394Z [WARNING]: ⠏ Locking...
2022-04-29T11:19:20.401Z [WARNING]: 
2022-04-29T11:19:20.401Z [WARNING]: ⠸ Locking...
2022-04-29T11:19:20.423Z [WARNING]: 
⠇ Creating virtual environment...
2022-04-29T11:19:20.427Z [WARNING]: 
2022-04-29T11:19:20.427Z [WARNING]: ⠏ Creating virtual environment...
2022-04-29T11:19:20.446Z [WARNING]: 
2022-04-29T11:19:20.446Z [WARNING]: ⠹ Creating virtual environment...
2022-04-29T11:19:20.462Z [WARNING]: 
⠴ Creating virtual environment...
2022-04-29T11:19:20.468Z [WARNING]: 
⠸ Creating virtual environment...
2022-04-29T11:19:20.474Z [WARNING]: 
2022-04-29T11:19:20.474Z [WARNING]: ⠋ Locking...
2022-04-29T11:19:20.504Z [WARNING]: 
⠏ Creating virtual environment...`

Here is the amplify.yml - 
`version: 1
backend:
  phases:
    build:
      commands:
        - update-alternatives --install /usr/bin/python3 python3 /usr/local/bin/python3.9 11
        - /usr/local/bin/pip3.9 install --upgrade pip
        - /usr/local/bin/pip3.9 install --user pipenv
        - amplifyPush
frontend:
  phases:
    preBuild:
      commands:
        - yarn install
        - yarn next --version
    build:
      commands:
        - yarn run build
  artifacts:
    baseDirectory: out
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
` 
Any solution to this issue?

---------------

---------------

# Enable pop out for federated

---------------

Author: @steve-ng
Upvotes: 7
Comments: 3

Currently I am using `import { Auth } from '@aws-amplify/auth'`

and in order to do social login, i've a button, on click will call this method `Auth.federatedSignIn({provider: "Google"})` 

Is there a way to configure it to show as pop up over over a redirection of the current window?
## Comment

---------------

Author: @Zach45

I would really love to see a solution to this, it's crazy how little customization there is with userpool social log in.
## Comment

---------------

Author: @hkjpotato

@steve-ng Are you referring to web or react-native platform? For RN it could be challenging. For web, by popup I assume you means a headless browser like this? https://dev.to/dinkydani21/how-we-use-a-popup-for-google-and-outlook-oauth-oci
## Comment

---------------

Author: @evanlarkin10

I am hoping to accomplish this in react native, has anyone made that happen? In fact Apple decided to reject our version because we link out of the app for oauth flows.

---------------

---------------

# Invoke AdminQueries API from NextJS API Route

---------------

Author: @sayu-agiliad
Upvotes: 1
Comments: 0

Hi,
I am developing a NextJS app where I need to invoke the Cognito listUsers AdminQuery inside my nextJS API route . However, when I run the application in dev mode, I get a 403 for the API.get. 
I have verified that
1. The Auth token (JWT) is correct.
2. I get the API and Auth instances from withSSRContext.

The same code when run on the client side works like a charm, but when put in an API route, it does not work.
Can anyone please help. I am a bit new to AWS / Amplify.

---------------

---------------

# Can DataStore manage schemas with no `id: ID!`?

---------------

Author: @BobToninho
Upvotes: 1
Comments: 0

Hi, I am trying to implement DataStore in an existing AppSync GraphQL backend, but I have the same problem as https://github.com/aws-amplify/amplify-js/issues/6912

This a type of my schema, but basically all of the types are like this (without `id: ID!`):

```graphql
type MyType
@model
@auth(rules: [
	{ allow: public, operations: [create, update] }
	{ allow: private }
])
@key(fields: ["pk", "sk"])
{
	pk: String!
	sk: String!
	# other fields...
}
```

Questions
1. As long as I understand, currently DataStore does **not** support schemas of this kind. It requires an `id: ID!` key. Is this correct?
2. If this is correct, what would be the faster solution to implement this with less issues as possible?

Thank you!

---------------

---------------

# Integrating Cognito in an Expo App without Amplify

---------------

Author: @CodalReef
Upvotes: 3
Comments: 0

I'm attempting to integrate Cognito with federated sign-on in my expo app, but I'm finding Amplify to be very heavy.

I already have Cognito sign-in working, but I'd like to add federated access through Apple.

All the tutorials I see require me to run `amplify init`.  For example:  https://dev.to/aws/the-complete-react-native-guide-to-user-authentication-with-the-amplify-framework-ib2

I ran `amplify init` and it created a bunch of files which I have a cursory understanding of from the docs here:  https://docs.amplify.aws/cli/reference/files/

I have my own backend API deployed and working.  The *only* service I currently need is Cognito.  Is there a way to make this happen without adapting all of Amplify?

---------------

---------------

# How do I verify a user email when he updates his temporary password?

---------------

Author: @Anthony-Gaudino
Upvotes: 2
Comments: 0

When a user creates an account he receives an email with a temporary password.

On first login the user has to input a new password. How can I confirm the user address (set `email_verified` to true) when the user inputs a new password?
Is there a parameter in `Auth.completeNewPassword` that I can pass to accomplish this?

The logic is that since the user received the temporary password by email and used it to login his email is verified.

---------------

---------------

# Notification unauthorized in schema where groups are granted to allow

---------------

Author: @funes79
Upvotes: 1
Comments: 0

Given the below schema when a userA (admin) logs in - he receives subscriptions data. But when another userB logs in (non admin) - he can create a Notification, but cannot subscribe to it.

```
type Notification
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: groups, groups: ["admins"] }
      { allow: owner, ownerField: "author" }
    ]
  ) {
...
```

Error message:
`"Connection failed: {"errors":[{"errorType":"Unauthorized","message":"Not Authorized to access onCreateNotification on type Notification"}]}"`

Is this a bug or intended feature? If it is not a bug, how can I achieve a setup where userB will receive notifications only on records created by userB (`owner=userB`), but userA will receive (will subscribe to) to all notifications.

---------------

---------------

# How can I implement a chat schema with @manyToMany using Amplify GraphQL with non private/public auth rules?

---------------

Author: @sansavision
Upvotes: 1
Comments: 0

I was trying to implement a chat feature that has three models; message, user and conversation.
A user can have many conversations, a conversation can have many users and a conversation can have many messages.

I tried using @manytomany between the user and conversation models with authenticated rules set to owner, this however fails because of " Not Authorized to access on type error". Im using graphql API (Not Datastore) with cognito user pool.

If I set the allow rule to private then it works but then that would mean that the users in a conversation would have access to each others user model and through that access to other conversations that the users might have.

One could maybe use a query filter and only show the relevant conversations but it would still mean that the user data is accessible to all signed in users. Maybe one could use a lambda function.

The simple explanation however is that my model is incorrect. My question is as follows, how can we create a simple chat with the above three models where the users in a conversation would only have access to the relevant data (messages in a conversation) and not have have access to each others, other conversations and messages.

The chat schema

type User @model @auth(rules: [{ allow: owner }]) {
id:ID!
username: String!
conversations: [Conversation] @manytomany(relationName: "ConversationUser")
}

type Conversation @model @auth(rules: [{ allow: owner }]) {
id: ID!
users: [User] @manytomany(relationName: "ConversationUser")
Messages: [Message] @hasmany(indexName: "byConversation", fields: ["id"])
}

type Message @model @auth(rules: [{ allow: owner }]) {
id: ID!
author: ID!
content: String!
conversationID: ID! https://github.com/Index(name: "byConversation", sortKeyFields: ["createdAt"])
}

Amplify CLI Version : 8.0.2

---------------

---------------

# Auth.currentSession() is null when relaunching the page

---------------

Author: @jbprat
Upvotes: 1
Comments: 2

Hi,

I'm trying to check is a user currently signed in when reloading the a web page, before doing any request that requires a JWT.

Here is my code: 
```
  axios.interceptors.request.use(
    (config) => {
      return new Promise((resolve, reject) => {
        Auth.currentSession()
          .then((session) => {
            const idTokenExpire = session.getIdToken().getExpiration();
            const refreshToken = session.getRefreshToken();
            const currentTimeSeconds = Math.round(Date.now() / 1000);

            if (idTokenExpire < currentTimeSeconds) {
              Auth.currentAuthenticatedUser().then((res) => {
                res.refreshSession(refreshToken, (err: any, data: any) => {
                  if (err) {
                    signOut();
                  } else {
                    config.headers.Authorization =
                      'Bearer ' + data.getIdToken().getJwtToken();
                    resolve(config);
                  }
                });
              });
            } else {
              config.headers.Authorization =
                'Bearer ' + session.getIdToken().getJwtToken();
              resolve(config);
            }
          })
          .catch(() => {
            if (token && !isTokenExpired)
              config.headers.Authorization = `Bearer ${token}`;

            resolve(config);
          });
      });
    }
```

The `Auth.currentSession().then((session) => )` returns something right after the user connects. 
If I reload the page,` Auth.currentSession()` is falling into the catch.

Isn't Auth supposed to get its information from the localStorage, where the tokens are with `amplify-authenticator-authState` key set to `signedIn`?
## Comment

---------------

Author: @elorzafe

@jbprat 

How are you configuring the library?
## Comment

---------------

Author: @eliecer2000

Hi, try adding `bypassCache: true` to the parameters of `currentAuthenticatedUser`. 

this makes if the user is really logged out or was disabled it will give you the exception 
  
      
```
        Auth.currentAuthenticatedUser({
          bypassCache: true
        })
```

---------------

---------------

# [v3] @searchable directive for @manyToMany

---------------

Author: @sampleaccount2
Upvotes: 1
Comments: 0

```
type Post @model {
  id: ID!
  title: String!
  content: String
  tags: [Tag] @manyToMany(relationName: "PostTags")
}

type Tag @model {
  id: ID!
  label: String!
  posts: [Post] @manyToMany(relationName: "PostTags")
}
```

I take the [docs ](https://docs.amplify.aws/cli/graphql/data-modeling/#many-to-many-relationship) as example. As I understand, in v2, when we want to create a N:N relationship table, `PostTags` model will be created automatically which is really convenient. However, I want to search for a list of `Post`s with some `Tag` sorted by `createdAt` and paginated. Is it possible to use `@searchable` directive with `@manyToMany`?

A follow up question is how do we also define other directives for a `manyToMany` model? Say I want to include `@model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })` for `PostTags`. I have some questions:
1. Must I create the model manually? 
2. If so, it seems like `@key` and `@connection` has been deprecated in v2, so how would I go about doing it? 

---------------

---------------

# PubSub unsubscribe completes before sign out?

---------------

Author: @entest-hai
Upvotes: 1
Comments: 0

I am using [Amplify PubSub to subscribe to an IoT topic](https://docs.amplify.aws/lib/pubsub/subunsub/q/platform/js/#subscribe-to-a-topic). I want to unsubscribe before sign out. However, sign out happens before unsubscribe. Please help. 

---------------

---------------

# withAuthenticator with pre-filled username and password?

---------------

Author: @entest-hai
Upvotes: 1
Comments: 0

Hello, 

I am doing a demonstration and need pre-filled username and password for the login form provided by withAuthenticator? Can anyone tell me how to do it? 

Thank you 

---------------

---------------

# Regarding Amplify Datastore Connectivity

---------------

Author: @mohitsuccessive
Upvotes: 0
Comments: 1

I am able to connect Amplify Datastore with Dynomodb and synchronization is also working fine but I don't want to use Dynomodb tables in my process. I want my Datastore to directly call my HTTP API.

I want to create an application that works offline and when users come online it will call my custom HTTP API and sync that data to the local datastore.

Can anybody suggest to me how can I achieve this by using amplify
## Comment

---------------

Author: @david-mcafee

@mohitsuccessive - currently, the DataStore sync engine only works with AWS AppSync.

---------------

---------------

# Handle unsynched Datastore during graphql schema changes

---------------

Author: @kheriox-technologies
Upvotes: 1
Comments: 1

Hello Team,

We are using Amplify Datastore and App Sync for our Offline requirements in react application.
Our end users use this app in offline mode in the field. The data from their app will be synched with AppSync (Dynamo DB) when they come online.
During our recent release, we added a new entity to the AppSync graphql schema. There was some unsynched data in the local data store. This unsynched data is deleted from the local data store after the release.

We would like to know if there any way to sync the data before refreshing / re-initializing the local data store with the new schema so that we won't lose unsynched data when we do app sync schema changes.
## Comment

---------------

Author: @david-mcafee

@kheriox-technologies - currently, schema changes are performed prior to processing the mutation queue when DataStore starts, meaning that if there are local changes that have not yet been persisted to AppSync, they will be cleared.

---------------

---------------

# Does Datastore sync with backend if changes on backend and app is closed

---------------

Author: @mir1198yusuf
Upvotes: 1
Comments: 1

There is a config called `fullSyncInterval` . When this time finishes and app is closed for a long time (not inactive , not in background, but closed completely), does syncing with backend happens?  or it  starts to happen when app is opened again? 
## Comment

---------------

Author: @david-mcafee

Hi @mir1198yusuf - thanks for starting this discussion! A sync will not occur until the app has been opened, and is online. The first time DataStore is started on a new client, a full sync is performed. Subsequent reloads of the app (including browser refresh, or a new browser session) are delta syncs. If it has been greater than the `fullSyncInterval` (a configurable value) since the client has performed a full sync, this operation occurs as a full sync. However, syncs only occur when the app has been opened, and is online.

---------------

---------------

# Is there a way to ignore DataStore subscription events if the listener is the event emitter?

---------------

Author: @mdegrees
Upvotes: 1
Comments: 1

When using 
```javascript
   const subscription = DataStore.observe(SomeModel, someModel.id).subscribe(
      (msg) => {}
    );
```
How do you avoid reacting to an incoming event when we are the event emitter?

thank you.
## Comment

---------------

Author: @david-mcafee

@mdegrees - `observe` will always return subscription events to all users, including the author of the event. Can you explain your use case further so we can better understand the issue? Thanks!

---------------

---------------

# How to get Amplify project and be able to execute amplify push

---------------

Author: @leonardocfor
Upvotes: 1
Comments: 1

Hi everybody, 

I have an amplify project already deployed in the Cloud and in production. Whenever I want to make a change, for example in schema.graphql for the database, I do it from the same computer where I initialized the project. How can I do it from another computer ? Not only the database but in general, update authentication, etc., i.e. admin privileges from another computer. 

Thank you, 
## Comment

---------------

Author: @david-mcafee

@leonardocfor thanks for starting this discussion! This workflow is documented in [this section of our docs](https://docs.amplify.aws/cli/start/workflows/#amplify-pull). Let me know if you have any other questions!

---------------

---------------

# Datastore local data disappears

---------------

Author: @tshad
Upvotes: 1
Comments: 2

Is there a time limit when the datastore data which resides in IndexedDB will be deleted?

I am not synching with the cloud yet and it was working fine. I hadn't run the project for about 2 weeks.  When I started the project again, all the data was gone. When I looked in dev tools, there are no records there.

![image](https://user-images.githubusercontent.com/12076957/105226291-a9224100-5b14-11eb-8aa7-2818f1c47dc6.png)

Thanks,
Tom
## Comment

---------------

Author: @egyangel

Hi did you manage to solve this problem? 
having same thing here...
## Comment

---------------

Author: @david-mcafee

@tshad and @egyangel - are you using DataStore strictly in local-only mode, or is there an AppSync backend that has been provisioned? Also, can you confirm if you have performed `DataStore.clear`, or if you have perhaps cleared local storage manually at any point? When you mention that you started the project again, was it on a local server? Thank you!

---------------

---------------

# DataStore update sending only updated attributes from v3.4.0

---------------

Author: @ramakrishnan
Upvotes: 1
Comments: 1

Starting from amplify-js 3.4.0 DataStore save (update) on a existing model sends only the updated attributes. Is there any option to send all the attributes.
## Comment

---------------

Author: @david-mcafee

@ramakrishnan - when DataStore sends a mutation to AppSync, we only send updated attributes. However, the most recent version of DataStore now sends _all_ fields to the customer (even those that are not updated) in each of the `observe` and `observeQuery` snapshots. Does this solve your issue? If not, could you let us know a little more about your use case? Thank you!

---------------

---------------

# How to query a DataStore Model that has nested properties?

---------------

Author: @mdegrees
Upvotes: 1
Comments: 1

Hi everyone, anyone has an idea how I can query a model with a predicate on a nested object. I'm working with the following schema:

```graphql
type Post @model {
  id: ID
  title: String
  tags: [Tag]
}

# e.g title="foo" , color="yellow"
type Tag {
id: ID
title: String
color: String
}
```
How can I get posts where tag title = 'foo' ?

It's not possible with predicates as they seem to work only on first level fields. I thought about using the `contains' predicate, but it does not work on an array of objects. Any ideas how I can get around this?

thank you

## Comment

---------------

Author: @david-mcafee

@mdegrees thanks for starting this discussion! I believe the most straightforward approach here would be to set up a "many to many" relationship between `Post` and `Tag`, [as described in our docs](https://docs.amplify.aws/lib/datastore/relational/q/platform/js/#many-to-many). Let me know if that works for you!

---------------

---------------

# Login by with "LINE" by OpenID, do we have document for that (React native - Cognito - OpenId - Line)

---------------

Author: @trungphotobank
Upvotes: 1
Comments: 1

I have implement "Login with facebook" successfully,
But I got some problem to implement with "Login with Line"

Please help me!. Thanks u !!!!
<img width="344" alt="Screen Shot 2021-05-28 at 14 51 04" src="https://user-images.githubusercontent.com/54518789/119949496-2169a900-bfc4-11eb-9ac2-293d8c9b1294.png">
## Comment

---------------

Author: @trungphotobank

closed!

---------------

---------------

# is amplify codegen removing always the custom queries you have made?

---------------

Author: @ARChatco
Upvotes: 1
Comments: 1

So I have done my own listUsers. returning less fields and when I do amplify push and I choose update, it is not adding the new stuff from schema, is also removing my custom queries,

Am I missing something?

Thanks!
## Comment

---------------

Author: @RossWilliams

Where are you saving your 'listUsers'? At the top of the queries.ts and queries.js files is a comment.
```
// this is an auto generated file. This will be overwritten
```

---------------

---------------

# AppSync SDK vs @aws-amplify/api

---------------

Author: @karrettgelley
Upvotes: 2
Comments: 2

I have been working on a react web app for a while and I have been using the api module (`@aws-amplify/api`). Love that package. It has done everything I need it to do. However, I am trying to pivot into a mobile. I now would like to create a react native mobile app that is offline enabled. I still want to keep my react app. There are two recommendations in the docs regarding [amplify and offline support](https://docs.amplify.aws/lib/graphqlapi/offline/q/platform/js): 1. Use DataStore  and 2. Use the AppSync SDK. 
I'm averse to using DataStore given that it's so new and does not have first class support for multi-tenant apps. But like I said, I have been using the api module for the longest and I have never heard of the AppSync sdk. It's documentation is fairly sparse and I'm wondering how it differs from `@aws-amplify/api`. Does anybody use it? Would you say that you either use `@aws-amplify/api` _or_ the AppSync SDK, or are they not mutually exclusive? Is the AppSync SDK part of the amplify framework or is it a one-off package for general use? And if `@aws-amplify/api` doesn't support offline cases, will it in the future? And what is the long term support of the AppSync SDK?

I know that's a lot of questions :). I'm just trying to figure out how this lowly mentioned package fits into the amplify ecosystem and what its purpose is. 
## Comment

---------------

Author: @d2kx

The AppSync SDK is what they initially started with, basically it's an extension of the popular Apollo GraphQL Client (https://www.apollographql.com/docs/react/). However, it is stuck on version 2.4 of the Apollo Client, and they since have released standalone Apollo Links to use with new versions of the Apollo Client (https://github.com/awslabs/aws-mobile-appsync-sdk-js#using-authorization-and-subscription-links-with-apollo-client-no-offline-support). These do not support the Offline use-case out of the box either, however.

I doubt they'll integrate any offline support into @aws-amplify/api, because there are many ways to do it and not everyone needs it and they don't want to bloat the library. The DataStore is probably what they'll push for your use-case going forward.

You can either use the Apollo Client with the AppSync SDK-Apollo Links and apollo-cache-persist (https://github.com/apollographql/apollo-cache-persist), which is more or less what the AppSync SDK was doing before they kind of dropped it because it was stuck on version 2.4 and focus shifted to @aws-amplify/api and the DataStore, or you can continue to use @aws-amplify/api and think about how to manage this yourself. E.g. if you are using a state management like redux, there are libraries that help you to persist it into IndexedDB for Web and AsyncStorage for React Native use-cases, or you build something yourself.

I absolutely sympathize with your issue, however this is a subject that will always be in flux, and hard to find a balance between what some users want vs. what other users want. I encourage you to make yourself familiar with IndexedDB for Web, AsyncStorage for ReactNative and simple ways to build your own small data stores and/or cache layers. It's fun and will help you going forward.
## Comment

---------------

Author: @david-mcafee

> I'm averse to using DataStore given that it's so new and does not have first class support for multi-tenant apps.

Hi @d2kx! I know this discussion is 2 years old now, but wanted to follow up with some feedback for future users. DataStore would give you the offline support you need across multiple platforms, and has been around for some time now. 


> Does anybody use [the AppSync SDK]? 

The AppSync SDK exists for users that have a preference for using Apollo.


> Would you say that you either use `@aws-amplify/api` _or_ the AppSync SDK, or are they not mutually exclusive? 

Using the two together would mean you would have 2 clients, which would be unnecessary.


> Is the AppSync SDK part of the amplify framework or is it a one-off package for general use? 

Amplify and the AppSync SDK can be used together, but they are separate packages.


> And if `@aws-amplify/api` doesn't support offline cases, will it in the future? And what is the long term support of the AppSync SDK?

If you're using Apollo V2, offline support is available. There is no current plan for offline support with Apollo V3.

Hope this answers any questions you may have!

---------------

---------------

# DataStore: What is the best way to approach privacy and clearing the local database on signin/out while preventing data loss?

---------------

Author: @laclance
Upvotes: 2
Comments: 33

### Before opening, please confirm:


- [X] I have [searched for duplicate or closed issues](https://github.com/aws-amplify/amplify-js/issues?q=is%3Aissue+) and [discussions](https://github.com/aws-amplify/amplify-js/discussions).
- [X] I have read the guide for [submitting bug reports](https://github.com/aws-amplify/amplify-js/blob/main/CONTRIBUTING.md#bug-reports).
- [X] I have done my best to include a minimal, self-contained set of instructions for consistently reproducing the issue.

### JavaScript Framework

React

### Amplify APIs

DataStore

### Amplify Categories

Not applicable

### Environment information

<details>

```
# Put output below this line
 System:
    OS: Windows 10 10.0.19042
    CPU: (8) x64 Intel(R) Core(TM) i5-10210U CPU @ 1.60GHz
    Memory: 7.05 GB / 15.84 GB
  Binaries:
    Node: 14.18.1 - C:\Program Files\nodejs\node.EXE
    Yarn: 1.22.17 - C:\Program Files\nodejs\yarn.CMD
    npm: 6.14.15 - C:\Program Files\nodejs\npm.CMD
  Browsers:
    Edge: Spartan (44.19041.1266.0), Chromium (96.0.1054.34)
  npmPackages:
    @aws-amplify/core: ^4.3.8 => 4.3.8
    @aws-amplify/datastore: ^3.7.0 => 3.7.0
    @babel/helper-call-delegate: ^7.12.1 => 7.12.13
    @capacitor-community/electron: ^4.0.3 => 4.0.3
    @capacitor/android: ^3.3.1 => 3.3.1
    @capacitor/app: ^1.0.5 => 1.0.6
    @capacitor/core: ^3.3.1 => 3.3.1
    @capacitor/device: ^1.0.5 => 1.0.6
    @material-ui/core: ^4.11.3 => 4.12.3
    @material-ui/icons: ^4.11.2 => 4.11.2
    @testing-library/jest-dom: ^5.11.9 => 5.15.0
    @testing-library/react: 12.1.2 => 12.1.2
    @testing-library/user-event: ^13.5.0 => 13.5.0
    @types/crypto-js: ^4.0.2 => 4.0.2
    @types/intl-tel-input: ^17.0.3 => 17.0.4
    @types/jest: ^27.0.2 => 27.0.2
    @types/node: 16.11.6 => 16.11.6
    @types/qrcode.react: ^1.0.1 => 1.0.2
    @types/react: ^17.0.30 => 17.0.34
    @types/react-dom: ^17.0.0 => 17.0.11
    @types/uuid: ^8.3.0 => 8.3.1
    @typescript-eslint/eslint-plugin: 5.3.0 => 5.3.0 (4.33.0)
    @typescript-eslint/parser: 5.3.0 => 5.3.0 (4.33.0)
    array-move: ^4.0.0 => 4.0.0
    clsx: ^1.1.1 => 1.1.1
    crypto-js: ^4.1.1 => 4.1.1
    eslint-plugin-prettier: ^4.0.0 => 4.0.0
    eslint-plugin-react: ^7.26.1 => 7.26.1
    eslint-plugin-react-hooks: ^4.2.0 => 4.2.0
    graphql: ^16.0.1 => 16.0.1 (14.5.0, 14.0.0)
    graphql-tag: ^2.12.6 => 2.12.6
    i18next: ^21.3.2 => 21.4.0
    intl-tel-input: ^17.0.13 => 17.0.13
    jwt-decode: ^3.1.2 => 3.1.2
    ksuid: ^3.0.0 => 3.0.0
    prettier: ^2.4.1 => 2.4.1
    qrcode.react: ^1.0.1 => 1.0.1
    react: ^17.0.1 => 17.0.2
    react-dnd: ^14.0.4 => 14.0.4
    react-dnd-html5-backend: ^14.0.2 => 14.0.2
    react-dom: ^17.0.1 => 17.0.2
    react-i18next: ^11.12.0 => 11.13.0
    react-indiana-drag-scroll: ^2.1.0 => 2.1.0
    react-loader-spinner: ^4.0.0 => 4.0.0
    react-scripts: 4.0.3 => 4.0.3
    react-simple-keyboard: ^3.3.7 => 3.3.26
    shelljs: ^0.8.4 => 0.8.4
    typescript: 4.4.4 => 4.4.4
    universal-cookie: ^4.0.4 => 4.0.4
  npmGlobalPackages:
    @aws-amplify/cli: 7.5.2
    cross-env: 7.0.3
    npm: 6.14.15
    yarn: 1.22.17

```

</details>


### Describe the bug

Trying to clear datastore after a mutation causes this error:
DOMException: Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.

### Expected behavior

Should be able to wait for mutations to complete before disconnecting.

### Reproduction steps

1. Make a mutation.
2. Clear datastore

### Code Snippet

```javascript
// Put your code below this line.

        //logout
        try {
          await DataStore.save(new DataTable(unsavedData));
          await DataStore.clear();
        } catch (e) {
          console.error('logout err', e);
        }
```


### Log output

<details>

```
// Put your logs below this line

[DEBUG] 46:14.36 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.36 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.36 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.37 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.37 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.37 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.37 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.37 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.38 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.38 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:115 [DEBUG] 46:14.56 DataStore - Attempting mutation with authMode: API_KEY
ConsoleLogger.ts:115 [DEBUG] 46:14.56 Util -  attempt #1 with this vars: ["DataTable","Create","{\"test\":\"test\",\"id\":\"8ed1246f-6dfa-4b54-92d2-a3ae353d0d4a\"}","modelId":"8ed1246f-6dfa-4b54-92d2-a3ae353d0d4a","model":"DataTable","operation":"Create","condition":"{}","id":"01FNDT3TP0P2KJSKFTG7T43NWF"}]
ConsoleLogger.ts:125 [DEBUG] 46:14.58 RestClient - POST https://****.appsync-api.eu-west-1.amazonaws.com/graphql
ConsoleLogger.ts:125 [DEBUG] 46:14.96 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.96 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.96 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.96 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxMutationEnqueued', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:125 [DEBUG] 46:14.97 Hub - Dispatching to datastore with  {event: 'outboxStatus', data: {…}}
ConsoleLogger.ts:115 [DEBUG] 46:14.154 DataStore - Starting Storage

wrap-idb-value.js:150 Uncaught (in promise) DOMException: Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.
    at Proxy.<anonymous> (http://localhost:3000/static/js/vendors~main.chunk.js:342317:22)
    at IndexedDBAdapter.<anonymous> (http://localhost:3000/static/js/vendors~main.chunk.js:38191:26)
    at step (http://localhost:3000/static/js/vendors~main.chunk.js:37730:17)
    at Object.next (http://localhost:3000/static/js/vendors~main.chunk.js:37661:14)
    at fulfilled (http://localhost:3000/static/js/vendors~main.chunk.js:37615:24)
```

</details>


### aws-exports.js

```javascript
const awsmobile = {
    "aws_project_region": "eu-west-1",
    "aws_appsync_graphqlEndpoint": "https://.appsync-api.eu-west-1.amazonaws.com/graphql",
    "aws_appsync_region": "eu-west-1",
    "aws_appsync_authenticationType": "API_KEY",
    "aws_appsync_apiKey": "da2-"
};
```

### Manual configuration

_No response_

### Additional configuration

_No response_

### Mobile Device

_No response_

### Mobile Operating System

_No response_

### Mobile Browser

_No response_

### Mobile Browser Version

_No response_

### Additional information and screenshots

_No response_
## Comment

---------------

Author: @chrisbonifacio

Hi @laclance 👋 thanks for raising this issue. In our [documentation](https://docs.amplify.aws/lib/datastore/sync/q/platform/js/#clear-local-data), we recommend listening to the signout event from the Auth category to trigger a `DataStore.clear` call.

I think there might be a race condition happening between the graphql call datastore makes and the clear/signout operations but this should work.

ex.
```js
Hub.listen('auth', async (data) => {
  if (data.payload.event === 'signOut') {
    await DataStore.clear();
  }
});
```
## Comment

---------------

Author: @laclance

ok thank you but how do I trigger the signOut event? It's a custom login, do I have to use amplify authentication in order to clear datastore on signout?
## Comment

---------------

Author: @chrisbonifacio

Ohh okay. Well, in that case, maybe you could use the `API.graphql` method to create that record before DataStore gets cleared? I think the issue is mainly that you're trying to save a record to the local database, which DataStore will always do, but the graphql queries happen separately apart from the DataStore operations. So, it might make more sense to make a call directly to the API so you don't have to worry about the DataStore websocket connection closing before the local record can be synced to the server.

something like this:

```js
//logout
try {
  await API.graphql({
    query: createRecord,
    variables: {
      ...unsavedData
    }
  });
  await DataStore.clear();
} catch (e) {
  console.error('logout err', e);
}
```
## Comment

---------------

Author: @laclance

Ok yeah thank you that's probably the best idea. 
## Comment

---------------

Author: @chrisbonifacio

No problem 😄  Let me know if that works for you!
## Comment

---------------

Author: @laclance

@chrisbonifacio is there a way to check a record has been synced to the cloud? Comparing the SubscriptionMessage when offline and online they seem to be identical?
## Comment

---------------

Author: @laclance

The problem I'm having is similar to this one https://github.com/aws-amplify/amplify-js/issues/6488. If the internet goes down and I do a Datastore.save to the local db while still offline and then when the internet comes on again datastore does not sync right away and if a user wants to log out before the sync occurs I can't tell which items in the local db have been synced to the cloud or not.
## Comment

---------------

Author: @laclance

> `graphql`

Also tried this and get same error.
## Comment

---------------

Author: @laclance

Can also get the same error without trying to save right before clearing. If you do a datastore.save while offline then at any point in time clear the db and then at any point in time go online again you will get the error. So doesn't matter whether or not I try to save data before clearing will still get the error if I clear the db at any point in time while there are unsynced records.
## Comment

---------------

Author: @chrisbonifacio

>is there a way to check a record has been synced to the cloud? Comparing the SubscriptionMessage when offline and online they seem to be identical?

As far as I know, there are two ways:

1. Using the Hub utility

```js
React.useEffect(() => {
  DataStore.start();

  const listener = async ({ payload }) => {
    const { event, data } = payload;

    switch (event) {
        case "ready":
          console.log("datastore is ready");
          break;
        case "modelSynced":
          console.log("modelSynced", data.model.name);
          break;
        default:
          console.log("unknown event", event, data);
      }
  };

  Hub.listen("datastore", listener);

  return () => {
    Hub.remove("datastore", listener);
  };
}, []);
```

console logs

<img width="1438" alt="Screen Shot 2021-12-01 at 2 59 23 PM" src="https://user-images.githubusercontent.com/16952986/144304938-2eef2f78-5bed-49a8-991f-0cfea8becaf7.png">

2. Using `DataStore.observeQuery`

```js
React.useEffect(() => {
  let sub;

  sub = DataStore.observeQuery(Profile).subscribe(({ items, isSynced }) => {
    console.log({ items, isSynced });
  });

  return () => {
    sub.unsubscribe();
  };
}, []);
```

console logs

<img width="1440" alt="Screen Shot 2021-12-01 at 3 40 31 PM" src="https://user-images.githubusercontent.com/16952986/144310601-129336f6-0d02-420b-af3a-1547652d537f.png">
## Comment

---------------

Author: @chrisbonifacio

Maybe I'm misunderstanding the use case here, but why are you clearing the local database if you are anticipating the user to perform operations offline? Do you expect multiple users to be logged into the same device? If the same user is signing in, it might be best to leave the data cached locally and only clear the database if a different user logs in.

https://docs.amplify.aws/lib/datastore/sync/q/platform/js/#clear-local-data
## Comment

---------------

Author: @laclance

Thanks but those solutions don't tell me if data has synced to the cloud only locally because even when offline datastore says items are synced. Yes there are multiple users and their data needs to be private.
## Comment

---------------

Author: @laclance

So whether online or offline this is what I get:
```
event: 'outboxMutationEnqueued'
event: 'outboxStatus', 
{items: Array(687), isSynced: true}
```

If offline then will get event: 'modelSynced' when I come online again which is great because I can check if 'outboxMutationEnqueued' fires then wait for 'modelSynced' to check if data has been synced but if online then 'modelSynced' events only fires when I refresh the page.
## Comment

---------------

Author: @laclance

That I can manage though but main issue is still if app is online I want to clear datastore but save unsynced data before doing so but I get the 'Failed to execute' error.
## Comment

---------------

Author: @chrisbonifacio

@laclance ah okay, I see what you mean. Hmm, I'm not really sure if there's a reliable way to make sure records are synced to the server before clearing, especially if offline.

Personally, I wouldn't clear the local database unless a different user logs into the same device to try to avoid the edge case of a user logging out while offline causing records to be lost before synced. But, I may just be missing some experience on how to properly handle this.

I'm going to reach out to the DataStore team to see if I can get some feedback for you on what might be the best way to approach this.
## Comment

---------------

Author: @laclance

Ok cool thanks so much, the only problem with not clearing is that other users can see the data in the indexdb via browser dev tools.
## Comment

---------------

Author: @chrisbonifacio

No problem! As a quick note, the team has pointed out that the event for when a local change has been synced to the cloud would be `outboxMutationProcessed`, rather than the enqueued changes.

Still in talks about this with the team. Thank you for bearing with me in the meantime!
## Comment

---------------

Author: @laclance

No problem thanks, yes I did see that but it's the same problem as the 'modelSynced' event, the events don't always get fired if you do not have a stable internet connection.
## Comment

---------------

Author: @laclance

All of a sudden getting this error and can't get rid of it. 
```index.ts:594 Uncaught (in promise) TypeError: Cannot read properties of undefined (reading 'lastFullSync')```
## Comment

---------------

Author: @laclance

@chrisbonifacio deleted amplify project and recreated from scratch but still the the same error, not sure if I should maybe open a new issue because I don't know how to reproduce it, all I did was try to run Datastore.clear() after doing multiple updates, which I tried many times before without receiving this error.
```
[DEBUG] 30:28.849 Util -  attempt #1 with this vars: ["query operation($limit: Int, $nextToken: String, $lastSync: AWSTimestamp, $filter: ModelPOSFilterInput){\n\t\tsyncPOS(limit: $limit, nextToken: $nextToken, lastSync: $lastSync, filter: $filter){\n\t\t\titems {\n\t\t\t\t\t\t\tid\npk\nsk\nentityType\ncurrentState\ndata\ngsi1Pk\ngsi1Sk\ncreatedAt\nupdatedAt\n_version\n_lastChangedAt\n_deleted\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextToken\n\t\t\t\t\t\tstartedAt\n\t\t}\n\t}",{"limit":1000,"nextToken":"***==","lastSync":0,"filter":null}]
ConsoleLogger.ts:125 [DEBUG] 30:28.850 RestClient - POST https://***.appsync-api.eu-west-1.amazonaws.com/graphql
ConsoleLogger.ts:115 [DEBUG] 30:31.434 DataStore - Sync successful with authMode: API_KEY
index.ts:594 Uncaught (in promise) TypeError: Cannot read properties of undefined (reading 'lastFullSync')
    at SyncEngine.<anonymous> (index.ts:594)
    at step (index.ts:3)
    at Object.next (index.ts:3)
    at fulfilled (index.ts:3)
    ```
## Comment

---------------

Author: @laclance

Re-created the project again with a different table name and created a fresh frontend app with only `Amplify.configure(aws_exports);` and `DataStore.start()` and get these 2 errors:

```
Unhandled Rejection (TypeError): Cannot read properties of undefined (reading 'namespaces')
IndexedDBAdapter.<anonymous>
C:/Users/src/storage/adapter/IndexedDBAdapter.ts:115
  112 | };
  113 | IndexedDBAdapter.prototype.getStorename = function (namespace, modelName) {
  114 |     var storeName = namespace + "_" + modelName;
> 115 |     return storeName;
      | ^  116 | };
  117 | IndexedDBAdapter.prototype.setUp = function (theSchema, namespaceResolver, modelInstanceCreator, getModelConstructorByModelName, sessionId) {
  118 |     return __awaiter(this, void 0, void 0, function () {
  ```
  
  ```
  Unhandled Rejection (TypeError): Cannot read properties of undefined (reading 'version')
DataStore.<anonymous>
C:/Users/Lance/src/datastore/datastore.ts:742
  739 | };
  740 | this.delete = function (modelOrConstructor, idOrCriteria) { return __awaiter(_this, void 0, void 0, function () {
  741 |     var condition, msg, modelConstructor, msg, msg, _a, deleted, model, modelConstructor, msg, modelDefinition, idPredicate, msg, _b, _c, deleted;
> 742 |     return __generator(this, function (_d) {
      | ^  743 |         switch (_d.label) {
  744 |             case 0: return [4 /*yield*/, this.start()];
  745 |             case 1:
  ```
## Comment

---------------

Author: @chrisbonifacio

looking into similar issues in the past, these errors seem to be caused by a few things.

1. Make sure DataStore is enabled for the project, of course
2. Remove any unnecessary amplify packages (I see you have both `@aws-amplify/core` and `@aws-amplify/datastore`. You can either try only installing `aws-amplify` from which you can still import the scoped packages if it's the only package installed. Or, you can remove `@aws-amplify/core` because its already listed as a dependency of the scoped datastore package.
3. Replace `DataStore.start()` with `DataStore.query()`
## Comment

---------------

Author: @laclance

Thank you, looks like replacing dataStore.start() with DataStore.query() works, I thought the first query() called start() anyway.
## Comment

---------------

Author: @laclance

Also have to use the aws-amplify package now, but we were using datastore fine for almost a year with @aws-amplify/core and @aws-amplify/datastore.
## Comment

---------------

Author: @laclance

Still get the same error when I start using Datastore more after the first DataStore.query().
## Comment

---------------

Author: @laclance

Ok now it seems to only throw errors on start and clear.

`DataStore.start()` gives `Cannot read properties of undefined (reading 'lastFullSync')` but we can use `query` instead.

`DataStore.clear()` still gives `DOMException: Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.` and we do want to be able to clear the db to not allow users to view other users' private information via browser dev tools.

Also using the aws-amplify package, types are not inferred which is quite annoying also can't do things like jump to the definition.
## Comment

---------------

Author: @chrisbonifacio

Yeah, we're still working to improve TypeScript support in our library.

I was thinking about the issue you're having with clearing the database and have some thoughts I'd like to run by you because with most of the syncing process being automated and requiring an active network connection, data loss is difficult to avoid if a user were to sign out and, as a result, clear the database while offline before records have a chance to sync.

I think the documentation's recommendation of real world usage being to clear the local db if a different user logs in makes more sense than simply clearing the db on signOut.

Definitely don't want to try to save a record before the database is cleared because, as mentioned before, the time it takes between a `save` and a `clear` won't be enough to ensure the record was synced through the outbox process anyway. This will probably always result in the `Failed to execute 'transaction' on 'IDBDatabase' error.

So, I was wondering if maybe there is some room for letting the data exist in the local store at least until the network status comes back online. There is also a `networkStatus` event from the `Hub`'s datastore listener that could maybe be used to check if the user is online and only clear the database if they are logged out with an active connection?
## Comment

---------------

Author: @laclance

Okay, thank you. Yes but as mentioned we don't want to to allow users to view other users' private information via the dev tools. The `networkStatus` still returns true if there is a network but no internet connection. So I'm using `outboxStatus` and `outboxMutationProcessed` to check if everything has synced then running clear() after a small delay. If data doesn't get synced after a certain amount of time then I encrypt it and store it locally. Using the hub events was causing a bit of a problem with an unstable internet connection but due to the other errors we haven't had a chance to fully test it yet. 
## Comment

---------------

Author: @chrisbonifacio

Okay yeah that makes sense and aligns with what the team has explained to me about what is probably the best way to handle this scenario (using the outbox status and mutationProcessed events).

Because the original issue is not a bug and intended behavior I'd close this issue but I believe this is worth a more in-depth discussion so we can move it to discussions instead to keep this open for feedback.
## Comment

---------------

Author: @laclance

Not quite the original issue but I feel like it shouldn't be the intended behavior. As I mentioned, the outboxStatus and mutationProcessed events often don't work without a stable internet connection, same goes for subscriptions. Also if a user logs out and the internet goes off for a second and datastore stops and mutations don't get processed you going to see the same error when a user logs in and `DataStore.clear()` is called. Is one purpose of datastore not suppose to be the aid in offline/online data synchronization?  
## Comment

---------------

Author: @laclance

Just got the same error now after running `DataStore.clear()` and I've had a stable internet connection and have not done a mutation.
## Comment

---------------

Author: @ecc7220

Is there any progress on this?
## Comment

---------------

Author: @perryneal11

Also having this issue, would love a solution

---------------

---------------

# After deleting corrupted environment admin queries API and function is not being added

---------------

Author: @Zilvinaskli
Upvotes: 1
Comments: 0

Hello, 

I had a working environment that hasn't been used in a while and it was throwing errors after every amplify push command.
Instead of resolving all the issues and cloudformation stacks I deleted the environment and started adding resources from a fresh start.

I managed to add all the resources fine and they were working except admin queries API and functions were missing.
I removed auth and dependent resources and tried to do it again, I definitely selected yes to add admin queries but still admin queries were missing. 

---------------

---------------

# Problems when exporting

---------------

Author: @eliecer2000
Upvotes: 1
Comments: 0

Hello community, I tell you about a problem I have with a project created with AWS Amplify, I have with several resolvers in the preLoadData stage, unfortunately I did not find an elegant solution to place them dataSourceName until I used the strategy of overwrite in the API, when I deploy with the CLI works great, the problem becomes when I try to export my project to CDK the overrider does not work, in the build stage when it is exported does not make this call, you can even try running the command `amplify build` and you will see that if the overrider file runs, it does not work when I run `amplify export`, I do not know whether to report this bug.


---------------

---------------

# Failed to deploy user pool using option "Reuse existing Amazon Cognito resources"

---------------

Author: @DVGY
Upvotes: 4
Comments: 0

The selected Cognito User Pool does not have at least 1 Web app client configured. Web app clients are app clients without a client secret. at headlessImport.

![image](https://user-images.githubusercontent.com/46158826/162268161-ad1fea01-da4a-453e-a933-11bda0244f30.png)

---------------

---------------

# How can get the authenticated user from cookies.

---------------

Author: @proraheelaslam
Upvotes: 4
Comments: 0

Hi,

I have setup user and pol data in cookies for multiple domain switch. I am using this script It is working fine to set the token
in cookies. When i try to get the authenticated user by this script it gives error.

`var cognitoUser = new AmazonCognitoIdentity.CognitoUserPool(poolData).getCurrentUser();`

```
amazon-cognito-identity.js:7577 Uncaught TypeError: this.storage.getItem is not a function
    at CognitoUserPool.getCurrentUser (amazon-cognito-identity.js:7577:37) 
```

```
var poolData = {
     UserPoolId : '...', // Your user pool id here
     ClientId : '...' // Your client id here
     Storage: new AmazonCognitoIdentity.CookieStorage({domain: "localhost"})
 };

 var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

 var userData = {
     Username: 'username',
     Pool: userPool,
     Storage: new AmazonCognitoIdentity.CookieStorage({domain: "localhost"})
 };
```

How can get the authenticated user from cookies instead from localstorage.


Thanks 


---------------

---------------

# Documentation on amazon-cognito-identity-js methods and functions

---------------

Author: @micoPhD
Upvotes: 2
Comments: 0

Hi,

Do we have an explicit documentation on the classes and methods used in the example use cases from the npm page (here: https://www.npmjs.com/package/amazon-cognito-identity-js)

For example:
AmazonCognitoIdentity.CognitoUserAttribute
AmazonCognitoIdentity.CognitoUserPool
AmazonCognitoIdentity.CognitoUser
etc.

Thank you

---------------

---------------

# Cache - elasticache

---------------

Author: @agrant-intix
Upvotes: 2
Comments: 1

General question on caching API results in a next.js application.

Whenever we try to connect to AWS elasticache, we get a timeout due to security issues.

I understand this is due to requiring to access elasticache by a VPC which would generally exist if you were running EC2 in the same VPC to connect properly.

However in Amplify it's all setup via Cloudfront. Is it possible to connect to elasticache from an Amplify project?

Alternatively I have found you can use a react library such as 

const cache = require('memory-cache');

My understanding this gets saved into memory but I'm unsure what memory and whether it is actually going to work in cloudfront with so many different cloudfront edges therefore negating the cache savings.

In my API request for example I currently have

export default async function venue(req, res){
   const cache = require('memory-cache');
   const cache_title = req.url;
   const get_cache = cache.get(cache_title);

   if( get_cache != null ){
      res.status(200).json(get_cache);
   } else {
       const sql = require('sql-template-strings');
       const db = require('../../../lib/db');
       db.query(sql`SELECT xxx WHERE xxxx = xxxx`)
      .then( data => {
           res.status(201).json(JSON.parse(JSON.stringify(data[0])));
           cache.put(cache_title, JSON.parse(JSON.stringify(data[0])), 10000); // Time in ms
      });
   }
}

## Comment

---------------

Author: @vbhakta8

How can we get amplify to deploy within our VPC?

---------------

---------------

# Cognito bug on Safari 15.0 - QuotaExceededError: The quota has been exceeded.

---------------

Author: @
Upvotes: 17
Comments: 12

This happened on the latest Safari 15.0 on both Mac system and IOS system.

Seems like sometimes the localstorage stopped working sometimes, and it could be solved by refreshing the page etc.

Anyone can help?
## Comment

---------------

Author: @Progressandro

@chengjiaapraamcos Same thing here. Were you able to solve the issue?
## Comment

---------------

Author: @blkg

This is happening for us too, and is particularly problematic since Safari is the #1 browser using our application, holding a 2-1 margin over its nearest competitor (Chrome).  Hope this gets fixed soon!
## Comment

---------------

Author: @ashika01

@chengjiaapraamcos @Progressandro is this happening only on safari 15? and do you have any configuration related to cookie storage? Could you maybe provide a snippet of your `Amplify.configure`?
## Comment

---------------

Author: @coisme

I got the same error too on Safari Version 15.0 (16612.1.29.41.4, 16612) on macOS Big Sur Version 11.6 (20G165).

After I clear cache from `Preferences > Privacy > Manage Website Data > [Target website] > Remove`, the problem disappeared.
## Comment

---------------

Author: @bassamrached

Is there any update on this issue? Is it a safari problem or cognito?
More and more of our safari users are having this issue.
Thank you!
## Comment

---------------

Author: @thomasdashney

My app was reporting this error for the last few months, I **finally** figured out how to reproduce it semi-consistently:

* Open an iOS simulator (I'm using iPhone 8, iOS 15.0)
* Open Safari
* Close all Safari tabs
* Force quit Safari
* In the terminal, run this command to open your web page that breaks: `xcrun simctl openurl booted <YOUR_URL_HERE>`
* After a couple of seconds, this should automatically open Safari into a state where any `localStorage.setItem` calls are throwing an instance of `QuotaExceededError`

From my testing, it seems that the error only occurs from a cold open via a link click, and when there were no pre-existing tabs open. I run into the same bug in iOS Chrome as well.

I was able to at least avoid use of `localStorage` by falling back to in-memory storage if `localStorage` isn't working:

```tsx
export function getAuthStorage(): Pick<
  Storage,
  "setItem" | "getItem" | "removeItem" | "clear"
> {
  try {
    window.localStorage.setItem("rewards.shared.test-ls", "1");
    window.localStorage.removeItem("rewards.shared.test-ls");
    // we know local storage is working
    return window.localStorage;
  } catch (error) {
    console.warn("Cannot use localstorage; falling back to memory storage");
    return MemoryStorage;
  }
}

let dataMemory: {
  [key: string]: string;
} = {};

export class MemoryStorage {
  static setItem(key: string, value: any) {
    dataMemory[key] = value;
    return dataMemory[key];
  }

  static getItem(key: string) {
    return Object.prototype.hasOwnProperty.call(dataMemory, key)
      ? dataMemory[key]
      : null;
  }

  static removeItem(key: string) {
    return delete dataMemory[key];
  }

  static clear() {
    dataMemory = {};
    return dataMemory;
  }
}

// and then pass this custom storage when initializing cognito:

Auth.configure({
  storage: getAuthStorage()
})
```
## Comment

---------------

Author: @

I don't think it's a good idea to workaround this issue. 
Localstorage is an important feature and we need to inform Safari to fix it.
Could anyone tell me how to inform their team? A proper fix should be done on their side but not our side.

Thanks guys
## Comment

---------------

Author: @silenceisgolden

Not having access to `localStorage` is not a new issue unfortunately [Angular2 issue link](https://github.com/marcj/angular2-localstorage/issues/73). Could Amplify fall back to in memory or choose another storage option if localStorage is not available for any reason, not just if Safari is started with a Private Browsing session?
## Comment

---------------

Author: @djdam

Did anyone try indexedDB as an alternative (instead of @thomasdashney 's mem storage) ?
## Comment

---------------

Author: @djdam

this seems to work, I will try it out in prod and monitor the ios users

https://gist.github.com/djdam/1dd3d0a1023a6533419aa4ec01ff7463

btw, I used the localforage package for simplicity:

`npm install localforage`

edit: I had key/val mixed up, fixed it
## Comment

---------------

Author: @darkmarthur

Hello people!

In my company, we are facing the same issue in our web application on iOS devices when trying to login to the application (using AWS Cognito auth) after a long period (a couple of days) of inactivity with the device browser.

Does anybody find a solution or a workaround to avoid the `QuotaExceededError` response?
## Comment

---------------

Author: @pawojciechowski

Duplicate of #9140. 
Solution: https://github.com/aws-amplify/amplify-js/issues/9140#issuecomment-1083364359
Alternatively you can setup [cookieStorage](https://docs.amplify.aws/lib/client-configuration/configuring-amplify-categories/q/platform/js/#scoped-configuration)
```javascript
Amplify.configure({
  Auth: {
    // (optional) - Configuration for cookie storage
    // Note: if the secure flag is set to true, then the cookie transmission requires a secure protocol
    cookieStorage: {
      // - Cookie domain (only required if cookieStorage is provided)
      domain: '.yourdomain.com',
      // (optional) - Cookie path
      path: '/',
      // (optional) - Cookie expiration in days
      expires: 365,
      // (optional) - See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite
      sameSite: 'strict' | 'lax',
      // (optional) - Cookie secure flag
      // Either true or false, indicating if the cookie transmission requires a secure protocol (https).
      secure: true
    },
  }
})
```

---------------

---------------

# How to send and receive message in amplify?

---------------

Author: @simon-zhangmuye
Upvotes: 2
Comments: 3

Hi,

 Is there a best practice case for amplify notification just like a blog with many posts, if someone clicks Like this post or make a comment, the author will receive a message like "username likes your post" or someone comments your post.

I am thinking about using a subscription listener, create a message model in schema.graphql and subscribe to the new messages by owner id. 

But if I use rules allow owner in my modal, the senders can subscribe to the notifications sent by themselves. How can receivers get notifications and subscribe to new messages? Obviously, receivers don't need to subscribe to all messages, they just need the messages sent to them. How can I config rules this time?

What if I have thousands of comments or likes per second, in this case, is it right to put them in one table and subscribe to all the events. What should I do?

If anyone knows how to do it, please help. 

Thanks,

## Comment

---------------

Author: @sw-yx

you can publish/subscribe a single topic per user: https://docs.amplify.aws/lib/pubsub/getting-started/q/platform/js#aws-iot
## Comment

---------------

Author: @viprocket1

Im also interested in this topic. 
## Comment

---------------

Author: @iukea1

Any luck on ideas about this? I am having the same thoughts and problems. 

---------------

---------------

# how do I give each subdomain a different meta tag?

---------------

Author: @kim00425
Upvotes: 1
Comments: 0

currently i m deploying a web front with SEO at amplify.

I want to give different meta tags for each subDomain.

is there a way?

---------------

---------------

# Changelog?

---------------

Author: @EdGonzalez-
Upvotes: 1
Comments: 1

Is there a changelog for each Amplify release?
## Comment

---------------

Author: @david-mcafee

Hi @EdGonzalez, thanks for starting this conversation! As of now, we have a separate CHANGELOG for each package (for instance, [the DataStore CHANGELOG](https://github.com/aws-amplify/amplify-js/blob/main/packages/datastore/CHANGELOG.md)), but we do not have a global CHANGELOG for all packages. Does this answer your question?

---------------

---------------

# `invalid_client` from TOKEN endpoint

---------------

Author: @wataruoguchi
Upvotes: 2
Comments: 1

Hello! Correct me if I am posting in wrong place.

I have a question about the error.

```
{"error":"invalid_client"}
```

My goal is to integrate an OpenID Connect client into AWS Cognito and authenticate users with Authorization Code Flow. The client provides client id and secret, my Cognito user pool client knows those values.

I've been using https://github.com/amazon-archives/amazon-cognito-auth-js, It's working fine with Implicit Flow.

I believe when the `response_type` is switched from `token` to `code`, it should take Authorization Code Flow. In fact, it started requesting to `https://<my domain>.auth.<region>.amazoncognito.com/oauth2/token` a POST request. However, I am getting the error above.

[The developer guide](https://docs.aws.amazon.com/cognito/latest/developerguide/token-endpoint.html) says that I may haven't set correct `client_id` and `client_secret`, however, there's nowhere I can set `client_secret`. I once thought it'd be in the Authentication header, but it seems like both the archived package and this Amplify package don't have the Authentication header set.

- [Where header is defined in Amplify](https://github.com/aws-amplify/amplify-js/blob/f89e545a93f370f0ce91b437514f833b03c6202b/packages/auth/src/OAuth/OAuth.ts#L169)
- [Where header is defined in amazon-cognito-auth-js](https://github.com/amazon-archives/amazon-cognito-auth-js/blob/master/lib/CognitoAuth.js#L168)

I am wondering if these JS libraries don't support "Authorization Code Flow", or I am missing the implementation adding the Authentication header?

On the other hand, I think it's odd to expose the client secret in the Authentication header if I have to. So I have doubt that the POST request should be done in server side?
## Comment

---------------

Author: @sagarb27

If the type of your client is WebApp then you will be issued a Client secret. 
As per the Oauth2 Authorization code flow specifications https://datatracker.ietf.org/doc/html/rfc6749#section-2.3
you have to follow basic authentication scheme for client application (if the clientApp type is Webapp) by including Authorization header of the following format:
Header => Authorization: "Basic<Space><base64 encoded string of <ClientID:<colon>ClientSecret>>
Invalid client error is because it couldnt authenticate your client while invoking the token endpoint as mentioned in the specifications
https://datatracker.ietf.org/doc/html/rfc6749#section-5.2

---------------

---------------

# Adding custom attributes to sign up form question.

---------------

Author: @thedraketaylor
Upvotes: 1
Comments: 1

I've got the following code where I'm adding a custom attribute to my sign up form:

```
    <AmplifyAuthenticator>
    <AmplifySignUp
      slot="sign-up"
      headerText="My Custom Sign Up Text"
      formFields={[
        { type: "username" },
        { type: "password" },
        { type: "email" },
        {
          type: "text",
          label: "Stage Name",
          placeholder: "Stage Name",
          name: "custom:stage-name1",
          fieldId: "custom:stage-name1"
        },
      ]}
    />
  </AmplifyAuthenticator>
```
It shows up fine, but when I click the submit button, I get the following error: "A client attempted to write unauthorized attribute
"  I've checked my cognito attributes and they are writable. Clearly I'm missing something, can someone tell me what I'm doing wrong?

Thanks!
## Comment

---------------

Author: @thedraketaylor

I found the issue. I needed type: "custom:stage-name1", instead of type: "text",

---------------

---------------

# How to allow custom headers for API Gateway programmatically

---------------

Author: @demilp
Upvotes: 1
Comments: 0

I need to receive a custom header in a lambda function but the API Gateway was blocking the request.
I followed this steps [here](https://docs.amplify.aws/lib/restapi/authz/q/platform/js/#customizing-http-request-headers) and it is working now, but is not scalable if I want to create multiple environments or do this on multiple endpoints.
Is there a way to do it from the amplify console or at least manually modifying some CloudFormation template?

---------------

---------------

# How to recover from AWSAppSyncRealTimeProvider errors?

---------------

Author: @CSHaze
Upvotes: 2
Comments: 0

Is there any easy way to reconnect the  AWSAppSyncRealTimeProvider web socket after an error ("Connection closed", "Timeout disconnect", etc)? These errors appear when the connection has been idle or disconnected for longer than the keepAliveTimeout (5 minutes).

I can't figure out a way to get any of my subscriptions to work again without refreshing the page (web) or restarting the app (android and ios).

---------------

---------------

# How to delete a DynamoDB item from Lambda with node.js

---------------

Author: @ClaudioVR
Upvotes: 1
Comments: 1

The "Calling DynamoDB from Lambda in Node.js" page of the [online docs](https://docs.amplify.aws/guides/functions/dynamodb-from-js-lambda/q/platform/js/#querying-a-table) has no mention of how to delete a DynamoDB item.

I've brought this up on the amplify docs issues board [#4114](https://github.com/aws-amplify/docs/issues/4114)

There are docClient methods for .get(), .query() and .scan() but nothing on how to delete an item. 

I have found [dynamoDb docs](https://github.com/aws-amplify/docs/issues/4114#:~:text=https%3A//docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.NodeJs.03.html%23GettingStarted.NodeJs.03.06) that explain how to delete items but the syntax seems to differ slightly.

My code looks something like this....

I am using a primaryKey: userID and a sortKey: bankAccountID

```
app.post('/delete-account', async function (req, res) {
  const bankAccountID = req.body.bankAccountID
  
  try {
    const accountDetails = await getSpecificAccountDetails(req, bankAccountID)
    
    var params = {
      TableName: 'myTableName',
      KeyConditionExpression: '#user = :value and #bankID = :OID',
      ExpressionAttributeValues: { ':value': accountDetails.userID, ':OID': bankAccountID  },
      ExpressionAttributeNames: { '#user': 'userID', '#bankID': 'bankAccountID'  }
    }

    const accountDeleted = docClient.delete(params).promise()

    res.json({
      ...
    })
  }
    catch (err) {
      ...
    })
  }
})
```

Has anyone come across this issue or have any suggestions?
## Comment

---------------

Author: @ClaudioVR

After working on this for a few days, I came across the answer only minutes after posting the above post, so I thought I'd share the answer here:

```
 var params = {
    TableName: 'myTableName',
     Key: {
         userID: account.userID, // primary key
         bankAccountID: account.bankAccountID, // sort key
      },
}

await docClient.delete(params).promise()
```

---------------

---------------

# Can I use Graphql and Datastore in same project ?

---------------

Author: @fistofzen
Upvotes: 1
Comments: 2

Hello,

I have a project, where I enabled Datastore. When I  execute the same select query with Graphql and Datastore, they return different resultsets.

Is it normal behaviour :? 

Regards.
## Comment

---------------

Author: @david-mcafee

Thanks for starting this discussion, @fistofzen!

The difference in query results between DataStore and the GraphQL API is due to the fact that DataStore performs soft deletes on records - a record that has been deleted by DataStore will be marked with the `_deleted` flag set to `true` with a TTL of 30 days. The records you're seeing when you perform a query with the API is likely containing all of the records in the table, including those marked with the `_deleted` flag. 

Can you help us understand your use-case for wanting to use both the GraphQL API, and DataStore, concurrently? Thanks!
## Comment

---------------

Author: @fistofzen

Hello David,
Actually, I tried to use Datastore but there were some performance problems. Initial data selection was so slow. 
Secondly, for the deep structures GraphQL is much more useful  than Datastore. 
Thanks


---------------

---------------

# tokenRefresh event triggered multiple times

---------------

Author: @alxAgu
Upvotes: 1
Comments: 0

Hi, I'm using the following code to monitor the auth process:

```js
const handleHubEvent = useCallback((capsule) => {
  const event = capsule?.payload?.event;

  try {
    switch(event){
      case 'signIn_start':
      case 'signIn':
      case 'tokenRefresh':
        const user = await auth.currentAuthenticatedUser();
        setCurrentUser(user);
        break;
      case 'signOut':
      case 'tokenRefresh_failure':
        setCurrentUser(null);
        break;
    }
  } catch (e) {
    console.log("Error: ", e);
    setCurrentUser(null);
  }
}, []);

useEffect(() => {
  Hub.listen('auth', handleHubEvent);
  Hub.dispatch('auth', { event: 'signIn_start' });

  return () => Hub.remove('auth', handleHubEvent);
}, []);

```

The problem is that after a few hours (seems random), the event callback `handleHubEvent` gets invoked continuously with the `tokenRefresh` event, I mean, like 7 times a second. I can see in the network tab multiple (successful) requests to `cognito-idp.ap-southeast-2.amazonaws.com`.

Even after refreshing the page, the behaviour is the same, the only way to get rid of it is by deleting the cookies and sign in again.

As a workaround, I even tried detecting the behaviour by calculating the elapsed time between `tokenRefresh` events and then call `Hub.remove` but even this is not working, the callback (`handleHubEvent`) keeps being invoked.

I spent a lot of time debugging this and I can confirm `Hub.listen` is only being called once.

I didn't create an issue because I'm not sure how to replicate this yet, but it is still happening. Can anyone from the amplify team (@chrisbonifacio? @david-mcafee? 🙏🙏🙏) look at this? Maybe I'm doing something obviously wrong? 

Thanks.

---------------

---------------

# Cannot modify an already provided attribute

---------------

Author: @rhinozD
Upvotes: 4
Comments: 0

Hi everyone,

Actually, I use [amazon-cognito-identity-dart-2](https://github.com/furaiev/amazon-cognito-identity-dart-2) in my flutter app.

I called [sendNewPasswordRequiredAnswer](https://github.com/furaiev/amazon-cognito-identity-dart-2/blob/main/lib/src/cognito_user.dart#L796) with the following parameters:
```
 newPassword = 'newPass'
 requiredAttributes = {'phone_number': '+123456789'}
```
to change initial password and add `phone_number` attribute. `phone_number` is not a required attribute.
The `sendNewPasswordRequiredAnswer` is mapping to [completeNewPasswordChallenge](https://github.com/aws-amplify/amplify-js/blob/main/packages/amazon-cognito-identity-js/src/CognitoUser.js#L580) and it should work fine.

It worked perfectly before but now I got this error(I did not change my source code):
`CognitoClientException{statusCode: 400, code: NotAuthorizedException, name: NotAuthorizedException, message: Cannot modify an already provided phone number}`

I am really stuck in this issue, please help me!
Thank you very much!

---------------

---------------

# What is the authorization grant used by the Amplify Auth?

---------------

Author: @kainn9
Upvotes: 1
Comments: 0

My apologies if this is a silly question, but I am struggling to understand this concept. When calling methods such as`Auth.signIn()` what type of Authorization grant is being used?

---------------

---------------

# aws-cognito-identity-js requires login on every refresh hosted on heroku, but not on localhost

---------------

Author: @katerlouis
Upvotes: 2
Comments: 1

I use `aws-cognito-identity-js` in my nuxt 2 application and login like this:

```js
import { CognitoUserPool, CognitoUser, CognitoUserAttribute, AuthenticationDetails } from 'amazon-cognito-identity-js';

// nuxt plugin function
export default ({ redirect, app, store, $config }, inject) => {
  // create a user pool using env vars
  const userPool = new CognitoUserPool({
    // todo: move data to env variables?
    UserPoolId: $config.cognito.userPoolId,
    ClientId: $config.cognito.clientId,
  });

  /**
   *   Login
   */
  const login = ({ username, password }) => {
    return new Promise((resolve, reject) => {
      const user = new CognitoUser({
        Username: username,
        Pool: userPool,
      });

      const authDetails = new AuthenticationDetails({
        Username: username,
        Password: password,
      });

      user.authenticateUser(authDetails, {
        onSuccess(result) {
          const payload = result.getIdToken().payload;
          console.log('login success:', result, payload);
          updateStore(payload);
          resolve(true);
        },
        onFailure(error) {
          console.log('login failed:', error);
          reject(error);
        },
        // preventing app breaking errors
        newPasswordRequired(error) {
          console.log('login failed: new password required', user);
          reject(error);
        },
      });
    });
  };

  // ... more functions
});
```

locally a page-refresh doesn't require me to login again. Hosting the SSR build on Heroku (https) forces users to login on every refresh, though. Unfortunately OAuth2 is a bit over my head and I don't really know how to incorporate a refreshToken here. I still hope it's not necessary and I can get it to work just like on `localhost:3000` :D

Appreciate some help! 

Thanks!
## Comment

---------------

Author: @katerlouis

I've figured it out.

Usually I generate static sites with nuxt, but this time I'm going for Server-Side-Rendering and the middleware checking if the user is still logged in is called server-side when the page is refreshed. The server obviously doesn't have the necessary tokens stored anywhere. 

My workaround for the moment is just telling the nuxt server to skip server-side-rendering:

```js
// nuxt.config.js

export default {
  target: 'server',
  ssr: false, 

  // ...
};
```

---------------

---------------

# One to many modeling in datastore with shared common data

---------------

Author: @marcioalexbarbosa
Upvotes: 1
Comments: 0

I have the following model in amplify datastore:

```
type Professor @model @auth(rules: [{ allow: owner }]) {
  id: ID! @primaryKey
  firstName: String!
  lastName: String!
  students: [Student] @hasMany
# ...  
}

type Student @model @auth(rules: [{ allow: owner }]) {
  id: ID! @primaryKey
  firstName: String!
  lastName: String!
# ...
}
```

Professor Charles can have both students Timothy and Johnson and Timothy can have as professors both Charles and Rita

Now the modeling part is piece of cake, the problem is with the way datastore works.

A professor will see a dashsboard with a list of his/her students, and the students will see a dashboard with a list with his/her professors.

At dynamodb this will be persisted with a professor key in the students table. So for Timothy to have more than one professor, each professor must have a copy of Timothy?

If I change to, say, @manyToMany, then how can I avoid the entire database to be downloaded? because selective sync does not allow to use an "in [list]" expression filter where I can change the list later with, for example, the keys in the join table.

Any ideas? 

---------------

---------------

# Remove "Sign in with AWS Button"

---------------

Author: @lack-of-gravitas
Upvotes: 2
Comments: 1

How can I remove **only** the Sign in with AWS button - using Amplify UI components

![image](https://user-images.githubusercontent.com/10094964/127498149-b0cc6ea8-c00d-4e6c-8982-b7d6b327cb33.png)

- i havent enabled this as a federated sign in in my userpool nor do i want to so why is it shown by default?
- hiding with CSS or query selectors seems to be a terrible way to hide a button for something that supposedly provides slots
- i referred to this [CodeSandbox](https://codesandbox.io/s/amplify-ui-federated-buttons-48x56?file=/src/App.js) which shows that there's an AmplifyGoogleButton / AmplifyFacebookButton component -- supposedly there is an AmplifyAmazonButton? where is this documented so that someone can actually implement what they are after?
- where is this documented (if at all) and no Github threads (with bad search) don't count
-  
![image](https://user-images.githubusercontent.com/10094964/127498245-4da135ee-0e2a-4eaf-892c-24040d9614fc.png)
## Comment

---------------

Author: @kewur

how did you find which slot you can override? is it on the documentation somewhere?

---------------

---------------

# Amplify component styling

---------------

Author: @MikeLungu77
Upvotes: 1
Comments: 2

Hey all,
has anybody been able to style the AWS Amplify component?
i can't seem to be able to do simple things, like 
1. applying border radius, or 
2. disabling the text transform on the buttons.
i can change top level attributes, from amplify-authenticator, which are then inherited down to input and buttons, but not the input fields or the buttons themselves.
any hints, would be greatly appreciated.
thanks,
Mike.
## Comment

---------------

Author: @david-mcafee

@MikeLungu77 thanks for starting this discussion! Can you let us know which version of Amplify UI you are using, and what component(s) you are wanting to style? I assume the Amplify Authenticator component, but just want to be sure. Thanks!
## Comment

---------------

Author: @MikeLungu77

hi David,
thanks heaps for your reply.
indeed i am using the Amplify Authenticator component.
and my versions are like below:

    ***@***.***/ui-angular": "^1.0.30",
    ***@***.***/ui-components": "^1.9.1",


    "aws-amplify": "^4.3.4",
    "aws-amplify-angular": "^6.0.22",

just a couple of things i am struggling with:

the buttons, i am unable to disable or remove the text-transform. i don't
want the all uppercase. or apply a different border-radius.
these properties seem to be inherited from the "amplify-button.hydrate",
and i am not sure how to change them.

the form fields, is there a way to set the label text different color than
the input?

thanks gain,

cheers,
Mike.

On Sat, 26 Feb 2022 at 08:25, David McAfee ***@***.***> wrote:

> @MikeLungu77 <https://github.com/MikeLungu77> thanks for starting this
> discussion! Can you let us know which version of Amplify UI you are using,
> and what component(s) you are wanting to style? I assume the Amplify
> Authenticator component, but just want to be sure. Thanks!
>
> —
> Reply to this email directly, view it on GitHub
> <https://github.com/aws-amplify/amplify-js/discussions/9622#discussioncomment-2254368>,
> or unsubscribe
> <https://github.com/notifications/unsubscribe-auth/AU2QVXYYNJOFGHR7244BJELU476UXANCNFSM5O5KUDYA>
> .
> Triage notifications on the go with GitHub Mobile for iOS
> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>
> or Android
> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.
>
> You are receiving this because you were mentioned.Message ID:
> ***@***.***>
>

---------------

---------------

# IndexedDB exposure in production

---------------

Author: @diontrepate
Upvotes: 1
Comments: 2

Hi! I recently deployed my application and noticed that the IndexedDB was exposed from the dev tools. This was concerning because all of my tables and the data from within them are present. Is there something I can do to fix this? 
## Comment

---------------

Author: @david-mcafee

Hi @diontrepate - you're correct that IndexedDB data is visible from dev tools. Can you give me more information regarding what your concern is? (i.e. are you concerned that end users can view the tables, or that someone else could potentially view this data?) Perhaps if you can provide more information regarding your concern, I can better help answer your question. Thanks!!
## Comment

---------------

Author: @david-mcafee

Hey @diontrepate - DataStore does not offer encoding of the data, however, you are correct that [using authorization rules](https://docs.amplify.aws/lib/datastore/setup-auth-rules/q/platform/js/) will allow you to control what users can view what data. Does this answer your question?

---------------

---------------

# Datastore: How can I sync with the data belongs to the Login user, not sync the entire database?

---------------

Author: @KevinLam0308
Upvotes: 1
Comments: 2

Hello,

I'm developing an Android App using Android Studio which stores user data by datastore and with their user login, I'm now facing a problem is that:

Every time re-install the App, amplify will sync again the entire database to the local, it takes at least 2 to 3 minutes, in the middle of syncing, encounter a Timeout error (maybe it's 1 minute now), so I would like to know how can I overcome this problem, and below are the possible solution that I'm looking on:

1) Add syncExpression for a dedicated user to minimize the sync time

Followed below instruction to change the syncExpression at runtime, but not success:

https://docs.amplify.aws/lib/datastore/sync/q/platform/android/#reevaluate-expressions-at-runtime

here is the code:

```
public static String userId;

protected void onCreate{
        try {
            Amplify.addPlugin(new AWSApiPlugin());

            Amplify.addPlugin(new AWSCognitoAuthPlugin());

            initialize();

            Amplify.configure(getApplicationContext());

            Log.i("Amplify", "Initialized Amplify");
        } catch (AmplifyException e) {
            Log.e("Amplify", "Could not initialize Amplify", e);
        }

       changeSync();
}

    public void initialize() {
        try {
            Amplify.addPlugin(AWSDataStorePlugin.builder().dataStoreConfiguration(
                    DataStoreConfiguration.builder()
                            .syncExpression(Alert.class, () -> Alert.NAME.eq(userId))
                            .build())
                    .build());
        } catch (AmplifyException e) {
            e.printStackTrace();
        }
    }

    public void changeSync() {
        userId = Amplify.Auth.getCurrentUser().getUserId();

        Amplify.DataStore.stop(
                () -> Log.i("Amplify", "DataStore is stopped."),
                failure -> Log.e("Amplify", "Failed to clear DataStore.")
        );

        Amplify.DataStore.start(
                () -> Log.i("MyAmplifyApp", "DataStore started"),
                error -> Log.e("MyAmplifyApp", "Error starting DataStore: ", error)
        );
    }
```

I would like to set userId as the sync condition, but not success in the above code, any suggestions?

2) Set the authentication rules on Amplify console

Are there any rules that can be set for each model on Amplfiy console that can have the same result that I want?


**Which Category is your question related to?**

DataStore and Cognito

**Amplify CLI Version**

v7.6.21

**What AWS Services are you utilizing?**

AppSync, Datastore, Cognito

Thanks and regards,
Kevin
## Comment

---------------

Author: @KevinLam0308

In addition, is there a way to extend the Timeout for syncing? I'm thinking that if the data size for each user becomes bigger and bigger, it may take over a minute to sync all data to local even I set the syncExpression successfully, below is the timeout error during syncing:

```
2022-03-09 10:56:06.032 14356-14416/com.example.bleapp E/amplify:aws-datastore: Failure encountered while attempting to start API sync.
    DataStoreException{message=Initial sync during DataStore initialization failed., cause=java.util.concurrent.TimeoutException: Timed out while performing initial model sync., recoverySuggestion=There is a possibility that there is a bug if this error persists. Please take a look at 
    https://github.com/aws-amplify/amplify-android/issues to see if there are any existing issues that 
    match your scenario, and file an issue with the details of the bug if there isn't.}
        at com.amplifyframework.datastore.syncengine.Orchestrator.lambda$startApiSync$3$com-amplifyframework-datastore-syncengine-Orchestrator(Orchestrator.java:327)
        at com.amplifyframework.datastore.syncengine.Orchestrator$$ExternalSyntheticLambda5.subscribe(Unknown Source:2)
        at io.reactivex.rxjava3.internal.operators.completable.CompletableCreate.subscribeActual(CompletableCreate.java:40)
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850)
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51)
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850)
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51)
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850)
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51)
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850)
        at io.reactivex.rxjava3.internal.operators.completable.CompletableSubscribeOn$SubscribeOnObserver.run(CompletableSubscribeOn.java:64)
        at io.reactivex.rxjava3.core.Scheduler$DisposeTask.run(Scheduler.java:614)
        at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.run(ScheduledRunnable.java:65)
        at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.call(ScheduledRunnable.java:56)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
        at java.lang.Thread.run(Thread.java:764)
     Caused by: java.util.concurrent.TimeoutException: Timed out while performing initial model sync.
        at com.amplifyframework.datastore.syncengine.Orchestrator.lambda$startApiSync$3$com-amplifyframework-datastore-syncengine-Orchestrator(Orchestrator.java:323)
        at com.amplifyframework.datastore.syncengine.Orchestrator$$ExternalSyntheticLambda5.subscribe(Unknown Source:2) 
        at io.reactivex.rxjava3.internal.operators.completable.CompletableCreate.subscribeActual(CompletableCreate.java:40) 
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850) 
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51) 
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850) 
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51) 
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850) 
        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51) 
        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2850) 
        at io.reactivex.rxjava3.internal.operators.completable.CompletableSubscribeOn$SubscribeOnObserver.run(CompletableSubscribeOn.java:64) 
        at io.reactivex.rxjava3.core.Scheduler$DisposeTask.run(Scheduler.java:614) 
        at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.run(ScheduledRunnable.java:65) 
        at io.reactivex.rxjava3.internal.schedulers.ScheduledRunnable.call(ScheduledRunnable.java:56) 
        at java.util.concurrent.FutureTask.run(FutureTask.java:266) 
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:301) 
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167) 
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641) 
        at java.lang.Thread.run(Thread.java:764) 
2022-03-09 10:56:06.034 14356-14416/com.example.bleapp W/amplify:aws-datastore: API sync failed - transitioning to LOCAL_ONLY.
```

Changing the timeout may not be the best approach, so what about querying data from remote directly instead of automatic syncing of the entire database to local?
## Comment

---------------

Author: @KevinLam0308

anyone can help? thanks!

---------------

---------------

# How do i set proper device name in deviceList, in react native.

---------------

Author: @theguy1985
Upvotes: 1
Comments: 0

I am using `aws-amplify 4.3.15(latest)` in my react native application with enabled MFA. Now when I try to fetch the list of authorized devices, I do not get a proper result for Android devices. `cognitoUser.listDevices()` gives me array of devices, but the DeviceAttribute ` device_name` doesn't say Android or something like that. Instead, I get `"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36"`. Also Sometime device_name is not at all there. This is most probably an issue with device tracking and detection. Please help if anyone went through a similar situation.

---------------

---------------

# Is the Release Cycle Wiki page up to date?

---------------

Author: @cietho
Upvotes: 2
Comments: 1

Hey guys, I have seen that an important pull request for me has been successfully reviewed and merged. Unfortunately it is not clear to me what happens after the merge into the main branch. I would like to install the latest version that contains the pull request.

I did some searching and came across this wiki page: https://github.com/aws-amplify/amplify-js/wiki/Release-Cycle - so far so good. Then I searched for the tag 4.0.32-unstable-xx. Unfortunately this tag does not exist.

So my question: Is the wiki page still up to date and were the tags just not pushed by mistake? Or has the process changed?

Many thanks and best regards
cietho
## Comment

---------------

Author: @david-mcafee

Hey @cietho! The wiki you linked to is still up-to-date. Can you tell me which PR you are searching for, specifically?

This tag does not exist because version `4.0.32` does not exist.

We just released a major version today, so your PR would be included with that release. For future reference, if you take a look at [our version history on npm](https://www.npmjs.com/package/aws-amplify), you'll see all of the unstable versions that are published each week. For instance, our last unstable version was [4.3.15-unstable.10](https://www.npmjs.com/package/aws-amplify/v/4.3.15-unstable.10). Hope this helps, and let me know if you have more questions!

---------------

---------------

# Correct way to handle adding required fields later

---------------

Author: @clintfoster
Upvotes: 1
Comments: 0

Suppose I update my GraphQL schema to add a new field that is required (or change an existing field to be required), e.g.:

```json
name: String!
```

If I then call `Datastore.query(Foo)` to list all Foos, it silently ignores existing items in the db that are missing `name`. This is true even when I explicitly provide an id to retrieve only one item, e.g.:

```json
DataStore.query(Foo, id)
```

This simply returns nothing, as if the item doesn't exist.

I don't think this situation can be handled by `DataStore.setErrorHandler()` since that's apparently only for sync errors.

One solution would be to write a script that backfills all items in the table whenever a required field is added. But if there are millions of records (many of which may never be accessed again) that may not be reasonable. 

I know this is going to sound extreme, but it seems to me it's not practical to make any fields required (except for the key schema) in an application that wants to be strict when storing, but forgiving when reading.

A way to provide a default value directly in the schema would be nice, and/or a handler called by `DataStore.query()` for each item that is missing any required fields.

Am I missing anything obvious, or should I make all fields optional, and handle validation for required fields myself? This means I'll no longer get automatic validation on `save()`, but at least i'll be able to query items that are missing required fields and deal with them.

---------------

---------------

# How to correctly use the `Analytics.updateEndpoint`?

---------------

Author: @BartoszKlonowski
Upvotes: 1
Comments: 1

In general: How to correctly use the `Analytics.updateEndpoint` method
from `AnalyticsClass`: `{ Analytics }` imported from `'@aws-amplify/analytics'`?

Documentation does not clearly specify how should the updated object look like that we are sending.

Let's say, that my example is:
I have the standard endpoint with all the required information, but I also have the
```javascript
endpoint: {
  attributes: {
    hobbies: ['piano', 'hiking'],
  },
}
```
and I want to extend the `attributes` with the user's pupils: `pupils: ['dog', 'cat']`.
So what I do is:
```javascript
import { Analytics } from '@aws-amplify/analytics';

Analytics.updateEndpoint({
  attributes: {
    pupils: ['dog', 'cat']
  },
})
.then(response => {
  console.log("Success with response: ", response);
})
.catch(error => {
  console.log("Error with response: ", error);
});
```

My questions are:
* I keep on getting the `ERROR  [ERROR] 58:48.118 AWSPinpointProvider - updateEndpoint failed [TypeError: undefined is not a function]` error, so I must be doing something in an incorrect way - what is it?
* Should I update the endpoint's additional attributes by giving all of them:
```javascript
Analytics.updateEndpoint({
  attributes: {
    hobbies: ['piano', 'hiking'],
    pupils: ['dog', 'cat']
  },
})
```
or just give the data that I want to update the endpoint with: `pupils` only?
* Should I specify the `address` field during updating the endpoint?
Like so?
```javascript
Analytics.updateEndpoint({
  address: '12345678',
  attributes: {
    pupils: ['dog', 'cat']
  },
})
```
* Should I give the **whole** configuration object or just give the object with data I want to update the endpoint with?

I'm really hoping for as much explanation as you can provide me with - I'm struggling with this a lot so I would use some help.
## Comment

---------------

Author: @david-mcafee

Closing this as a duplicate of [this docs ticket](https://github.com/aws-amplify/amplify-js/issues/9608). @BartoszKlonowski has [an open PR](https://github.com/aws-amplify/docs/pull/4054) on improving that documentation to be more clear. Thanks!

---------------

---------------

# I have some saved configured users, how do I delete them?

---------------

Author: @bojidaryovchev
Upvotes: 0
Comments: 1

Hey guys, this is driving me nuts.. I decided to clear out everything from my account and start clean, so I also deleted my IAM users and so on. Then, I used npx amplify init to initialize amplify in an application and I saw that I still have some users saved. I started googling for 15 or 20 mins without ever being able to find where are these users stored or how could I delete them. This is something that's supposed to be super simple and intuitive yet it seems impossible..

Does anyone know how to delete previously used users, where are they stored? I don't remember how I created them in the first place, but it should be easy to delete them..
## Comment

---------------

Author: @bojidaryovchev

ok I found out that I have to delete my AWS profile and in order to do that I had to go in my user folder (on Windows that is C:\Users\name) and then find the .aws folder in there and delete the config and credentials files in there and it worked

---------------

---------------

# OpenID Connect Federated Sign-In

---------------

Author: @lvillacin
Upvotes: 2
Comments: 1

**I'm trying to use Microsoft as my authorization and authentication provider using OpenID Connect** and found that User Pools has an OIDC option so I could set things up through there. My question is, how do I now call this within my amplify webapp? I don't want to use the Hosted UI and `Auth.federatedSignIn({provider: 'xyz'})` only works for Google, Facebook, Apple and Amazon. 
## Comment

---------------

Author: @lvillacin

Found out this can actually be done but I now don't know how to have access to the OIDC Access and Refresh Tokens. Anyone know how I can achieve that?

---------------

---------------

# Pulling existing backend for standalone frontend is creating a new backend environment

---------------

Author: @raffibag
Upvotes: 1
Comments: 1

When calling `amplify pull` from the Amplify CLI, I'm taken through the process of selecting a profile and a project (something I've been doing on this project for nearly two years), however, recently when answering `No` to `Do you plan on modifying this backend?`, Amplify is creating an `amplify` folder containing `cli.json` and `team-provider-info.json` files. This never used to happen.

The issue is that when I try to deploy the frontend in Amplify, it is failing on backend build. Again, it shouldn't even be creating a backend build.

Is there a way to pull only the `aws-exports.js` file and not an entirely new backend when calling `amplify pull`?
## Comment

---------------

Author: @david-mcafee

Hi @raffibag - thanks for starting this discussion! Check out [this page in our docs](https://docs.amplify.aws/cli/start/workflows/#amplify-pull) for instructions on how to pull the backend / env for an existing project. 

---------------

---------------

# Error message: Let's Build a TINDER clone with REACT NATIVE and AWS Amplify (pt. 2) at time 02:00:00

---------------

Author: @gasspau
Upvotes: 1
Comments: 0

Hi there!
I have an issue concerning the video of notJust.dev pt.2 at time mark 02:00:00 (https://www.youtube.com/watch?v=Wt8jo1znYWA&t=7215s) 
When I follow his steps I get the error messages in the attachment...

It seems like many others have the problem too...

Has anyone a solution to this problem? Would be very thankful!!

Thanks!
Paul
`import React, {useState} from 'react'
import { View, Text, StyleSheet, SafeAreaView, Image, Pressable, TextInput} from 'react-native'
import {Auth, DataStore} from "aws-amplify"
import {Picker} from "@react-native-picker/picker"
import  {User} from "../models/"


const ProfileScreen = () => {
    const [name, setName] = useState("")
    const [bio, setBio] = useState("")
    const [gender, setGender] = useState()
    const [lookingFor, setLookingFor] = useState()

    const isValid = () => {
        return name  && bio && gender && lookingFor;

    }

    const save = () => {
        if(!isValid()){
            console.warn("Not Valid")
            return 
        }

   
        const newUser = new User({
             name,
             bio, 
             gender,
             lookingFor,
            image: "https://notjustdev-dummy.s3.us-east-2.amazonaws.com/avatars/elon.png",
        })

        DataStore.save(newUser)
        console.warn("Valid")

    }
    return (
        <SafeAreaView style={styles.root}>
            <View style={styles.container}>
                <TextInput 
                    style={styles.input} 
                    placeholder="Name" 
                    value={name} 
                    onChangeText={setName}
                />
                <TextInput 
                    style={styles.input} 
                    placeholder="Bio..." 
                    multiline
                    numberOfLines={3}
                    value={bio} 
                    onChangeText={setBio}
                />

                <Text>Gender</Text>

                <Picker
                    label="Gender"
                    selectedValue={gender}
                    onValueChange={itemValue => setGender(itemValue)}
                    >
                    <Picker.Item  label="Male" value="MALE"/>
                    <Picker.Item  label="Female" value="FEMALE"/>
                    <Picker.Item label="Other" value="OTHER"/>

                </Picker>

                <Text>Looking For</Text>
                <Picker
                    label="Looking for"
                    selectedValue={lookingFor}
                    onValueChange={itemValue => setLookingFor(itemValue)}
                    >
                    <Picker.Item  label="Male" value="MALE"/>
                    <Picker.Item  label="Female" value="FEMALE"/>
                    <Picker.Item label="Other" value="OTHER"/>

                </Picker>
          
                <Pressable onPress={save} style={styles.button}>
                       <Text>Save</Text> 
                </Pressable>

                <Pressable onPress={() => Auth.signOut()} style={styles.button}>
                    <Text>Sign Out</Text>
                </Pressable>
            </View>
        </SafeAreaView>
    )
}
const styles = StyleSheet.create({
    root: {
        width: "100%",
        padding: 10,
        flex: 1,

    },
    container: {
        padding: 10,
        // backgroundColor: "red"

    },
    input: {
        margin: 10,
        borderBottomColor: "lightgray",
        borderBottomWidth: 1
    },
    button: {
        backgroundColor: "[#F63A6E](https://www.youtube.com/hashtag/f63a6e)",
        height: 25,
        justifyContent: "center",
        alignItems: "center",
        borderRadius: 20,
        margin: 10
    }

})
export default ProfileScreen`

![image](https://user-images.githubusercontent.com/78957068/155233355-fe8a4fab-57d2-4a58-b600-bc6c28d9b25c.png)

![image](https://user-images.githubusercontent.com/78957068/155233374-d9f1c509-6735-4161-bf0a-00dccd4dee2d.png)


---------------

---------------

# DataStore observe not working

---------------

Author: @fr-an-k
Upvotes: 1
Comments: 4

DataStore.observe(MyModel).subscribe(data => ...) is supposed to enable live notifications of remote database mutations through the websocket, correct?

Neither of the following get notified when I create or update an an item either through the AppSync console or a succesful signed graphql mutation request. DynamoDB console confirms that the mutations take place, with incremented versions.

```
Hub.listen('datastore', data => console.log('hub datastore', data))
DataStore.observe(MyModel).subscribe(
  data => console.log('subscription event', data),
  err => console.error('subscription error', err), // never called
  () => console.log('subscription completed') // never called
)
```

The Hub.listen('datastore') happens before my first query, which starts the DataStore
The observe() call happens after datastore 'ready' event.

When I refresh the page there is still no notification.
I have an AppSync log and Amplify.Logger.LOG_LEVEL = 'DEBUG' but nothing interesting occurs.

On DataStore.query(MyModel, Predicates.ALL), I receive the new data, but only after refreshing the page twice.
## Comment

---------------

Author: @fr-an-k

It seems to be working again, but haven't checked the live update of a remote change yet. I switched to aws-amplify instead of the modular packages, updated versions, did an amplify pull & checkout env to fix any files that may have been corrupted.
## Comment

---------------

Author: @fr-an-k

Turns out DataStore's inner subscribe system only supports owner strings in a model, not arrays. I turned off the auth rules and hope I can do it with a customized resolver instead.
## Comment

---------------

Author: @david-mcafee

@frank-unovica - you mention updates within the AppSync console, as well as graphql mutations. Do you receive updates when calling `Datastore.save` to perform a mutation? Thanks!
## Comment

---------------

Author: @david-mcafee

Marking as resolved as there hasn't been a response on this. If you are still running into issues, @frank-unovica, please re-open this discussion. Thank you!

---------------

---------------

# JavaScript heap out of memory

---------------

Author: @krikork
Upvotes: 3
Comments: 2

Today my builds have started failing with "FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory".

I am aware of https://github.com/aws-amplify/amplify-cli/issues/3708 and https://cloudnamaste.com/amplify-console-build-fail-java-heap-out-of-memory/ and have tried to mess around with those settings but that did not help. 

Any ideas?

## Comment

---------------

Author: @david-mcafee

Hi @krikork - can you provide additional details regarding what versions of the Amplify CLI / node you are using? Thanks!
## Comment

---------------

Author: @david-mcafee

Marking this as closed, as a solution is documented on [this issue](https://github.com/aws-amplify/amplify-cli/issues/3708). @krikork if you run into further issues, please re-open this discussion. Thank you!

---------------

---------------

# Does Lex/Interactions pass Cognito session information to underlying Lambda Validation scripts?

---------------

Author: @patweb99
Upvotes: 1
Comments: 1

I have an application that requires knowing WHO's logged in via the front end through Cognito. I'd like to be able to see this information whenever the validation Lambda is called through Lex.

Is this possible?

I see NO session or Cognito information. It would great to have this available since my validation Lambda script handles business logic and updates database records depending on whoever is logged in at the moment.
## Comment

---------------

Author: @elorzafe

@patweb99 

Do you mean you want to have information from the signed in user on your lambda once the bot is fullfilled? For example username, email, etc?


---------------

---------------

# Subscribe not working on ElasticSearch

---------------

Author: @muthu32
Upvotes: 1
Comments: 1

** Which Category is your question related to? **
gql queries and subscriptions

** What AWS Services are you utilizing? **
AppSync, DynamoDB, ElasticSearch

** Provide additional details e.g. code snippets **
Graphql subscription works with Dynamo db, So it can't get updated data from elasticsearch as soon as subscription triggers.
I have to use settimeout function to get updated results, as elasticsearch data does not available immediately. 
Due to this problem delete function is not working as expected sometime (if delay for insert in data in elsticsearch takes 2 seconds)

How to  change subscription function to work on amazon elastic search??

Related github issue: https://github.com/aws-amplify/amplify-js/issues/4916 => but no solution there

```
type Customer @model @searchable @auth(rules:[
# allow admins to create, update, delete 
{ allow: groups, groups: ["admin"] }
# allow all authenticated users to read
{ allow: private, operations: [read] }
]) {
id: ID!
name: String!
email: String!
Mobile: String!
customer_notes: String!
admin_notes: String!
city: City @hasOne
cities: String
langs: [String]
owner: String
createdAt: AWSDateTime!
updatedAt: AWSDateTime!
}
```
Subscription
```
type Subscription {
  onMutateCustomer: Customer
  @aws_subscribe(mutations: ["createCustomer", "updateCustomer", "deleteCustomer"])
  onMutateCity: City
  @aws_subscribe(mutations: ["createCity", "updateCity", "deleteCity"])
  onMutateLanguage: Language
  @aws_subscribe(mutations: ["createLanguage", "updateLanguage", "deleteLanguage"])
}
```
subscription Query
```
useEffect(()=> {
  const subscriptionOnCreate = (API.graphql(
    graphqlOperation(onMutateCustomer)
    ) as any).subscribe({
    next: (customerData:any) => {
      console.log("subscription data");
      console.log(customerData);
       setTimeout(fetchCustomer, 1000);
    },
    error: (error:any) => console.warn(error)
});

return () => {
  subscriptionOnCreate.unsubscribe();
}
},[]);
```
## Comment

---------------

Author: @muthu32

is it bug on subscription?? If it is bug, then I will post this on amplify issues page.

---------------

---------------

# How to attach only an email to a Pinpoint endpoit and not the browser?

---------------

Author: @AngelHadzhiev
Upvotes: 1
Comments: 0

Hello, 

I recently started using AWS Amplify to create a newsletter functionality with AWS Pinpoint. Everything goes good with the exception that I found out that when I create an endpoint, I can only create one endpoint per browser hence only one user will be an endpoint per browser thus any other new user created on this browser will take the place of the previous in my Pinpoint segment. Imagine you share your PC with another person and you both register from the same browser - this is an issue. 

Is there any way to use only the user email as a endpoint and not the browser? 

Thank you in advance

---------------

---------------

# React Native 64  "@aws-amplify/geo" triggering location permission when deploying to Apple Store

---------------

Author: @baruishigold
Upvotes: 0
Comments: 0

My app uses `"aws-amplify"` for `Auth, Storage` and  `Datastore` functionalities.
`Geo` is not explicitly used, but it is listed as a sub-dependcy of the `"aws-amplify"`. 
The app doesn't use any geo locations. 

When applying to Apple Store, the error showed up:
_ITMS-90683: Missing Purpose String in Info.plist - Your app's code references one or more APIs that access sensitive user data. The app's Info.plist file should contain a NSLocationWhenInUseUsageDescription key..._

Is there a way to manually remove/disable the @aws-amplify/geo" from the project? 
Any advise on how to remove the Geo from React Native project would be appreciated. 

---------------

---------------

# Amplify error

---------------

Author: @rajeshbhatks
Upvotes: 1
Comments: 0

Getting the following Amplify error when code is deployed. Works fine on the local machine

[ERROR] 06:12.40 AuthError - 
            Error: Amplify has not been configured correctly. 
            The configuration object is missing required auth properties.
            This error is typically caused by one of the following scenarios:

            1. Did you run `amplify push` after adding auth via `amplify add auth`?
                See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information

Here is the code

import Amplify, { Auth } from 'aws-amplify';

const render = () => {

  const awsConfig = {
    Auth: {
      region: "us-east-1",
      userPoolId: "xxxxxx",
      userPoolWebClientId: "yyyyyy"
    }
  };
    
  Amplify.configure(awsConfig);

	ReactDOM.render(
		<AppContainer>
			<Root />
		</AppContainer>,
		document.getElementById("appMountPoint")
	);
};

I tried the options mentioned here https://github.com/aws-amplify/amplify-js/issues/6930, but no success
I am using -> aws-amplify: 4.3.14

Really appreciate if some can help me

---------------

---------------

# DataStore predicates exist and not exist?

---------------

Author: @Hideman85
Upvotes: 1
Comments: 1

Hi community,

I'm wondering how can I query objects that satisfy the predicates attribute A does not exist.
I'm not able to see that predicates in the doc: https://docs.amplify.aws/lib/datastore/data-access/q/platform/js#predicates

Thanks in advance for your help
## Comment

---------------

Author: @david-mcafee

Thanks for starting this discussion, @Hideman85! Could you please share a code snippet of the query that is failing, and the related schema? Thank you!

---------------

---------------

# Fragile graphql

---------------

Author: @MiladNazeri
Upvotes: 1
Comments: 1

Yesterday we were doing some tests for our app and one thing that worries me is if there is some bad data that gets written to the DB, graphql kind of craps out on all the queries that might be involved.  I know I'm not the only person that has run into this.  Is there anyway to mitigate this so one bad entry doesn't possibly shutdown the whole system?
## Comment

---------------

Author: @david-mcafee

@MiladNazeri thanks for starting this discussion! Can you provide additional details on what error you were seeing? Is it on mutations, queries, etc? I've certainly done this a few times when testing, but never ran into an issue myself. If you provide us with additional repro steps, that would be helpful. Thanks!

---------------

---------------

# Am i doing this right ?

---------------

Author: @ambuu
Upvotes: 1
Comments: 1


## Comment

---------------

Author: @david-mcafee

@ambuu seeing that you removed your question, assuming we can mark this as resolved. If you have further questions, please reach out to us again. Thanks!

---------------

---------------

# Does AppSync have a limit on number of subscriptions/client?

---------------

Author: @cthomaschase
Upvotes: 1
Comments: 1

Getting this back from AppSync:

`Connection failed: {"errors":{"errorType":"MaxSubscriptionsReachedError","message":"Max number of 50 subscriptions reached"}}`
## Comment

---------------

Author: @david-mcafee

@cthomaschase you're correct that there is a subscription limit, but after you opened this discussion, we increased the limit to 100 (see https://github.com/aws-amplify/amplify-js/issues/5050). We also have a tracking ticket for this issue (https://github.com/aws-amplify/amplify-js/issues/6260), and there are a few workarounds that may work depending on your specific use case. If you have further concerns or questions, please include your feedback on #6260. Thanks!!

---------------

---------------

# import Amplify from 'aws-amplify';

---------------

Author: @jjviton
Upvotes: 1
Comments: 1

Hi all
I´m working in a POC using Amplify authentication using the simplest HTML & JS application (without using advanced tools such as React, only plain HTML and simple JS).

All setup process following the documentation (https://docs.amplify.aws/lib/q/platform/js) works properly, but in Js file at importing line I get this error:

> _**import Amplify from 'aws-amplify';
> ^^^^^^
> SyntaxError: Cannot use import statement outside a module**_

Any idea about how to fix it?
If I can not import the libraries, I can not progress.
## Comment

---------------

Author: @mogarick

Yo need to add more context. Are you trying to run the code from node without babel?

---------------

---------------

# Detach services from amplify

---------------

Author: @ricardoribas
Upvotes: 1
Comments: 1

Hey there,

There is any proper way to detach services from amplify (for instance storage, api, etc...)? My idea is to isolate each part of amplify into a more owned app service. 

For instance, if i want to remove API from amplify i would like to keep my database tables and everything related to it. Imagine that i want to create my own API that will communicate with those tables and return data to users. In this moment, if i remove API from amplify everything related to it will be removed. 

There is any proper way to do this, or i need to use an (1) export/import service to export all data from a particular table and import it to a new one and (2) create a lambda trigger that will consume dyanmodb changes from old tables so i can keep all data up-to-date.
## Comment

---------------

Author: @david-mcafee

Hey @ricardoribas, thanks for starting this discussion! All of the AWS services that are spun up with Amplify can be used in isolation as regular AWS services. Does that answer your question?

---------------

---------------

# Error: Amplify has not been configured correctly.

---------------

Author: @simonthesurgery
Upvotes: 1
Comments: 2

I'm in the process of trying to update a project I built in 2020 that no longer works but I keep running into this issue.

I created a new angular project to see if I could pin-point the issue and again this issue has returned. I followed the documentation to set up amplify with the exception that we already have a backend so I ran `amplify pull --appId XXXXXX --envName XXXX` to get the aws-exports.js.

I've done `npm i aws-amplify @aws-amplify/ui-angular`
In the main.ts I've added

`import Amplify, { Auth } from 'aws-amplify';
import awsmobile from './aws-exports';

Amplify.configure(awsmobile);
Auth.configure(awsmobile) // I've tried both with and without this line`

And I've implemented the Authenticator UI Component as per the documentation.

Any information would be greatly appreciated!

**Edit:**
Here is some more information

I'm in the process of trying to update a project I built in 2020 that no longer works but I keep running into this issue.

```
[ERROR] 04:09.562 AuthError - 
            Error: Amplify has not been configured correctly. 
            The configuration object is missing required auth properties.
            This error is typically caused by one of the following scenarios:

            1. Did you run `amplify push` after adding auth via `amplify add auth`?
                See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information

            2. This could also be caused by multiple conflicting versions of amplify packages, see (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js) for help upgrading Amplify packages.
```

I created a new angular (Ionic) project to see if I could pin-point the issue and again this issue has returned. I followed the documentation to set up amplify with the exception that we already have a backend so I ran `amplify pull --appId XXXXXX --envName XXXX` to get the **aws-exports.js**.

1. I've done `npm i aws-amplify @aws-amplify/ui-angular`
2. I've tried deleting **node-modules** and **package-lock.json**, and then running `npm i`
3. I've renamed **aws-exports.js** to **aws-exports.ts** and added it to my **ts-config.app.json**
```
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "./out-tsc/app",
    "types": []
  },
  "files": [
    "src/main.ts",
    "src/polyfills.ts",
	"src/aws-exports.ts"
  ],
  "include": [
    "src/**/*.d.ts"
  ]
}
```
4. In **main.ts** I've added
```
import Amplify, { Auth } from 'aws-amplify';
import awsmobile from './aws-exports';

Amplify.configure(awsmobile);
Auth.configure(awsmobile); // I've tried both with and without this line
```

5. I've implemented the Authenticator UI Component as per the documentation.

Any information would be greatly appreciated! I've read through multiple threads on the issue and none of the advice has worked.

This is the contents of my **aws-exports.ts** (with data redacted!)

```
const awsmobile = {
    "aws_project_region": "eu-west-2",
    "aws_appsync_graphqlEndpoint": "https://XXXXX.appsync-api.eu-west-2.amazonaws.com/graphql",
    "aws_appsync_region": "eu-west-2",
    "aws_appsync_authenticationType": "API_KEY",
    "aws_appsync_apiKey": "XXXXX",
    "aws_cognito_identity_pool_id": "eu-west-2:XXXXX",
    "aws_cognito_region": "eu-west-2",
    "oauth": {},
    "aws_cognito_username_attributes": [],
    "aws_cognito_social_providers": [],
    "aws_cognito_signup_attributes": [],
    "aws_cognito_mfa_types": [],
    "aws_cognito_password_protection_settings": {
        "passwordPolicyCharacters": []
    },
    "aws_cognito_verification_mechanisms": [],
    "aws_mobile_analytics_app_id": "XXXXX",
    "aws_mobile_analytics_app_region": "eu-west-1"
};

export default awsmobile;

```

**Edit:**
I've also tried running `amplify init` and creating a new Amplify project but the issue persists

Here's my package.json:
```
{
  "name": "XXXX",
  "version": "0.0.1",
  "author": "Ionic Framework",
  "homepage": "https://ionicframework.com/",
  "scripts": {
    "ng": "ng",
    "start": "ng serve",
    "build": "ng build",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e"
  },
  "private": true,
  "dependencies": {
    "@angular/common": "~13.0.0",
    "@angular/core": "~13.0.0",
    "@angular/forms": "~13.0.0",
    "@angular/platform-browser": "~13.0.0",
    "@angular/platform-browser-dynamic": "~13.0.0",
    "@angular/router": "~13.0.0",
    "@aws-amplify/ui-angular": "^2.0.11",
    "@capacitor/app": "1.1.0",
    "@capacitor/core": "3.4.0",
    "@capacitor/haptics": "1.1.4",
    "@capacitor/keyboard": "1.2.1",
    "@capacitor/status-bar": "1.0.7",
    "@ionic/angular": "^6.0.0",
    "aws-amplify": "^4.3.13",
    "rxjs": "~6.6.0",
    "tslib": "^2.2.0",
    "zone.js": "~0.11.4"
  },
  "devDependencies": {
    "@angular-devkit/build-angular": "~13.0.1",
    "@angular-eslint/builder": "~13.0.1",
    "@angular-eslint/eslint-plugin": "~13.0.1",
    "@angular-eslint/eslint-plugin-template": "~13.0.1",
    "@angular-eslint/template-parser": "~13.0.1",
    "@angular/cli": "~13.0.1",
    "@angular/compiler": "~13.0.0",
    "@angular/compiler-cli": "~13.0.0",
    "@angular/language-service": "~13.0.0",
    "@capacitor/cli": "3.4.0",
    "@ionic/angular-toolkit": "^5.0.0",
    "@types/jasmine": "~3.6.0",
    "@types/jasminewd2": "~2.0.3",
    "@types/node": "^12.11.1",
    "@typescript-eslint/eslint-plugin": "5.3.0",
    "@typescript-eslint/parser": "5.3.0",
    "eslint": "^7.6.0",
    "eslint-plugin-import": "2.22.1",
    "eslint-plugin-jsdoc": "30.7.6",
    "eslint-plugin-prefer-arrow": "1.2.2",
    "jasmine-core": "~3.8.0",
    "jasmine-spec-reporter": "~5.0.0",
    "karma": "~6.3.2",
    "karma-chrome-launcher": "~3.1.0",
    "karma-coverage": "~2.0.3",
    "karma-coverage-istanbul-reporter": "~3.0.2",
    "karma-jasmine": "~4.0.0",
    "karma-jasmine-html-reporter": "^1.5.0",
    "protractor": "~7.0.0",
    "ts-node": "~8.3.0",
    "typescript": "~4.4.4"
  },
  "description": "An Ionic project"
}
```
**Edit:**
As suggested by someone on StackOverflow, I've tried using 
``` 
"@aws-amplify/auth": "^4.3.14", 
"@aws-amplify/core": "^4.3.14" 
``` 
with
``` 
import { Amplify } from '@aws-amplify/core'; 
import { Auth } from '@aws-amplify/auth'; 
import awsmobile from './aws-exports'; 
Amplify.configure(awsmobile); 
Auth.configure(awsmobile); 
``` 
and I'm still getting the same result. The latest version of @aws-amplify/auth seems to have an internal issue so I matched the latest version of @aws-amplify/core
## Comment

---------------

Author: @david-mcafee

@simonthesurgery thanks for starting this discussion! Can you tell us what Amplify dependencies you are using, and what versions they are? Thank you!
## Comment

---------------

Author: @simonthesurgery

I've discovered the cause of my issue.
This is due to the fact that we had to migrate away from a previous Amplify project due to `UPDATE_ROLLBACK_FAILED` making the whole thing unrecoverable. The new project was not connected to the old Cognitio resources and so running `amplify pull` didn't provide me with the `aws_user_pools_id` and `aws_user_pools_web_client_id` fields in my aws-exports.js. I've had to manually provide that information and it works now.

Thank you for taking the time to look at my issue, but it turns out it was an issue with AWS rather than the amplify libraries.

---------------

---------------

# Is there a way to login with Social account (Google, Facebook, etc) using 'amazon-cognito-identity-js'?

---------------

Author: @vytautas-softeta
Upvotes: 1
Comments: 0

I have setup the sign up and login using 'amazon-cognito-identity-js' library, but there is a lack of information regarding how to use it for social logins. Is that even possible? Any feedback would be greatly appreciated.

---------------

---------------

# Multiple subdomain and single JWT authentication URL

---------------

Author: @
Upvotes: 1
Comments: 0

What I want to implement is to have `acounts.domain.com` as the main subdomain for register, sign in and forget password operations.
And we have also separate web applications on different sub-domains like : 
- subdomain1.domain.com 
- subdomain2.domain.com 

that should use `acounts.domain.com` for credentials. 
All web apps are using the same **AWS Cognito** (user pool and user identity), and we are using **Amplify** now.
So the question is: Is it possible to use **JWT Authentication** method with Amplify? If yes, what is your suggested structure?

---------------

---------------

# amplifyPush in the CI - How to auto commit generated/updated files?

---------------

Author: @giulioambrogi
Upvotes: 1
Comments: 0

Hello,

Today I run `amplify push` from my own laptop, but I would like to move this to the Amplify CI.
I already use the aws Amplify CI with Github webhook (every time I push), but currently doesn't handle the `amplify push` part.

## Question

I read in the docs that [we can use `amplifyPush`](https://docs.aws.amazon.com/amplify/latest/userguide/build-settings.html) for this matter. I noticed thought that sometimes files get updated/edited when running `amplify push` locally, how do I auto-commit tese changes as part of my CI process?

Thanks

```
version: 1
env:
  variables:
    key: value
backend:
  phases:
    build:
      commands:
        - amplifyPush --simple
  ``` 

---------------

---------------

# How to restore an existing amplify app on new machine?

---------------

Author: @codinronan
Upvotes: 2
Comments: 2

So let's say I have gone through and created an app, done `amplify init`, added services and pushed my app and it's published.

I now have a bunch of files inside the `amplify` folder, not checked into Git; and nor is the `aws-exports.js` file.

My colleague pulls the git repository, and he does `amplify init` at which point it creates a new project -- not initializing the existing one nor asking if it wants to initialize an existing one from the console.

How is this supposed to work? Without checking these files into Git, how is more than one developer supposed to be able to manage an amplify app?

I've looked through the issues and discussions in this repository and although this has been asked, an answer has never been given. There was some talk of "multienv" 2 years ago, but those doc pages are completely gone and isn't what I am talking about, anyway.

https://github.com/aws-amplify/amplify-cli/issues/508
https://github.com/aws-amplify/amplify-js/issues/1635
https://github.com/aws-amplify/amplify-cli/issues/37 -- this is the closest I could find, no answer
## Comment

---------------

Author: @codinronan

I think I found the answer, `amplify pull` with the given appId?
## Comment

---------------

Author: @david-mcafee

@codinronan - To generate the `aws-exports.js` file in an existing project (or checkout a backend environment that exists in the console but does not show up locally), follow these steps:

1. Go to the AWS console
2. Choose `AWS Amplify`
3. Find the app
4. Go to `Backend environments`
5. Find the backend environment
6. Click `Edit backend`
7. Run the command that is listed there, something like: 
    - `amplify pull --appId YOUR_APP_ID --envName YOUR_ENV_NAME`

---------------

---------------

# Is it safe to expose aws_exports.js to the public repo, such as Github repo here?

---------------

Author: @fintechee
Upvotes: 1
Comments: 1

Is it safe to expose aws_exports.js to the public repo, such as Github repo here?
Because I saw there is an API key in the information.
Many thanks.
## Comment

---------------

Author: @david-mcafee

@fintechee the `aws-exports.js` file is added to `.gitignore` by default when creating an Amplify project - this file is not meant to be committed. If you are worried about being able to retrieve this file in the future (i.e. a new machine), follow the steps below:

To generate the `aws-exports.js` file in an existing project (or checkout a backend environment that exists in the console but does not show up locally), follow these steps:

1. Go to the AWS console
2. Choose `AWS Amplify`
3. Find the app
4. Go to `Backend environments`
5. Find the backend environment
6. Click `Edit backend`
7. Run the command that is listed there, something like: 
    - `amplify pull --appId YOUR_APP_ID --envName YOUR_ENV_NAME`

---------------

---------------

# Error : undefined is not function when call Auth.sendCustomChallengeAnswer with separate Auth.signIn on server side

---------------

Author: @allandallopez
Upvotes: 2
Comments: 0

Hi guys, need help to find out what is going wrong with the error undefined is not function on Auth.sendCustomChallengeAnswer.

Currently i am trying to do authentication with the aws amplify custom auth which is user can login using phone number and then verify the otp. But all of this, its running on separate side, first Auth.sigin ( when sending phone number ) i call this method on server side ( using node js ) then convert it to REST API then second one is Auth.sendCustomChallengeAnswer i call this method on client side ( using react native ). Actually it is running well when i call Auth.sigin on server side then its return the CognitoUser response. But when im trying to verify otp and calling this method Auth.sendCustomChallengeAnswer, its says undefined is not function. 

### I have question, is it possible to do the sigin and sendCustomChallengeAnswer on separate side ??



I will share my example code, first on server side :

1.  The method when call Auth.signIn :
```
import Amplify from '@aws-amplify/core';
import {Auth} from '@aws-amplify/auth';
import awsConfig from '../../configs/aws.config';

public async signIn(signInRequestDto: SignInRequestDto): Promise<any> {
    try {
      const {phoneNumber, method} = signInRequestDto;
      let methodOTP = method ? EOTPMethod[method.toUpperCase()] : 'sms';
      await this.redis.setSendOTPMethod(phoneNumber, methodOTP);

      const cognitoUser: CognitoUser = await Auth.signIn(phoneNumber);
      return cognitoUser;
    } catch (error) {
      throw error;
    }
  }
  ```
  2.  The configuration code :
  ```
export default {
  region: process.env.REGION,
  userPoolId: process.env.USER_POOL_ID,
  userPoolWebClientId: process.env.USER_POOL_CLIENT_ID,
  Storage: {
    AWSS3: {
      bucket: 'xxxx',
      region: 'xxxx',
    },
  },
  Auth: {
    identityPoolId: process.env.IDENTITY_POOL_ID,
    region: process.env.REGION,
    userPoolId: process.env.USER_POOL_ID,
    userPoolWebClientId: process.env.USER_POOL_CLIENT_ID,
  },
};
  ```
  
 And second, on client side : 
1. This method when i verify otp and Auth.sendCustomChallenge :
```
import {Auth} from '@aws-amplify/auth';
import {CognitoUser} from 'amazon-cognito-identity-js';

export const checkVerificationCode = async (
  cognitoUser: CognitoUser,
  otp: string,
): Promise<boolean> => {
  let currentUser: any = {};
  try {
    currentUser = await Auth.sendCustomChallengeAnswer(cognitoUser, otp);
  } catch (error: any) {
    console.error( error.data || error.response?.data || error.response || error  );

    throw error;
  }

  return true;
};
  ```
2.  The configuration code on client side: 
  ```
export default {
  region: env.REGION,
  userPoolId: env.USER_POOL_ID,
  userPoolWebClientId: env.USER_POOL_CLIENT_ID,
  Storage: {
    AWSS3: {
      bucket: 'xxxx',
      region: 'xxxx',
    },
  },
  Auth: {
    identityPoolId: env.IDENTITY_POOL_ID,
    region: env.REGION,
    userPoolId: env.USER_POOL_ID,
    userPoolWebClientId: env.USER_POOL_CLIENT_ID,
  },
};
  ```
  
  For your information im using the same version both of server and client side, the version :
```
"@aws-amplify/auth": "^4.3.12",
"@aws-amplify/core": "^4.3.4",
```

---------------

---------------

# Amplify Console build issue - please help

---------------

Author: @gambithunt
Upvotes: 2
Comments: 1

Hi all

My vue app is running fine locally and builds fine locally, however, I'm trying to build my app on Amplify using a link to my github repo. The link and the clone work fine but I'm getting an error during the build.

Amplify push also works fine without problems.

I've only ever used NPM for all modules along with the vue-cli and Amplify-cli.

The lambda function that I think it may have a problem with is a layers function, I've used it to include, layers for Axios, Express and Cloudinary all installed with npm.

I have no idea where to start with this.

The main error seems to be : Cannot find module '/codebuild/output/src323788196/src/.yarn/releases/yarn-1.23.0-20210726.1745.cjs'

I've tried 'yarn install' but that does not help. I'm not sure what to do next because I've never used yarn at all in this project.

My build config is standard -

```version: 1
backend:
  phases:
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*```

Here is my error - 

```[WARNING]: ✖ An error occurred when pushing the resources to the cloud
2022-01-04T06:47:49.986Z [WARNING]: ✖ There was an error initializing your environment.
2022-01-04T06:47:49.993Z [INFO]: [0mError: Packaging lambda function failed with the error [0m
[0mCommand failed with exit code 1: yarn --production[0m
[0minternal/modules/cjs/loader.js:818[0m
[0m  throw err;[0m
[0m  ^[0m
[0mError: Cannot find module '/codebuild/output/src323788196/src/.yarn/releases/yarn-1.23.0-20210726.1745.cjs'[0m
[0m    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:815:15)[0m
                                 [0m    at Function.Module._load (internal/modules/cjs/loader.js:667:27)[0m
                                 [0m    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:60:12)[0m
                                 [0m    at internal/main/run_main_module.js:17:47 {[0m
                                 [0m  code: 'MODULE_NOT_FOUND',[0m
                                 [0m  requireStack: [][0m
                                 [0m}[0m
                                 [0m    at runPackageManager (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-nodejs-function-runtime-provider/src/utils/legacyBuild.ts:66:13)[0m
                                 [0m    at installDependencies (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-nodejs-function-runtime-provider/src/utils/legacyBuild.ts:40:3)[0m
                                 [0m    at Object.buildResource [as build] (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-nodejs-function-runtime-provider/src/utils/legacyBuild.ts:13:5)[0m
                                 [0m    at buildFunction (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-category-function/src/provider-utils/awscloudformation/utils/buildFunction.ts:41:36)[0m
                                 [0m    at prepareResource (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-provider-awscloudformation/src/push-resources.ts:605:33)[0m
                                 [0m    at async Promise.all (index 1)[0m
                                 [0m    at prepareBuildableResources (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-provider-awscloudformation/src/push-resources.ts:601:10)[0m
                                 [0m    at Object.run (/root/.nvm/versions/node/v12.21.0/lib/node_modules/@aws-amplify/cli/node_modules/amplify-provider-awscloudformation/src/push-resources.ts:173:5)[0m
2022-01-04T06:47:50.024Z [ERROR]: !!! Build failed
2022-01-04T06:47:50.024Z [ERROR]: !!! Non-Zero Exit Code detected```
## Comment

---------------

Author: @gambithunt

I managed to solve it

---------------

---------------

# Using Cognito in Vue.js without Amplify

---------------

Author: @mrichman
Upvotes: 1
Comments: 1

There used to be a standalone JS implementation which is now buried in Amplify and is now deprecated.

I really don’t want to incur the bloat that comes along with `amplify add auth` as I have no use for most of Amplify and all it’s overhead.

Isn’t there a simple (-ish) way to use Amplify’s auth components without sucking in the whole framework?

I’m fine with Cognito’s hosted UI.

A trivial example is most welcome.
## Comment

---------------

Author: @ashika01

@mrichman `amplify add auth` is going to setup the backend for you. However if you choose not to use the CLI, you can still configure auth using `Auth.configure` options. 
https://docs.amplify.aws/lib/auth/start/q/platform/js#re-use-existing-authentication-resource

you could also do import only auth without the need of bringing in all of amplify by doing something like this,

```
import {Auth} from "@aws-amplify/auth";
....
Auth.configure({
        // REQUIRED only for Federated Authentication - Amazon Cognito Identity Pool ID
        identityPoolId: 'XX-XXXX-X:XXXXXXXX-XXXX-1234-abcd-1234567890ab',

        // REQUIRED - Amazon Cognito Region
        region: 'XX-XXXX-X',

        // OPTIONAL - Amazon Cognito Federated Identity Pool Region 
        // Required only if it's different from Amazon Cognito Region
        identityPoolRegion: 'XX-XXXX-X',

        // OPTIONAL - Amazon Cognito User Pool ID
        userPoolId: 'XX-XXXX-X_abcd1234',

        // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
        userPoolWebClientId: 'a1b2c3d4e5f6g7h8i9j0k1l2m3',

        // OPTIONAL - Enforce user authentication prior to accessing AWS resources or not
        mandatorySignIn: false,

        // OPTIONAL - Configuration for cookie storage
        // Note: if the secure flag is set to true, then the cookie transmission requires a secure protocol
        cookieStorage: {
        // REQUIRED - Cookie domain (only required if cookieStorage is provided)
            domain: '.yourdomain.com',
        // OPTIONAL - Cookie path
            path: '/',
        // OPTIONAL - Cookie expiration in days
            expires: 365,
        // OPTIONAL - Cookie secure flag
        // Either true or false, indicating if the cookie transmission requires a secure protocol (https).
            secure: true
});
```

Looks like the last bit is unclear in docs. I ll open up an issue for that.

---------------

---------------

# Where does amplify cache static pages?

---------------

Author: @matart15
Upvotes: 0
Comments: 1

about next cache I found [this article](https://flaviocopes.com/nextjs-cache-data-globally/). which uses a file for the cache.  [this article](https://blog.dennisokeeffe.com/blog/2021-09-30-introduction-to-caching-with-nextjs#caching-on-the-client-side) uses redis.

just wondering by default where does amplify caches generated static pages.

looked at my profile `Elasticcahe`. but there was nothing.
## Comment

---------------

Author: @matart15

never mind. 
I found static pages in `S3`

---------------

---------------

# Pricing criteria of amplify flutter

---------------

Author: @Hevton
Upvotes: 1
Comments: 0

I am confused about pricing criteria in aws amplify

It is said that the price is set per 1,000 SELECT, POST, GET, and LIST requests.

Let's assume

```
List<Object> obj = Amplify.DataStore.query(Object.classtype, where: Object.ID.eq('123'));
//obj.length is 1000

```
Is this command 1000 requests or 1 request?

---------------

---------------

# S3 KeyTooLongError

---------------

Author: @ritika2291
Upvotes: 5
Comments: 0

The key that is being generated for my files in S3 is around 600 characters too long. The file name and path are both under 15 characters. When I try to access the object via a presigned url, generated via Storage.get, I get the error that KeyTooLongError. Any ideas on what to do?

---------------

---------------

# How to use docker compose in Amplify pipeline?

---------------

Author: @anastasiyamazheika
Upvotes: 1
Comments: 1

Hello! 
I want to launch my tests in docker in Amplify pipeline. 

Dockerfile:
```
FROM mcr.microsoft.com/playwright:v1.16.3-focal

RUN npx playwright install chrome
ENTRYPOINT [ "npx", "playwright", "test", "--config=tests/playwright.config.ts" ] 
```

docker-compose.yml

```
version: "3.4"
services:
  tests:
    volumes:
      - .:/code
    build: 
      context: .
      dockerfile: Dockerfile
    working_dir: /code
    ipc: host
```

amplify.yml
```
test:
      commands:
        - docker compose up
```

Amplify console

```
# Starting phase: test
[INFO]: # Executing command: docker compose up
[WARNING]: /codebuild/output/src983611118/src/{project_name}/tests.sh: line 29: docker: command not found
[INFO]: # Completed phase: test
[INFO]: ## Tests completed successfully
```

Did I forget something that docker isn't recognized?
Why error _docker: command not found_ is recognized only as **WARNING** instead of **ERROR**?
## Comment

---------------

Author: @anastasiyamazheika

Moved question to https://github.com/aws-amplify/amplify-console/issues/2550

---------------

---------------

# Is it possible to authenticate a user from SSR routes in next.js?

---------------

Author: @benjamindoe
Upvotes: 2
Comments: 1

I am trying to authenticate users via a custom cognito challenge. Due to some constraints we have to do this from a `/api` route, which causes the code to run server-side. I am using something similar to below:

```javascript
const { Auth }  = withSSRContext({ req });

let user = await Auth.signin(username);
user = Auth.sendCustomChallengeAnswer(user, challengeAnswer);

// User is successfully authenticated
console.log(user);

// Any other logic in SSR works
```

Any other logic works within the SSR route. As soon as you try anything from another endpoint, SSR or client-side, there is no user in the session. I assume this is because the cognito cookie isn't being altered? 
## Comment

---------------

Author: @davemooreuws

Hi @benjamindoe ,

We have built an amplify library for ssr. We are currently using it in a NextJS app for protecting routes and persisting the user.

Feel free to check it out: https://github.com/nitrictech/amplify-secure-js

---------------

---------------

# GraphQL & Cognito - manyToMany on the groupsField

---------------

Author: @poyashad
Upvotes: 2
Comments: 1

Hi guys!

I am working on a multitenant application. And i am using two resources for this. 
Cognito for user authentication and Groups.
GraphQL(DynamoDB) for storing data about Workspaces(Groups) and Users

Cognito Group = Tenant/Workspace.
The tenant = Workspace(In GraphQL). 

So when a user signs up and confirms the account.  The post-confirmation lambda gets triggered.
The plan is to have the Lambda function do these things.
1. Create a Cognito Group ✅
2. Add the user to the Cognito Group. ✅
3. Create the workspace with GraphQL(dynamodb) ❌ (Need to create the schema before doing mutations from the lambda)
4. Create the user in with GraphQL ❌ (Need to create the schema before doing mutations from the lambda)

So I am working on the schema. But can't manage to get it right. Based on the documentation I should create something like this.
```
type Workspace @model
  @auth(rules: [
    {allow: groups, groupsField: "id"}
    {allow: private, provider: iam}
    ]) {
    id: ID! @primaryKey
    workspace_name: String!
}

type User @model
  @auth(rules: [
    {allow: groups, groupsField: "workspaces"}
    {allow: private, provider: iam}
    ]) {
    id: ID! @primaryKey
    workspaces: [String]
    email: String!
    firstName: String
    lastName: String
}
 ```
But i want relationships between the workspace and the users. 

For example: a workspace could have many users. or users could access many workspaces. 
```
type Workspace @model
  @auth(rules: [
    {allow: groups, groupsField: "id"}
    {allow: private provider: iam}
    ]) {
    id: ID! @primaryKey
    workspace_name: String!
    users: [User] @manyToMany(relationName: "WorkspaceUsers")
}

type User @model
  @auth(rules: [
    {allow: groups, groupsField: "workspaces"}
    {allow: private, provider: iam}
    ]) {
    id: ID! @primaryKey
    workspaces: [Workspace!] @manyToMany(relationName: "WorkspaceUsers")
    username: String!
    email: String!
    firstName: String
    lastName: String
} 
```
Documentation says this:
```
Under the hood, the @manyToMany directive will create a "join table" named after the relationName to facilitate the many-to-many relationship. This generates queries and mutations that allow you to retrieve the related Comment records from the source Post record and vice versa:
```
Just by testing queries in App Sync GUI and using the newly created Cognito User, it throws not authorized. 
The Cognito user is able to create a workspace. 
But the Cognito user is not able to create a user or the relationship WorkspaceUsers. 
Does anyone know how to tackle this?
## Comment

---------------

Author: @poyashad

Update: 
In AppSync when looking at createUser mutation there is no workspaces field. And that is probably why i am getting not authorized because theres no input for the workspaces field... I am trying to create a user without inputing the workspaces field... hmmm how can i access the field. Does anyone know? Thanks
![Skärmavbild 2022-01-26 kl  14 15 25](https://user-images.githubusercontent.com/20397026/151172313-07c4603c-9c1c-43d2-8008-bf37074c594e.png)

---------------

---------------

# React components: How to create a custom ConfirmSignUp?

---------------

Author: @thevangelist
Upvotes: 1
Comments: 0

How can I customize other content in ConfirmSignUp than Header and Footer?

---------------

---------------

# Graphql Custom-Auth Auth Header Type

---------------

Author: @thegoliathgeek
Upvotes: 1
Comments: 0

Hey! 
i have setup the custom authentication with amplify on a model
```graphql
type Module
  @model
  @auth(
    rules: [{ allow: custom }]
  ) {
  id: ID!
  name: String
}
```

I have also setup a lambda for this ,for verification of the token.

Am getting my jwt from cognito.
It seems lambda (custom auth) is not trigged.
When the header is (this is the default auth header from amplify)

`Authorization: {jwt}`

But when i change header

`Authorization: Bearer {jwt}`


Lambda is triggered when auth header used as above with Bearer.

Why is not getting trigged in the first pattern?
Amplify lib is using this `Authorization: {jwt}` by default for network calls.

So whats wrong here ?

---------------

---------------

# How to sort many to many connections

---------------

Author: @Abuitime
Upvotes: 1
Comments: 2

I am currently building a react application with Amplify. I am building out the schema but having trouble adding sorting.

**How can I set up my schema to return all the products for a collection sorted by product name?**

A collection can have many products. A product can be in many collections.

```
type Collection @model {
    id: ID!
    name: String!
    products: [CollectionProduct] @connection(name: "Product")
}

type CollectionProduct @model {
    id: ID!
    collection: Collection! @connection(name: "Product")
    product: Product! @connection (name: "Collection")
}

type Product @model {
    id: ID!
    name: String!
    collections: [CollectionProduct] @connection(name: "Collection")
}

query GetCollection {
  getCollection() {
    id
    name
    products {
      items { #sort by product name
        id
        product {
          name
        }
      }
    }
  }
}
```
## Comment

---------------

Author: @dabit3

Hey @Abuitime, I think you'll have to add the additional field to the connection.

The other main thing here is that you need some arbitrary field that is consistent across all three types (for the type field), this way you have a consistent field across all three tables that can be queried.

I think something like this would work:

```graphql
type Collection @model {
    id: ID!
    name: String!
    type: String!
    products: [CollectionProduct] @connection(keyName: "byProductType", fields: ["type"])
}
 
type CollectionProduct @model 
  @key(name: "byProductType", fields: ["type", "productName"])
  @key(name: "byCollectionType", fields: ["type", "collectionName"])
  {
    id: ID!
    type: String
    productName: String
    collectionName: String
    collection: Collection @connection
    product: Product @connection
}

type Product @model {
    id: ID!
    name: String!
    type: String!
    collections: [CollectionProduct] @connection(keyName: "byCollectionType", fields: ["type"])
}
```

```graphql
# create collection
mutation createCollection {
  createCollection(input:{
    name: "Collection1"
    type: "CollectionIdentifier"
  }) {
    id
    name
  }
}

# create product
mutation createProduct {
  createProduct(input:{
    name: "Product 1"
    type: "CollectionIdentifier"
  }) {
    id
    name
  }
}

# create the link between a product and a collection
mutation createCollectionProduct {
  createCollectionProduct(input: {
    productName: "Product 1"
    type: "CollectionIdentifier"
    collectionName: "Collection 2"
    collectionProductProductId: "<productid>"
    collectionProductCollectionId: "<collectionid>"
  }) {
    id
    product {
      id
      name
    }
  }
}

# query
query listCollections {
  listCollections {
    items {
      id
      name
      products(sortDirection: ASC) {
        items {
          id
          productName
        }
      }
    }
  }
}

```
## Comment

---------------

Author: @Abuitime

I got it working with the following

```
type Collection @model {
    id: ID!
    name: String!
    products: [CollectionProduct] @connection(keyName: "byCollection", fields: ["name"])
}

type CollectionProduct
  @model(queries: null)
  @key(name: "byProduct", fields: ["productName", "collectionName"])
  @key(name: "byCollection", fields: ["collectionName", "productName"])
  {
    id: ID!
    productName: String
    collectionName: String
    collection: Collection! @connection
    product: Product!  @connection
}

type Product @model {
    id: ID!
    name: String!
    collections: [CollectionProduct] @connection(keyName: "byProduct", fields: ["name"])
}
```

---------------

---------------

# How to type cdk override with typescript

---------------

Author: @matart15
Upvotes: 1
Comments: 0

trying to do [this](https://docs.amplify.aws/cli/project/override/) with amplify 

but my tslint complains 

```
TypeScript error in amplify/#current-cloud-backend/auth/salescircle/override.ts(12,3):
Object is possibly 'undefined'.  TS2532

    10 |   };
    11 |   // eslint-disable-next-line no-param-reassign
  > 12 |   resources.userPool.schema = [
       |   ^
    13 |     ...(resources.userPool.schema as any),
    14 |     customAttribute,
    15 |   ];
```


also, minor issue with esint rule `no-param-reassign`. which is a bad practice I assume.

So, how to type `TS2532` error.

---------------

---------------

# Unable to delete app env using cli or from aws console

---------------

Author: @gmineropfdrive
Upvotes: 1
Comments: 0

appId: d37ekhbhp9fm2w
region: us-east2
env name: devsync
tried deleting using the console or cli.

Same for an app, which seems to be stuck in limbo:

console displays, `Deletion completed 12/9/2021, 10:25:29 AM`, but the app is stuck in the Amplify apps UI
appId: dh6mdw6ntdxjd
region: us-east2

---------------

---------------

# Lambda functions environment variable disappear when Amplify deploys

---------------

Author: @ashWhiteHat
Upvotes: 1
Comments: 1

Every time I deploy new version Lambda application, all the environment variables disappear as following.
![env](https://user-images.githubusercontent.com/39494661/149099092-1142e98e-20fc-4d70-9746-ba1389bbfa6b.png)
How can I set permanent environment variable?
## Comment

---------------

Author: @ashWhiteHat

Sorry this is mistake.
My amplify setting has problem so it's another problem.

---------------

---------------

# Mutation inside a NodeJS lambda

---------------

Author: @giovannigiordano
Upvotes: 2
Comments: 0

Hello everyone!
I am trying to make a query on AppSync through a NodeJS lambda and I've followed [this guide](https://docs.amplify.aws/lib/graphqlapi/graphql-from-nodejs/q/platform/js/) from the official documentation.

```
import https from "https";
import { init, getLambda } from "@macai-tech/framework-node";
import AWSAppSyncClient from "aws-appsync";
import * as AWS from "aws-sdk";
import SignerV4 from "aws-sdk/lib/signers/v4";
import * as M from "./models";
import url from "url";
import { CustomerInfrastructure } from "./infrastructure/Customer";

const endpoint = new url.URL(
  process.env.AWS_APPSYNC_URL as string
).hostname.toString();

const lambda = getLambda({ eventDetailSchema: M.EventDetail });

export const handler = async () => {
  const req = new AWS.HttpRequest(
    new AWS.Endpoint(process.env.AWS_APPSYNC_URL as string),
    process.env.AWS_APPSYNC_REGION as string
  );

  req.method = "POST";
  req.path = "/graphql";
  req.headers.host = endpoint;
  req.headers["Content-Type"] = "application/json";
  req.body = JSON.stringify({
    query: `
            mutation CreateCustomer($customer: CustomerInput!) {
              createCustomer(customer: $customer) {
                customer_id
                phone_number {
                  value
                  prefix
                }
              }
            }

    `,
    variables: {
      customer: {
        customer_id: "asdasdad",
        phone_number: {
          prefix: "+39",
          value: "3333333333",
        },
      },
    },
  });

  const signer = new SignerV4(req, "appsync", true);
  signer.addAuthorization(AWS.config.credentials, new Date());

  const data = await new Promise((resolve, reject) => {
    const httpRequest = https.request({ ...req, host: endpoint }, (result) => {
      let data = "";

      result.on("data", (chunk) => {
        data += chunk;
      });

      result.on("end", () => {
        resolve(JSON.parse(data.toString()));
      });
    });
    httpRequest.on("error", reject);

    httpRequest.write(req.body);
    httpRequest.end();
  });

  return {
    statusCode: 200,
    body: data,
  };
};

```
First of all, I had to change the import of Signer V4, on the documentation there is no reference to the import, and there is no `Signers` under `AWS`.

The code works if the deployed, but if I try to run it on my local machine it doesn't work.

The steps I followed are:

-  Login with the `aws-cli`
- Export the env variables: `AWS_PROFILE`, `AWS_SDK_LOAD_CONFIG`
- Run the script

The problem is that `AWS.config.credentials` is `null`, so the signer can't sign the request and I cannot test it locally.

How can i resolve this problem?

---------------

---------------

# Token refresher failing with 'code' responseType but works with 'token'

---------------

Author: @Ngandu
Upvotes: 1
Comments: 2

Need assistance with refreshing jwt token from cognito.

When using the 'code' responseType the token is failing to refresh, but when using 'token' the token is refreshing correctly. Refresher is doing so automatically after 1-hour.

We are using Amplify to manage authentication on the App with react-native and expo.

We are using a Federation - OpenID connects to sign-in users.

Cognito Allowed OAuth Flows are set with:
* Authorization code grant
* Implicit grant

When responseType:'token' - the token is refreshing correctly.
<img width="509" alt="token_refresh" src="https://user-images.githubusercontent.com/5862278/148730737-7a31fc58-20f3-4dfe-8521-ed195562838a.png">

When responseType:'code' - the refresher is failing.
<img width="461" alt="code_refrsh_failure" src="https://user-images.githubusercontent.com/5862278/148730858-8a1b9668-dd26-487d-b4fe-a489d7103021.png">


From Amplify documentation it's supposed to work the other way around.
## Comment

---------------

Author: @hkjpotato

Thank you for submitting this discussion. Based on the [Cognito doc](https://docs.aws.amazon.com/cognito/latest/developerguide/token-endpoint.html#:~:text=Note-,The%20token%20endpoint%20returns%20refresh_token%20only%20when%20the%20grant_type%20is%20authorization_code.,-code) and my local testing, refreshToken won't be available in the implicit grant type. It is only returned in the `code` grant. I need to do more testing to reproduce it. Can you provide me your `aws-export` config?
## Comment

---------------

Author: @Ngandu

Hi @hkjpotato, thank you for your reply.

It started working correctly after one of my team members did an update on the App Client settings, we don't know why cause his update had nothing to do with the issue above.

My current guess, it needed a refresh or reset.

---------------

---------------

# aws-amplify interactions(lex) way to start a conversation without user input.

---------------

Author: @charithreddyv
Upvotes: 1
Comments: 0

Hai There, 
I am new to aws-amplify, lex and react-native.

Trying to work on way to create/fire and interaction with some intent without user interaction. basically the approach i am working on is when user clicks on a push notification it should automatically trigger intent  (which i am assuming as bot first conversation where bot first initiates a conversation ) i asked this same kinda question over aws re:post https://repost.aws/questions/QUONBDhLUBTViTCP-rsIvXPA/scheduling-a-aws-lex-intent-as-push-notification and got to know that there is this putSession API which can be used to create a conversation, but i have no idea on how to fit it with amplify.

And another thing i am curious about is i see `PutSessionCommand` from `@aws-sdk/client-lex-runtime-service` and i see a class  `AVOSLexProvider` where `sendMessage` is configured to use `PostTextCommand` and there is this configuration in `App.tsx` `Interactions.addPluggable(new AVOSLexProvider());` so is there a way i can do PutSession using aws-amplify if not is there any other way to achieve what i am expecting ?

Thanks in advance.

---------------

---------------

# Overriding Access-Control-Allow-Headers

---------------

Author: @krikork
Upvotes: 1
Comments: 1

In older versions of the cli, I was able to edit the cloud formation template for an API resource. Now that's no longer possible as the cli generates those files on `push`. 

One thing that I used to do is add custom headers to the following key: "method.response.header.Access-Control-Allow-Headers":

The following is what gets created by default.

"method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'"

How can I override these headers in the `override.ts` so that I end up with customer `Access-Control-Allow-Headers` once the cloud formation template is generated?
## Comment

---------------

Author: @krikork

Looks like I found what I was looking for. Something like this should do the trick

```
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.override = void 0;
function override(resources) {
    resources.restApi.body.paths["/invitation"].options["x-amazon-apigateway-integration"].responses.default.responseParameters["method.response.header.Access-Control-Allow-Headers"] =
        "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent,authorizationtoken'";
}
exports.override = override;

```

---------------

---------------

# @aws-amplify/ui-react How To Customize SignIn/SignUp

---------------

Author: @billycolley
Upvotes: 1
Comments: 1

Hello,

I am using @aws-amplify/ui-react and I would like to use a custom component for the SignIn/SignUp pages. Ideally I'd like to extend AmplifySignIn class, change the rendering to be what I want it to be, and call super to handle the majority of the logic. You used to be able to do this with the old aws-amplify-react package following something like [this](https://blog.kylegalbraith.com/2018/11/29/how-to-easily-customize-the-aws-amplify-authentication-ui/).

I understand that with the new system you can do some basic field selection and css customization, but I want to supply an entirely different UI for the SignIn component and pass that to Authenticator, and as long as it adheres to the correct API it should be supported, but I can't get it to show up at all. Is this still possible with the new package? Is there any documentation that explains how you would go about this? Is it something super simple that I'm just not noticing?

Thanks in advance,
Billy
## Comment

---------------

Author: @blazinaj

Having the same issue https://github.com/aws-amplify/amplify-js/issues/8491

---------------

---------------

# Any Amplify method for S3's GetObjectTagging?

---------------

Author: @rswerve
Upvotes: 1
Comments: 1

In S3, there's a [GetObjectTagging](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/clients/client-s3/classes/getobjecttaggingcommand.html) method that allows us to get all the tags associated with an object in an S3 bucket.  What's the best way to get object tags via Amplify?  Much searching hasn't turned up anything.

To describe the use case: upload a file, do a virus scan, tag infected files so that the front-end can use that information.
## Comment

---------------

Author: @zachjonesnoel

Hi @rswerve,

I'm not sure if you want the Object tags accessible on the front-end or backend. As per my knowledge, there is not equivalent method for getting object tags on Amplify instead you can use Lambda triggers to trigger a Lambda whenever a file is put and extract the object tags if that servers your purpose.

---------------

---------------

# How to manage cascade deletes of hasOne relations?

---------------

Author: @PeteDuncanson
Upvotes: 4
Comments: 1

I've got a a type called Round which can have a technician assigned, technicians are of type StaffMember. I do this with a technicianID and technician ``@connection``. 

Staff can be assigned to multiple Jobs.

```
# Taken from my schema
type Round
  @model {
  id: ID!
  date: AWSDateTime
  technicianID: ID
  technician: StaffMember @connection(fields: ["technicianID"])
  status: String #RoundStatus
}
```

When I delete a Job DataStore seems to be doing a cascade delete on the StaffMember and I don't want it too. This seems kind of dangerous. Following the docs I wouldn't have expected that to happen as its not a 1:M, it doesn't show you how to safely delete the Round but still leave the StaffMember undeleted in the database? 

As a work around I've just found that you can seemingly get it to work if you first set the id of the technician on the Round to something else (I used an empty string) and then delete it that seems to work as I want it to.

```
// Fetch our existing round
DataStore.query(Round, roundId).then((currentRound) => {
      if (currentRound) {
        // Save it to remove the technician
        DataStore.save(
          Round.copyOf(currentRound, (updated) => {
            updated.technicianID = "";
          })
        ).then((toDelete) => {
          // Now we can safely delete this Round but leave the StaffMember intact
          DataStore.delete(toDelete);
        });
      }
    });
```

Trouble is I can really see that biting someone if not careful. At a minimum it would be great to have this set up added to the docs here https://docs.amplify.aws/lib/datastore/relational/q/platform/js#deleting-relations




## Comment

---------------

Author: @yucomds

Hi @PeteDuncanson, have you find another solution for this? Do you think we should open a gh issue for officially describe this feature request?

---------------

---------------

# Automatically skip verifyContact

---------------

Author: @LeJ84
Upvotes: 1
Comments: 0

Hi !

Is there a way to automatically skip this step of the flow and how ?

Thx

---------------

---------------

# Save the redirect query param after login with google

---------------

Author: @mossa-Sammer
Upvotes: 2
Comments: 0

when i give a user an invite link route to a resource in my website like ```/dashboard/join/1```, the user is not logged in so i redirect him to the route ```/login?redirect=/dashboard/join/1```, but after the user uses login with google, he get's redirect to login with google and after he finish back to the website but without the query param ```?redirect=/dashboard/join/1```, 
i searched the docs but didn't find something helpfull, the problem is  i need my query paramter to be saved when i redirected back to my website, help please  

---------------

---------------

# How to dynamically allow either phone or e-mail verification option to be send to user at signUp, based on user preferences?

---------------

Author: @peter-greekbase
Upvotes: 1
Comments: 0

Hello!

I would like to leverage amplify Auth, and I was wondering where I should look to implement the custom logic for the scenario that is described in the title: "How to dynamically allow either phone or e-mail verification option to be send to user at signUp, based on user preferences?"

If a user checks a box stating they prefer to receive an SMS to verify their sign in, I'd like to provide that, or if it's via e-mail, I'd like to provide that too. Is there a certain trigger I should customize based on some clientMetadata, or is this a matter of supplying a proper attribute to an existing method?

Thanks in advance ;)

---------------

---------------

# How do I return object tags with Storage.list or Storage.get method?

---------------

Author: @futurebenmorris
Upvotes: 1
Comments: 1

Hi there, I'm using the Amplify javascript package in a project and I have a need to return object tags along with the object itself. However, I can't see the option in the Storage.list or Storage.get config object to do this.

I can download the object and parse it's contents fine, but I really need to grab the tags as well so I can use their values in my UI...

Current code which works for getting an object is as follows:

```javascript
async function getObject(filename) {
  try {
    const file = await Storage.get(filename, {
      download: true,
      cacheControl: 'no-cache',
      contentType: 'application/json'
    })
    const text = await file.Body.text()
    const parsedText = JSON.parse(text)
    // Do things with parsed text here...
  } catch (error) {
    logger(error)
  }
}
```

I've been through the documentation and also through the issues and found #3547 which seems to suggest that tagging support is only available on the Storage.put method. This seems to be a severe limitation of using the Amplify library with S3. Is it even possible?

I would rather avoid having to reach down for the AWS SDK as I like the abstraction that Amplify offers. Hope someone out there can help!
## Comment

---------------

Author: @ashika01

hi @futurebenmorris , looks like we send the response from S3 back as is. Reference to our code - https://github.com/aws-amplify/amplify-js/blob/main/packages/storage/src/providers/AWSS3Provider.ts#L431

This is the s3 doc on what they send as response -  https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html#API_GetObject_ResponseSyntax

what do u see as output? 

---------------

---------------

# How to set owner field in case of group auth

---------------

Author: @funes79
Upvotes: 1
Comments: 0

I have created a schema with the following auth rules:
```
type Todo
  @model
  @auth(
    rules: [
      {
        allow: groups
        groups: ["admins"]
        operations: [create, update, read, delete]
      }
      { allow: groups, groups: ["users"], operations: [read] }
    ]
  ) {
  name: String! @primaryKey
  author: String
}
```
I tried to set the `ownerField` in auth to `author` but it does not fill the logged user name during the creation. Is it possible to store the creation/update user automatically or do I have to implement it in client side? 
And because of this when I got a subscription I do not know what user created the Todo item.


### Update: 
when I use a simple owner authorization rule like this, then the `owner` field is created.

```
  @auth(
    rules: [
      { allow: owner }
      { allow: groups, groups: ["users"], operations: [read] }
    ]
  ) 
```

According to the legacy documentation I can combine owner and group auth

> To enable advanced authorization use cases, you can layer auth rules to provide specialized functionality
https://docs.amplify.aws/cli-legacy/graphql-transformer/auth/#ownership-with-create-mutations

But when I use a mix of owner and group authentication:

```
  @auth(
    rules: [
      { allow: owner }
      {
        allow: groups
        groups: ["admins"]
        operations: [create, update, read, delete]
      }
      { allow: groups, groups: ["users"], operations: [read] }
    ]
  ) 
```

the **owner field is not created any more**

---------------

---------------

# Change reset password code expiration time from 1 hour to 24 hours

---------------

Author: @kathara-jane
Upvotes: 1
Comments: 0

I'm not finding any answers anywhere in the docs and I'm wondering if its functionality we can implement. 

---------------

---------------

# Find items descending with multiple index keys

---------------

Author: @ayhoung
Upvotes: 1
Comments: 0

Hi there,

I'd like to sort by createdAt descending for the following schema definition:

```
type Place @model 
{
  id: ID!
  city: String
  approved: String
  createdAt: String!
}
```

For instance I'd like to find all places that
city: 'Paris'
approved: 'true'

while sorting by createdAt descending.

Is there any way to achieve this in the schema? It seems if I define a multiple key index 
`(i.e. @key(name: "byApprovedCity", fields: ["active", "city", "createdAt"])` 
it will force me to create a composite sort key, which is what I don't want, because I won't be able to sort on just the createdAt field.

---------------

---------------

# Get AWS credentials from Cognito Identity Pool?

---------------

Author: @jashsayani
Upvotes: 1
Comments: 0

I have login implemented which uses Cognito User Pool. However, I need to use the JWT to get AWS credentials from Identity Pool next, in order to make calls to services like DynamoDB. I don't see Cognito APIs documented for this. Is this supported by the JS SDK? or do I need to proxy this through API Gateway?

---------------

---------------

# Grant lambda access to AppSync GraphQL endpoints using IAM auth

---------------

Author: @jleskovar-tyro
Upvotes: 1
Comments: 1

Hi there,

I'm trying to setup IAM authentication with my AppSync API defined using Amplify, with the aim of being able to send requests to the GraphQL endpoint from my lambda. I've checked all of the usual things - i.e. enabled IAM as an "other" authentication method (default is Cognito for access from front-end), and my models are correctly annotated I'm pretty sure, for e.g.:
```
type Script @model @auth(rules: [
  { allow: owner },
  { allow: private, provider: iam }, 
]) {
  id: ID!
...
}
```

When I attempt to call the AppSync API from my node lambda, I keep getting the following error returned in the GraphQL response body: `Not Authorized to access listScripts on type ModelScriptConnection`

I've made sure my lambda execution role has correct permissions - in a desperate attempt I've granted appsync:* on * resources to rule out IAM policy related issues.

I _think_ what I'm meant to do is modify the generated "Auth" function resolvers to accept my lambda's role, as I can see in the VTL there are various checks around groups and admin for IAM authentication. However, I'm not sure where to begin as to the "correct" way to do this.

Any pointers would be greatly appreciated!


## Comment

---------------

Author: @jleskovar-tyro

FIgured it out - for future travellers, you need to add your external lambda role name to custom-roles.json, as per https://docs.amplify.aws/cli/graphql/authorization-rules/

---------------

---------------

# Setting up a Google OAuth Production Client?

---------------

Author: @fireflysemantics
Upvotes: 1
Comments: 0

Hello,

I'm trying to setup a Google OAuth Web Client.  I've followed the instructions provided by AWS and Google and gone through the process multiple times, however the Google Trust and Safety Team keeps requesting that I remove the client and once I remove it they request that I add it back.

I've documented this here:

https://stackoverflow.com/questions/70385799/setting-up-a-google-oauth-production-client

Does anyone know how to make it through this step?  

---------------

---------------

# Mocking Admin Queries API Failing

---------------

Author: @franklin113
Upvotes: 1
Comments: 0

Hi, I'm trying to locally mock my admin queries api but am getting an error.  I copied the event from an actual lambda invocation which works in the lambda console, but I'm not sure how to configure the context that is passed in.
```
/root/projects/aspera-file-transfer/amplify/backend/function/AdminQueries142823f9/src/node_modules/@vendia/serverless-express/src/index.js:229

if (params.resolutionMode === 'CONTEXT_SUCCEED') return params.context.succeed(params2.response)
                                                                             ^
TypeError: params.context.succeed is not a function
```

Has anyone seen this?

---------------

---------------

# Cognito - switch application without new authorization

---------------

Author: @xrn
Upvotes: 1
Comments: 0

Hi, 

I created my entire product based on multitenancy which is based on different Cognito apps. Organization 1 is creating Org1 which is creating new Cognito app org1.mydomain.com

I would like to allow my users to switch between organizations without the requirement of providing a username/password again. Following Oauth2 flow and Cognito Hosted UI as well as `XSRF-TOKEN` and `cognito` cookies I am able to call `/oauth2/token` multiple times with different client_id and I will receive different authorization tokens. 

My questions:
1. Am I able to switch between client_id without providing each time password in Amplify-js?
2. If not - Am I able to build my own UI using Cognito based endpoints like https://docs.aws.amazon.com/cognito/latest/developerguide/token-endpoint.html - from what I see I can not call as of now that endpoints because I have CORS / Set-Cookies security blockers

I think this is also related to this discussion - https://github.com/aws-amplify/amplify-js/issues/1585

---------------

---------------

# react native biometric login

---------------

Author: @nadavdo
Upvotes: 1
Comments: 0

Hi , is there any way to use the aws amplify and integrated it with device fingerprinr or face recognition .
Regards Nadav

---------------

---------------

# Check if a username exists in Cognito User pool

---------------

Author: @AchrafBn
Upvotes: 1
Comments: 0

i want to my flow authentication meet these scenarios :  check username exist if exist then navigate  to screen signIn otherwise  signUp.
I cannot find documentation on how to check a username using AWS Cognito. I should be able to pass username/passcode in a call and get a response back that says User Exists/User does not exist ?

---------------

---------------

# "Subscription timeout {\"query\":\"subscription OnOrderUpdated($Id: ID!)

---------------

Author: @neerajap-01
Upvotes: 1
Comments: 0

I was trying to use subscription in graphql below is the code ,

```
import { onOrderUpdated } from "./subscriptions";

// subscribe to order updates
  useEffect(() => {
    const subscription = API.graphql(
      graphqlOperation(onOrderUpdated, { id: route.params.id })
    ).subscribe({
      next: ({ provider, value }) => console.log({ provider, value }),
      error: ({ error }) => console.warn(error)
    })

    return () => subscription.unsubscribe();
  }, [])
```

**onOrderUpdated.js**
```
export const onOrderUpdated = /* GraphQL */ `
    subscription OnOrderUpdated($Id: ID!) {
        onOrderUpdated(Id: $Id) {
            id
            createdAt
            type
            status
            originLatitude
            originLongitude
            destLatitude
            destLongitude
            userId
            carId
            updatedAt
        }
    }
`;
```

**Aws-exports,js**
```
/* eslint-disable */
// WARNING: DO NOT EDIT. This file is automatically generated by AWS Amplify. It will be overwritten.

const awsmobile = {
    "aws_project_region": "xxxxx",
    "aws_cognito_identity_pool_id": "xxxxx-xxxxx-xxxxx-xxxx-xxx",
    "aws_cognito_region": "xxxxx",
    "aws_user_pools_id": "xxxxx-xxxxx-xxxxx-xxxx-xxx",
    "aws_user_pools_web_client_id": "xxxxx",
    "oauth": {},
    "aws_cognito_username_attributes": [],
    "aws_cognito_social_providers": [],
    "aws_cognito_signup_attributes": [
        "EMAIL"
    ],
    "aws_cognito_mfa_configuration": "OFF",
    "aws_cognito_mfa_types": [
        "SMS"
    ],
    "aws_cognito_password_protection_settings": {
        "passwordPolicyMinLength": 8,
        "passwordPolicyCharacters": []
    },
    "aws_cognito_verification_mechanisms": [
        "EMAIL"
    ],
    "aws_appsync_graphqlEndpoint": "https://uhjxgztxgjejxic2mgc7hyjmza.appsync-api.ap-south-1.amazonaws.com/graphql",
    "aws_appsync_region": "ap-south-1",
    "aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS"
};


export default awsmobile;

```
 It gives me this error,
@amhinson i saw your answer on another same kind of issue but didn't understand much.
![WhatsApp Image 2021-12-10 at 2 38 42 PM](https://user-images.githubusercontent.com/88912160/145547934-1c294021-d4d9-4688-acd9-3ef2e71806b2.jpeg)

![Screenshot_2021-12-10-14-49-41-89_d0f5c12174170e37eb4af5e473653c8b](https://user-images.githubusercontent.com/88912160/145549649-681b1bdd-3177-421d-ac0e-fa3bb399b805.jpg)

![Screenshot_2021-12-10-14-49-36-05_d0f5c12174170e37eb4af5e473653c8b](https://user-images.githubusercontent.com/88912160/145549656-1dc33179-b9b1-4390-9703-b5ea331d48b1.jpg)

![Screenshot_2021-12-10-14-49-48-57_d0f5c12174170e37eb4af5e473653c8b](https://user-images.githubusercontent.com/88912160/145549666-430284c4-ef20-4b75-9081-1e3a1477e137.jpg)
 


---------------

---------------

# Invalid access_token obtained via Cognito pool authorizer configured in Amplify Auth

---------------

Author: @estebane-frb
Upvotes: 1
Comments: 0

Hello, I am using API Gateway with a Cognito User Pool Authorizer in the back end, and I am trying to use an Access Token provided by the pool, so that I can validate Cognito group and scope access. However, when using the Amplify framework, the Access token being retrieved is not valid. Here is my code below.

It is worth noting that when I manually retrieve an access token (Using method in this link https://aws.amazon.com/premiumsupport/knowledge-center/cognito-custom-scopes-api-gateway/ ), my authentication works fine. This issue is only happening when I'm using Amplify. My process.env.REACT_APP_API_ENDPOINTS_ENDPOINT is my API Gateway endpoint. Am I supposed to use a second endpoint to retrieve the access token?



```
Amplify.configure({
  Auth: {
    // REQUIRED - Amazon Cognito Region
    region: process.env.REACT_APP_REGION,

    // OPTIONAL - Amazon Cognito User Pool ID
    userPoolId: process.env.REACT_APP_AUTH_USER_POOL_ID,

    // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
    userPoolWebClientId: process.env.REACT_APP_AUTH_USER_POOL_WEB_CLIENT_ID,
  },
  API: {
    endpoints: [
      {
        name: process.env.REACT_APP_API_ENDPOINTS_NAME,
        region: process.env.REACT_APP_REGION,
        endpoint: process.env.REACT_APP_API_ENDPOINTS_ENDPOINT,
        custom_header: async () => {
          return {
            Authorization: `Bearer ${(await Auth.currentSession())
              .getAccessToken()
              .getJwtToken()
            }`,
          };
        },
      },
    ],
  },
});
```

---------------

---------------

# JS Client Dynamo Table Model - Lambda Model Reference

---------------

Author: @gmineropfdrive
Upvotes: 0
Comments: 1

I have a lambda function which inserts data in my dynamoDb  for a given environment <MyModel >-<SOME_ID>-<EnvName>
In the same environment, my client is referencing the Model and, I would assume that the same format is used when referencing the table in DynamoDb for inserting data <MyModel >-<SOME_ID>-<EnvName> eventhough I only reference the Model itself in my client code:

`import { MyModel } from '../../../models';`

However, when I  perform an insert to my dynamoDb model from the client:

`DataStore.save( new MyModel (form))`

The record never appears under the environment table in dynamoDb

same thing when I attempt to query data, no dynamodb records are returned which were inserted using my lambda function. Coudl someone shed any light as to why this happens?
## Comment

---------------

Author: @gmineropfdrive

Figured it out - When trying to sync the data between local -> datastore (vice versa) there were field errors thrown. Once the field errors were resolved, everything worked accordingly.

---------------

---------------

# How to manipulate the flow of resetting the password by code ?

---------------

Author: @franklt69
Upvotes: 1
Comments: 0

Hi,
In the reset password process, I want to intercept the send code event to do an operation. After the reset password flow continues, I have been experimenting with the Hub, but I can't find what message I should send using the Hub to the app; go to the UI asking for the Verification Code and New Password. Could you help me with this, please?

`
  <amplify-forgot-password slot="forgot-password" submitButtonText="Submit"  [handleSend]="onSendCode"
                                         usernameAlias="email" ></amplify-forgot-password>


    onSendCode = async event => {
        event.preventDefault();
        await Auth.forgotPassword(this.userEmail);
        Hub.dispatch(UI_AUTH_CHANNEL, {
            event: AUTH_STATE_CHANGE_EVENT,
            message: AuthState.ResetPassword
        });

`

Note: I am using
`    "aws-amplify": "^3.3.24",
    "aws-amplify-angular": "^5.0.53",`

Thanks,
Frank

---------------

---------------

# Is `userSub` a permanent unique user ID for the users

---------------

Author: @WathikAhmed
Upvotes: 2
Comments: 0

Question:
Is `userSub` like a permanent unique user ID for the users? Because on the Amplify Admin UI it says `Unique identifier (username)` which means it is regarding the username as the ID for the user? I'm looking for something a little more distinguishable because the users may want to change their username in the future and so a separate ID would be a lot more reliable.

When I try to search using this `userSub` on the Amplify UI of user management, it doesn't come up with any results because it relies on the username/email as the unique identifier which is not an ideal one, to begin with.

Thanks.

---------------

---------------

# Datastore  & Flutter GraphQL auth rules

---------------

Author: @matthewapps
Upvotes: 1
Comments: 0

I am trying to set up auth rules for a Flutter app using Datastore but am not getting far. I have a Graphql  model for which I want public to have read access and the owner to read, create, update and delete. I expected the following rule to work:

@auth(rules: [{allow: public, operations: [read]}, {allow: public, operations: [read], provider: iam}, {allow: owner}]) 
In this situation updates to the table don't get synced up to the backend. I am using the standard command to save the data
 "await Amplify.DataStore.save(item)".

The following rules work:
@auth(rules: [{allow: public  } ]) 
@auth(rules: [{allow: public  }, {allow: public, provider: iam} ]) 
 
The following rules seem to have an effect in that the records are no longer synced down from the backend. I assume this is because the read operation is omitted from the list of owner operations:

@auth(rules: [{allow: public, operations: [read]}, {allow: public, operations: [read], provider: iam}, {allow: owner, operations: [create, update, delete] }]).

Any ideas why this doesn't work as I think it should??


---------------

---------------

# Unable to have Content management working on Amplify console after migration to CLI 7+

---------------

Author: @duranmla
Upvotes: 8
Comments: 2

Hi!

I am using `amplify-cli` (@aws-amplify/cli) version `7.3.6`, and I have migrated as suggested https://docs.amplify.aws/cli/migration/override/ my resources, while everything within the app seems to be working fine that problem I have still a blocker for my use case. The "Content" section on my Amplify console is not available as it suggests:

> An additional deployment is needed to enable content management capabilities for your API. Navigate to "Data" and hit "Save and deploy.

When I try to do so, I go to the "Data modeling" and hit "Save and deploy" which then throws error like:

```
Cannot read property 'push' of undefined, at AmplifyAuthCognitoStack.generateCognitoStackResources . 
```

The error on the stack trace suggests to update my schema but I have run the codegen command like:

`amplify codegen models`, `amplify codegen`, `yarn amplify-modelgen` and none of them generate a diff that make a change on the cloud formation. 

I am a bit lost in terms of how to debug this error. Appreciate any type of help or guidance. Thanks in advance folks!

Stack Trace:
```
Command failed with exit code 1: /root/.amplify/bin/amplify pull --amplify {"envName":"migration","defaultEditor":"code","appId":"my-app-id"} --providers {"awscloudformation":{"configLevel":"project","useProfile":true,"profileName":"amplify-backend-processor"}} --frontend {"frontend":"javascript","framework":"react","config":{"SourceDir":"src","DistributionDir":"build","BuildCommand":"npm run-script build","StartCommand":"npm run-script start"}} --yes
- Fetching updates to backend environment: migration from the cloud.
- Building resource auth/userPoolGroups
- Building resource auth/solauth
- Building resource storage/media
2021-11-18T14:56:14.564Z - error: uncaughtException: Cannot read property 'push' of undefined date=Thu Nov 18 2021 14:56:14 GMT+0000 (Coordinated Universal Time), pid=489, uid=0, gid=0, cwd=/tmp/amplify-5eacc2e2-f578-4761-a266-7df59586b376, execPath=/root/.amplify/bin/amplify, version=v12.22.7, argv=[/root/.amplify/bin/amplify, /snapshot/node_modules/@aws-amplify/cli/bin/amplify, pull, --amplify, {"envName":"migration","defaultEditor":"code","appId":"my-app-id"}, --providers, {"awscloudformation":{"configLevel":"project","useProfile":true,"profileName":"amplify-backend-processor"}}, --frontend, {"frontend":"javascript","framework":"react","config":{"SourceDir":"src","DistributionDir":"build","BuildCommand":"npm run-script build","StartCommand":"npm run-script start"}}, --yes], rss=412897280, heapTotal=333860864, heapUsed=305550904, external=20525906, arrayBuffers=18958544, loadavg=[0.4, 0.32, 0.12], uptime=418, trace=[column=51, file=/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-cognito-stack-builder.js, function=AmplifyAuthCognitoStack.generateCognitoStackResources, line=238, method=generateCognitoStackResources, native=false, column=31, file=/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-stack-transform.js, function=AmplifyAuthTransform.generateStackResources, line=341, method=generateStackResources, native=false, column=20, file=/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-stack-transform.js, function=AmplifyAuthTransform.transform, line=332, method=transform, native=false, column=12, file=/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/utils/generate-auth-stack-template.js, function=generateAuthStackTemplate, line=7, method=null, native=false], stack=[TypeError: Cannot read property 'push' of undefined,     at AmplifyAuthCognitoStack.generateCognitoStackResources (/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-cognito-stack-builder.js:238:51),     at AmplifyAuthTransform.generateStackResources (/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-stack-transform.js:341:31),     at AmplifyAuthTransform.transform (/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/auth-stack-builder/auth-stack-transform.js:332:20),     at generateAuthStackTemplate (/snapshot/node_modules/@aws-amplify/amplify-category-auth/lib/provider-utils/awscloudformation/utils/generate-auth-stack-template.js:7:12)]
⚠️ Amplify command hooks are disabled in the current execution environment.
⚠️ See https://docs.amplify.aws/cli/usage/command-hooks/ for more information.
[0mAmplify AppID found: my-app-id. Amplify App name is: sol[0m
[0mBackend environment migration found in Amplify Console app: sol[0m
[32mGraphQL schema compiled successfully.[39m

[32mEdit your schema at /tmp/amplify-5eacc2e2-f578-4761-a266-7df59586b376/amplify/backend/api/sol/schema.graphql or place .graphql files in a directory at /tmp/amplify-5eacc2e2-f578-4761-a266-7df59586b376/amplify/backend/api/sol/schema[39m
[0mSuccessfully generated models. Generated models can be found in /tmp/amplify-5eacc2e2-f578-4761-a266-7df59586b376/src[0m
```
## Comment

---------------

Author: @sachscode

@duranmla 
1. Could you please share the contents of your amplify folder. (this will help us debug the issue quicker ).  We are mainly looking for the contents of the `amplify/backend/auth/cli-inputs.json` file.

2. Can you please upgrade  CLI version 7.4.1  ( this is the latest version of CLI ) 
## Comment

---------------

Author: @duranmla

I was going over this again, using CLI 7.5.1 and I now stumble upon something interesting:
_I have the same issue, like everything on my infrastructure seems to be created successfully but I don't have the models created_

![CleanShot 2021-11-24 at 13 35 58@2x](https://user-images.githubusercontent.com/1425162/143239893-4a2e8d54-e129-48c5-b083-94d6689e3e3f.png)

It seems that after the migration there is something bad with my schema.
After the migration ran I also have this error on the terminal:

```
Failed to create models in the cloud: Modelgen job creation failed
```

Perhaps, this is the actual error and it is more actionable than before?

---------------

---------------

# GraphQL interface and `@connection`

---------------

Author: @strugman
Upvotes: 1
Comments: 0

Hello
I'm struggling with using an interface and `@connection` directive - maybe you could point me to some materials, where I could learn how to solve my problem? I know I could use lambda resolver for this, but I'm hoping there's another (better?) way...

In my `schema.graphql` I have an interface defined (I've minimised number of fields to present the idea):
```
interface Company {
	id: ID!
	name: String
}
```

and two types of companies:
```
type Broker implements Company @model {
	id: ID!
	name: String
}

type Customer implements Company @model {
	id: ID!
	name: String
}
```

`Broker` and `Customer` are mapped into separate tables in DynamoDB and `amplify codegen` produces correct queries and mutations for them.

The problem appeared when I created a `Person` type - a person is assigned to a company of any of those 2 types, and the problem appears on the `company` field, which I defined as follows:
```
type Person {
	id: ID!
	fname: String
	lname: String
	companyId: ID!
	company: Company @connection(fields: ["companyId"])
}
```

When I execute `amplify api gql-compile` I get an error:
`InvalidDirectiveError: Could not find an object type named Company`

I probably am doing something wrong or missing something. Please advise.

Piotr

---------------

---------------

# How to get/update/delete individual DynamoDB items using REST Api?

---------------

Author: @DiegoMcDipster
Upvotes: 1
Comments: 1

I'm using NextJs and storing my data in DynamoDB, using the REST Api.

All of the Get started tutorials teach the GraphQl api.  Not the REST API.  So, I'm stuck doing simple things like fetching individual records or updating individual records because there are no 'real' examples in the documentation.  (I instead followed this tutorial: https://www.youtube.com/watch?v=A2LXm9TZJck)

So if i can list all records using this bit of code:
```
    API.get(apiName, `${path}/name`)
      .then((fetchedPets) => {
        setPets([...pets, ...fetchedPets]);
      })
```

Using this code as a basis, how would I:
- get an individual pet
- update an individual pet
- delete an individual pet
## Comment

---------------

Author: @DiegoMcDipster

Please ignore this discussion. I figured it out. I was confused by the paths in the auto generated lambda function.  This discussion will therefore be closed.

---------------

---------------

# Administrative MFA TOTP reset

---------------

Author: @synapdk
Upvotes: 1
Comments: 12

### Before opening, please confirm:


- [X] I have [searched for duplicate or closed issues](https://github.com/aws-amplify/amplify-js/issues?q=is%3Aissue+) and [discussions](https://github.com/aws-amplify/amplify-js/discussions).
- [X] I have read the guide for [submitting bug reports](https://github.com/aws-amplify/amplify-js/blob/main/CONTRIBUTING.md#bug-reports).
- [X] I have done my best to include a minimal, self-contained set of instructions for consistently reproducing the issue.

### JavaScript Framework

Angular

### Amplify APIs

Authentication

### Amplify Categories

auth

### Environment information

<details>

```
# Put output below this line

  System:
    OS: macOS 11.6
    CPU: (12) x64 Intel(R) Core(TM) i9-8950HK CPU @ 2.90GHz
    Memory: 112.69 MB / 32.00 GB
    Shell: 3.2.57 - /bin/bash
  Binaries:
    Node: 14.17.5 - ~/.nvm/versions/node/v14.17.5/bin/node
    Yarn: 1.22.10 - /usr/local/bin/yarn
    npm: 6.14.14 - ~/.nvm/versions/node/v14.17.5/bin/npm
  Browsers:
    Chrome: 94.0.4606.81
    Firefox: 92.0.1
    Safari: 15.0
  npmPackages:
    <%= name %>:  <%= version %>
    @angular-devkit/build-angular: 0.1102.14 => 0.1102.14
    @angular-eslint/builder: ^0.0.1-alpha.32 => 0.0.1-alpha.32
    @angular-eslint/eslint-plugin: ~1.0.0 => 1.0.0
    @angular-eslint/eslint-plugin-template: ~1.0.0 => 1.0.0
    @angular-eslint/template-parser: ~1.0.0 => 1.0.0
    @angular-material-components/datetime-picker: 5.1.1 => 5.1.1
    @angular/animations: 11.2.14 => 11.2.14
    @angular/animations/browser:  undefined ()
    @angular/animations/browser/testing:  undefined ()
    @angular/cdk: 11.2.13 => 11.2.13
    @angular/cdk/a11y:  undefined ()
    @angular/cdk/accordion:  undefined ()
    @angular/cdk/bidi:  undefined ()
    @angular/cdk/clipboard:  undefined ()
    @angular/cdk/coercion:  undefined ()
    @angular/cdk/collections:  undefined ()
    @angular/cdk/drag-drop:  undefined ()
    @angular/cdk/keycodes:  undefined ()
    @angular/cdk/layout:  undefined ()
    @angular/cdk/observers:  undefined ()
    @angular/cdk/overlay:  undefined ()
    @angular/cdk/platform:  undefined ()
    @angular/cdk/portal:  undefined ()
    @angular/cdk/scrolling:  undefined ()
    @angular/cdk/stepper:  undefined ()
    @angular/cdk/table:  undefined ()
    @angular/cdk/testing:  undefined ()
    @angular/cdk/testing/protractor:  undefined ()
    @angular/cdk/testing/testbed:  undefined ()
    @angular/cdk/text-field:  undefined ()
    @angular/cdk/tree:  undefined ()
    @angular/cli: 11.2.14 => 11.2.14
    @angular/common: 11.2.14 => 11.2.14
    @angular/common/http:  undefined ()
    @angular/common/http/testing:  undefined ()
    @angular/common/testing:  undefined ()
    @angular/common/upgrade:  undefined ()
    @angular/compiler: 11.2.14 => 11.2.14
    @angular/compiler-cli: 11.2.14 => 11.2.14
    @angular/compiler/testing:  undefined ()
    @angular/core: 11.2.14 => 11.2.14
    @angular/core/testing:  undefined ()
    @angular/flex-layout: 11.0.0-beta.33 => 11.0.0-beta.33
    @angular/flex-layout/core:  undefined ()
    @angular/flex-layout/extended:  undefined ()
    @angular/flex-layout/flex:  undefined ()
    @angular/flex-layout/grid:  undefined ()
    @angular/flex-layout/server:  undefined ()
    @angular/forms: 11.2.14 => 11.2.14
    @angular/language-service: 11.2.14 => 11.2.14
    @angular/material: 11.2.13 => 11.2.13
    @angular/material/autocomplete:  undefined ()
    @angular/material/autocomplete/testing:  undefined ()
    @angular/material/badge:  undefined ()
    @angular/material/badge/testing:  undefined ()
    @angular/material/bottom-sheet:  undefined ()
    @angular/material/bottom-sheet/testing:  undefined ()
    @angular/material/button:  undefined ()
    @angular/material/button-toggle:  undefined ()
    @angular/material/button-toggle/testing:  undefined ()
    @angular/material/button/testing:  undefined ()
    @angular/material/card:  undefined ()
    @angular/material/card/testing:  undefined ()
    @angular/material/checkbox:  undefined ()
    @angular/material/checkbox/testing:  undefined ()
    @angular/material/chips:  undefined ()
    @angular/material/chips/testing:  undefined ()
    @angular/material/core:  undefined ()
    @angular/material/core/testing:  undefined ()
    @angular/material/datepicker:  undefined ()
    @angular/material/datepicker/testing:  undefined ()
    @angular/material/dialog:  undefined ()
    @angular/material/dialog/testing:  undefined ()
    @angular/material/divider:  undefined ()
    @angular/material/divider/testing:  undefined ()
    @angular/material/expansion:  undefined ()
    @angular/material/expansion/testing:  undefined ()
    @angular/material/form-field:  undefined ()
    @angular/material/form-field/testing:  undefined ()
    @angular/material/form-field/testing/control:  undefined ()
    @angular/material/grid-list:  undefined ()
    @angular/material/grid-list/testing:  undefined ()
    @angular/material/icon:  undefined ()
    @angular/material/icon/testing:  undefined ()
    @angular/material/input:  undefined ()
    @angular/material/input/testing:  undefined ()
    @angular/material/list:  undefined ()
    @angular/material/list/testing:  undefined ()
    @angular/material/menu:  undefined ()
    @angular/material/menu/testing:  undefined ()
    @angular/material/paginator:  undefined ()
    @angular/material/paginator/testing:  undefined ()
    @angular/material/progress-bar:  undefined ()
    @angular/material/progress-bar/testing:  undefined ()
    @angular/material/progress-spinner:  undefined ()
    @angular/material/progress-spinner/testing:  undefined ()
    @angular/material/radio:  undefined ()
    @angular/material/radio/testing:  undefined ()
    @angular/material/select:  undefined ()
    @angular/material/select/testing:  undefined ()
    @angular/material/sidenav:  undefined ()
    @angular/material/sidenav/testing:  undefined ()
    @angular/material/slide-toggle:  undefined ()
    @angular/material/slide-toggle/testing:  undefined ()
    @angular/material/slider:  undefined ()
    @angular/material/slider/testing:  undefined ()
    @angular/material/snack-bar:  undefined ()
    @angular/material/snack-bar/testing:  undefined ()
    @angular/material/sort:  undefined ()
    @angular/material/sort/testing:  undefined ()
    @angular/material/stepper:  undefined ()
    @angular/material/stepper/testing:  undefined ()
    @angular/material/table:  undefined ()
    @angular/material/table/testing:  undefined ()
    @angular/material/tabs:  undefined ()
    @angular/material/tabs/testing:  undefined ()
    @angular/material/toolbar:  undefined ()
    @angular/material/toolbar/testing:  undefined ()
    @angular/material/tooltip:  undefined ()
    @angular/material/tooltip/testing:  undefined ()
    @angular/material/tree:  undefined ()
    @angular/material/tree/testing:  undefined ()
    @angular/platform-browser: 11.2.14 => 11.2.14
    @angular/platform-browser-dynamic: 11.2.14 => 11.2.14
    @angular/platform-browser-dynamic/testing:  undefined ()
    @angular/platform-browser/animations:  undefined ()
    @angular/platform-browser/testing:  undefined ()
    @angular/router: 11.2.14 => 11.2.14
    @angular/router/testing:  undefined ()
    @angular/router/upgrade:  undefined ()
    @apollo/client: ^3.0.0 => 3.2.2
    @apollo/client/cache:  undefined ()
    @apollo/client/core:  undefined ()
    @apollo/client/errors:  undefined ()
    @apollo/client/link/batch:  undefined ()
    @apollo/client/link/batch-http:  undefined ()
    @apollo/client/link/context:  undefined ()
    @apollo/client/link/core:  undefined ()
    @apollo/client/link/error:  undefined ()
    @apollo/client/link/http:  undefined ()
    @apollo/client/link/persisted-queries:  undefined ()
    @apollo/client/link/retry:  undefined ()
    @apollo/client/link/schema:  undefined ()
    @apollo/client/link/utils:  undefined ()
    @apollo/client/link/ws:  undefined ()
    @apollo/client/react:  undefined ()
    @apollo/client/react/components:  undefined ()
    @apollo/client/react/context:  undefined ()
    @apollo/client/react/data:  undefined ()
    @apollo/client/react/hoc:  undefined ()
    @apollo/client/react/hooks:  undefined ()
    @apollo/client/react/parser:  undefined ()
    @apollo/client/react/ssr:  undefined ()
    @apollo/client/testing:  undefined ()
    @apollo/client/utilities:  undefined ()
    @aws-amplify/ui-angular: ^1.0.3 => 1.0.3
    @casl/ability: ^5.2.2 => 5.2.2
    @casl/ability/extra:  undefined ()
    @casl/angular: ^5.1.0 => 5.1.0
    @datorama/akita: ^4.23.2 => 4.23.2
    @graphql-codegen/cli: ^1.13.3 => 1.14.0
    @graphql-codegen/introspection: ^1.18.0 => 1.18.0
    @graphql-codegen/typescript-apollo-angular: ^1.13.3 => 1.14.0
    @graphql-codegen/typescript-document-nodes: ^1.13.3 => 1.14.0
    @graphql-codegen/typescript-operations: ^1.13.3 => 1.14.0
    @nestjs/common: 7.6.18 => 7.6.18 (7.4.2)
    @nestjs/core: 7.6.18 => 7.6.18
    @nestjs/graphql: ^7.6.0 => 7.7.0
    @nestjs/platform-express: 7.6.18 => 7.6.18
    @nestjs/schematics: 7.3.1 => 7.3.1
    @nestjs/testing: 7.6.18 => 7.6.18
    @nestjs/typeorm: ^7.1.0 => 7.1.0
    @ngx-formly/core: ^5.9.3 => 5.9.3
    @ngx-formly/core/json-schema:  undefined ()
    @ngx-formly/core/select:  undefined ()
    @nrwl/angular: 11.6.3 => 11.6.3
    @nrwl/angular/testing:  undefined ()
    @nrwl/cli: 11.6.3 => 11.6.3
    @nrwl/cypress: 11.6.3 => 11.6.3
    @nrwl/eslint-plugin-nx: 11.6.3 => 11.6.3
    @nrwl/jest: 11.6.3 => 11.6.3
    @nrwl/linter: 11.6.3 => 11.6.3
    @nrwl/nest: 11.6.3 => 11.6.3
    @nrwl/node: 11.6.3 => 11.6.3
    @nrwl/nx-cloud: ^12.2.7 => 12.2.7
    @nrwl/tao: 11.6.3 => 11.6.3
    @nrwl/workspace: 11.6.3 => 11.6.3
    @synap/nest-aws-kms: ^0.0.2 => 0.0.2
    @synap/ngx-subscription-helpers: ^0.0.1 => 0.0.1
    @types/config: ^0.0.36 => 0.0.36
    @types/jest: 26.0.8 => 26.0.8 (26.0.23)
    @types/lodash-es: ^4.17.3 => 4.17.3
    @types/node: 14.14.33 => 14.14.33 (14.0.5, 10.17.24, 14.6.4)
    @typescript-eslint/eslint-plugin: 4.3.0 => 4.3.0
    @typescript-eslint/parser: 4.3.0 => 4.3.0
    apollo-angular: ^2.0.4 => 2.0.4
    apollo-angular/headers:  undefined ()
    apollo-angular/http:  undefined ()
    apollo-angular/testing:  undefined ()
    apollo-link-scalars: ^2.0.1 => 2.0.1
    apollo-server-express: ^2.12.0 => 2.13.1
    aws-amplify: ^3.3.22 => 3.3.22
    aws-sdk: ^2.730.0 => 2.730.0 (2.738.0)
    casual: ^1.6.2 => 1.6.2
    chart.js: ^2.9.4 => 2.9.4
    chartjs-node-canvas: ^3.0.6 => 3.0.6
    class-transformer: ^0.3.1 => 0.3.1
    class-validator: ^0.12.2 => 0.12.2
    config: ^3.3.1 => 3.3.1
    core-js: ^2.5.4 => 2.6.11 (3.8.3, 3.6.5)
    cypress: ^4.1.0 => 4.6.0
    deep-object-diff: ^1.1.0 => 1.1.0
    dotenv: 8.2.0 => 8.2.0 (4.0.0, 6.2.0)
    eslint: 7.10.0 => 7.10.0
    eslint-config-prettier: 8.1.0 => 8.1.0
    eslint-plugin-cypress: ^2.10.3 => 2.11.3
    eslint-plugin-no-null: ^1.0.2 => 1.0.2
    eslint-plugin-prettier: ^3.1.4 => 3.1.4
    exceljs: ^4.1.1 => 4.1.1
    graphql: ^15.0.0 => 15.3.0 (14.0.0, 14.6.0)
    graphql-tools: ^5.0.0 => 5.0.0 (4.0.8)
    jest: 26.2.2 => 26.2.2
    jest-preset-angular: 8.3.2 => 8.3.2
    jsonwebtoken: ^8.5.1 => 8.5.1
    jwk-to-pem: ^2.0.4 => 2.0.4
    lib:  0.0.1
    lodash-es: ^4.17.15 => 4.17.15
    moment: ^2.27.0 => 2.27.0 (2.29.1, 2.26.0, 2.24.0)
    moment-timezone: ^0.5.31 => 0.5.31
    morgan: ^1.10.0 => 1.10.0
    mysql: ^2.18.1 => 2.18.1
    nest-aws-sdk: ^1.1.1 => 1.1.1
    ng2-charts: ^2.4.2 => 2.4.2
    ngx-dropzone: ^2.2.2 => 2.2.2
    ngx-markdown: 11.0.0 => 11.0.0
    nodemailer: ^6.4.16 => 6.4.16
    pdf-lib: ^1.11.2 => 1.11.2
    prettier: 2.2.1 => 2.2.1
    reflect-metadata: ^0.1.13 => 0.1.13
    rxjs: 6.5.5 => 6.5.5 (6.6.3, 6.6.7, 6.3.3)
    rxjs/ajax:  undefined ()
    rxjs/fetch:  undefined ()
    rxjs/internal-compatibility:  undefined ()
    rxjs/operators:  undefined ()
    rxjs/testing:  undefined ()
    rxjs/webSocket:  undefined ()
    ts-jest: 26.4.0 => 26.4.0 (26.5.6)
    ts-node: 9.1.1 => 9.1.1
    tslib: ^2.0.0 => 2.0.0 (1.13.0, 2.1.0, 1.14.1, 2.0.1, 1.11.2, 2.2.0)
    typeorm: ^0.2.25 => 0.2.25
    typeorm-seeding: ^1.6.1 => 1.6.1
    typescript: 4.0.8 => 4.0.8 (4.1.5, 4.0.3, 3.9.3)
    zone.js: ^0.10.2 => 0.10.3
  npmGlobalPackages:
    @angular/cli: 12.2.2
    npm: 6.14.14

```

</details>


### Describe the bug

When a user's MFA preference is removed, that user can no longer log in and is stuck with a spinner in the login button.

### Expected behavior

From the  [AdminSetUserMFAPreference docs](https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html) the expected behavior is:

> If  multiple options  are enabled and no preference is set, a challenge to choose an MFA option will be returned during sign in.

### Reproduction steps

Begin with a user in an MFA-required pool with software token MFA enabled and preferred:

```json
{
    "Username": "...",
    "UserAttributes": ["..."],
    "Enabled": true,
    "UserStatus": "CONFIRMED",
    "MFAOptions": [
        {
            "DeliveryMedium": "SMS",
            "AttributeName": "phone_number"
        }
    ],
    "PreferredMfaSetting": "SOFTWARE_TOKEN_MFA",
    "UserMFASettingList": [
        "SOFTWARE_TOKEN_MFA"
    ]
}
```

Use the [AdminSetUserMFAPreference](https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html) action to remove the preferred MFA, putting the user in this state:

```json
{
    "Username": "...",
    "UserAttributes": ["..."],
    "Enabled": true,
    "UserStatus": "CONFIRMED",
    "MFAOptions": [
        {
            "DeliveryMedium": "SMS",
            "AttributeName": "phone_number"
        }
    ],
    "UserMFASettingList": [
        "SOFTWARE_TOKEN_MFA"
    ]
}
```

Now when the user tries to log in they receive this console error: "Unhandled Promise rejection: Local storage is missing an ID Token, Please authenticate".

```

```

### Code Snippet

```javascript
// Put your code below this line.

```


### Log output

<details>

```
// Put your logs below this line

zone-evergreen.js:659 Unhandled Promise rejection: Local storage is missing an ID Token, Please authenticate ; Zone: <root> ; Task: Promise.then ; Value: Error: Local storage is missing an ID Token, Please authenticate
    at CognitoUser.getSession (CognitoUser.js:1324)
    at Auth.js:1305
    at new ZoneAwarePromise (zone-evergreen.js:960)
    at AuthClass.push.v4IS.AuthClass.userSession (Auth.js:1303)
    at Auth.js:1030
    at new ZoneAwarePromise (zone-evergreen.js:960)
    at AuthClass.push.v4IS.AuthClass.userAttributes (Auth.js:1029)
    at AuthClass.push.v4IS.AuthClass.verifiedContact (Auth.js:1044)
    at checkContact (auth-helpers-bd096ca7.js:20)
    at handleSignIn (auth-helpers-bd096ca7.js:59) Error: Local storage is missing an ID Token, Please authenticate
    at CognitoUser.getSession (https://staging.iask.works/vendor.js:68019:16)
    at https://staging.iask.works/vendor.js:198008:18
    at new ZoneAwarePromise (https://staging.iask.works/polyfills.js:1058:33)
    at AuthClass.push.v4IS.AuthClass.userSession (https://staging.iask.works/vendor.js:198006:16)
    at https://staging.iask.works/vendor.js:197733:19
    at new ZoneAwarePromise (https://staging.iask.works/polyfills.js:1058:33)
    at AuthClass.push.v4IS.AuthClass.userAttributes (https://staging.iask.works/vendor.js:197732:16)
    at AuthClass.push.v4IS.AuthClass.verifiedContact (https://staging.iask.works/vendor.js:197747:21)
    at checkContact (https://staging.iask.works/common.js:60:83)
    at handleSignIn (https://staging.iask.works/common.js:99:19)
```

</details>


### aws-exports.js

_No response_

### Manual configuration

```js 
       Auth: {
            userPoolId: 'us-west-1_Zj5xZfsJI',
            userPoolWebClientId: '5gs4rr5nlstvb2qaegunfejhtf',
            region: 'us-west-1',
        }
```

### Additional configuration

_No response_

### Mobile Device

_No response_

### Mobile Operating System

_No response_

### Mobile Browser

_No response_

### Mobile Browser Version

_No response_

### Additional information and screenshots

![Screen Shot 2021-10-15 at 11 00 51 AM](https://user-images.githubusercontent.com/37423570/137532384-33de3ff9-2d38-4f8c-9ebb-de02d6979982.png)
## Comment

---------------

Author: @ashika01

@synapdk are you using Amplify at all? the doc you have mentioned links to Cognito docs. If you are using Amplify, I think you might still need to use `setPreferedMFA` method since that is where we persist the data in localStorage in our code. If you are doing a combination of Cognito API calls and Amplify, I think you might have to replicate what we have done in our code to set the localStorage.

Could you share a minimal code so we can see your usage? Also, after you have called the API, can you do `getCurrentAuthenticatedUser` to see if the challengeName and mfaPreference have updated?
## Comment

---------------

Author: @synapdk

@ashika01 we are using a pretty vanilla implementation of the Angular sign in component:


```html
    <amplify-authenticator>
        <amplify-sign-in slot="sign-in" [hideSignUp]="true"></amplify-sign-in>
    </amplify-authenticator>
```

There is no other code in that component. In a service we use the hub to listen for an auth event, but this is never received when the sign in component is stuck with a spinner.

```ts
import { Hub } from '@aws-amplify/core';

@Injectable()
export class NgxAuthService {
 
    constructor(
        private ngZone: NgZone,
    ) {
        Hub.listen('auth', ({ payload: { event, data } }) => {
            if (event === 'signIn') this.ngZone.run(() => this.startSession(data));
        });
    }

    private startSession = (data: any) => {
        const token = data?.signInUserSession?.accessToken?.jwtToken ?? undefined;
        if (!token) return undefined;

       // ...the rest of our session setup, but a user whose MFA preference has been reset never gets here
    }
}
```

Is that helpful? It would be a fair amount of work to create a publicly accessible example, is there some kind of sandbox you use for that?
## Comment

---------------

Author: @ashika01

@synapdk since we dont directly support all cognito APIs I would have to get more info to reproduce this issue. 

Could you give us a psuedo code/code snippet of your AdminSetUserMFAPreference sample https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html
## Comment

---------------

Author: @synapdk

@ashika01 I'm currently using the CLI to plan how I will call the API, hoping this is equivalent. It does behave a little strangely. If I just make the call I would expect to remove the MFA preference it appears to have succeeded  but nothing changes:

```sh
aws cognito-idp admin-set-user-mfa-preference --cli-input-json '{
    "SMSMfaSettings": {
        "Enabled": true,
        "PreferredMfa": false
    },
    "SoftwareTokenMfaSettings": {
        "Enabled": true,
        "PreferredMfa": false
    },
    "Username": "dylan@synap.io",
    "UserPoolId": "us-west-1_Zj5xZfsJI"
}
'
```
If I disable both MFA methods first, then re-enable them with the above command, the preference is successfully removed.
```sh
aws cognito-idp admin-set-user-mfa-preference --cli-input-json '{
    "SMSMfaSettings": {
        "Enabled": false,
        "PreferredMfa": false
    },
    "SoftwareTokenMfaSettings": {
        "Enabled": false,
        "PreferredMfa": false
    },
    "Username": "dylan@synap.io",
    "UserPoolId": "us-west-1_Zj5xZfsJI"
}
'
aws cognito-idp admin-set-user-mfa-preference --cli-input-json '{
    "SMSMfaSettings": {
        "Enabled": true,
        "PreferredMfa": false
    },
    "SoftwareTokenMfaSettings": {
        "Enabled": true,
        "PreferredMfa": false
    },
    "Username": "dylan@synap.io",
    "UserPoolId": "us-west-1_Zj5xZfsJI"
}
'
```

After doing both the user is in the state that causes the error.
## Comment

---------------

Author: @ashika01

@synapdk I am not sure how this relates to Amplify. I would suggest reaching out in AWS forum to discuss the strange behavior. With respect to Amplify's support, this is the admin queries we support at the moment - https://docs.amplify.aws/cli/auth/admin/

You can use the doc and try to setup an api for admin action and then see if the issue still exists.
## Comment

---------------

Author: @synapdk

Thank you @ashika01 . I should note that #8103 would work for me also, but in the absence of that feature I was hoping it would at least be possible for an administrator to reset TOTP for a user, that's what I was after here. If there is another way to accomplish that I would love to know.
## Comment

---------------

Author: @ashika01

@synapdk Yeah I see your use case. It is definitely one of the use case we have been trying to work around cognito limitations. But we need support from cognito service to make it smoother. At the moment this has been marked as feature request and we are very much aware and looking into how to get this experience.

So if I have understood your usage here right, you are trying to use this Admin API to disable TOTP and re enable them with TOTP preferred so the customer can go through the setup again?
## Comment

---------------

Author: @synapdk

@ashika01 You've got it, yes. I sent feedback on the [AdminSetUserMFAPreference doc page](https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_AdminSetUserMFAPreference.html). Is there anywhere else I should push for improvements on the Cognito side?
## Comment

---------------

Author: @ashika01

@synapdk I tried setting up Admin Query support for the API you called out. I was able to update the settings as need. Please refer to [this doc](https://docs.amplify.aws/cli/auth/admin/)

I added a function in `cognitoActions.js` created by our CLI for AdminMFA,
```
async function mfaPref (params){
  try {
    console.log("params mfa", params);
    const result = await cognitoIdentityServiceProvider.adminSetUserMFAPreference(params).promise();
    console.log("result mfa", result);
    return result;
  } catch (err) {
    console.log(err);
    throw err;
  }
}
```

In my function/AdminQueriesXXX/app.js
```
app.post('/mfaPref', async (req,res,next) => {
  try {
    console.log("mfa request", req);
    let response = await mfaPref(req.body);
    res.status(200).json(response);
  } catch (err) {
    next(err);
  }
});
```


And from my client app.js,

```
async function setMfa() {
  let apiName = "AdminQueries";
  let path = "/mfaPref";
  const params = {
    SMSMfaSettings: { 
       Enabled: false,
       PreferredMfa: false
    },
    Username: 'test4',
    UserPoolId: awsConfig.aws_user_pools_id
  }

  let myInit = {
    body: params,
    headers: {
      "Content-Type": "application/json",
      Authorization: `${(await Auth.currentSession())
        .getAccessToken()
        .getJwtToken()}`,
    },
  };
  const { NextToken, ...rest } = await API.post(apiName, path, myInit);
  nextToken = NextToken;
  console.log("rest", rest);
  return rest;
}
```
## Comment

---------------

Author: @ashika01

To reach out to cognito forum - https://forums.aws.amazon.com/forum.jspa?forumID=173. 

I am moving this to discussion since this is more of a question than issue or bug. 
## Comment

---------------

Author: @synapdk

I also got a reply from my feedback on the documentation with some more information:

The next step (after resetting MFA preference) is not possible in the hosted UI. The choice must be made in your software. I performed the same operation as you in the CLI, and then ran an InitiateAuth [1] for that user. This was the response:

```json
{
    "ChallengeName": "SELECT_MFA_TYPE",
    "ChallengeParameters": {
        "CODE_DELIVERY_DELIVERY_MEDIUM": "SMS",
        "CODE_DELIVERY_DESTINATION": "+*******1212",
        "FRIENDLY_DEVICE_NAME": "phoneGauth",
        "MFAS_CAN_CHOOSE": "[\"SMS_MFA\",\"SOFTWARE_TOKEN_MFA\"]",
        "USER_ID_FOR_SRP": "testuser"
    }
}
```

The auth challenge I received after resetting my MFA preferences was to choose a new preference. I can follow that up with RespondToAuthChallenge [2] and provide my preferred MFA type. I will then be presented with a SMS_MFA | SOFTWARE_TOKEN_MFA challenge, provide my code, and proceed with authentication.

I do understand that the process is not intuitive, and I am working on improving the docs around these processes. I hope this helps.

Thanks for taking the time to send us feedback! We appreciate all feedback, whether it's positive or it alerts us to a problem we need to address. Please don't hesitate to contact us with any other feedback you might have about our documentation.

[1]  InitiateAuth  - https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_InitiateAuth.html

[2]  RespondToAuthChallenge  - https://docs.aws.amazon.com/cognito-user-identity-pools/latest/APIReference/API_RespondToAuthChallenge.html
## Comment

---------------

Author: @ashika01

Just to summarize,
1. The UX you would like to achieve and as described in https://github.com/aws-amplify/amplify-js/issues/8103 is not currently possible because of limitations
2. However for your workaround, where you would like Admin to override you could use the admin queries feature. You would need some sort of UI/API introduced for Admin to do this.

I am going to mark this answered. If you have further queries specific to Cognito or feature requests, we recommend AWS forum for response from Cognito team.

---------------

---------------

# Getting error "error on fetching instances Error: No current user" with initial login.

---------------

Author: @mguja-fcc
Upvotes: 1
Comments: 2

I want to load initial data but only for authenticated users. Currently, I am using useEffect hook, however, it tries to fetch data before authentication. If it is my initial login then I am getting error "error on fetching instances Error: No current user". If I refresh the browser than no issue fetching data from the database and it works until authentication token expires. How can I fetch data only after authentication ?
## Comment

---------------

Author: @david-mcafee

@mguja-fcc - what type of auth are you using (IAM, Cognito, etc)? Additionally, how are you enforcing auth? Have you added auth to your schema? Additionally, how are you enforcing auth on the page (i.e. are you using `withAuthenticator`, and if so, where are you placing it?). 

For instance, if your schema looks like this:
```js
type Todo @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  name: String!
  description: String!
  owner: String
}
```

and you are also wrapping your App, or component, with the authenticator, like this:
```js
import { withAuthenticator } from "@aws-amplify/ui-react";

const App = () => {
[...]
};

export default withAuthenticator(App);
```
then you should have no problem retrieving the data like so:
```js
 useEffect(() => {
    fetchTodos();
}, []);

async function fetchTodos() {
    try {
        const todoData = await API.graphql(graphqlOperation(listTodos));
        const todos = todoData?.data?.listTodos?.items;
        setTodos(todos);
    } catch (err) {
        console.log("error fetching todos", err);
    }
}
```
## Comment

---------------

Author: @mguja-fcc

Hi,

I was able to figure it out. It actually worked the way it should. I moved my post authentication event to `<AmplifyAuthenticator handleAuthStateChange={handleAuthStateChange}>` where `handleAuthStateChange` function is fetching data from the database. I do not fetch data from `useEffect` react hook since it tries to fetch data before authentication happens.

---------------

---------------

# DataStore: Subscriptions should show previous state as well as current state

---------------

Author: @danrivett
Upvotes: 3
Comments: 1

# Request
When subscribing to data model changes, it would be incredibly useful when the `opType` is `UPDATE` for the `SubscriptionMessage` returned to the subscriber to not just include the current value, but also the previous value in order for the application to be able to identify what's changed since depending on what's changed then different responses may be required.

I see this analogous to DynamoDB streams where the streams contain old and new image records for each update so subscribers can identify what's changed and react accordingly.

Alternatively, if there are better ways to solve this use case I'd be very happy to consider them.
## Comment

---------------

Author: @danrivett

Copying @manueliglesias so you're aware as this could be a pretty helpful change to `SubscriptionMessage` and perhaps one that isn't very complicated to implement if the underlying subscription event is being triggered by a DynamoDB stream event and so DataStore already has access to the previous value?

As for use cases for this functionality, we have a few, but an example of one of them is highlighting the fields that have been just updated so the user can easily see what's been updated in the model.

---------------

---------------

# RFC: React Hooks for Amplify API

---------------

Author: @ericclemmons
Upvotes: 1
Comments: 25

_This issue is a Request For Comments (RFC). It is intended to elicit community feedback regarding a proposed change to the library. Please feel free to post comments or questions here._

## Purpose

Simplify integration of the Amplify API category to accomplish common use-cases within modern React applications.

## The Problem

Running asynchronous GraphQL queries can easily lead to memory leaks, setting state on unmounted components, and incorrectly catching/handling errors:

```js
useEffect(() => {
    setIsLoading(true);
    
    API.graphql({
      authMode: owner ? 'AMAZON_COGNITO_USER_POOLS' : 'AWS_IAM',
      query: listAlbums,
      variables: {
        nextToken: pageToken
      }
    })
      .then(payload => {
        setNextToken(payload.data.listAlbums.nextToken);
        setAlbums(payload.data.listAlbums.items);
        setIsLoading(false);
      })
      .catch(payload => {
        throw new Error(payload.errors[0].message);
      });
      
}, [owner, pageToken]);
```

Additionally, [`API.graphql` may require the user to pass `authMode`](#2396), whereas it would be preferably for it to work "out of the box" without [explicitly listening to `Hub` events](#2542).

## Proposed Solution

### `useQuery(query, variables?, setData?)`

_returns `[res, runQuery]`._

`useQuery` turns `API.graphql` into a synchronous API for managing the fetch/loading/data/error life-cycle:

```js
const [res, runQuery] = useQuery(listAlbums, { nextToken: pageToken });

if (res.loading) return <Loader />;

if (res.error) return (
  <button onClick={() => runQuery()}>Retry</Button>
);

return (
  <>
    <AlbumList albums={res.data.listAlbums.items} />
    
    <button onClick={() => setPageToken(res.data.listAlbums.nextToken}>
      Next Page
    </button> 
  </>
);
```

- The `query` is automatically ran on mount.
- `res` has the shape `{ data, error, loading }`, similar to [urql](https://formidable.com/open-source/urql/docs/getting-started/#using-hooks).  This signature allows for users to provide semantic meaning (e.g. `albumRes`) when there are multiple `useQuery` hooks in a single component.
- `runQuery` has the signature `runQuery(overrideVariables?)` for re-fetching data (typically in the event of an error).
- `setData` has the signature `setData(data)`, which simplifies data normalization & computed property scenarios:

    ```js
    const [album, setAlbum] = useState()
    const [res] = useQuery(getAlbum, { id: album.id }, (data) => {
      setAlbum(data.getAlbum)
    })
    ```

    Typically, `useQuery` and `useMutation` won't use this, but it exists due to constraints with `useSubscription` & for symmetry.

### `useMutation(query, setData?)`

_Returns `[res, runMutation]`._

`useMutation` provides a handler for `API.graphql` that turns the asynchronous event into a synchronous API for managing the fetch/loading/data/error life-cycle:

```js
const [res, runMutation] = useMutation(deleteAlbum);

if (res.error) throw res.error;
if (res.data) return <Redirect to="/" />

return (
  <button onClick={() => runMutation({
    input: {
      expectedVersion: album.version,
      id: album.id
    }
  )}>Delete Album</button>
);
```

- `query` is _not_ ran on mount, but triggered via the `runMutation` callback.
- `res` has the shape `{ data, error, loading }`.
- `runMutation` has the signature `runMutation(variables?)`, since mutations often require scoped values (e.g. `event.target.value)`.
- `setData` has the signature `setData(data)` to simplify keeping local state in sync after a mutation succeeds:

    ```js
    const [album, setAlbum] = useState()
    const [query] = useQuery(getAlbum, { id: album.id }, (data) => {
      setAlbum(data.getAlbum)
    })
    const [mutation, runMutation] = useMutation(updateAlbum, (data) => {
      setAlbum(data.updateAlbum)
    })
    ...
    ```

### `useSubscription(query, variables?, setData?)`

_returns `undefined`._

`useSubscription` pairs naturally with `useQuery` and `useMutation` for keeping state in sync, especially when mutations happen in other components:

```js
const [album, setAlbum] = useState();

const [res] = useQuery(getAlbum, { id }, (data) => {
  setAlbum(data.getAlbum);
});

useSubscription(onUpdateAlbum, { owner }, (data) => {
  setAlbum(data.onUpdateAlbum);
});

if (res.loading) return <Loader />

return <AlbumDetails album={album} />
```

### `useGraphQL(query, variables?)`

_returns `[runQuery]`._

`useQuery`, `useMutation`, and `useSubscription` are all powered by `useGraphQL`, which memoizes `API.graphql` calls to reduce network connections and automatically handle `authMode`.

This isn't intended to be used directly, but is leveraged by the other hooks.

## Related Issues

- #2611
- #2542
- https://github.com/aws-amplify/amplify-cli/issues/2396
- #474 


## Resources

- https://github.com/mwarger/amplify-query-helpers
- [React v16.8: The One With Hooks](https://reactjs.org/blog/2019/02/06/react-v16.8.0.html) is released in February, 2019.
- In 3 months [55% of 6,632 respondents were using hooks](https://twitter.com/icookandcode/status/1131740303780712448).
- [Should I use Hooks, classes, or a mix of both?](https://reactjs.org/docs/hooks-faq.html#should-i-use-hooks-classes-or-a-mix-of-both)
- [80% of users' time is spent in function components](https://twitter.com/kentcdodds/status/1136261881696382977).
- [Hooks, Suspense, the death of render props, the-platform, and migrating sanely](https://twitter.com/ReactPodcast/status/1064865948333744128)
- [Creating reusable abstractions with Amplify and React hooks](https://itnext.io/creating-reusable-abstractions-with-amplify-and-react-hooks-97784c8b5c2a)
- [AWS Amplify GraphQL Operations with TypeScript and Hooks - Part 1 [Queries]](https://dev.to/mwarger/aws-amplify-graphql-queries-with-typescript-and-hooks-1e2)
- [Authorizing Subscriptions](https://aws-amplify.github.io/docs/cli-toolchain/graphql#authorizing-subscriptions)
- [Observable types like RxJS `BehaviorSubject` and `ReplaySubject`. (Types like RxJS `Subject` or `Observable` are not supported, because they provide no way to read the "current" value after it has been emitted.)](https://github.com/facebook/react/pull/15022/files#diff-f3a2eff7618256a34a255026486e7e9fR27)

## Comment

---------------

Author: @jkeys-ecg-nmsu

Nice proposal! 

One question: does the below code not exactly simulate this functionality asynchronously by having a local useState hook that will hold your API data and give it an initial state of undefined? Or is there something I'm missing about React lifecycles? 

```
const [myApiData, setMyApiData] = useState(undefined);

useEffect( () => {
   const _effect = async () => await API.graphql(props.apiConfig);
   let data = _effect();
   setMyApiData(data);

  return () => setMyApiData(undefined); //set back to undefined so the lifecycle restarts on unmount and remount
}, []);

if(myApiData === undefined) return <Loading />
else if(myApiData.data.errors.length !== 0) return <Error />
else return <div>{myApiData.map( datum => <ul>{datum}</ul>}</div>
```

Then set it to undefined on unmount.  The most annoying part with this pattern is that you have to wrap your async call to `API.graphql` in an async IIFE / closure inside your useEffect hook (which is then called synchronously).

All that being said, I am sure we will convert to using this just to reduce cruft.
## Comment

---------------

Author: @3nvi

Thanks for that! It's nice how most GraphQL libraries have an aligned API in the use of hooks. 

A few things I'm wondering:

1. Doesn't the callback on `useQuery` & `useMutation` create the same memory-leak issues? If it executes right after the promise has resolved, I feel it might inevitably lead to the same problems if the component has unmounted while the request is in-flight.

2. How is query memoization handled? Is the user allowed to choose among different cache & network strategies? 

3. Does the query get re-executed on a variable change or what's the plan to handle this scenario?

4. I feel that an option to make the query "lazy" (behave like way mutation does) would be interesting whenever the query is triggered by some user action (i.e. button click).
## Comment

---------------

Author: @ericclemmons

@3nvi Great feedback!

1. Potentially, but in a reference implementation the mount status is tracked to prevent firing callbacks as the GraphQL Promise resolves.  (There's an opportunity for `AbortController` to be used internally)

2. The reference implementation memoizes based on `query` & `variables` (and potentially on auth state, based on how `authMode` is handled) via `useMemo`. At the very least the same as https://aws-amplify.github.io/docs/js/api#amplify-graphql-client for starters.

3. The `useQuery` implementation would re-fire as `variables` change.

4. Something like `useLazyQuery` would work, which is similar to how `useMutation` currently behaves: https://www.apollographql.com/docs/react/api/react-hooks/#uselazyquery
## Comment

---------------

Author: @ajhool

According to the docs, the amplify api client is a lightweight alternative to apollo. Out of curiosity, in what way is this api client a lightweight alternative? It appears to have less features (apollo has ssr, hooks, caching, multiple languages, good documentation, etc.), has a much larger dependency footprint (gigantic), and doesn't offer codegen for custom queries/mutations. Configuration might be 10 LOC quicker.

Amplify feels overextended and my sincere RFC feedback for adding api hooks is to just add a page of documentation explaining how to point apollo at amplify's generated backend and drop support for this bespoke graphql client to focus on the more novel components of the amplify client
## Comment

---------------

Author: @ericclemmons

@ajhool Thanks for your feedback! Your concerns are totally valid: Amplify covers a lot of ground (e.g. Analytics, API, Authentication, etc.), so over-extending and providing immature or unsupported APIs isn't an option.

The wording in the docs could be improved, but we offer Amplify as a "lightweight alternative" to the AWS SDK Client: 

> <p>The <a href="https://github.com/awslabs/aws-mobile-appsync-sdk-js/">AWS AppSync SDK</a> enables you to integrate your app with the AWS AppSync service and integrates with the Apollo client found <a href="https://github.com/apollographql/apollo-client/">here</a>. The SDK supports multiple authorization models, handles subscription handshake protocols for real-time updates to data, and has built-in capabilities for offline support that makes it easy to integrate into your app.</p>
>
> <p>The Amplify GraphQL client is a lighter weight option if you’re looking for a simple way to leverage GraphQL features and do not need the offline capabilities or caching of the Apollo client. If you need those features, choose the AWS AppSync SDK.</p>
– https://aws-amplify.github.io/docs/js/api#using-aws-appsync

The ideal result of the hooks RFC is identifying common use-cases from you and others have, then iron out that friction in the underlying, framework-agnostic APIs.

A good example of identifying use-cases is your suggestion here: https://github.com/aws-amplify/amplify-js/issues/4325

Keep up the feedback and examples! They're essential to prioritize our efforts & make your experiences better.


## Comment

---------------

Author: @ajhool

Thanks for the response. Two of the feature requests that I have open with Amplify are #4325 (the one you linked, a convenience function for making private files public) and #1910 (not mine, but I would have opened it if it wasn't already -- add cloudfront to the Storage module). Both of these use-cases are examples of where amplify is most useful for us; implementing common AWS-specific access patterns that Amplify is uniquely suited to make convenient for users. They make it easier for us to spend money on AWS infrastructure and add features to our own services.

The fact that the Storage module does not already have Cloudfront integration is precisely why it seems wasteful for the Amplify team to be reinventing/cloning-but-a-few-months-slower a graphql client. While the Storage module is not directly related to the API module, presumably time spent working on a Graphql API client is time not spent working on Storage or Auth or one of the more AWS-specific tools.

Pointing out a "good example" of a use-case that I've provided feels a littleee like it's dismissing my criticism here as being "not a good example." On the contrary, the feedback I'm trying to provide is that there is simply no use-case for me, an Amplify user, to use API hooks because we've already been using graphql hooks + ssr + cache + polling + other features for a few months via apollo-react.

> The wording in the docs could be improved, but we offer Amplify as a "lightweight alternative" to the AWS SDK Client: https://github.com/awslabs/aws-mobile-appsync-sdk-js/

It's still unclear what "llightweight alternative" means in that context. Smaller footprint? Less features? It looks like the Appsync team has the right idea; that client + apollo integration documentation is already perfect and everything else about the API module is a distraction from that implementation IMO. Might solve this issue, too: https://github.com/aws-amplify/amplify-js/issues/3365#issuecomment-502009495
## Comment

---------------

Author: @ericclemmons

That was my mistake.  Your feedback has been great!  What I didn't understand was if the hooks RFC was potentially redundant or conflicting with your needs.

And yes, your understanding of "lightweight alternative" is correct: smaller footprint, fewer features, fewer dependencies.

> there is simply no use-case for me, an Amplify user, to use API hooks because we've already been using graphql hooks + ssr + cache + polling + other features for a few months.
> ...
> It looks like the Appsync team has the right idea; that client + apollo integration documentation is already perfect and everything else about the API module is a distraction from that implementation IMO.

This is fantastic feedback! Thanks so much for your thoughtful responses @ajhool.
## Comment

---------------

Author: @jkeys-ecg-nmsu

>Pointing out a "good example" of a use-case that I've provided feels a littleee like it's dismissing my criticism here as being "not a good example." 

I tried to point out in a polite way that, unless I and most working React developers are missing something about lifecycles and useEffect, it was a proposed solution in search of a problem, and then got ignored. Feelsbadman. Maybe I need to be more direct when telling someone that I don't see the benefit of their proposed solution so that my criticism won't be similarly dismissed. @ericclemmons 

I'd much rather see Amplify developers spend their efforts locking the authorization rules down for the API category than make it mildly easier to actually use the Amplify API SDK, which as @ajhool points out is redundant in the ecosystem. 
## Comment

---------------

Author: @ajhool

@jkeys-ecg-nmsu The apollo hooks implementation provides a loading, data, and error return for the hooks, so you can write very clean code to handle the three main states (If you have 3 different queries or mutations in a component, then things can get ugly quickly with the old HOC code but it is very clean with hooks).

React hooks, themselves, are so nice that they do make these implementations somewhat trivial, but the graphql clients do add some useful functionality over your basic `useEffect` and I recommend trying them out or adding it to your code!

Under the hood, those hooks are basically doing what you've described with `useEffect` + some convenience parameters and caching (https://github.com/apollographql/react-apollo/blob/master/packages/hooks/src/utils/useBaseQuery.ts), but I do find the react-apollo implementation to be a breath of fresh air after the previous HOC components strategy (both amplify's and apollo's, before apollo added hooks).
## Comment

---------------

Author: @ericclemmons

Thanks everyone who's participated in this RFC, both here & on Twitter!

While we continue planning out our roadmap, I'd recommend anyone interested in hooks review the **Resources** in the original post body, which has existing, community-driven solutions for integrating Amplify within your existing React projects using hooks. 🙏



## Comment

---------------

Author: @jkeys-ecg-nmsu

@ajhool thanks for the advice, I'll take a look at it. FWIW I specifically don't want caching and server-side rendering is not an option. So I use the API sdk since it's already a dependency and meets our needs. It also does the sigv4 signing to be fair which does free up some developer resources.

I absolutely agree that the Amplify team should be coding for the common Amazon use case -- if Azure or GCP want to leverage Amplify, they can submit pull requests and build plugins to implement boilerplate logic for their common use cases. I appreciate the provider-agnostic design, but when it comes to the actual Amplify SDK I want it to solve AWS problems first. 

Maybe one feature request that branches from this conversation is the Amplify team declaring itself _opinionated_ on things like **recommended** GraphQL clients, backend methods for querying AppSync* that don't require hacks to make Amplify work in a Lambda, etc. In general, any JS/TS software that is already popular in the ecosystem and solves a use case in a more robust manner than Amplify currently does or would, while still remaining _unopinionated_ on application architecture. Then compile the list of recommended software / packages into a RFC and see what the community thinks about it. @ericclemmons could you please consider this (or consider, considering?) this in your roadmap planning?

*It's a shame that the AppSync documentation is so focused on how to create the API that it doesn't even mention how to access it, nor provide an SDK to communicate with it from the backend. You're just given an endpoint and [trial-and-error](https://github.com/aws-amplify/amplify-js/issues/2231#issuecomment-447628455). So then you have developers turning to Amplify and asking questions about how to use Amplify from Lambda, how to import just the API category to keep Lambda size small, etc. When really those questions should already be documented by the service team. 

Even just a blurb on the AppSync page that describes how to use a client like `axios` would have probably prevented a lot of issues from being opened on this page.
## Comment

---------------

Author: @amcdnl

I'd curious why not just use apollo hooks? I setup my project using apollo and appysync client and it works great (except for the tremendous amount of effort it took to figure it out).

Here is my appsync setup:

```ts
import Amplify from 'aws-amplify';
import AWSAppSyncClient, { createAppSyncLink } from 'aws-appsync';
import { ApolloLink } from 'apollo-link';
import { AWS_CUSTOM_CONFIG } from '../../aws-custom-exports';
import { errorLink } from 'core/Apollo';
import { jsonLink } from 'core/Apollo';
import { getToken } from 'core/Auth';

Amplify.configure(AWS_CUSTOM_CONFIG);

const auth = {
  type: AWS_CUSTOM_CONFIG.aws_appsync_authenticationType as any,
  jwtToken: () => getToken()
};

export const appSyncClient = new AWSAppSyncClient(
  {
    url: AWS_CUSTOM_CONFIG.aws_appsync_graphqlEndpoint,
    disableOffline: true,
    region: AWS_CUSTOM_CONFIG.aws_appsync_region,
    auth,
    cacheOptions: {
      addTypename: false
    }
  },
  {
    link: ApolloLink.from([
      jsonLink,
      errorLink,
      createAppSyncLink({
        url: AWS_CUSTOM_CONFIG.aws_appsync_graphqlEndpoint,
        region: AWS_CUSTOM_CONFIG.aws_appsync_region,
        auth,
        complexObjectsCredentials: () => Amplify.Auth.currentCredentials()
      })
    ])
  }
);
```

I had to hack the rehydrate like this:

```ts
import { useEffect, useState } from 'react';
import { useApolloClient } from 'react-apollo';
import AWSAppSyncClient from 'aws-appsync';

export const Rehydrated = ({ children }) => {
  const client = useApolloClient();
  const [rehydrated, setState] = useState(false);

  useEffect(() => {
    if (client instanceof AWSAppSyncClient) {
      (async () => {
        await client.hydrated();
        setState(true);
      })();
    }
  }, [client]);

  return rehydrated ? children : null;
};
```

but now that is all working I can do my queries just like apollo, example:

```ts
export const ConnectionsContainer: FC<ConnectionsContainerProps> = props => {
  const { data, loading } = useQuery(CONNECTION_QUERY);

  const [deleteConnection] = useMutation(
    DELETE_CONNECTION_MUTATION,
    mutationOptions
  );
````

 and take advantage of the middlewares like error link:

```ts
import { onError } from 'apollo-link-error';

export const errorLink = onError(({ graphQLErrors, networkError }) => {
  if (graphQLErrors) {
    graphQLErrors.forEach(({ message, locations, path }) => {
      if (message === 'Valid authorization header not provided.') {
        window.location.replace('/login');
      }

      console.error(
        `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`
      );
    });
  }

  if (networkError) {
    console.error(`[Network error]: ${networkError}`);
  }
});
```
## Comment

---------------

Author: @ericclemmons

This RFC focused on simplifying existing usage patterns for the [Amplify's GraphQL API](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js) within the React community, while preventing common bugs (forgetting to `unsubscribe` to subscriptions, setting state  after unmounting, etc.).

Not all apps use `react-apollo`, but for those that do can re-use Apollo Client's hooks as you've done here!
## Comment

---------------

Author: @amcdnl

@ericclemmons - It would be awesome if we could improve the docs to talk about this and maybe show how to do it easier.
## Comment

---------------

Author: @mdegrees

@amcdnl, to @ericclemmons point, I went, for e.g,  the route of react-apollo but hit a wall with multi authentications. My app have guests and users. Switching between Cognito pool and API key was cumbersome + subscriptions didn't work: 
https://github.com/awslabs/aws-mobile-appsync-sdk-js/issues/562
## Comment

---------------

Author: @lenarmazitov

> I'd curious why not just use apollo hooks? I setup my project using apollo and appysync client and it works great (except for the tremendous amount of effort it took to figure it out).
> 
> Here is my appsync setup:
> 
> ```ts
> import Amplify from 'aws-amplify';
> import AWSAppSyncClient, { createAppSyncLink } from 'aws-appsync';
> import { ApolloLink } from 'apollo-link';
> import { AWS_CUSTOM_CONFIG } from '../../aws-custom-exports';
> import { errorLink } from 'core/Apollo';
> import { jsonLink } from 'core/Apollo';
> import { getToken } from 'core/Auth';
> 
> Amplify.configure(AWS_CUSTOM_CONFIG);
> 
> const auth = {
>   type: AWS_CUSTOM_CONFIG.aws_appsync_authenticationType as any,
>   jwtToken: () => getToken()
> };
> 
> export const appSyncClient = new AWSAppSyncClient(
>   {
>     url: AWS_CUSTOM_CONFIG.aws_appsync_graphqlEndpoint,
>     disableOffline: true,
>     region: AWS_CUSTOM_CONFIG.aws_appsync_region,
>     auth,
>     cacheOptions: {
>       addTypename: false
>     }
>   },
>   {
>     link: ApolloLink.from([
>       jsonLink,
>       errorLink,
>       createAppSyncLink({
>         url: AWS_CUSTOM_CONFIG.aws_appsync_graphqlEndpoint,
>         region: AWS_CUSTOM_CONFIG.aws_appsync_region,
>         auth,
>         complexObjectsCredentials: () => Amplify.Auth.currentCredentials()
>       })
>     ])
>   }
> );
> ```
> 
> I had to hack the rehydrate like this:
> 
> ```ts
> import { useEffect, useState } from 'react';
> import { useApolloClient } from 'react-apollo';
> import AWSAppSyncClient from 'aws-appsync';
> 
> export const Rehydrated = ({ children }) => {
>   const client = useApolloClient();
>   const [rehydrated, setState] = useState(false);
> 
>   useEffect(() => {
>     if (client instanceof AWSAppSyncClient) {
>       (async () => {
>         await client.hydrated();
>         setState(true);
>       })();
>     }
>   }, [client]);
> 
>   return rehydrated ? children : null;
> };
> ```
> 
> but now that is all working I can do my queries just like apollo, example:
> 
> ```ts
> export const ConnectionsContainer: FC<ConnectionsContainerProps> = props => {
>   const { data, loading } = useQuery(CONNECTION_QUERY);
> 
>   const [deleteConnection] = useMutation(
>     DELETE_CONNECTION_MUTATION,
>     mutationOptions
>   );
> ```
> 
> and take advantage of the middlewares like error link:
> 
> ```ts
> import { onError } from 'apollo-link-error';
> 
> export const errorLink = onError(({ graphQLErrors, networkError }) => {
>   if (graphQLErrors) {
>     graphQLErrors.forEach(({ message, locations, path }) => {
>       if (message === 'Valid authorization header not provided.') {
>         window.location.replace('/login');
>       }
> 
>       console.error(
>         `[GraphQL error]: Message: ${message}, Location: ${locations}, Path: ${path}`
>       );
>     });
>   }
> 
>   if (networkError) {
>     console.error(`[Network error]: ${networkError}`);
>   }
> });
> ```

Thanks @amcdnl this works. 
But also there is need to add resolutions to package.json
```
  "resolutions": {
    "apollo-client": "2.6.8"
  }
```

Because AppSync uses apollo-client@2.4.6 which causes error see https://github.com/apollographql/react-apollo/issues/3148
## Comment

---------------

Author: @amcdnl

@lenarmazitov I ended up changing the setup to this:

```
    "apollo-cache-inmemory": "^1.6.6",
    "apollo-client": "^2.6.10",
    "apollo-link": "^1.2.14",
    "apollo-link-error": "^1.1.13",
    "apollo-link-http": "^1.5.17",
    "apollo-link-ws": "^1.0.20",
    "aws-amplify": "^3.0.13",
    "aws-appsync-auth-link": "^2.0.2",
    "aws-appsync-subscription-link": "^2.1.0",
```

and 

```ts
import Amplify from 'aws-amplify';
import { ApolloLink } from 'apollo-link';
import { AWS_CUSTOM_CONFIG } from '../../aws-custom-exports';
import { errorLink } from 'core/Apollo';
import { jsonLink } from 'core/Apollo';
import { getToken } from 'core/Auth';
import { createAuthLink } from 'aws-appsync-auth-link';
import { createSubscriptionHandshakeLink } from 'aws-appsync-subscription-link';
import ApolloClient from 'apollo-client';
import { InMemoryCache } from 'apollo-cache-inmemory';
import { createHttpLink } from 'apollo-link-http';

Amplify.configure(AWS_CUSTOM_CONFIG);

const auth = {
  type: AWS_CUSTOM_CONFIG.aws_appsync_authenticationType as any,
  jwtToken: () => getToken()
};

const config = {
  url: AWS_CUSTOM_CONFIG.aws_appsync_graphqlEndpoint,
  region: AWS_CUSTOM_CONFIG.aws_appsync_region,
  auth,
  disableOffline: true
};

const cache = new InMemoryCache({ addTypename: false });
const httpLink = createHttpLink({ uri: config.url });

const link = ApolloLink.from([
  errorLink,
  jsonLink,
  createAuthLink(config),
  createSubscriptionHandshakeLink(config, httpLink)
]);

export const client = new ApolloClient({
  link,
  cache
});
```

to prevent the resolutions issue and just make things more simple.
## Comment

---------------

Author: @lenarmazitov

@amcdnl why are you refused **createAppSyncLink**?
## Comment

---------------

Author: @amcdnl

@lenarmazitov - See: https://github.com/awslabs/aws-mobile-appsync-sdk-js#using-authorization-and-subscription-links-with-apollo-client-no-offline-support
## Comment

---------------

Author: @lenarmazitov

@amcdnl I tested both configs you provided
 - the first one with **createAppSyncLink** and **AppSyncClient**.
 - the second one with ApolloClient.

AppSyncClient works fine, I did not notice some troubles so far.
ApolloClient: There is one problem with it, I lost ability to upload files via GraphQL like described [here](https://docs.amplify.aws/cli/graphql-transformer/storage) (of course it can uploaded manually with Storage module)

Did you have some troubles with AppSyncClient or why are you decided to use ApolloClient instead?

## Comment

---------------

Author: @ChrisSargent

I think I am echoing most of the comments here when I say that, since I am already quite confused with a number of amplify vs appsync vs @aws-amplify vs aws-amplify imports vs AWS CDK etc etc.., I would prefer to use a defacto GraphQL client with an already established community and documentation (such as Apollo Client), and for the AWS team to document how to integrate it with the a GraphQL API built using Amplify. At the moment it feels like there is quite a lot of magic going on behind the scenes, which isn't always documented - great for going through tutorials and for when things 'just work' - but incredibly difficult to debug in the other 95% of usage.

And just to say that I do, so far, love using Amplify and to encourage keeping up the good work! :-)
## Comment

---------------

Author: @carlosvega20

Other way to achieve something similar with small footprint.

**Query:**
```javascript
import { API, graphqlOperation } from 'aws-amplify'
import { listSomething } from 'graphql/query'
import {useAsync} from 'react-use'


const Demo = () => {
  const {loading, error, value} = useAsync(async () =>
    API.graphql(graphqlOperation(listSomething)) //await client.query({query: gql(listSomething)})
  , [])

  return (
    <div>
      {loading
        ? <div>Loading...</div>
        : error
          ? <div>Error: {error.message}</div>
          : <div>Value: {JSON.stringify(value)}</div>
      }
    </div>
  )
}

```

**Mutation:**
```javascript
import { API, graphqlOperation } from 'aws-amplify'
import { createSomething } from 'graphql/mutations'
import {useAsyncFn} from 'react-use'


const Demo = () => {
  const [{loading, error, value}, mutateFn] = useAsyncFn(async (method, variables) =>
    API.graphql(graphqlOperation(method, variables)) //await client.mutate({mutation: gql(method), variables})
  , [])

  return (
    <div>
      {loading
        ? <div>Loading...</div>
        : error
          ? <div>Error: {error.message}</div>
          : <div>Value: {JSON.stringify(value)}</div>
      }
      <button onClick={() => mutateFn(createSomething, {input: {a: 10} })}>Create Something</button>
    </div>
  )
}

```


## Comment

---------------

Author: @danigb

Following @carlosvega20 suggestion, this is the same with [react-query](https://github.com/tannerlinsley/react-query) (adds cache and other goodies) 

Example in typescript👇

#### Query

```ts
import { API, graphqlOperation } from 'aws-amplify'
import { useQuery } from "react-query";
// those are generated by Amplify
import { GetPostQuery } from "../API";
import { getPost } from "../graphql/queries";

const { data: post, isLoading, refetch } = useQuery(
  ["post", { id: params.id }],
  async (_, { id }) => {
    const result: any = await API.graphql(graphqlOperation(getPost, { id }));
    return result.data as GetPostQuery;
  }
);
```

#### Mutation

```ts
import { API, graphqlOperation } from 'aws-amplify'
import { useMutation } from "react-query";
// those are generated by Amplify
import { DeletePostMutationVariables } from "../API";
import { deletePost } from "../graphql/mutations";

const [deleteGalleryMutation, { isLoading: isDeleting }] = useMutation(
  async (variables: DeletePostMutationVariables) =>
    await API.graphql(graphqlOperation(deletePost, variables))
);
```
## Comment

---------------

Author: @amcdnl

Each of these approaches have some downsides, for instance:

- `useAsyncFn` doesn't have caching, de-duplication, error handling, auth handling, sockets
- `useQuery` is great but doesn't have the native de-duplication / caching that apollo has. It also doesn't have the subscriptions natively either.
## Comment

---------------

Author: @github-actions

This issue has been automatically locked since there hasn't been any recent activity after it was closed. Please open a [new issue](https://github.com/aws-amplify/amplify-js/issues/new?assignees=&labels=&template=1.bug_report.yaml) for related bugs.

Looking for a help forum? We recommend joining the [Amplify Community Discord server](https://discord.com/invite/amplify) `*-help` channels or [Discussions](https://github.com/aws-amplify/amplify-js/discussions) for those types of questions.

---------------

---------------

# Invoke lambda functiona AccessDenied

---------------

Author: @safwanolaimat
Upvotes: 1
Comments: 1

Hello i have created function using amplify add function

when i call it i recieved 
```
AccessDenied
User: arn:aws:sts::*****:assumed-role/amplify-projectname-22816-authRole/CognitoIdentityCredentials is not authorized to perform: lambda:InvokeFunction on resource: arn:aws:lambda:us-east-1:******:function:test
```
code:
```
Auth.currentCredentials().then((credentials) => {
      console.log(Auth.essentialCredentials(credentials));
      const lambda = new Lambda({
        credentials: Auth.essentialCredentials(credentials),
        region: "us-east-1",
      });
      lambda.invoke(
        {
          FunctionName: "test",
          Payload: JSON.stringify({ name: file.name }),
        },
        function (err, data) {
          if (err) {
            console.log(err);
            return;
          }
          console.log(data);
        }
      );
    });
```
## Comment

---------------

Author: @david-mcafee

Hi @safwanolaimat - can you explain a little more about your use case, and what you're trying to accomplish with the lambda function? We have several guides in our docs, with code samples, that may help you address your specific usecase. https://docs.amplify.aws/

---------------

---------------

# aws s3/ cannot see my images in my app

---------------

Author: @BeagleTechno
Upvotes: 1
Comments: 1

Hi, I have aws s3 provisioned to my app. I can upload and delete files to my bucket, but I cannot see them on the app (method GET returns an error?). Ideas?
Bucket policies, IAM permissions seem to be fine.
## Comment

---------------

Author: @david-mcafee

@BeagleTechno what error are you receiving? Have you tried the following?

```js
async function fetchFiles() {
    try {
      const result = await Storage.list("");
      setFiles(result);
    } catch (error) {
      console.log("error fetching files", error);
    }
  }
```

---------------

---------------

# Additional MFA Security Features

---------------

Author: @atzawada
Upvotes: 1
Comments: 0

Along the lines of #804, are there any plans to implement more stringent security policies around MFA, as well as the ability to appropriately recover MFA for users who have lost their devices? these seem like standard features that Cognito lacks, seriously affecting the security and usability of Cognito with MFA devices.

Currently if you have TOTP MFA set up, you can both reset your password and disable MFA without having to input a TOTP code, which both seem like serious security flaws.

Along the same lines, it would be great to allow some kind of recovery method for accounts with MFA enabled when the MFA device has been lost. Potentially something like storable recovery codes would be a good option to have.

Thanks!

---------------

---------------

# [Auth] How to prompt the user for MFA or password when doing actions in frontend after sign in

---------------

Author: @joelzwarrington
Upvotes: 2
Comments: 1

Hello,

I hope someone would be able to help clarify how one could prompt the user for their password or for their MFA TOTP once they've already signed in.

I would like to be able to start an authentication flow when doing high-risk actions which require verification. I can't seem to find anything about this on Cognito or Amplify side of things.

Would either of you know @chrisbonifacio & @david-mcafee ?
## Comment

---------------

Author: @ashika01

@joelwarrington-jobber You are asking for already signed in user with password or TOTP to reverify their password again for an action?

If it is part of authentication lifecycle, you could use lambda triggers, there are different parts here
Cognito- https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html
Amplify support - https://docs.amplify.aws/cli/usage/lambda-triggers/

If it is not part of auth cycle, just another extra signin introduced. You could use `Auth.confirmSignIn` and confirm sign in again and block the rest of the action based on the success or failure. 

https://docs.amplify.aws/lib/auth/mfa/q/platform/js/#advanced-use-cases

Let us know if it answers your question

---------------

---------------

# Build environment between branches

---------------

Author: @rosscturner
Upvotes: 1
Comments: 0

I'm hoping this is a simple question but I can't find a good answer anywhere. 

I have a master branch which was bootstrapped with create react app. This has been working and deploying fine for months. 

I've recently decided to port the project to Next JS which I was developing on a separate branch. This has been building fine with SSR pages working correctly. 

However, since I started on this I can no longer deploy to my master branch retaining my original setup. It fails at the deploy stage as if it's trying to build a NEXT app. I have a seperate amplify.yml in each of my branches but this makes no difference. I need to continue using the original CRA app while I finish the NEXT migration, how do I do this? Do I need to create a new APP? If so how do I reset my environment to roll back to my original config. 

Thanks!

Error I'm getting at the deploy stage:

2021-11-08T12:35:02 [INFO]: Beginning deployment for application ************, branch:master,  buildId master
2021-11-08T12:35:02 [INFO]: Cannot find any generated SSR resources to deploy. If you intend for your app to be SSR, please check your app Service Role permissions. Otherwise, please check out our docs on how to setup your app to be detected as SSG (https://docs.aws.amazon.com/amplify/latest/userguide/server-side-rendering-amplify.html#deploy-nextjs-app)
2021-11-08T12:35:02 [ERROR]: {"code":"7","message":"No ssrResources.json file"}


---------------

---------------

# AWS Amplify + Prisma ("ENOENT: no such file or directory, open '/var/task/chunks/schema.prisma'")

---------------

Author: @bojidaryovchev
Upvotes: 6
Comments: 0

Hello, so I followed this tutorial [AWS Amplify Next.js SSR](https://docs.amplify.aws/guides/hosting/nextjs/q/platform/js/) and deployed a Next.js app to AWS using Amplify. I added Prisma and it works fine locally, however I am getting this error in the deployed lambda function:

![prisma](https://user-images.githubusercontent.com/8954749/140654898-1f991fa4-3394-4b04-99e8-c70417bc1f04.png)

this is how the deployed lambda function looks like:

![image](https://user-images.githubusercontent.com/8954749/140654943-acfb1b65-10cc-4295-9a7b-14955e4c29ac.png)

apparently the ```LibraryEngine``` tries to look for ```schema.prisma``` in the ```chunks``` folder but I have no idea how to copy it there.. so I am unable to figure out what should I do to make it work sadly..

I'd greatly appreciate it if you could help me out




---------------

---------------

# GQL Mutations only seems to work once

---------------

Author: @thathurtabit
Upvotes: 1
Comments: 2

This is likely a n00b question, but I have a GQL Mutation which works (and updates the values in the datastore), but if I change the mutation values and run it again, nothing changes. Could this be down to cacheing?

```
mutation MyMutation($input: UpdateShowdownInput!) {
  updateShowdown(input: $input) {
    id
    name
    ...
  }
}

Mutation 1:
{
  "input": {
    "id": "xxxxx",
    "name": "updated name"
  }
}

```

RETURN: `name` is now  "updated name"

```
Mutation 2:
{
  "input": {
    "id": "xxxxx",
    "name": "please change again"
  }
}
```
RETURN: `name` is _still_ "updated name"
## Comment

---------------

Author: @thathurtabit

It seems to answer to this is to make sure the current `_version` value is present in the mutation input values, i.e.

```
mutation MyMutation($input: UpdateShowdownInput!) {
  updateShowdown(input: $input) {
    id
    name
    _version
    ...
  }
}

Mutation 1:
{
  "input": {
    "id": "xxxxx",
    "name": "updated name",
    "_version": "my_current_version"
  }
}
```

Amplify GQL must be using the `_version` value to track changes, if it isn't present, the mutation seems to get ignored (or won't be processed). Hat tip to this comment: https://github.com/aws-amplify/amplify-cli/issues/3237#issuecomment-619359322
## Comment

---------------

Author: @thathurtabit

There's also this solution which other people have tried, though I have just kept the above: https://github.com/aws-amplify/amplify-cli/issues/3796#issuecomment-607519187

---------------

---------------

# Import from multiple schema.graphql

---------------

Author: @leonardocfor
Upvotes: 1
Comments: 0

Hi guys,

I'm wondering if it is possible to split a very complex schema.graphql file in multiple .grapql files and importing some how in schema.graphql. I've been googling around and having found something clear enough. If this is actually possible could you please point to the corresponding documentation or ideally an example? 

thank you,

---------------

---------------

# DataStore blocked by firewall

---------------

Author: @phaedonmit
Upvotes: 1
Comments: 0

I am using DataStore to set up a database for our application. When a user logs in all the requests/updates to the database work as expected. However, when the user is logging in from a device that is behind a corporate firewall, they can log in but the database does not get downloaded and synced.

---------------

---------------

# Is there IN operator?

---------------

Author: @sergeyjsg
Upvotes: 1
Comments: 1

Is there IN operator in Amplify Datastore? How to use it?
## Comment

---------------

Author: @ashika01

If you are asking for that in the predicates, these are the supported one at the moment

https://docs.amplify.aws/lib/datastore/data-access/q/platform/js/#predicates

---------------

---------------

# Build sveltekit adapter

---------------

Author: @24jr
Upvotes: 1
Comments: 1

For sveltekit I'm at a point I would like to publish an aws amplify site and the build fails.  I need to use something called an adapter to build the app before that and I found https://github.com/sveltejs/kit/tree/master/packages/adapter-node seems to be what I should use however `npm run build` fails from aws problems like `> 'request' is not exported by __vite-browser-external, imported by node_modules/@aws-sdk/credential-provider-imds/dist/es/remoteProvider/httpRequest.js`  will this not work with aws or i just need to do something differently
## Comment

---------------

Author: @24jr

actually this is covered here and seems to be ongoing but perhaps being worked on issue https://github.com/aws/aws-sdk-js/issues/3673

---------------

---------------

# How to position sign in screen

---------------

Author: @jasper72
Upvotes: 1
Comments: 1

I'm migrating my app to the new framework. Previously the signing screen centred itself. Now it squashes into the top left corner.

I've tried wrapping it in a div to add margin but then my app has the margin as well.

What is the best approach for recovering the previous behaviour?
![squashed](https://user-images.githubusercontent.com/939156/81696950-82c3e600-945c-11ea-8e58-9a278ada8e56.png)
## Comment

---------------

Author: @david-mcafee

@jasper72 - please see [this guide](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react/#props-css-amplify-authenticator), and let me know if you need further help!

---------------

---------------

# How to configure AWS IoT PubSub Timeout?

---------------

Author: @Jun711
Upvotes: 1
Comments: 1

Hi, I followed this [documentation](https://docs.amplify.aws/lib/pubsub/getting-started/q/platform/js/) to set up PubSub. It seems to work fine for now.

Questions
1) what is the max connection timeout is?  I can't find it in the documentation / aws console.
2) Is it configurable? 

## Comment

---------------

Author: @ashika01

@Jun711 to answer your question the best, can you provide more info on what provider you are using? and why are you interested in the maxTimeout? What is your use case?

---------------

---------------

# 36 vulnerabilities after npm install

---------------

Author: @slimandslam
Upvotes: 6
Comments: 3

After I did an "npm install aws-amplify --save", npm now reports "36 low severity vulnerabilities".
Is this a known problem? I can't see what's causing it. The audit results seem unclear as to the origin of the issues. Here's my package.json:

```
{
  "name": "MYapp",
  "version": "0.4.0",
  "private": true,
  "dependencies": {
    "aws-amplify": "^3.3.14",
    "react": "^17.0.1"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```
## Comment

---------------

Author: @alditis

I have the same problem. 
Any suggestions please?
## Comment

---------------

Author: @david-mcafee

Related issue: https://github.com/aws-amplify/amplify-js/issues/7583
## Comment

---------------

Author: @sammartinez

Since this is related to the issue customers brought up, we will be tracking the progress there. 

---------------

---------------

# Async Lambda Resolver in GraphQL API

---------------

Author: @rohit8
Upvotes: 3
Comments: 1

Hi,
Is there any way to use the `@function` directive to create a GQL API resolver that executes a lambda function asynchronously in the background and returns an immediate response? Specifically execute a lambda function similar to this way: https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-integration-async.html
## Comment

---------------

Author: @eugen-maser

> Hi, Is there any way to use the `@function` directive to create a GQL API resolver that executes a lambda function asynchronously in the background and returns an immediate response? Specifically execute a lambda function similar to this way: https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-integration-async.html

Hi @rohit8 
Did you find a solution for that case?

---------------

---------------

# Update DataStore item using AWS-SDK DynamoDBClient

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

I am using DataStore and would like some advice with the following:

Can I update a DynamoDB item by directly accessing the DynamoDB item in the table using the AWS-SDK DynamoDBClient?

I have set the DataStore configuration for maxRecordsToSync to 100 items however, I would like to be able to retrieve and update items that are not synced to the local database.

I am aware that the _version, updatedAt and _lastChangedAt fields probably need to be altered if/when updating the item using the DynamoDBClient

So can I update the item like this or is there a better way of doing it?

Thanks

---------------

---------------

# Help with imgprops in AmplifyS3Image

---------------

Author: @coe720
Upvotes: 1
Comments: 1

Hi! I'm working with AmplifyS3Image from @aws-amplify/ui-react and I'm a bit confused on what the "imgProps" prop is expecting. I'm just trying to set the width of the image to 100% and I've tried both 
`<AmplifyS3Image
     imgKey={key}
     imgProps={{"width": "100%"}}
 />`

As well as:

`<AmplifyS3Image
     imgKey={key}
     imgProps={{"--width": "100%"}}
 />`

Neither of which are setting the width of the underlying img component.
## Comment

---------------

Author: @david-mcafee

Hey @coe720, thanks for starting this discussion! 

[Here's the documentation on the component / imgProps](https://docs.amplify.aws/ui/storage/s3-image/q/framework/react/#props-attr-amplify-s3-image). There's a link to MDN that further explains how to use the attributes.

Instead of passing the css properties as a prop, you can set the css of the component as explained under `Custom CSS Properties` in the docs linked above. Example: 

```js
amplify-s3-image {
  --width: 400px;
}
```

Hope this helps!

---------------

---------------

# What is the recommended way to call AppSync GraphQL endpoint from a function

---------------

Author: @cgorrieri
Upvotes: 1
Comments: 1

Hello,

I am building an app where I need to run a few checks before letting a user add an entity for example.
To do so, I added a function triggered by a qraphql query that will pull data from the graphql api and do the checks before running the mutation to add the entity.

Looking at the online resources, I found so many different ways to call the graphql endpoint that I am not sure which one is the recommended way. I see multiple options in the official docs https://docs.amplify.aws/cli/function (with axios and https), and I have seen others resources using the AWSAppSyncClient or fetch. Also, I see in the documentation the use of IAM or API key for the function.

**Which client solution is the most recommended to implement and what kind of auth do you use for your functions?**

Thank you for your help.
Cheers,
Cyril
## Comment

---------------

Author: @jesuscovam

Hey I wanted to know if you reached a conclusion about this??

I'm using axios because I want the same function to work on nodejs | web | React native.
Maybe the API that comes from 'aws-amplify' package works in those 3 but I'm not sure.
And from that I'm only doing requests that are signed with the API KEY, because I don't know
how to do it with COGNITO user pols ore IAM with axios...

but it goes like this 

```
 const result = await axios({
      url: config?.endpoint || process.env.API_SLISSTO_GRAPHQLAPIENDPOINTOUTPUT,
      method: 'post',
      headers: {
        'x-api-key':
          config?.apiKey || process.env.API_SLISSTO_GRAPHQLAPIKEYOUTPUT,
      },
      data: {
        query,
        variables,
      },
    })
```

---------------

---------------

# Debugging and Tracing Amplify.PubSub

---------------

Author: @slynn100
Upvotes: 1
Comments: 1

- 
- 
- Hi Team,
- 
- i've gone trhoug the pubsub guide at 
- https://docs.amplify.aws/lib/pubsub/getting-started/q/platform/js/
- 
- 
- 
- -------------------------
- For now, I've given full permissions on the Policy:
- {
- "Version": "2012-10-17",
- "Statement": [
- {
- "Effect": "Allow",
- "Action": "iot:",
- "Resource": ""
- }
- ]
- }
- -------------------------
- 
- In my code , i have the following:
- 
- 
- =========
-   await PubSub.subscribe('test/SOMETHING_CHANGED').subscribe({
-               next: data => console.log('Message received', data),
-               error: error => console.error('ERROR  !')              
-             });
-             await PubSub.publish('test/SOMETHING_CHANGED', { msg: 'Hello Testing!' });
- =========
- 
- The pubsub statement appears to succeed. (Code execution continues and no error message generated.)
- 
- However nothing arrives on the topic on AWS. Have checked the CloudWatch logs - nothing is visible there with regard to mqtt messages 
- 
- 
- ( I've hada successful Storage.put call with a file arriving on s3 -i believe
- all is ok with the cognito user... https://docs.amplify.aws/lib/storage/getting-started/q/platform/js/   ) 
-  
- 
- 
- Please can you give me some pointers on how to retrieve some  error/tracing information on the PubSub issue.
- 
- 
- 
- Thanks
- 
- Stephen
## Comment

---------------

Author: @slynn100

Issue appears to be due to conflicting versions of amplify

---------------

---------------

# Is it possible to use Datastore subscriptions to execute a function when a specified field was changed?

---------------

Author: @Jack-Huskinson
Upvotes: 1
Comments: 0

In my project I am wanting to run a function when a certain field of a data model is changed/updated.

This is the subscription I have made currently and it returns when the data is updated, but it does this when any of the fields change.
> useEffect(() => {
    const subscriptions = wishList.map(wlp =>
      DataStore.observe(Product, wlp.productID).subscribe(msg => {
        if (msg.opType === 'UPDATE') {
          console.log('Made an update to Product');
        }
      }),
    );
    return () => {
      subscriptions.forEach(sub => sub.unsubscribe());
    };
  }, [wishList]);

I have looked around through the docs and cant seem to find anything but I was wondering if there was a way to only have it returned if a certain field was changed.

If it is not possible with Datastore then any other method to do this is appreciated.

---------------

---------------

# How client to do Graphql subcription with a provided token

---------------

Author: @hoan-pham-duy
Upvotes: 1
Comments: 0

Hi everyone, 
Currently, I get a problem when designing a system that client needs to watch real-time graph from Amplify Backend with a provided token (client didn't log in with AWS Cognito)
Here are the steps I want:
Step 1: Client requires to subscribe data of graph with a provided token.
Step 2: Backend checks the token is legit or not and accepts the connection.
Step 3: Any modified data in backend data will be notified to the client
Step 4: The client will upload the graph.

Currently, my design is client sends REST APIs each period to get data with provided token and the backend must check provided token each period. 
It had disadvantages because the client always send requests to the back-end.
I try to make the client do GraphQL subscription data from the backend with provided token but can't think any solution can handle it.

Hope so much for your suggestion!
Thank you so much for your help!

---------------

---------------

# Geo: calculate route

---------------

Author: @maxludovicohofer
Upvotes: 2
Comments: 0

Is it possible to leverage the new Geo functionality to calculate distance\route (time) between two points on a map? Since this is an Amazon Location Service feature (https://docs.aws.amazon.com/location/latest/developerguide/calculate-route.html), I would love to have it also with Amplify.

---------------

---------------

# Web notification support

---------------

Author: @anjali89r
Upvotes: 1
Comments: 0

Hi, 
I'm trying to implement web notification on our application. We use amplify and Cognito for the authentication and is interested to know if Amplify support web push notification. I do see in the documentation where it talks about service workers, but my question can AWS pinpoint be used as a web notification provider or the notification is only supported for mobile apps.
Doc referred:
https://docs.amplify.aws/lib/utilities/serviceworker/

---------------

---------------

# Auth.signOut opens Expo web browser (React Native)

---------------

Author: @bronz3son
Upvotes: 1
Comments: 0

Hello, I am trying to get Federated sign in to work with my Expo project (React Native).

I was looking at this issue https://github.com/aws-amplify/amplify-js/issues/7213 (I have the same issue but that's not the point of this question), and I see that the expected flow is to open the web browser on sign out. 
 
For me, my sign out button works and correctly signs the user out, but then tries to open the web browser again. I don't see why it needs to do this, and I see in other apps, this doesn't happen.
Is there some way to not open the web browser on sign out? 

---------------

---------------

# Does Amplify currently support authorization code grant workflow + hosted UI ?

---------------

Author: @jhw
Upvotes: 4
Comments: 1

I'm looking to implement the Cognito authorization code grant workflow with the Cognito hosted UI, using Amplify.

There's a good example here

https://github.com/arronharden/cognito-demo-ui

which uses the npm `amazon-cognito-auth-js` package and specifically a method called `CognitoAuth.parseCognitoWebResponse` to exchange the `code` value returned by the hosted UI for (JWT) `id/access/refresh_tokens`.

Now this works fine but I'm a bit concerned about using `amazon-cognito-auth-js` as it seems to have been archived / made read only / generally end-of-life'd / assimulated into the Amplify borg lol :-)

https://github.com/amazon-archives/amazon-cognito-auth-js

But browsing the Amplify Auth code

https://github.com/aws-amplify/amplify-js/blob/main/packages/auth/src/Auth.ts

I can't find anything which calls `/oauth2/token` (which `CognitoAuth.parseCognitoWebResponse` does under the hood)

Does Amplify currently support authorization code grant workflow + hosted UI, or not ? And if so, which methods should I be looking at ?
## Comment

---------------

Author: @ume-benard

Also curious about this.

---------------

---------------

# "You may only supply one @key": why that ?

---------------

Author: @philohelp
Upvotes: 1
Comments: 0

Sorry if the question has already been asked but I got `InvalidDirectiveError: You may only supply one @key with the name 'byProfile' on type 'Article'` 

I used to do that in my former graphql schema and it was handy:

For ex. a Facebook post is reposted by a user. It has an owner (the one who shares the post) and an original author (the one who wrote it in the first place). I'd wish I could do something like:

````
{
title: "FW: Cats are evil",
content: "Let me explain why",
author:"joe_Who_Doesnt_Like_Cats_Id",
owner:"bernard_Who_Shares_The_Post_Id
}
````

---------------

---------------

# How can I limit an email that has only one cognito user associated with it?

---------------

Author: @T-DiegoF
Upvotes: 0
Comments: 0

Currently, by default, cognito allows creating several users with the same email and I would like to have a relationship of one to one, email-user.

---------------

---------------

# Implementing a sharing functionality (authorization)

---------------

Author: @cfbo
Upvotes: 1
Comments: 1

Does anyone have some feedback on how to implement a **sharing functionality** and how to do this using Amplify with Datastore / AppSync.

Basically we need to implement a feature where a user can share an item they have created with other users. 

I have read https://docs.aws.amazon.com/appsync/latest/devguide/security-authorization-use-cases.html, but I was wondering if I could implement something similar using @auth as presented below.

I have written an example of a possible approach with fake types. It would be great to get some inputs on it or have someone share their approach to this problem.
```
type Item
  @model
  @auth(
    rules: [
      { allow: owner, operations: [create, update, delete, read] }
    ]
  ) {
  id: ID!
  title: String!
  owner: String
  description: String
}

type SharedItem
  @model
  @auth(
    rules: [
      { allow: owner, operations: [create, update, delete, read] }
      {
        allow: owner
        ownerField: "sharedWithEmailReadOnly"
        identityClaim: "email"
        operations: [read]
      }
      {
        allow: owner
        ownerField: "sharedWithEmailReadWrite"
        identityClaim: "email"
        operations: [update, read]
      }
    ]
  ) {
  id: ID!
  itemId: ID!
  item: Item @connection(fields: ["itemId"])
  owner: String
  sharedWithEmailReadOnly: String
  sharedWithEmailReadWrite: String
  sharedAt: AWSDateTime!
}
```

As a start we were actually thinking of implementing just an option to share via a link, and that would be "view only".. but how can I model this case in graphql?
The Item is only accessible to the owner. I guess I could use the SharedItem, but how can I modify it to handle the "anyone" case, which means I don't have an email to add?
I guess I could create another type SharedWithAnyoneItem
```
type SharedWithAnyoneItem
  @model
  @auth(
    rules: [
      { allow: private, operations: [read] }
      { allow: owner, operations: [create, update, delete, read] }
    ]
  ) {
  id: ID!
  itemId: ID!
  item: Item @connection(fields: ["itemId"])
  owner: String
  sharedAt: AWSDateTime!
}
```
Does it makes sense? Would that work?

My stack: React / Amplify with Datastore / API AppSync, Cognito, etc.
## Comment

---------------

Author: @evcodes

Check out @renegoretzka Gist: https://gist.github.com/renegoretzka/9ed754c4463b19c883ff8c98492ee5fe

---------------

---------------

# Add Item to DynamoDB Table and Propagate Change to AWS Amplify

---------------

Author: @man517
Upvotes: 1
Comments: 0

I have an AWS Amplify project that is using DataStore and I'm trying to add multiple items to a table. I've tried using DynamoDB and the put_item() method to add the items like this:
```
client = boto3.client('dynamodb')
response = client.put_item(
    Item={
        'AlbumTitle': {
            'S': 'Somewhat Famous',
        },
        'Artist': {
            'S': 'No One You Know',
        },
        'SongTitle': {
            'S': 'Call Me Today',
        },
    },
    ReturnConsumedCapacity='TOTAL',
    TableName='Music',
)
```
I'm able to successfully add items to my table in DynamoDB; however, the added items don't show up when looking at the table's items through Admin UI. Any tips?

---------------

---------------

# loads of lambda functions and don't know whats what

---------------

Author: @spormeon
Upvotes: 1
Comments: 0

I setup a few apps, then deleted a few apps, leaving the one that I'm working on but there are now loads of lambda functions and I have no clue which ones relate to the app thats still running , so as I can delete the others, there is no ref number or anything that relates to the running app.  Anyone help with this ( i've been asked to post here from the Amplify discord)
![Functions_-_Lambda](https://user-images.githubusercontent.com/8503167/137538641-e7b1ec0d-fd73-49e8-993a-d3f106bc6f7a.png)



---------------

---------------

# How to get authentication code grant from amplify signin

---------------

Author: @kchangch
Upvotes: 2
Comments: 0

Hi, Im trying to get the authorization code grant from amplify signin to use it for a SSO to a third platform page (no the social media ones from AWS docs). Is there a way to get this from amplify authenticator? It seems that the only way is using AWS Cognito Hosted UI.

Any help would be great.

---------------

---------------

# Does amplify require having public buckets for the deployment and the build?

---------------

Author: @MaxOrelus
Upvotes: 1
Comments: 0

Hi, 

When you set up amplify for a project, it creates an initial bucket containing:

- current-cloud-backend.zip
- amplify-meta.json
- hooks/
- nested-cloudformation-stack.yml

This bucket that contains this has "Block all public access" all turned off.

Also, when you successfully complete a build it creates an additional bucket with your deployed application. This bucket also has "Block all public access" all turned off with a policy that only allows cloudfront getObject permissions into the bucket.

For amplify to work correctly, does it need these buckets to be public or is there a strategy to actually have these buckets private?


---------------

---------------

# How to  set user attributes during sign up, with UI component <SignUp/> with react native

---------------

Author: @271915902
Upvotes: 1
Comments: 0

in react i can use  this to set attributes , but i do not know how to set in react native UI component


<AmplifySignUp
      handleSignUp={handleSignUp}
        />

 const handleSignUp = async (formData) => {
    try {
      console.log("handle");
      const param = {
        ...formData,
        attributes: {
          ...formData.attributes,
          "custom:phoneNumber": "111",
          "custom:notifications": "222",
        },
      };
      const data = await Auth.signUp(param);
      return data;
     } catch (error) {
       console.log(error)
     }

---------------

---------------

# Multiple IAM User roles

---------------

Author: @menkari
Upvotes: 1
Comments: 0

I've come across a situation where I'm using amplify with the following configuration: 

- There is an unauth section of the storefront using IAM as the provider to access data via AppSync.

This unauth section is capable of read-only access to a particular model. This is defined via the `schema.graphql` in my `~amplify/...` folder as

`{allow: public, operations: [read], provider: iam}`

However I also have a lambda trigger attached to dynamodb stream to interpret INSERT streams. This lambda function has the ability to update the model based on certain parameters. The problem is that the IAM user that makes the changes CANNOT update the model as the rules defined in the schema prohibit this.

I've reviewed my IAM configurations and there is indeed 2 separate IAM users - both with the correct permissions for accessing the particular types in AppSync, however no matter what the setup, the appsync schema has `@aws_iam` specified and seems to default to the permissions outlined in the `schema.graphql`

So here's my question: How do you facilitate unauthed permissions on say a frontend website, granting readonly permissions to IAM and also having IAM users on the backend to perform update/delete/create functions on the same AppSync types in lambda? They both use IAM but it seems you cannot specify specific IAM users for specific tasks.

---------------

---------------

# How do I access `region` with a `MapStyle`?

---------------

Author: @mojodna
Upvotes: 1
Comments: 0

`Geo.getDefaultMap()` returns a `MapStyle`, which does not include `region`. `AmazonLocationServiceMapStyle` extends `MapStyle` to introduce `region`, but the only way to get an `AmazonLocationServiceMapStyle` is via [`AmazonLocationServiceProvider`](https://github.com/aws-amplify/amplify-js/blob/e2788723edad3a798720982d6fba14e3f0e20e4a/packages/geo/src/Providers/AmazonLocationServiceProvider.ts), which must be constructed explicitly. Given the existence of the [`Geo` singleton](https://github.com/aws-amplify/amplify-js/blob/e2788723edad3a798720982d6fba14e3f0e20e4a/packages/geo/src/index.ts#L1), I would expect the preferred access model to be through that.

Furthermore, `AmazonLocationServiceProvider`'s constructor expects a [`GeoConfig`](https://github.com/aws-amplify/amplify-js/blob/e2788723edad3a798720982d6fba14e3f0e20e4a/packages/geo/src/types/Geo.ts#L14-L26), which [doesn't match the shape of the config created by `amplify add geo`](https://github.com/aws-amplify/amplify-cli/issues/8405).

Complicating things even more, `AmazonLocationServiceProvider` must be imported via `@aws-amplify/geo/lib/Providers/AmazonLocationServiceProvider`.

What is the recommended pattern for using Geo with Amazon Location?

---------------

---------------

# Translate variables in aws-amplify i18n

---------------

Author: @homosape
Upvotes: 1
Comments: 0

Hi, I've just started using i18n in my React Native app and everything seems to work just fine.

One question though, how would one translate variables using i18n:

Option 1:
<img width="620" alt="Screenshot 2021-10-08 at 13 25 48" src="https://user-images.githubusercontent.com/70649220/136532366-dd17096f-04fb-42e1-a1fe-e7199fe1b787.png">

Option 2:
<img width="656" alt="Screenshot 2021-10-08 at 13 26 57" src="https://user-images.githubusercontent.com/70649220/136532497-05b33188-e505-43c6-88ef-470130fe175f.png">

Which one is optimal way? 

Please note that reminder here is always a number.

Also, how to translate if reminder is not a number but dynamically generated text.

Example: if reminder = 10 generated text would be "10 is too short" or "10 is too much" etc.


---------------

---------------

# Auth.updateUserAttributes()  vuex mutation  error

---------------

Author: @ajay-wohlig
Upvotes: 1
Comments: 3

I am using aws amplify with vuex in nuxt. 
On calling Auth.updateUserAttributes() is giving me a successfull response but it's also gives me the,
[vuex] do not change vuex store state outside mutation handler, even though I am not doing any mutation


```
export default state = () =>({
user: {} 
//CognitoUser data
}) 

export default actions = {
async updateUserAttribute(_, data), {
var user = data.user
var params = data. params 
await Auth.updateUserAttributes(user, 
params )
} 
} 

```

This is not the exact same code I have written, 
But I think the problem lies with the aws amplify trying to manipulate the user state where  CognitoUser is saved 
## Comment

---------------

Author: @dacarva

I am having the same issue here. Can somebody give some light on this?
## Comment

---------------

Author: @khanguslee

Would also like to know how to solve this. Thanks in advance.
## Comment

---------------

Author: @abelant

I have the same issue with signOut() method

It throws a mutation error when I try to Sign Out.

Would like to know if there is some kind of solution .

---------------

---------------

# [api-graphql] would like to use private method in typescript.

---------------

Author: @ysuzuki19
Upvotes: 1
Comments: 0

`API.graphql()` is hard to use with typescript. Because return type is `Promise<GraphQLResult> | Observable<object>` ([link](https://github.com/aws-amplify/amplify-js/blob/bd528c7c2d65a7476bd8601d7f3f135d1a24fd53/packages/api-graphql/src/GraphQLAPI.ts#L220)). In this implementation, we must check type for using `then()`/`catch()`😭.
For use this method, 

So I would like to use two methods following.

[private async _graphql()](https://github.com/aws-amplify/amplify-js/blob/bd528c7c2d65a7476bd8601d7f3f135d1a24fd53/packages/api-graphql/src/GraphQLAPI.ts#L265)
[private _graphqlSubscribe()](https://github.com/aws-amplify/amplify-js/blob/bd528c7c2d65a7476bd8601d7f3f135d1a24fd53/packages/api-graphql/src/GraphQLAPI.ts#L367)

I think that by using these methdos, we can resolve  #6369 and #7589 cleary and easily.

How about this?

---------------

---------------

# Is it possible to use AWS amplify with Xamarin forms?

---------------

Author: @hpatel-vohra
Upvotes: 1
Comments: 0

Is it possible to use AWS amplify with Xamarin forms?

---------------

---------------

# how to prevent endpoint from update userid on app launch

---------------

Author: @suparerkk
Upvotes: 1
Comments: 0

I'm using react-native here, the situation is that every times you open. the app, amplify will update my endpoint userid to cognito identity and my push notification will stop working at that moment until i update it again with my userid

and here the issue is that user can close my app and my update endpoint userid function will not gonna fire, result in user will not receive any notification.

so the question is can i prevent the auto update endpoint ?

---------------

---------------

# Amplify Storage put and S3 ManageUpload

---------------

Author: @Kumar-Aakash
Upvotes: 2
Comments: 0

Hello AWS team,

I'm a bit confused as to the usage for Storage put and S3 SDK. I will try to explain everything in detail as possible. I am using Angular 8 application.

Our existing implementation is working fine with the usage of S3.ManageUpload for uploading the photos/doc. Here is a code snippet for the config part that we have been using.

For Amplify configure code, we have this.

```
import Amplify from 'aws-amplify';
Amplify.configure({
  Auth: {
    identityPoolId: '*******',
    region: '******',
    identityPoolRegion: '*******',
    userPoolId: '*******',
    userPoolWebClientId: '*******',
    authenticationFlowType: 'USER_PASSWORD_AUTH'
  }
});
```

When app gets initialize we have this.

```
import Amplify from 'aws-amplify';

Amplify.configure({
                Auth: data,
                Storage: {
                    AWSS3: {
                        bucket: this.bucket,
                        region: localStorage.getItem('region'),
                    }
                }
            });
```

When we are using S3 for the upload like this:

```
import * as S3 from 'aws-sdk/clients/s3';
const upload = new S3.ManagedUpload({
                    partSize: 5 * 1024 * 1024, queueSize: 10,
                    params: {
                        Bucket: BucketName,
                        Key: Key, // This contains the path including the filename. example- See the attached image 1
                        Body: file,
                        ContentType: file.type

                    },
                    tags: tagObject
                }).on('httpUploadProgress', function (evt) {
                    const uploaded = Math.round(evt.loaded / file['size'] * 100);
                    that.setProgressValue(uploaded);
                });
                const promise = upload.promise();

```

Now when I use S3.ManageUpload, my network PUT call looks like this:

**`https://bucketName.s3.us-east-2.amazonaws.com/photos/9979789080/alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg`**

For the above, when promise returns data, Response data looks like this:
![S3-ManageUpload](https://user-images.githubusercontent.com/31201591/135520799-2011c24f-125c-4e64-9e67-c392eabeb29c.PNG)

And above all look fine. You have a bucket name and private location where photos are getting uploaded. In the above snap, it is: photos/9979789080/alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg 

------------------------------------------------------

Now let's come to Storage.

This is how Storage put code looks:

```
return new Promise((resolve, reject) => {
      const customPrefix = {
        private: uploadPath  // Same path as S3 path -"photos/9979789080/"
      };
      Storage.put(filename, file, { /// filename  - alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg
        progressCallback(progress) {
          const value = Math.round(progress.loaded / progress.total * 100);
        },
        contentType: contentType,
        level: 'private',
        customPrefix: customPrefix  // For customize path
      }).then((result: any) => {
        console.log('Success result =>', result);
        // Need to resolve a promise here
        resolve({ status: true, uploadedKey: result.key });

      }).catch((err) => {
        // Need to add a debug alert here
        // Need to reject a promise here
        reject(false);

      });
    });
```

Now when I use Storage.put, my network PUT call looks like this:

**`https://bucketName.s3.us-east-2.amazonaws.com/photos/9979789080/us-east-2%3Aa7feb7eb-ef12-4c60-8119-06617e5f998b/alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg`**

I believe "us-east-2%3Aa7feb7eb-ef12-4c60-8119-06617e5f998b" is something called identity id. 

Response for Storage.put look like this:
![image](https://user-images.githubusercontent.com/31201591/135522171-f55e3755-baf7-43f9-a6e0-72201a61d307.png)



Notice the difference between NETWORK  HTTP PUT CALL for both S3.ManageUpload and Storage.put:

S3.ManageUpload - **`https://bucketName.s3.us-east-2.amazonaws.com/photos/9979789080/alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg`**

Storage.put - **`https://bucketName.s3.us-east-2.amazonaws.com/photos/9979789080/us-east-2%3Aa7feb7eb-ef12-4c60-8119-06617e5f998b/alexandr-bormotin-UmzV-gKPx6I-unsplash.jpg`**

---------------------------------------------------------------------------------

I know it's been a long question but here are my questions.

- Both are working fine for upload but how can I get result output the same as what I am getting in S3.ManageUpload because that's how I have been processing other work in my application like using ETAG.
- Why we have two different kind of HTTP PUT call. Storage.put method adds "us-east-2%3Aa7feb7eb-ef12-4c60-8119-06617e5f998b" extra.
- Stupid question, both methods in the above case uploading photos in the same directory called "photos/9979789080" ? 
- Which one to use based on the performance or they both are equal?
- I like Storage Amplify better and the team suggested using this and remove all S3.ManageUpload but making sure desired results are the same.

Please let me know your answers. Thanks in advance.

/Aakash


---------------

---------------

# Geo.searchByText --> [Error: URL.hostname is not implemented]

---------------

Author: @istashak
Upvotes: 1
Comments: 0

In my React Native app when I call:

```
try{
   let result = await Geo.searchByText('<Address String>');
} catch(error) {
   console.error(error);
}
```

I get the following error:

[Error: URL.hostname is not implemented]

I've manually set up a Place index from the AWS Management Console.
I've configured both my authorized and unauthorized Identity Pool Roles to allow for access to it through the prescribed inline policy.
I've added the appropriate Amplify.configure() additions:

```
Amplify.configure({
...
geo: {
    amazon_location_service: {
      search_indices: {
        items: ['MyPlaceIndex'], // REQUIRED - Amazon Location Service Place Index name
        default: 'MyPlaceIndex', // REQUIRED - Amazon Location Service Place Index name to set as default
      },
      region: 'us-east-1', // REQUIRED - Amazon Location Service Region
    },
});
```

Any ideas what I may be missing?
Thanks.

---------------

---------------

# How to detect the provider which user have used to log in?

---------------

Author: @wjureczka
Upvotes: 2
Comments: 1

Hi there! Thanks for your work!

I have no idea how to check where the user logged in from. 

Case: 
I have a settings page where users can change their passwords. As far as I know, it is possible if a user is logged in via email and password, but not via a social provider. I would like to hide a password change section when a user is logged in via a social provider. How to check that?
## Comment

---------------

Author: @noahking27

I got it this way in my app. I use google and linkedin and can tell between the three login types with the code below.

```
  const getLoginType = identities => {
    const parsedIdentities = identities ? JSON.parse(identities) : [{ providerName: 'Local' }];

    return parsedIdentities[0].providerName;
  };
      
      const { attributes } = await Auth.currentAuthenticatedUser();
      getLoginType(attributes.identities)
```

---------------

---------------

# Using @auth owner directive with federatedSignIn

---------------

Author: @webdog-rich
Upvotes: 1
Comments: 0

I have set up federated sign-in for my app using the capacitor plugin https://github.com/capacitor-community/facebook-login and call `Auth.federatedSignIn()` as per the below. This logs my user in with a federated identity. This is great, but it means I cannot use `@auth(rules: [{ allow: owner }])` in my graphql schema. Is there any way to create a user in the userpool when calling `Auth.federatedSignIn()`? I know that calling `Auth.federatedSignIn({ provider: "Facebook" })` and using the hosted UI works like this, but I do not want to redirect my user to a browser/chrome tab to sign in. I would like the authentication to be provided by the native functionality provided by the above capacitor plugin.

Using the federated identity allows me to restrict access to my graphql schema using IAM: `@auth(rules: [{ allow: private, provider: iam }])` but this is limited to private and public rules. I want to limit the graphql api so that users can see only their own entries with functionality like `@auth(rules: [{ allow: owner }])`. 

Maybe I am going about this the wrong way? I'm stumped. Any help is appreciated. Thanks.

```javascript
const FBLogIn = async () => {
    const result = await FacebookLogin.login({ permissions: FACEBOOK_PERMISSIONS });
    const { email } = await FacebookLogin.getProfile({ fields: ['email'] });
   
    try {
      const userDetails = await Auth.federatedSignIn("facebook", { token: result.accessToken.token, expires_at: result.accessToken.expires }, { name: result.accessToken.userId, email: email })
      
    } catch (error) {
      console.log(error)
    }
  }
```

---------------

---------------

# How to use DataStore with an exising backend?

---------------

Author: @cshenrik
Upvotes: 1
Comments: 0

I'm a serverless developer that is trying to get my head around how I make best use of Amplify DataStore.

I'm used to manage all my cloud resources with AWS SAM. Here I have my DynamoDB table definitions, api gateway, lambda functions etc. The clients that are accessing my api gateway are web applications that are expected to always be online, as well as third parties that expect a REST-like api.

Now I'm writing a mobile app which should use the existing backend. The app needs to work while being offline, so I am looking into ways of syncing data to the mobile device. That's why I stumbled upon Amplify DataStore. It solves a lot of the syncing problems, but in return it seems to take over the ownership of e.g. the DynamoDB table.

My DynamoDB table follows a single-table design, where I carefully structure my data according to the queries. For this reason I have a hard time seeing how DataStore will be able to take ownership of my DynamoDB table.

Even if I went with DataStore and accepted that it manages my DynamoDB table, I'm not sure how I would use the table from my existing Lambda functions. I mean, with DataStore there's a sync table and a main table, and I suppose it's not the intention that my lambda function should be concerned with that.

So to sum up, I'm looking for advice on how to make best use of Amplify DataStore if I'm not willing to let go of the control of my existing cloud resources.

---------------

---------------

# Amplify Flutter and Amplify React same project different result

---------------

Author: @runzun1987
Upvotes: 1
Comments: 0

I am working on a project where I have completed my website through React JS. Now I am working on developing App using flutter. All backend are done using aws amplify. While working on flutter I am facing strange issue. When I am querying the aws Table in flutter I am getting empty list, as there are data on that table, query same table on React works and working till now.

So I planned to create some test file to check what the issue so I create test flutter project and test react project .

I will add the code down below

. After doing the test I came to know that, data I save from flutter can be only queried using flutter and data saved in react can only queried through react as it is same table, same region ,every thing is same. Why is this strange behaviour .



![https://i.stack.imgur.com/QK9t0.png](https://i.stack.imgur.com/QK9t0.png)

![https://i.stack.imgur.com/nlt2g.png](https://i.stack.imgur.com/nlt2g.png)

As you can see query same table but results are different and flutter created data is not showing up in react app and even here ![https://i.stack.imgur.com/FfYQC.png](https://i.stack.imgur.com/FfYQC.png)

Code of flutter are as below: Main.dart :

```
import 'package:amplify_datastore/amplify_datastore.dart';
import 'package:amplify_flutter/amplify.dart';
import 'package:flutter/material.dart';
import 'package:my_app/amplifyconfiguration.dart';

import 'models/ModelProvider.dart';
import 'screens/homepage.dart';

Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await configureAmplify();
  runApp(MyApp());
}

Future<void> configureAmplify() async {
  Amplify.addPlugin(AmplifyDataStore(modelProvider: ModelProvider.instance));
  try {
    await Amplify.configure(amplifyconfig);
  } catch (e) {
    print("Amplify is alreay configured");
  }
}

class MyApp extends StatelessWidget {
  // This widget is the root of your application.

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        // This is the theme of your application.
        //
        // Try running your application with "flutter run". You'll see the
        // application has a blue toolbar. Then, without quitting the app, try
        // changing the primarySwatch below to Colors.green and then invoke
        // "hot reload" (press "r" in the console where you ran "flutter run",
        // or simply save your changes to "hot reload" in a Flutter IDE).
        // Notice that the counter didn't reset back to zero; the application
        // is not restarted.
        primarySwatch: Colors.blue,
      ),
      home: HomePage(),
    );
  }
}
```
HomePage:

```
import 'package:amplify_flutter/amplify.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

import 'package:my_app/models/Person.dart';

class HomePage extends StatelessWidget {
  Future<void> initTodos() async {
    final model = Person(name: "runzun");
    await Amplify.DataStore.save(model);
    final persons = await Amplify.DataStore.query(Person.classType);
    print(persons);
    print('======================');
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Hello'),
      ),
      body: Center(
        child: GestureDetector(
            onTap: () async {
              await initTodos();
              // var todos = Todo(name: "runzun", description: "this is a blog");
              // await Amplify.DataStore.save(todos);
            },
            child: Text('Add todos')),
      ),
    );
  }
}
```
models: ModelProvider.dart

```
/*
* Copyright 2021 Amazon.com, Inc. or its affiliates. All Rights Reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License").
* You may not use this file except in compliance with the License.
* A copy of the License is located at
*
*  http://aws.amazon.com/apache2.0
*
* or in the "license" file accompanying this file. This file is distributed
* on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
* express or implied. See the License for the specific language governing
* permissions and limitations under the License.
*/

// ignore_for_file: public_member_api_docs

import 'package:amplify_datastore_plugin_interface/amplify_datastore_plugin_interface.dart';
import 'Person.dart';

export 'Person.dart';

class ModelProvider implements ModelProviderInterface {
  @override
  String version = "115942e9588e46ca9df7bb771727f5c7";
  @override
  List<ModelSchema> modelSchemas = [Person.schema];
  static final ModelProvider _instance = ModelProvider();

  static ModelProvider get instance => _instance;
  
  ModelType getModelTypeByModelName(String modelName) {
    switch(modelName) {
    case "Person": {
    return Person.classType;
    }
    break;
    default: {
    throw Exception("Failed to find model in model provider for model name: " + modelName);
    }
    }
  }
}
```
Person.dart:

```
/*
* Copyright 2021 Amazon.com, Inc. or its affiliates. All Rights Reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License").
* You may not use this file except in compliance with the License.
* A copy of the License is located at
*
*  http://aws.amazon.com/apache2.0
*
* or in the "license" file accompanying this file. This file is distributed
* on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
* express or implied. See the License for the specific language governing
* permissions and limitations under the License.
*/

// ignore_for_file: public_member_api_docs

import 'package:amplify_datastore_plugin_interface/amplify_datastore_plugin_interface.dart';
import 'package:flutter/foundation.dart';


/** This is an auto generated class representing the Person type in your schema. */
@immutable
class Person extends Model {
  static const classType = const _PersonModelType();
  final String id;
  final String? _name;
  final String? _des;

  @override
  getInstanceType() => classType;
  
  @override
  String getId() {
    return id;
  }
  
  String get name {
    try {
      return _name!;
    } catch(e) {
      throw new DataStoreException(DataStoreExceptionMessages.codeGenRequiredFieldForceCastExceptionMessage, recoverySuggestion: DataStoreExceptionMessages.codeGenRequiredFieldForceCastRecoverySuggestion, underlyingException: e.toString());
    }
  }
  
  String? get des {
    return _des;
  }
  
  const Person._internal({required this.id, required name, des}): _name = name, _des = des;
  
  factory Person({String? id, required String name, String? des}) {
    return Person._internal(
      id: id == null ? UUID.getUUID() : id,
      name: name,
      des: des);
  }
  
  bool equals(Object other) {
    return this == other;
  }
  
  @override
  bool operator ==(Object other) {
    if (identical(other, this)) return true;
    return other is Person &&
      id == other.id &&
      _name == other._name &&
      _des == other._des;
  }
  
  @override
  int get hashCode => toString().hashCode;
  
  @override
  String toString() {
    var buffer = new StringBuffer();
    
    buffer.write("Person {");
    buffer.write("id=" + "$id" + ", ");
    buffer.write("name=" + "$_name" + ", ");
    buffer.write("des=" + "$_des");
    buffer.write("}");
    
    return buffer.toString();
  }
  
  Person copyWith({String? id, String? name, String? des}) {
    return Person(
      id: id ?? this.id,
      name: name ?? this.name,
      des: des ?? this.des);
  }
  
  Person.fromJson(Map<String, dynamic> json)  
    : id = json['id'],
      _name = json['name'],
      _des = json['des'];
  
  Map<String, dynamic> toJson() => {
    'id': id, 'name': _name, 'des': _des
  };

  static final QueryField ID = QueryField(fieldName: "person.id");
  static final QueryField NAME = QueryField(fieldName: "name");
  static final QueryField DES = QueryField(fieldName: "des");
  static var schema = Model.defineSchema(define: (ModelSchemaDefinition modelSchemaDefinition) {
    modelSchemaDefinition.name = "Person";
    modelSchemaDefinition.pluralName = "People";
    
    modelSchemaDefinition.addField(ModelFieldDefinition.id());
    
    modelSchemaDefinition.addField(ModelFieldDefinition.field(
      key: Person.NAME,
      isRequired: true,
      ofType: ModelFieldType(ModelFieldTypeEnum.string)
    ));
    
    modelSchemaDefinition.addField(ModelFieldDefinition.field(
      key: Person.DES,
      isRequired: false,
      ofType: ModelFieldType(ModelFieldTypeEnum.string)
    ));
  });
}

class _PersonModelType extends ModelType<Person> {
  const _PersonModelType();
  
  @override
  Person fromJson(Map<String, dynamic> jsonData) {
    return Person.fromJson(jsonData);
  }
}
```




```
backend schema.graphql:

type Person @model {
  id: ID!
  name: String!
  des: String
}
```





React JS app: index.js
```
import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';
import Amplify from 'aws-amplify';
import aws_exports from './../src/aws-exports';
Amplify.configure(aws_exports);
ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))

reportWebVitals();
app.js:

import logo from './logo.svg';
import './App.css';
import { useEffect } from 'react';
import { API, graphqlOperation } from 'aws-amplify';
import { listPeople } from './graphql/queries';
import { createPerson } from './graphql/mutations';
function App() {
  useEffect(() => {
    const test = async () => {
      try {
        await API.graphql(
          graphqlOperation(createPerson, {
            input: {
              name: 'runzun Node',
            },
          })
        );
        const result = await API.graphql(graphqlOperation(listPeople));
        console.log(result);
      } catch (err) {
        console.log(err);
      }

      // const peopleList = result.data.listPeople;
    };

    test();
  }, []);

  return (
    <div className="App">
      <header className="App-header">
        <img src={logo} className="App-logo" alt="logo" />
        <p>
          Edit <code>src/App.js</code> and save to reload.
        </p>
        <a
          className="App-link"
          href="https://reactjs.org"
          target="_blank"
          rel="noopener noreferrer"
        >
          Learn React
        </a>
      </header>
    </div>
  );
}

export default App;
```
graphql Query :

```
/* eslint-disable */
// this is an auto generated file. This will be overwritten

export const getPerson = /* GraphQL */ `
  query GetPerson($id: ID!) {
    getPerson(id: $id) {
      id
      name
      des
      createdAt
      updatedAt
    }
  }
`;
export const listPeople = /* GraphQL */ `
  query ListPeople(
    $filter: ModelPersonFilterInput
    $limit: Int
    $nextToken: String
  ) {
    listPeople(filter: $filter, limit: $limit, nextToken: $nextToken) {
      items {
        id
        name
        des
        createdAt
        updatedAt
      }
      nextToken
    }
  }
`;
```
graphql Mutation:

```
/* eslint-disable */
// this is an auto generated file. This will be overwritten

export const createPerson = /* GraphQL */ `
  mutation CreatePerson(
    $input: CreatePersonInput!
    $condition: ModelPersonConditionInput
  ) {
    createPerson(input: $input, condition: $condition) {
      id
      name
      des
      createdAt
      updatedAt
    }
  }
`;
export const updatePerson = /* GraphQL */ `
  mutation UpdatePerson(
    $input: UpdatePersonInput!
    $condition: ModelPersonConditionInput
  ) {
    updatePerson(input: $input, condition: $condition) {
      id
      name
      des
      createdAt
      updatedAt
    }
  }
`;
export const deletePerson = /* GraphQL */ `
  mutation DeletePerson(
    $input: DeletePersonInput!
    $condition: ModelPersonConditionInput
  ) {
    deletePerson(input: $input, condition: $condition) {
      id
      name
      des
      createdAt
      updatedAt
    }
  }
`;
```
backend schema.graphql

```
type Person @model {
  id: ID!
  name: String!
  des: String
}
```

---------------

---------------

# Social Federated Login and currentAuthenticatedUser vs currentUserInfo

---------------

Author: @Jun711
Upvotes: 2
Comments: 2

I noticed that after social sign-in, currentAuthenticatedUser returns `CognitoUser` but currentUserInfo return an empty object `{}`.  

**Describe the issue**
After social login, currentAuthenticatedUser returns CognitoUser but currentUserInfo returns empty object

The social sign-in doc does only uses currentAuthenticatedUser as an example. https://docs.amplify.aws/lib/auth/social/q/platform/js#setup-frontend

After turning on debug, I noticed that I need another scope permission.

```
{code: "NotAuthorizedException", name: "NotAuthorizedException", message: "Access Token does not have required scopes"}
code: "NotAuthorizedException"
message: "Access Token does not have required scopes"
name: "NotAuthorizedException"
__proto__: Object
``

![Screen Shot 2020-04-23 at 1 34 28 PM](https://user-images.githubusercontent.com/6880939/80146755-2cebd480-8567-11ea-807f-2a5d182d8cfe.png)

**Questions**
1 What scope do I need to call currentUserInfo? 
2 Is there a map of functions and scopes?

**To Reproduce**
Steps to reproduce the behavior:

1. social login e.g. Google login
2. call currentAuthenticatedUser and currentUserInfo
3. currentAuthenticatedUser returns CognitoUser but currentUserInfo returns an empty object

**Code Snippet**
Please provide a code snippet or a link to sample code of the issue you are experiencing to help us reproduce the issue. (Be sure to remove any sensitive data)
```
Auth.currentAuthenticatedUser()
      .then(user => console.log('currentAuthenticatedUser', user))
      .catch(() => console.log("Not signed in")

Auth.currentUserInfo()
      .then(user => console.log('currentUserInfo', user))
      .catch(() => console.log("Not signed in"));
```



```
## Comment

---------------

Author: @LOMFM

I have same issue with this.

I have integrated the social provider with the user pool.

`Auth.federatedSignIn('google', {token, expire_at}, user)`
I have implemented the sign in using above function.

But I can get the full user infomation.
This function returns following values.
`Auth.currentAuthenticatedUser(data => {console.log(data)}).catch(err => {});`

```
output: 
email: "",
id: "identity-id"
```

But I want the same result with the normal signIn.
```
{
   userSession: {
    token: {}
  },
  userAttributes: [
...
  ]
}
```


There is no method???
## Comment

---------------

Author: @PabloLION

# REPOSTING ISSUE
(for a correct format)

I noticed that after social sign-in, currentAuthenticatedUser returns `CognitoUser` but currentUserInfo return an empty object `{}`.

**Describe the issue**
After social login, currentAuthenticatedUser returns CognitoUser but currentUserInfo returns empty object
The social sign-in doc does only uses currentAuthenticatedUser as an example. https://docs.amplify.aws/lib/auth/social/q/platform/js#setup-frontend
After turning on debug, I noticed that I need another scope permission.
```
{code: "NotAuthorizedException", name: "NotAuthorizedException", message: "Access Token does not have required scopes"}
code: "NotAuthorizedException"
message: "Access Token does not have required scopes"
name: "NotAuthorizedException"
__proto__: Object
```
![Screen Shot 2020-04-23 at 1 34 28 PM](https://user-images.githubusercontent.com/6880939/80146755-2cebd480-8567-11ea-807f-2a5d182d8cfe.png)
**Questions**
1 What scope do I need to call currentUserInfo? 
2 Is there a map of functions and scopes?
**To Reproduce**
Steps to reproduce the behavior:
1. social login e.g. Google login
2. call currentAuthenticatedUser and currentUserInfo
3. currentAuthenticatedUser returns CognitoUser but currentUserInfo returns an empty object
**Code Snippet**
Please provide a code snippet or a link to sample code of the issue you are experiencing to help us reproduce the issue. (Be sure to remove any sensitive data)
```
Auth.currentAuthenticatedUser()
.then(user => console.log('currentAuthenticatedUser', user))
.catch(() => console.log("Not signed in")
Auth.currentUserInfo()
.then(user => console.log('currentUserInfo', user))
.catch(() => console.log("Not signed in"));
```


---------------

---------------

# Changing lambda layer version from console resulted in code not working

---------------

Author: @babaralishah
Upvotes: 1
Comments: 0

When we changed the version from AWS console, our whole code stopped working.

---------------

---------------

# Shorter manual setup code for AWS Amplify Cognito TOTP setup

---------------

Author: @zhenyamarinovich
Upvotes: 1
Comments: 0

We are using Amplify, Cognito and Angular to build a login workflow. During setup of TOTP, we show a QR code to the user.

As good practice, we also want to allow the user to manually enter a "setup code" in case they can't use the QR code.

I can't really find any specific documentation on this, but it seems like some people suggest having a "Copy to Clipboard" button, that copies the result of Auth.setupTOTP() so that it can then be copied into Google Authenticator or Authy, or whatever the user is using to manage their MFA.

The problem is that:

Users typically setup TOTP on their desktop computer, with a cellphone as their two factor authentication. Therefore the 'Copy to Clipboard' technique is useless. They have to manually type in the code.
The code is 52 characters long! No one in their right mind will want to type in 52 characters.
Is there a way to get a shorter code, e.g. up to 16 characters?

---------------

---------------

# Generating API key for customer to consume GraphQL API externally

---------------

Author: @v-raja
Upvotes: 1
Comments: 0

I'd like to create an API key for each customer that lets them consume my AppSync GraphQL API using that key. From what I understand, this is a common use case which is described [here](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-scenarios.html#scenario-api-gateway).

What I don't understand, however, is how to manage the issuing of the API key. What can I call to generate an API key for a user? Is it possible to issue an API key that never expires?

---------------

---------------

# Getting DataStore updates to the UI without using a reactive framework

---------------

Author: @
Upvotes: 1
Comments: 0

How do we get changes to the UI without using a reactive framework? Delta Sync + hybrid auth, so users don't see changes they aren't authorized for? How do we get alerts when there are new items available in the Delta Sync table, an infinite loop in the browser that checks?

---------------

---------------

# Amplify Predictions & Content Moderation

---------------

Author: @andy-HM
Upvotes: 2
Comments: 0

Hello, 

I am using Amplify to build an application where I need to provide content moderation.  I have added predictions to my application and have this working successfully.  However, I am wondering why the Predictions.identify.labels does not include detecting inappropriate content.  It will return a simple boolean of "unsafe" but it does not return any labels discussed under the [Moderating Content within AWS Rekognition](https://docs.aws.amazon.com/rekognition/latest/dg/moderation.html#moderation-api).  

To be clear, I have been working with the Amplify Predictions referenced [here](https://docs.amplify.aws/lib/predictions/label-image/q/platform/js/).

My questions are:

- What is the difference (if any) between the two?
- How can i get the content moderation labels specified [here](https://docs.aws.amazon.com/rekognition/latest/dg/moderation.html#moderation-api)?
- If these are separate, is there a reason for the separation?  I am confused why I would have to make separate calls to specific content moderation.  The Amplify Predictions seems well suited for this.

Thank you.

---------------

---------------

# cognito token revocation through Amplify

---------------

Author: @s1mrankaur
Upvotes: 1
Comments: 0

Can anyone on this thread confirm that "Amazon Cognito now supports token revocation and Amplify (from version 4.1.0) will revoke Amazon Cognito tokens if the application is online." as per here actually works? After upgrading amplify/auth to

npm i aws-amplify@4.1.0
npm i @aws-amplify/auth

there is no invalidation.


---------------

---------------

# Using Appsync with axios

---------------

Author: @jesuscovam
Upvotes: 1
Comments: 0

Hello, I wanted to know if a can add the JWT token from CognitoUser as a header
in a axios.post to send queries and mutations ?

At the moment I do mutations with the API KEY like this:
```
  const result = await axios({
      url: config?.endpoint || process.env.API_SLISSTO_GRAPHQLAPIENDPOINTOUTPUT,
      method: 'post',
      headers: {
        'x-api-key':
          config?.apiKey || process.env.API_SLISSTO_GRAPHQLAPIKEYOUTPUT,
      },
      data: {
        query,
        variables,
      },
    })
```

And I would like to know if these could also be extended to use IAM Auth?

Thanks in advance to anyone with the time to help me!

---------------

---------------

# Amplify.configure storage - issue with Android while authorization

---------------

Author: @valin0k
Upvotes: 1
Comments: 1

hey guys, i want to use MMKV storage with amplify and add my own storage class
```
import Amplify, { Auth } from 'aws-amplify';
import aws_exports from 'src/aws-exports';
import Analytics from '@aws-amplify/analytics';
import MmkvStorage from 'mmkvStorage';

const config = {
  ...aws_exports,
  graphql_headers: async () => {
    try {
      const token = (await Auth.currentSession()).getIdToken().getJwtToken();
      return { Authorization: token };
    } catch (e) {
      return {};
    }
  },
  Auth: {
    storage: MmkvStorage, // <- this line
  },

  PushNotification: {
    appId: aws_exports.aws_mobile_analytics_app_id,
    requestIOSPermissions: false,
  },
};
Amplify.configure(config);

Analytics.configure(aws_exports);

```
for iOS it working well, but Android throws an error while authorization `[ERROR] 14:54.437 AuthClass - Failed to get the signed in user [TypeError: Cannot read property 'length' of undefined]`. Any examples of how to fix it?
## Comment

---------------

Author: @hkjpotato

Hi, are you looking for a different storage provider (other than AWS S3)? If so, you can refer to https://docs.amplify.aws/lib/storage/getting-started/q/platform/js/#using-a-custom-plugin to add a plugin.

---------------

---------------

# What's the utility of function-parameters.json generated for lambda functions?

---------------

Author: @vthukral94
Upvotes: 1
Comments: 0

This file is located at `amplify/backend/function/<name>/src/function-parameters.json`. 
I have a hunch that it could be used for mocking. But, couldn't find any documentation or pointers to do so.

Thanks

---------------

---------------

# Amplify Storage - cant retrieve browser uploaded files as Administrator

---------------

Author: @slikk66
Upvotes: 1
Comments: 2

Hi - I've given up on using the Amplify CLI and the frontend/backend automation.  I am using Pulumi to do all of my backend work and deploying to s3 using code bulid including Cognito, Dynamo, AppSync, Lambda etc.

But, I've been still using the Amplify JS SDK in my app taking advantage of that side of things using a manually configured `aws-exports.js` file.

I have recently been working with Storage. I have my app now uploading items to S3 using storage eg: `await Storage.put(fileId, file, {});`

I can also retrieve the files from the app.  The thing is, my other AWS users (including `Administrator` role) are not able to download the files that Amplify uploads.  It seems like Amplify must be setting some DENY rules in the uploaded file.

I get this when trying to download or view permissions on a file:

````
You don’t have permission to get object ACL
After you or your AWS administrator have updated your permissions to allow the s3:GetObjectAcl action, refresh the page. 
API response
Access Denied
````
or from CLI:
````
aws s3 cp s3://my-bucket/public/8a44ec17-4993-4f1a-8dcb-399e32c0ff4e .
fatal error: An error occurred (403) when calling the HeadObject operation: Forbidden
````

Is this a known thing that Amplify adds DENY to all other users except somehow through the same method to put it (such as cognito) ?

## Comment

---------------

Author: @slikk66

OK, so what I think has happened here is that I'm using a centralized Cognito in another account to grant access to this app (and several others) which is then uploading to a bucket into the account/bucket where the app is running.  I have a bucket policy on the bucket in the app account that allows uploads from the Cognito account ID.

This seems to be the problem however: https://aws.amazon.com/premiumsupport/knowledge-center/s3-bucket-owner-access/

Seems like the object owner needs to grant ACL access to `--acl bucket-owner-full-control` meaning the Cognito account would need to add that permission of "bucket owner has control" at time of upload.  I'm guessing that this is probably not something Amplify supports.. not from what I've seen.

Am I stuck here?
## Comment

---------------

Author: @slikk66

Ah! Well that was easy.. answer staring right in face..  The docs 

````
            await Storage.put(fileId, file, {
                acl: "bucket-owner-full-control",
            });
````

The docs mention `public-read` as an option, but apparently the other built-ins work as well.  Cool!

---------------

---------------

# How I can get the value of the form

---------------

Author: @ethiers
Upvotes: 1
Comments: 2

Hi everyone,

I'm trying to figure out how I can get the value of the form, and to pass to API Auth.sign as parameters. Thank you.  

I'm working with Angular 10.

```
    "@aws-amplify/auth": "^3.3.3",
    "@aws-amplify/ui-angular": "^0.2.13",
    "@aws-amplify/ui-components": "^0.6.0",
```


**login.component.html**

```
<amplify-authenticator [handleAuthStateChange]="handleAuthStateChange">
<amplify-sign-in
    headerText="{{title}}"
    submitButtonText="{{submitButtonText}}"
    [handleSubmit]="handleSubmit"
    slot="sign-in"
    [formFields]="formFields">
  </amplify-sign-in>
</amplify-authenticator> 
```


**login.components.ts**
```
export class LoginComponent implements OnInit {
  handleAuthStateChange = this._handleAuthStateChange.bind(this);
  handleSubmit = this._handlerSubmit.bind(this);
  formFields: FormFieldTypes;
  ...
```

```
public _handlerSubmit(event: Event): void {
    console.log('handler Submit', event, this);
    event.preventDefault();

    Auth.signIn('**[getUsername]**', **'[getPassword]**').then((value: CognitoUser) => {
      console.log('SIGN IN', value);
    }).catch(err => {
      console.error('SIGN ERROR', err);
    });
  }
```
## Comment

---------------

Author: @datarster

Hello @ethiers Any luck? I am also looking for an answer. I also do the same step with Angular 10 and Amplify.
## Comment

---------------

Author: @ethiers

yes, you can get this values from the "**handleInputChange**" callback. When the input is modified by the user, try to grab the values and set them into an object like this.inputs.username and this.inputs.password...

Please see this example made with React, you can inspire of that for the Angular code. 
https://blog.kylegalbraith.com/2020/03/31/customizing-the-aws-amplify-authentication-ui-with-your-own-react-components/

---------------

---------------

# TypeError: Cannot read properties of undefined (reading 'association')

---------------

Author: @ntmk
Upvotes: 1
Comments: 0

I have just updated my packages and it has resulted in the following error. If anyone has any ideas let me know! 

Amplify project with React

-  "@aws-amplify/api": "^4.0.13",
-  "@aws-amplify/auth": "^4.3.3",
-  "@aws-amplify/core": "^4.2.7",
-  "@aws-amplify/datastore": "^3.4.1",

```
storage.ts:327 Uncaught (in promise) TypeError: Cannot read properties of undefined (reading 'association')
    at storage.ts:327
    at Array.forEach (<anonymous>)
    at e.getUpdateMutationInput (storage.ts:325)
    at storage.ts:124
    at Array.forEach (<anonymous>)
    at e.<anonymous> (storage.ts:114)
    at 2.d88a823a.chunk.js:2
    at Object.next (2.d88a823a.chunk.js:2)
    at a (2.d88a823a.chunk.js:2)
(anonymous) @ storage.ts:327
e.getUpdateMutationInput @ storage.ts:325
(anonymous) @ storage.ts:124
(anonymous) @ storage.ts:114
(anonymous) @ 2.d88a823a.chunk.js:2
(anonymous) @ 2.d88a823a.chunk.js:2
a @ 2.d88a823a.chunk.js:2
Promise.then (async)
value @ EditExperience.js:418
(anonymous) @ EditExperience.js:1145
vo @ react-dom.production.min.js:131
us @ react-dom.production.min.js:212
wc @ react-dom.production.min.js:255
t.unstable_runWithPriority @ scheduler.production.min.js:19
Yi @ react-dom.production.min.js:122
_c @ react-dom.production.min.js:248
sc @ react-dom.production.min.js:239
(anonymous) @ react-dom.production.min.js:123
t.unstable_runWithPriority @ scheduler.production.min.js:19
Yi @ react-dom.production.min.js:122
Xi @ react-dom.production.min.js:123
$i @ react-dom.production.min.js:122
N @ react-dom.production.min.js:287
Xt @ react-dom.production.min.js:68
```

---------------

---------------

# Missing dependencies

---------------

Author: @atoiv
Upvotes: 3
Comments: 1

**Describe the bug**
Missing dependencies in `package.json`s of multiple workspaces:
* Internal dependencies between workspaces are not defined.
* external dependencies to packages under @aws-sdk organization are not defined.

For example "@aws-amplify/api" uses "@aws-amplify/core", without listing it in package.json.

This becomes a show stopper when trying to use aws-amplify from a regular yarn 2 (a.k.a yarn berry or yarn modern) project, without [falling back to using node_modules](https://yarnpkg.com/api/modules/plugin_node_modules.html) for the whole project. Given that not all of the packages used in aws-amplify repository are exposed as npm packages, it is not possible to get past the problem by just using yarn's [packageExtensions](https://yarnpkg.com/advanced/migration#a-package-is-trying-to-access-another-package-). 

**Solution**
List all dependencies inside each workspace's package.json.

**Additional information**

If all the missing dependencies would be npm packages, it would be possible to override them via the following .yarnrc.yml config:

```yaml
packageExtensions:
  "@aws-amplify/api@*":
    dependencies:
      "@aws-amplify/core": "*"
  "@aws-amplify/datastore@*":
    dependencies:
      "@aws-amplify/auth": "*"
      "@aws-amplify/cache": "*"
      crypto-js: "*"
  "@aws-amplify/storage@*":
    # following doesn't work, as the packages are not found in npm
    dependencies:
      "@aws-sdk/fetch-http-handler": "*"
      "@aws-sdk/protocol-http": "*"
      "@aws-sdk/querystring-builder": "*"
      "@aws-sdk/url-parser-node": "*"
  "@aws-sdk/fetch-http-handler@*":
    # following doesn't work, as the packages are not found in npm
    dependencies:
      "@aws-sdk/util-base64-browser": "*"
```

As it is, they are apparently not npm packages, and yarn 2 can't fetch them.

---

There could be more missing dependencies. These are just the one's that came up when trying to use auth functionality.
## Comment

---------------

Author: @milichev

@atoiv , first of all, thanks for raising this.

I succeeded to run the CRA+amplify app as follows:

1. In `package.json`:

```
  "dependencies": {
    "@aws-amplify/ui-react": "^0.2.32",
    "aws-amplify": "^3.3.12",
```

2. In `.yarnrc.yml`:

```
packageExtensions:
  "@aws-amplify/api@*":
    dependencies:
      "@aws-amplify/auth": "*"
      "@aws-amplify/cache": "*"
      "@aws-amplify/core": "*"
  "@aws-amplify/datastore@*":
    dependencies:
      "@aws-amplify/auth": "*"
      "@aws-amplify/cache": "*"
      "crypto-js": "*"
  "@aws-amplify/storage@*":
    dependencies:
      "@aws-sdk/fetch-http-handler": "*"
      "@aws-sdk/protocol-http": "*"
      "@aws-sdk/querystring-builder": "*"
      "@aws-sdk/url-parser-node": "*"
  "@aws-amplify/ui-react@*":
    dependencies:
      "@aws-amplify/auth": "*"
      "@aws-amplify/core": "*"
```

3. Run `yarn install`

---------------

---------------

# Store multiple identity providers data in Auth instance

---------------

Author: @akhalinem
Upvotes: 1
Comments: 0

When I try to use Auth.federatedSignIn with multiple providers, Auth instance clears the previous signed-in providers' data and stores only the last signed-in provider data. Is it possible to store previous providers' data among with the last signed-in provider?

---------------

---------------

# DataStore: need more information about implicit model fields

---------------

Author: @julie777
Upvotes: 1
Comments: 0

Now that I am past the initial learning curve, and have read all the DataStore documentation that I can find multiple times, I still have many questions about use in a "real" application. If there is an advance usage doc somewhere please let me know.

If I create a DataStore model 
```
    type Todo @model {
        id: ID!
        title: String!
        completed: Boolean
    }
```
DataStore adds several fields to the model that is generated, 
   CreatedAt, UpdatedAt - they appear in the generated schema.js file and are readonly and I found documentation about renaming them
   _deleted, _lastChanged, _version - don't appear in the generated schema

CreatedAt and UpdatedAt don't appear in the local store, but the _fields do.

id which I defined is assigned a value when datastore creates the model instance, and any value I provide is ignored
all the other fields are always undefined when running locally

There is no field as far as I can see that relates the model instance to a user.

My assumption is that the fields will be filled in by the backend if/when I sync to the cloud. I don't know if this is correct.

Is there any way other than reading the datastore code for me to find out the details of implicit fields and sync to the cloud?



---------------

---------------

# How to configure Logger to work with VueJs?

---------------

Author: @rutwick-alic
Upvotes: 1
Comments: 0

In my Vue Project I am already using Pinpoint and Auth using aws-amplify package. I need to configure Logger to work so I can send error logs to Cloudwatch. The documentation state the usage, but not the configuration part.

I have looked at this PR, but even the exact config doesn't work: https://github.com/aws-amplify/amplify-js/pull/8309. My aws-amplify version is 4.2.3 (^).

There is absolutely no information on how to configure it, or at least I am not able to find it. Please can someone help?

---------------

---------------

# Syntax/object structure for federated property on Authenticator/Signin UI Component

---------------

Author: @aossey
Upvotes: 1
Comments: 1

I am attempting to add Federated Identity Providers to my Vue application that is use the pre-built Amplify UI components.  When I add a binding for federated.prop (see below), I get a horizontal divider above the existing login form, but there are no buttons appearing for the federated identity providers.  I would expect a button for Google to appear in this case.  I can't seem to find any documentation on using the federated property of the Authenticator or Signin components, can someone please point me to the documentation or post a working code sample?

```javascript
<template>
  <div class="auth">
    <amplify-authenticator username-alias="username" :federated="federatedIds">
      <amplify-sign-in slot="sign-in" :federated.prop="federatedConfig">
      </amplify-sign-in>
    </amplify-authenticator>
  </div>
</template>

<script>
export default {
  name: "Auth",
  data() {
    return {
      federatedConfig: { provider: "Google" },
      federatedIds: {
        google_client_id:
          "XXXXXXXXXXXXXXXXXXXXX.apps.googleusercontent.com",
        facebook_app_id: "",
        amazon_client_id: "",
      },
    };
  },
};
</script>
```

---
![Screen Shot 2020-08-14 at 7 57 17 PM](https://user-images.githubusercontent.com/10093753/90304023-76d72e00-de68-11ea-8784-6754766758d5.png)

@dabit3 - Any thoughts?
## Comment

---------------

Author: @frawgie

Did you find a solution? I'm having the same problem.

---------------

---------------

# How to prevent Auth 'signIn' event?

---------------

Author: @debotos
Upvotes: 1
Comments: 0

Hi, Is there any way to just collect userId from Auth.federatedSignIn() call without logging in the user?
I want just the 'userId' property but don't wanna log in the user. Trying to implement Social Connect functionality(like, Connect with Google, Facebook, Apple).

---------------

---------------

# How to detect user has a password?

---------------

Author: @debotos
Upvotes: 1
Comments: 0

Currently i am using social login(`Auth.federatedSignIn()`). Now there is an option to change the password. Before showing that form I wanna confirm that this user has a password already set up or not neither I will show him create password form(`Auth.completeNewPassword()`).

Please help me to figure out the correct way to detect it. Thanks.

---------------

---------------

# Is Google One-tap Sign-up supported?

---------------

Author: @jysung
Upvotes: 2
Comments: 0

Is Google one-tap sign-up (https://developers.google.com/identity/gsi/web) possible to integrate with Amplify? Has anyone successfully done it? Would I have to integrate it myself using Google's SDK?

I currently sign up users using
```
Auth.federatedSignIn({ provider: 'Google' };
```

Thanks!

---------------

---------------

# Amplify with gitpod

---------------

Author: @htmnk
Upvotes: 1
Comments: 1

Hi, could anybody point me in the right direction or have any experience with setting up amplify with [gitpod](https://www.gitpod.io/)? I would like to be able to have aws-exports.js generated automatically, be able to push new changes, etc. inside the cloud dev workspaces.
## Comment

---------------

Author: @htmnk

I've got it working (mirror: https://stackoverflow.com/questions/68896926/aws-amplify-javascript-gitpod-automatic-setup) first I've added these environment variables for the `amplify` setup using the [Gitpod account settings][1]:
```bash
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_DEFAULT_REGION=us-west-2
AWS_AMPLIFY_PROJECT_NAME=headlessProjectName
AWS_AMPLIFY_APP_ID=amplifyServiceProjectAppId
```
The first three are the IAM user credentials and config, the latter two are amplify specific and can be found inside the AWS console on the Amplify project.

After that, I've created a [Dockerfile][2] for the Gitpod Custom Docker Image and a bash script that creates `~/.aws` config files and runs `amplify pull` in a headless mode.

*.gitpod.dockerfile*
```sh
FROM gitpod/workspace-full

# install aws-cli v2
RUN sudo curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" \
  && unzip awscliv2.zip \
  && sudo ./aws/install

# install amplify-cli
RUN sudo curl -sL https://aws-amplify.github.io/amplify-cli/install | bash && $SHELL
```

This will preinstall [aws-cli][4] and [amplify-cli][5] on the docker image so they are ready to use inside the workspace. Also don't forget to add the docker configuration to the top of `.gitpod.yml` file:

*.gitpod.yml*
```yml
image:
  file: .gitpod.Dockerfile
```

At this point, I'm setting up Amplify in a way that I don't have to manually pick the `amplify-cli` options when a new workspace is started. The magic happens inside a custom bash script with the help of the environment variables specified at the start:

*amplify-pull.bash*
```bash
#!/bin/bash
set -e
IFS='|'

# Specify the headless amplify pull parameters
# https://docs.amplify.aws/cli/usage/headless/#amplify-pull-parameters
VUECONFIG="{\
\"SourceDir\":\"src\",\
\"DistributionDir\":\"dist\",\
\"BuildCommand\":\"npm run-script build\",\
\"StartCommand\":\"npm run-script serve\"\
}"
AWSCLOUDFORMATIONCONFIG="{\
\"configLevel\":\"project\",\
\"useProfile\":false,\
\"profileName\":\"default\",\
\"accessKeyId\":\"$AWS_ACCESS_KEY_ID\",\
\"secretAccessKey\":\"$AWS_SECRET_ACCESS_KEY\",\
\"region\":\"$AWS_DEFAULT_REGION\"\
}"
AMPLIFY="{\
\"projectName\":\"$AWS_AMPLIFY_PROJECT_NAME\",\
\"appId\":\"$AWS_AMPLIFY_APP_ID\",\
\"envName\":\"dev\",\
\"defaultEditor\":\"code\"\
}"
FRONTEND="{\
\"frontend\":\"javascript\",\
\"framework\":\"vue\",\
\"config\":$VUECONFIG\
}"
PROVIDERS="{\
\"awscloudformation\":$AWSCLOUDFORMATIONCONFIG\
}"

# Create AWS credential file inside ~/.aws
mkdir -p ~/.aws \
&& echo -e "[default]\naws_access_key_id=$AWS_ACCESS_KEY_ID\naws_secret_access_key=$AWS_SECRET_ACCESS_KEY" \
>> ~/.aws/credentials

# Create AWS config file ~/.aws
echo -e "[default]\nregion=$AWS_DEFAULT_REGION" >> ~/.aws/config

# Run amplify pull in Headless mode, 
# this also generates thw aws-exports.js file inside /src
amplify pull \
--amplify $AMPLIFY \
--frontend $FRONTEND \
--providers $PROVIDERS \
--yes

```
I'm using Vue for my frontend as an example, so those values need to be changed depending on the project type. The rest of the params are pretty straightforward, more info about the headless mode can be found [here][6]. I'm also creating the [aws config files][7] before the `amplify pull` command as mentioned before.

And this is what the final `.gitpod.yml` file looks like

*.gitpod.yml*
```yml
image:
  file: .gitpod.dockerfile
  
tasks:
  - name: Amplify pull dev
    command: |
      bash amplify-pull.bash
      gp sync-done amplify
  
  - name: Install npm packages, run dev
    init: yarn install
    command: |
      gp sync-await amplify
      yarn serve
    
ports:
  - port: 8080
    onOpen: open-preview
```

I'm also waiting for the Amplify pull to finish before running the dev server using [gp sync][8].


  [1]: https://www.gitpod.io/docs/environment-variables#using-the-account-settings
  [2]: https://www.gitpod.io/docs/config-docker#configure-a-custom-dockerfile
  [3]: https://stackoverflow.com/users/16736076/pauline-p-narvas
  [4]: https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html
  [5]: https://docs.amplify.aws/cli/start/install/
  [6]: https://docs.amplify.aws/cli/usage/headless/
  [7]: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html
  [8]: https://www.gitpod.io/docs/config-start-tasks#wait-for-commands-to-complete

---------------

---------------

# Custom field for signin, alter jwt token

---------------

Author: @dgastudio
Upvotes: 1
Comments: 0

Hello
I have two questions, I hope for your help

1. I have a multitenant system where the user must log in by username + password + property code. But after checking the documentation, I can't find a way to use the additional login field (Auth.signIn (username, password)).
2. I am already using custom jwt token and part of its payload is for configuring websocket library. Will it be possible to attach custom fields to aws ampify jwt payload?

thank you!

---------------

---------------

# HOW TO SET UNIQUE PROPERTY ON A TABLE ATTRIBUTE

---------------

Author: @Anishshettyk
Upvotes: 1
Comments: 0

is there a way to set unique property on graphQL schema

---------------

---------------

# Cannot upload file to S3 using Angular

---------------

Author: @edoardo849
Upvotes: 1
Comments: 6

**Describe the bug**
I want to upload an image to the configured Storage bucket. When I do, I receive the following error:
```
Access to XMLHttpRequest at 'https://BUCKETs3.eu-west-1.amazonaws.com/public/public/eu-west-1%3A7d2fa609-a252-474d-9de2-3144d0f77cbf/19C0927_062.jpg.jpg?uploads=' from origin 'http://localhost:4201' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.

[ERROR] 49:18.972 axios-http-handler Error: Network Error
```

I have created the bucket via the console and I this is the created CORS policy:

```
<?xml version="1.0" encoding="UTF-8"?>
<CORSConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
<CORSRule>
    <ID>S3CORSRuleId1</ID>
    <AllowedOrigin>*</AllowedOrigin>
    <AllowedMethod>GET</AllowedMethod>
    <AllowedMethod>HEAD</AllowedMethod>
    <AllowedMethod>PUT</AllowedMethod>
    <AllowedMethod>POST</AllowedMethod>
    <AllowedMethod>DELETE</AllowedMethod>
    <MaxAgeSeconds>3000</MaxAgeSeconds>
    <ExposeHeader>x-amz-server-side-encryption</ExposeHeader>
    <ExposeHeader>x-amz-request-id</ExposeHeader>
    <ExposeHeader>x-amz-id-2</ExposeHeader>
    <ExposeHeader>ETag</ExposeHeader>
    <AllowedHeader>*</AllowedHeader>
</CORSRule>
</CORSConfiguration>

```

**Code Snippet**

```typescript
const { identityId } = await Auth.currentCredentials();
const key = `public/${identityId}/${fileName}${fileExtension}`;
const storage = await Storage.put(key, await this.mediaFile.text(), { contentType: mimeType });
```


**What is Configured?**
If applicable, please provide what is configured for Amplify CLI:

| Category                 | Resource name                         | Operation | Provider plugin   |
| ------------------------ | ------------------------------------- | --------- | ----------------- |
| Hosting                  | amplifyhosting                        | No Change    |                   |
| Auth                     | sixtythreeapp563ea47e                 | No Change | awscloudformation |
| Auth                     | userPoolGroups                        | No Change | awscloudformation |
| Api                      | sixtythreeapp                         | No Change | awscloudformation |
| Function                 | sixtythreeapp563ea47ePostConfirmation | No Change | awscloudformation |
| Function                 | generateFeed                          | No Change | awscloudformation |
| Function                 | userEvent                             | No Change | awscloudformation |
| Lambdatriggerpermissions | postConfirmationPermissions           | No Change | awscloudformation |
| Storage                  | sixtythree                            | No Change | awscloudformation |


* Which steps did you follow via Amplify CLI when configuring your resources.
* Which resources do you have configured?
  * If applicable, please provide your `aws-exports` file:

```json

const awsmobile = {
    "aws_project_region": "eu-west-1",
    "aws_cognito_identity_pool_id": "eu-west-XXX",
    "aws_cognito_region": "eu-west-1",
    "aws_user_pools_id": "eu-west-XXX",
    "aws_user_pools_web_client_id": "XXX",
    "oauth": {},
    "aws_appsync_graphqlEndpoint": "https:/XXX.appsync-api.eu-west-1.amazonaws.com/graphql",
    "aws_appsync_region": "eu-west-1",
    "aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS",
    "aws_appsync_apiKey": "XXX",
    "aws_user_files_s3_bucket": "XXX",
    "aws_user_files_s3_bucket_region": "eu-west-1"
};

```
   * If applicable, please provide your manual configuration example:
   
```typescript

import aws_exports from "./aws-exports";
import Amplify from 'aws-amplify';

Amplify.configure(aws_exports);
```


<details>
  <summary><strong>Environment</strong></summary>

<!-- Please run the following command inside your project and copy/paste the output into the codeblock: -->

```
  System:
    OS: Linux 5.4 Ubuntu 20.04.1 LTS (Focal Fossa)
    CPU: (8) x64 Intel(R) Core(TM) i7-1065G7 CPU @ 1.30GHz
    Memory: 555.65 MB / 15.47 GB
    Container: Yes
    Shell: 5.0.17 - /bin/bash
  Binaries:
    Node: 14.13.0 - ~/.nvm/versions/node/v14.13.0/bin/node
    npm: 6.14.8 - ~/.nvm/versions/node/v14.13.0/bin/npm
  Browsers:
    Chrome: 85.0.4183.121
    Firefox: 81.0
  npmPackages:
    @angular-devkit/build-angular: ^0.1000.8 => 0.1000.8 
    @angular/animations: ^10.1.2 => 10.1.2 
    @angular/cli: ^10.1.2 => 10.1.2 
    @angular/common: ^10.1.2 => 10.1.2 
    @angular/compiler: ^10.1.2 => 10.1.2 
    @angular/compiler-cli: ^10.1.2 => 10.1.2 
    @angular/core: ^10.1.2 => 10.1.2 
    @angular/forms: ^10.1.2 => 10.1.2 
    @angular/platform-browser: ^10.1.2 => 10.1.2 
    @angular/platform-browser-dynamic: ^10.1.2 => 10.1.2 
    @angular/router: ^10.1.2 => 10.1.2 
    @aws-amplify/ui-angular: ^0.3.0 => 0.3.0 
    @types/jasmine: ^3.5.14 => 3.5.14 
    @types/jasminewd2: ~2.0.3 => 2.0.8 
    @types/node: ^12.12.61 => 12.12.61 
    aws-amplify: ^3.3.1 => 3.3.1 
    bulma: ^0.9.0 => 0.9.0 
    codelyzer: ^6.0.0 => 6.0.0 
    jasmine-core: ~3.5.0 => 3.5.0 
    jasmine-spec-reporter: ~5.0.0 => 5.0.2 
    karma: ~5.0.0 => 5.0.9 
    karma-chrome-launcher: ~3.1.0 => 3.1.0 
    karma-coverage-istanbul-reporter: ~3.0.2 => 3.0.3 
    karma-jasmine: ~3.3.0 => 3.3.1 
    karma-jasmine-html-reporter: ^1.5.0 => 1.5.4 
    material-icons: ^0.3.1 => 0.3.1 
    protractor: ~7.0.0 => 7.0.0 
    rxjs: ~6.5.5 => 6.5.5 
    ts-node: ~8.3.0 => 8.3.0 
    tslib: ^2.0.0 => 2.0.1 
    tslint: ~6.1.0 => 6.1.3 
    typescript: ~3.9.5 => 3.9.7 
    zone.js: ~0.10.3 => 0.10.3 
  npmGlobalPackages:
    @angular/cli: 10.1.4
    @aws-amplify/cli: 4.29.4
    npm: 6.14.8
```

</details>

**Smartphone (please complete the following information):**

- Device: [e.g. iPhone6]
- OS: [e.g. iOS8.1]
- Browser [e.g. stock browser, safari]
- Version [e.g. 22]

## Comment

---------------

Author: @ashika01

@edoardo849 what version of angular are you using? also, could you post your amplify dependency versions too?
## Comment

---------------

Author: @edoardo849

@ashika01 I'm using angular `~10.0.9` - but you can see the dependencies in the "Environment" section in the above post, but Let me post the entire dependency tree here:

`npm ls`

<details>
  <summary><strong>Dependency Tree</strong></summary>

REPO@0.0.0 /home/edo/code/REPO
├─┬ @angular-devkit/build-angular@0.1000.8
│ ├─┬ @angular-devkit/architect@0.1000.8
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ └── rxjs@6.5.5 deduped
│ ├─┬ @angular-devkit/build-optimizer@0.1000.8
│ │ ├── loader-utils@2.0.0 deduped
│ │ ├── source-map@0.7.3 deduped
│ │ ├── tslib@2.0.0
│ │ └── webpack-sources@1.4.3 deduped
│ ├─┬ @angular-devkit/build-webpack@0.1000.8
│ │ ├── @angular-devkit/architect@0.1000.8 deduped
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ └── rxjs@6.5.5 deduped
│ ├─┬ @angular-devkit/core@10.0.8
│ │ ├── ajv@6.12.3 deduped
│ │ ├── fast-json-stable-stringify@2.1.0
│ │ ├── magic-string@0.25.7 deduped
│ │ ├── rxjs@6.5.5 deduped
│ │ └── source-map@0.7.3 deduped
│ ├─┬ @babel/core@7.9.6
│ │ ├── @babel/code-frame@7.10.4 deduped
│ │ ├── @babel/generator@7.9.6 deduped
│ │ ├─┬ @babel/helper-module-transforms@7.11.0
│ │ │ ├── @babel/helper-module-imports@7.10.4 deduped
│ │ │ ├─┬ @babel/helper-replace-supers@7.10.4
│ │ │ │ ├─┬ @babel/helper-member-expression-to-functions@7.11.0
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ ├── @babel/helper-optimise-call-expression@7.10.4 deduped
│ │ │ │ ├── @babel/traverse@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├─┬ @babel/helper-simple-access@7.10.4
│ │ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├─┬ @babel/helper-split-export-declaration@7.11.0
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├── @babel/types@7.11.5 deduped
│ │ │ └── lodash@4.17.20 deduped
│ │ ├─┬ @babel/helpers@7.10.4
│ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├── @babel/traverse@7.11.5 deduped
│ │ │ └── @babel/types@7.11.5 deduped
│ │ ├── @babel/parser@7.11.5
│ │ ├── @babel/template@7.8.6 deduped
│ │ ├─┬ @babel/traverse@7.11.5
│ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ ├─┬ @babel/generator@7.11.6
│ │ │ │ ├── @babel/types@7.11.5 deduped
│ │ │ │ ├── jsesc@2.5.2 deduped
│ │ │ │ └── source-map@0.5.7
│ │ │ ├─┬ @babel/helper-function-name@7.10.4
│ │ │ │ ├── @babel/helper-get-function-arity@7.10.4 deduped
│ │ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├── @babel/helper-split-export-declaration@7.11.0 deduped
│ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ ├── @babel/types@7.11.5 deduped
│ │ │ ├─┬ debug@4.2.0
│ │ │ │ └── ms@2.1.2
│ │ │ ├── globals@11.12.0
│ │ │ └── lodash@4.17.20 deduped
│ │ ├─┬ @babel/types@7.11.5
│ │ │ ├── @babel/helper-validator-identifier@7.10.4
│ │ │ ├── lodash@4.17.20 deduped
│ │ │ └── to-fast-properties@2.0.0
│ │ ├── convert-source-map@1.7.0 deduped
│ │ ├─┬ debug@4.2.0
│ │ │ └── ms@2.1.2
│ │ ├── gensync@1.0.0-beta.1
│ │ ├─┬ json5@2.1.3
│ │ │ └── minimist@1.2.5 deduped
│ │ ├── lodash@4.17.20 deduped
│ │ ├── resolve@1.17.0 deduped
│ │ ├── semver@5.7.1
│ │ └── source-map@0.5.7
│ ├─┬ @babel/generator@7.9.6
│ │ ├── @babel/types@7.11.5 deduped
│ │ ├── jsesc@2.5.2
│ │ ├── lodash@4.17.20 deduped
│ │ └── source-map@0.5.7
│ ├─┬ @babel/plugin-transform-runtime@7.9.6
│ │ ├─┬ @babel/helper-module-imports@7.10.4
│ │ │ └── @babel/types@7.11.5 deduped
│ │ ├── @babel/helper-plugin-utils@7.10.4
│ │ ├── resolve@1.17.0 deduped
│ │ └── semver@5.7.1
│ ├─┬ @babel/preset-env@7.9.6
│ │ ├─┬ @babel/compat-data@7.11.0
│ │ │ ├── browserslist@4.14.5 deduped
│ │ │ ├── invariant@2.2.4 deduped
│ │ │ └── semver@5.7.1
│ │ ├─┬ @babel/helper-compilation-targets@7.10.4
│ │ │ ├── @babel/compat-data@7.11.0 deduped
│ │ │ ├── browserslist@4.14.5 deduped
│ │ │ ├── invariant@2.2.4 deduped
│ │ │ ├── levenary@1.1.1 deduped
│ │ │ └── semver@5.7.1
│ │ ├── @babel/helper-module-imports@7.10.4 deduped
│ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-proposal-async-generator-functions@7.10.5
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├─┬ @babel/helper-remap-async-to-generator@7.11.4
│ │ │ │ ├── @babel/helper-annotate-as-pure@7.10.4 deduped
│ │ │ │ ├─┬ @babel/helper-wrap-function@7.10.4
│ │ │ │ │ ├── @babel/helper-function-name@7.10.4 deduped
│ │ │ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ │ ├── @babel/traverse@7.11.5 deduped
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ ├─┬ @babel/template@7.10.4
│ │ │ │ │ ├── @babel/code-frame@7.10.4 deduped
│ │ │ │ │ ├── @babel/parser@7.11.5 deduped
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ └── @babel/plugin-syntax-async-generators@7.8.4 deduped
│ │ ├─┬ @babel/plugin-proposal-dynamic-import@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/plugin-syntax-dynamic-import@7.8.3 deduped
│ │ ├─┬ @babel/plugin-proposal-json-strings@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/plugin-syntax-json-strings@7.8.3 deduped
│ │ ├─┬ @babel/plugin-proposal-nullish-coalescing-operator@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/plugin-syntax-nullish-coalescing-operator@7.8.3 deduped
│ │ ├─┬ @babel/plugin-proposal-numeric-separator@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/plugin-syntax-numeric-separator@7.10.4 deduped
│ │ ├─┬ @babel/plugin-proposal-object-rest-spread@7.11.0
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├── @babel/plugin-syntax-object-rest-spread@7.8.3 deduped
│ │ │ └── @babel/plugin-transform-parameters@7.10.5 deduped
│ │ ├─┬ @babel/plugin-proposal-optional-catch-binding@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/plugin-syntax-optional-catch-binding@7.8.3 deduped
│ │ ├─┬ @babel/plugin-proposal-optional-chaining@7.11.0
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├─┬ @babel/helper-skip-transparent-expression-wrappers@7.11.0
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ └── @babel/plugin-syntax-optional-chaining@7.8.3 deduped
│ │ ├─┬ @babel/plugin-proposal-unicode-property-regex@7.10.4
│ │ │ ├─┬ @babel/helper-create-regexp-features-plugin@7.10.4
│ │ │ │ ├── @babel/helper-annotate-as-pure@7.10.4 deduped
│ │ │ │ ├── @babel/helper-regex@7.10.5 deduped
│ │ │ │ └─┬ regexpu-core@4.7.1
│ │ │ │   ├── regenerate@1.4.1
│ │ │ │   ├─┬ regenerate-unicode-properties@8.2.0
│ │ │ │   │ └── regenerate@1.4.1 deduped
│ │ │ │   ├── regjsgen@0.5.2
│ │ │ │   ├─┬ regjsparser@0.6.4
│ │ │ │   │ └── jsesc@0.5.0
│ │ │ │   ├─┬ unicode-match-property-ecmascript@1.0.4
│ │ │ │   │ ├── unicode-canonical-property-names-ecmascript@1.0.4
│ │ │ │   │ └── unicode-property-aliases-ecmascript@1.1.0
│ │ │ │   └── unicode-match-property-value-ecmascript@1.2.0
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-async-generators@7.8.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-dynamic-import@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-json-strings@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-nullish-coalescing-operator@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-numeric-separator@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-object-rest-spread@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-optional-catch-binding@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-optional-chaining@7.8.3
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-syntax-top-level-await@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-arrow-functions@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-async-to-generator@7.10.4
│ │ │ ├── @babel/helper-module-imports@7.10.4 deduped
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/helper-remap-async-to-generator@7.11.4 deduped
│ │ ├─┬ @babel/plugin-transform-block-scoped-functions@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-block-scoping@7.11.1
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-classes@7.10.4
│ │ │ ├─┬ @babel/helper-annotate-as-pure@7.10.4
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├─┬ @babel/helper-define-map@7.10.5
│ │ │ │ ├── @babel/helper-function-name@7.10.4 deduped
│ │ │ │ ├── @babel/types@7.11.5 deduped
│ │ │ │ └── lodash@4.17.20 deduped
│ │ │ ├── @babel/helper-function-name@7.10.4 deduped
│ │ │ ├─┬ @babel/helper-optimise-call-expression@7.10.4
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├── @babel/helper-replace-supers@7.10.4 deduped
│ │ │ ├── @babel/helper-split-export-declaration@7.11.0 deduped
│ │ │ └── globals@11.12.0 deduped
│ │ ├─┬ @babel/plugin-transform-computed-properties@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-destructuring@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-dotall-regex@7.10.4
│ │ │ ├── @babel/helper-create-regexp-features-plugin@7.10.4 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-duplicate-keys@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-exponentiation-operator@7.10.4
│ │ │ ├─┬ @babel/helper-builder-binary-assignment-operator-visitor@7.10.4
│ │ │ │ ├─┬ @babel/helper-explode-assignable-expression@7.11.4
│ │ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-for-of@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-function-name@7.10.4
│ │ │ ├── @babel/helper-function-name@7.10.4 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-literals@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-member-expression-literals@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-modules-amd@7.10.5
│ │ │ ├── @babel/helper-module-transforms@7.11.0 deduped
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └─┬ babel-plugin-dynamic-import-node@2.3.3
│ │ │   └─┬ object.assign@4.1.1
│ │ │     ├── define-properties@1.1.3 deduped
│ │ │     ├─┬ es-abstract@1.18.0-next.1
│ │ │     │ ├── es-to-primitive@1.2.1 deduped
│ │ │     │ ├── function-bind@1.1.1 deduped
│ │ │     │ ├── has@1.0.3 deduped
│ │ │     │ ├── has-symbols@1.0.1 deduped
│ │ │     │ ├── is-callable@1.2.2 deduped
│ │ │     │ ├── is-negative-zero@2.0.0
│ │ │     │ ├── is-regex@1.1.1 deduped
│ │ │     │ ├── object-inspect@1.8.0 deduped
│ │ │     │ ├── object-keys@1.1.1 deduped
│ │ │     │ ├── object.assign@4.1.1 deduped
│ │ │     │ ├── string.prototype.trimend@1.0.1 deduped
│ │ │     │ └── string.prototype.trimstart@1.0.1 deduped
│ │ │     ├── has-symbols@1.0.1
│ │ │     └── object-keys@1.1.1 deduped
│ │ ├─┬ @babel/plugin-transform-modules-commonjs@7.10.4
│ │ │ ├── @babel/helper-module-transforms@7.11.0 deduped
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├── @babel/helper-simple-access@7.10.4 deduped
│ │ │ └── babel-plugin-dynamic-import-node@2.3.3 deduped
│ │ ├─┬ @babel/plugin-transform-modules-systemjs@7.10.5
│ │ │ ├─┬ @babel/helper-hoist-variables@7.10.4
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ ├── @babel/helper-module-transforms@7.11.0 deduped
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── babel-plugin-dynamic-import-node@2.3.3 deduped
│ │ ├─┬ @babel/plugin-transform-modules-umd@7.10.4
│ │ │ ├── @babel/helper-module-transforms@7.11.0 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-named-capturing-groups-regex@7.10.4
│ │ │ └── @babel/helper-create-regexp-features-plugin@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-new-target@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-object-super@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/helper-replace-supers@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-parameters@7.10.5
│ │ │ ├─┬ @babel/helper-get-function-arity@7.10.4
│ │ │ │ └── @babel/types@7.11.5 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-property-literals@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-regenerator@7.10.4
│ │ │ └─┬ regenerator-transform@0.14.5
│ │ │   └── @babel/runtime@7.9.6 deduped
│ │ ├─┬ @babel/plugin-transform-reserved-words@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-shorthand-properties@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-spread@7.11.0
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └── @babel/helper-skip-transparent-expression-wrappers@7.11.0 deduped
│ │ ├─┬ @babel/plugin-transform-sticky-regex@7.10.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ └─┬ @babel/helper-regex@7.10.5
│ │ │   └── lodash@4.17.20 deduped
│ │ ├─┬ @babel/plugin-transform-template-literals@7.10.5
│ │ │ ├── @babel/helper-annotate-as-pure@7.10.4 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-typeof-symbol@7.10.4
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/plugin-transform-unicode-regex@7.10.4
│ │ │ ├── @babel/helper-create-regexp-features-plugin@7.10.4 deduped
│ │ │ └── @babel/helper-plugin-utils@7.10.4 deduped
│ │ ├─┬ @babel/preset-modules@0.1.4
│ │ │ ├── @babel/helper-plugin-utils@7.10.4 deduped
│ │ │ ├── @babel/plugin-proposal-unicode-property-regex@7.10.4 deduped
│ │ │ ├── @babel/plugin-transform-dotall-regex@7.10.4 deduped
│ │ │ ├── @babel/types@7.11.5 deduped
│ │ │ └── esutils@2.0.3
│ │ ├── @babel/types@7.11.5 deduped
│ │ ├── browserslist@4.14.5 deduped
│ │ ├─┬ core-js-compat@3.6.5
│ │ │ ├── browserslist@4.14.5 deduped
│ │ │ └── semver@7.0.0
│ │ ├─┬ invariant@2.2.4
│ │ │ └─┬ loose-envify@1.4.0
│ │ │   └── js-tokens@4.0.0 deduped
│ │ ├─┬ levenary@1.1.1
│ │ │ └── leven@3.1.0
│ │ └── semver@5.7.1
│ ├─┬ @babel/runtime@7.9.6
│ │ └── regenerator-runtime@0.13.5 deduped
│ ├─┬ @babel/template@7.8.6
│ │ ├── @babel/code-frame@7.10.4 deduped
│ │ ├── @babel/parser@7.11.5 deduped
│ │ └── @babel/types@7.11.5 deduped
│ ├─┬ @jsdevtools/coverage-istanbul-loader@3.0.3
│ │ ├── convert-source-map@1.7.0 deduped
│ │ ├─┬ istanbul-lib-instrument@4.0.3
│ │ │ ├── @babel/core@7.9.6 deduped
│ │ │ ├── @istanbuljs/schema@0.1.2
│ │ │ ├── istanbul-lib-coverage@3.0.0 deduped
│ │ │ └── semver@6.3.0
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├─┬ merge-source-map@1.1.0
│ │ │ └── source-map@0.6.1
│ │ └─┬ schema-utils@2.7.1
│ │   ├── @types/json-schema@7.0.6
│ │   ├─┬ ajv@6.12.5
│ │   │ ├── fast-deep-equal@3.1.3 deduped
│ │   │ ├── fast-json-stable-stringify@2.1.0 deduped
│ │   │ ├── json-schema-traverse@0.4.1 deduped
│ │   │ └── uri-js@4.4.0 deduped
│ │   └── ajv-keywords@3.5.2 deduped
│ ├─┬ @ngtools/webpack@10.0.8
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ ├─┬ enhanced-resolve@4.1.1
│ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ ├─┬ memory-fs@0.5.0
│ │ │ │ ├── errno@0.1.7 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ └── tapable@1.1.3 deduped
│ │ ├── rxjs@6.5.5 deduped
│ │ └── webpack-sources@1.4.3 deduped
│ ├─┬ ajv@6.12.3
│ │ ├── fast-deep-equal@3.1.3
│ │ ├── fast-json-stable-stringify@2.1.0 deduped
│ │ ├── json-schema-traverse@0.4.1
│ │ └─┬ uri-js@4.4.0
│ │   └── punycode@2.1.1
│ ├─┬ autoprefixer@9.8.0
│ │ ├── browserslist@4.14.5 deduped
│ │ ├── caniuse-lite@1.0.30001144 deduped
│ │ ├── chalk@2.4.2 deduped
│ │ ├── normalize-range@0.1.2
│ │ ├── num2fraction@1.2.2
│ │ ├── postcss@7.0.31 deduped
│ │ └── postcss-value-parser@4.1.0
│ ├─┬ babel-loader@8.1.0
│ │ ├─┬ find-cache-dir@2.1.0
│ │ │ ├── commondir@1.0.1 deduped
│ │ │ ├── make-dir@2.1.0 deduped
│ │ │ └─┬ pkg-dir@3.0.0
│ │ │   └── find-up@3.0.0 deduped
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├── mkdirp@0.5.5 deduped
│ │ ├── pify@4.0.1
│ │ └── schema-utils@2.7.1 deduped
│ ├─┬ browserslist@4.14.5
│ │ ├── caniuse-lite@1.0.30001144 deduped
│ │ ├── electron-to-chromium@1.3.577
│ │ ├── escalade@3.1.0
│ │ └── node-releases@1.1.61
│ ├─┬ cacache@15.0.3
│ │ ├── chownr@2.0.0
│ │ ├─┬ fs-minipass@2.1.0
│ │ │ └── minipass@3.1.3 deduped
│ │ ├── glob@7.1.6 deduped
│ │ ├── infer-owner@1.0.4
│ │ ├─┬ lru-cache@5.1.1
│ │ │ └── yallist@3.1.1
│ │ ├─┬ minipass@3.1.3
│ │ │ └── yallist@4.0.0
│ │ ├─┬ minipass-collect@1.0.2
│ │ │ └── minipass@3.1.3 deduped
│ │ ├─┬ minipass-flush@1.0.5
│ │ │ └── minipass@3.1.3 deduped
│ │ ├─┬ minipass-pipeline@1.2.4
│ │ │ └── minipass@3.1.3 deduped
│ │ ├── mkdirp@1.0.4
│ │ ├─┬ move-file@2.0.0
│ │ │ └── path-exists@4.0.0
│ │ ├─┬ p-map@4.0.0
│ │ │ └─┬ aggregate-error@3.1.0
│ │ │   ├── clean-stack@2.2.0
│ │ │   └── indent-string@4.0.0
│ │ ├── promise-inflight@1.0.1
│ │ ├── rimraf@3.0.2 deduped
│ │ ├─┬ ssri@8.0.0
│ │ │ └── minipass@3.1.3 deduped
│ │ ├─┬ tar@6.0.5
│ │ │ ├── chownr@2.0.0 deduped
│ │ │ ├── fs-minipass@2.1.0 deduped
│ │ │ ├── minipass@3.1.3 deduped
│ │ │ ├─┬ minizlib@2.1.2
│ │ │ │ ├── minipass@3.1.3 deduped
│ │ │ │ └── yallist@4.0.0 deduped
│ │ │ ├── mkdirp@1.0.4
│ │ │ └── yallist@4.0.0 deduped
│ │ └─┬ unique-filename@1.1.1
│ │   └─┬ unique-slug@2.0.2
│ │     └── imurmurhash@0.1.4
│ ├── caniuse-lite@1.0.30001144
│ ├── circular-dependency-plugin@5.2.0
│ ├─┬ copy-webpack-plugin@6.0.3
│ │ ├─┬ cacache@15.0.5
│ │ │ ├─┬ @npmcli/move-file@1.0.1
│ │ │ │ └── mkdirp@1.0.4
│ │ │ ├── chownr@2.0.0 deduped
│ │ │ ├── fs-minipass@2.1.0 deduped
│ │ │ ├── glob@7.1.6 deduped
│ │ │ ├── infer-owner@1.0.4 deduped
│ │ │ ├─┬ lru-cache@6.0.0
│ │ │ │ └── yallist@4.0.0 deduped
│ │ │ ├── minipass@3.1.3 deduped
│ │ │ ├── minipass-collect@1.0.2 deduped
│ │ │ ├── minipass-flush@1.0.5 deduped
│ │ │ ├── minipass-pipeline@1.2.4 deduped
│ │ │ ├── mkdirp@1.0.4
│ │ │ ├── p-map@4.0.0 deduped
│ │ │ ├── promise-inflight@1.0.1 deduped
│ │ │ ├── rimraf@3.0.2 deduped
│ │ │ ├── ssri@8.0.0 deduped
│ │ │ ├── tar@6.0.5 deduped
│ │ │ └── unique-filename@1.1.1 deduped
│ │ ├─┬ fast-glob@3.2.4
│ │ │ ├── @nodelib/fs.stat@2.0.3
│ │ │ ├─┬ @nodelib/fs.walk@1.2.4
│ │ │ │ ├─┬ @nodelib/fs.scandir@2.1.3
│ │ │ │ │ ├── @nodelib/fs.stat@2.0.3 deduped
│ │ │ │ │ └── run-parallel@1.1.9
│ │ │ │ └─┬ fastq@1.8.0
│ │ │ │   └── reusify@1.0.4
│ │ │ ├── glob-parent@5.1.1 deduped
│ │ │ ├── merge2@1.4.1
│ │ │ ├─┬ micromatch@4.0.2
│ │ │ │ ├── braces@3.0.2 deduped
│ │ │ │ └── picomatch@2.2.2 deduped
│ │ │ └── picomatch@2.2.2
│ │ ├── find-cache-dir@3.3.1 deduped
│ │ ├─┬ glob-parent@5.1.1
│ │ │ └── is-glob@4.0.1 deduped
│ │ ├─┬ globby@11.0.1
│ │ │ ├── array-union@2.1.0
│ │ │ ├─┬ dir-glob@3.0.1
│ │ │ │ └── path-type@4.0.0
│ │ │ ├── fast-glob@3.2.4 deduped
│ │ │ ├── ignore@5.1.8
│ │ │ ├── merge2@1.4.1 deduped
│ │ │ └── slash@3.0.0
│ │ ├── loader-utils@2.0.0 deduped
│ │ ├── normalize-path@3.0.0
│ │ ├─┬ p-limit@3.0.2
│ │ │ └── p-try@2.2.0
│ │ ├── schema-utils@2.7.1 deduped
│ │ ├─┬ serialize-javascript@4.0.0
│ │ │ └─┬ randombytes@2.1.0
│ │ │   └── safe-buffer@5.1.2 deduped
│ │ └── webpack-sources@1.4.3 deduped
│ ├── core-js@3.6.4
│ ├─┬ css-loader@3.5.3
│ │ ├── camelcase@5.3.1
│ │ ├── cssesc@3.0.0
│ │ ├─┬ icss-utils@4.1.1
│ │ │ └── postcss@7.0.31 deduped
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├── normalize-path@3.0.0 deduped
│ │ ├── postcss@7.0.31 deduped
│ │ ├─┬ postcss-modules-extract-imports@2.0.0
│ │ │ └── postcss@7.0.31 deduped
│ │ ├─┬ postcss-modules-local-by-default@3.0.3
│ │ │ ├── icss-utils@4.1.1 deduped
│ │ │ ├─┬ postcss@7.0.35
│ │ │ │ ├── chalk@2.4.2 deduped
│ │ │ │ ├── source-map@0.6.1
│ │ │ │ └─┬ supports-color@6.1.0
│ │ │ │   └── has-flag@3.0.0 deduped
│ │ │ ├─┬ postcss-selector-parser@6.0.4
│ │ │ │ ├── cssesc@3.0.0 deduped
│ │ │ │ ├── indexes-of@1.0.1
│ │ │ │ ├── uniq@1.0.1
│ │ │ │ └── util-deprecate@1.0.2
│ │ │ └── postcss-value-parser@4.1.0 deduped
│ │ ├─┬ postcss-modules-scope@2.2.0
│ │ │ ├── postcss@7.0.31 deduped
│ │ │ └── postcss-selector-parser@6.0.4 deduped
│ │ ├─┬ postcss-modules-values@3.0.0
│ │ │ ├── icss-utils@4.1.1 deduped
│ │ │ └── postcss@7.0.31 deduped
│ │ ├── postcss-value-parser@4.1.0 deduped
│ │ ├── schema-utils@2.7.1 deduped
│ │ └── semver@6.3.0
│ ├─┬ cssnano@4.1.10
│ │ ├─┬ cosmiconfig@5.2.1
│ │ │ ├─┬ import-fresh@2.0.0
│ │ │ │ ├─┬ caller-path@2.0.0
│ │ │ │ │ └─┬ caller-callsite@2.0.0
│ │ │ │ │   └── callsites@2.0.0
│ │ │ │ └── resolve-from@3.0.0
│ │ │ ├── is-directory@0.3.1
│ │ │ ├── js-yaml@3.14.0 deduped
│ │ │ └─┬ parse-json@4.0.0
│ │ │   ├─┬ error-ex@1.3.2
│ │ │   │ └── is-arrayish@0.2.1
│ │ │   └── json-parse-better-errors@1.0.2 deduped
│ │ ├─┬ cssnano-preset-default@4.0.7
│ │ │ ├─┬ css-declaration-sorter@4.0.1
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── timsort@0.3.0
│ │ │ ├─┬ cssnano-util-raw-cache@4.0.1
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-calc@7.0.5
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ ├── postcss-selector-parser@6.0.4 deduped
│ │ │ │ └── postcss-value-parser@4.1.0 deduped
│ │ │ ├─┬ postcss-colormin@4.0.3
│ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ ├─┬ color@3.1.2
│ │ │ │ │ ├── color-convert@1.9.3 deduped
│ │ │ │ │ └─┬ color-string@1.5.3
│ │ │ │ │   ├── color-name@1.1.3 deduped
│ │ │ │ │   └─┬ simple-swizzle@0.2.2
│ │ │ │ │     └── is-arrayish@0.3.2
│ │ │ │ ├─┬ has@1.0.3
│ │ │ │ │ └── function-bind@1.1.1
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-convert-values@4.0.1
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-discard-comments@4.0.2
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-discard-duplicates@4.0.2
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-discard-empty@4.0.1
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-discard-overridden@4.0.1
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-merge-longhand@4.0.11
│ │ │ │ ├── css-color-names@0.0.4
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ ├── postcss-value-parser@3.3.1
│ │ │ │ └─┬ stylehacks@4.0.3
│ │ │ │   ├── browserslist@4.14.5 deduped
│ │ │ │   ├── postcss@7.0.31 deduped
│ │ │ │   └─┬ postcss-selector-parser@3.1.2
│ │ │ │     ├── dot-prop@5.3.0 deduped
│ │ │ │     ├── indexes-of@1.0.1 deduped
│ │ │ │     └── uniq@1.0.1 deduped
│ │ │ ├─┬ postcss-merge-rules@4.0.3
│ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ ├─┬ caniuse-api@3.0.0
│ │ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ │ ├── caniuse-lite@1.0.30001144 deduped
│ │ │ │ │ ├── lodash.memoize@4.1.2
│ │ │ │ │ └── lodash.uniq@4.5.0
│ │ │ │ ├── cssnano-util-same-parent@4.0.1
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ ├─┬ postcss-selector-parser@3.1.2
│ │ │ │ │ ├─┬ dot-prop@5.3.0
│ │ │ │ │ │ └── is-obj@2.0.0
│ │ │ │ │ ├── indexes-of@1.0.1 deduped
│ │ │ │ │ └── uniq@1.0.1 deduped
│ │ │ │ └── vendors@1.0.4
│ │ │ ├─┬ postcss-minify-font-values@4.0.2
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-minify-gradients@4.0.2
│ │ │ │ ├── cssnano-util-get-arguments@4.0.0
│ │ │ │ ├─┬ is-color-stop@1.1.0
│ │ │ │ │ ├── css-color-names@0.0.4 deduped
│ │ │ │ │ ├── hex-color-regex@1.1.0
│ │ │ │ │ ├── hsl-regex@1.0.0
│ │ │ │ │ ├── hsla-regex@1.0.0
│ │ │ │ │ ├── rgb-regex@1.0.1
│ │ │ │ │ └── rgba-regex@1.0.0
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-minify-params@4.0.2
│ │ │ │ ├── alphanum-sort@1.0.2
│ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ ├── cssnano-util-get-arguments@4.0.0 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ ├── postcss-value-parser@3.3.1
│ │ │ │ └── uniqs@2.0.0
│ │ │ ├─┬ postcss-minify-selectors@4.0.2
│ │ │ │ ├── alphanum-sort@1.0.2 deduped
│ │ │ │ ├── has@1.0.3 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └─┬ postcss-selector-parser@3.1.2
│ │ │ │   ├── dot-prop@5.3.0 deduped
│ │ │ │   ├── indexes-of@1.0.1 deduped
│ │ │ │   └── uniq@1.0.1 deduped
│ │ │ ├─┬ postcss-normalize-charset@4.0.1
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-normalize-display-values@4.0.2
│ │ │ │ ├── cssnano-util-get-match@4.0.0
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-positions@4.0.2
│ │ │ │ ├── cssnano-util-get-arguments@4.0.0 deduped
│ │ │ │ ├── has@1.0.3 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-repeat-style@4.0.2
│ │ │ │ ├── cssnano-util-get-arguments@4.0.0 deduped
│ │ │ │ ├── cssnano-util-get-match@4.0.0 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-string@4.0.2
│ │ │ │ ├── has@1.0.3 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-timing-functions@4.0.2
│ │ │ │ ├── cssnano-util-get-match@4.0.0 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-unicode@4.0.1
│ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-url@4.0.1
│ │ │ │ ├── is-absolute-url@2.1.0
│ │ │ │ ├── normalize-url@3.3.0
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-normalize-whitespace@4.0.2
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-ordered-values@4.1.2
│ │ │ │ ├── cssnano-util-get-arguments@4.0.0 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-reduce-initial@4.0.3
│ │ │ │ ├── browserslist@4.14.5 deduped
│ │ │ │ ├── caniuse-api@3.0.0 deduped
│ │ │ │ ├── has@1.0.3 deduped
│ │ │ │ └── postcss@7.0.31 deduped
│ │ │ ├─┬ postcss-reduce-transforms@4.0.2
│ │ │ │ ├── cssnano-util-get-match@4.0.0 deduped
│ │ │ │ ├── has@1.0.3 deduped
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ └── postcss-value-parser@3.3.1
│ │ │ ├─┬ postcss-svgo@4.0.2
│ │ │ │ ├─┬ is-svg@3.0.0
│ │ │ │ │ └── html-comment-regex@1.1.2
│ │ │ │ ├── postcss@7.0.31 deduped
│ │ │ │ ├── postcss-value-parser@3.3.1
│ │ │ │ └─┬ svgo@1.3.2
│ │ │ │   ├── chalk@2.4.2 deduped
│ │ │ │   ├─┬ coa@2.0.2
│ │ │ │   │ ├── @types/q@1.5.4
│ │ │ │   │ ├── chalk@2.4.2 deduped
│ │ │ │   │ └── q@1.5.1
│ │ │ │   ├─┬ css-select@2.1.0
│ │ │ │   │ ├── boolbase@1.0.0
│ │ │ │   │ ├── css-what@3.4.1
│ │ │ │   │ ├─┬ domutils@1.7.0
│ │ │ │   │ │ ├─┬ dom-serializer@0.2.2
│ │ │ │   │ │ │ ├── domelementtype@2.0.2
│ │ │ │   │ │ │ └── entities@2.0.3
│ │ │ │   │ │ └── domelementtype@1.3.1
│ │ │ │   │ └─┬ nth-check@1.0.2
│ │ │ │   │   └── boolbase@1.0.0 deduped
│ │ │ │   ├── css-select-base-adapter@0.1.1
│ │ │ │   ├─┬ css-tree@1.0.0-alpha.37
│ │ │ │   │ ├── mdn-data@2.0.4
│ │ │ │   │ └── source-map@0.6.1
│ │ │ │   ├─┬ csso@4.0.3
│ │ │ │   │ └─┬ css-tree@1.0.0-alpha.39
│ │ │ │   │   ├── mdn-data@2.0.6
│ │ │ │   │   └── source-map@0.6.1
│ │ │ │   ├── js-yaml@3.14.0 deduped
│ │ │ │   ├── mkdirp@0.5.5 deduped
│ │ │ │   ├─┬ object.values@1.1.1
│ │ │ │   │ ├── define-properties@1.1.3 deduped
│ │ │ │   │ ├─┬ es-abstract@1.17.7
│ │ │ │   │ │ ├── es-to-primitive@1.2.1 deduped
│ │ │ │   │ │ ├── function-bind@1.1.1 deduped
│ │ │ │   │ │ ├── has@1.0.3 deduped
│ │ │ │   │ │ ├── has-symbols@1.0.1 deduped
│ │ │ │   │ │ ├── is-callable@1.2.2 deduped
│ │ │ │   │ │ ├── is-regex@1.1.1 deduped
│ │ │ │   │ │ ├── object-inspect@1.8.0 deduped
│ │ │ │   │ │ ├── object-keys@1.1.1 deduped
│ │ │ │   │ │ ├── object.assign@4.1.1 deduped
│ │ │ │   │ │ ├── string.prototype.trimend@1.0.1 deduped
│ │ │ │   │ │ └── string.prototype.trimstart@1.0.1 deduped
│ │ │ │   │ ├── function-bind@1.1.1 deduped
│ │ │ │   │ └── has@1.0.3 deduped
│ │ │ │   ├── sax@1.2.4 deduped
│ │ │ │   ├── stable@0.1.8
│ │ │ │   ├── unquote@1.1.1
│ │ │ │   └─┬ util.promisify@1.0.1
│ │ │ │     ├── define-properties@1.1.3 deduped
│ │ │ │     ├─┬ es-abstract@1.17.7
│ │ │ │     │ ├── es-to-primitive@1.2.1 deduped
│ │ │ │     │ ├── function-bind@1.1.1 deduped
│ │ │ │     │ ├── has@1.0.3 deduped
│ │ │ │     │ ├── has-symbols@1.0.1 deduped
│ │ │ │     │ ├── is-callable@1.2.2 deduped
│ │ │ │     │ ├── is-regex@1.1.1 deduped
│ │ │ │     │ ├── object-inspect@1.8.0 deduped
│ │ │ │     │ ├── object-keys@1.1.1 deduped
│ │ │ │     │ ├── object.assign@4.1.1 deduped
│ │ │ │     │ ├── string.prototype.trimend@1.0.1 deduped
│ │ │ │     │ └── string.prototype.trimstart@1.0.1 deduped
│ │ │ │     ├── has-symbols@1.0.1 deduped
│ │ │ │     └── object.getownpropertydescriptors@2.1.0 deduped
│ │ │ └─┬ postcss-unique-selectors@4.0.1
│ │ │   ├── alphanum-sort@1.0.2 deduped
│ │ │   ├── postcss@7.0.31 deduped
│ │ │   └── uniqs@2.0.0 deduped
│ │ ├── is-resolvable@1.1.0
│ │ └── postcss@7.0.31 deduped
│ ├─┬ file-loader@6.0.0
│ │ ├── loader-utils@2.0.0 deduped
│ │ └── schema-utils@2.7.1 deduped
│ ├─┬ find-cache-dir@3.3.1
│ │ ├── commondir@1.0.1
│ │ ├─┬ make-dir@3.1.0
│ │ │ └── semver@6.3.0
│ │ └─┬ pkg-dir@4.2.0
│ │   └─┬ find-up@4.1.0
│ │     ├─┬ locate-path@5.0.0
│ │     │ └─┬ p-locate@4.1.0
│ │     │   └── p-limit@2.3.0 deduped
│ │     └── path-exists@4.0.0
│ ├─┬ glob@7.1.6
│ │ ├── fs.realpath@1.0.0
│ │ ├─┬ inflight@1.0.6
│ │ │ ├── once@1.4.0 deduped
│ │ │ └── wrappy@1.0.2
│ │ ├── inherits@2.0.4
│ │ ├── minimatch@3.0.4 deduped
│ │ ├─┬ once@1.4.0
│ │ │ └── wrappy@1.0.2 deduped
│ │ └── path-is-absolute@1.0.1
│ ├─┬ jest-worker@26.0.0
│ │ ├── merge-stream@2.0.0
│ │ └─┬ supports-color@7.2.0
│ │   └── has-flag@4.0.0
│ ├─┬ karma-source-map-support@1.4.0
│ │ └── source-map-support@0.5.19 deduped
│ ├─┬ less-loader@6.1.0
│ │ ├── clone@2.1.2
│ │ ├─┬ less@3.12.2
│ │ │ ├─┬ errno@0.1.7
│ │ │ │ └── prr@1.0.1
│ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ ├── image-size@0.5.5
│ │ │ ├── make-dir@2.1.0 deduped
│ │ │ ├── mime@1.6.0
│ │ │ ├── native-request@1.0.7
│ │ │ ├── source-map@0.6.1
│ │ │ └── tslib@1.13.0
│ │ ├── loader-utils@2.0.0 deduped
│ │ └── schema-utils@2.7.1 deduped
│ ├─┬ license-webpack-plugin@2.2.0
│ │ ├─┬ @types/webpack-sources@0.1.8
│ │ │ ├── @types/node@12.12.64 deduped
│ │ │ ├── @types/source-list-map@0.1.2
│ │ │ └── source-map@0.6.1
│ │ └── webpack-sources@1.4.3 deduped
│ ├─┬ loader-utils@2.0.0
│ │ ├── big.js@5.2.2
│ │ ├── emojis-list@3.0.0
│ │ └── json5@2.1.3 deduped
│ ├─┬ mini-css-extract-plugin@0.9.0
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├─┬ normalize-url@1.9.1
│ │ │ ├── object-assign@4.1.1
│ │ │ ├── prepend-http@1.0.4
│ │ │ ├─┬ query-string@4.3.4
│ │ │ │ ├── object-assign@4.1.1 deduped
│ │ │ │ └── strict-uri-encode@1.1.0
│ │ │ └─┬ sort-keys@1.1.2
│ │ │   └── is-plain-obj@1.1.0
│ │ ├─┬ schema-utils@1.0.0
│ │ │ ├── ajv@6.12.3 deduped
│ │ │ ├── ajv-errors@1.0.1
│ │ │ └── ajv-keywords@3.5.2 deduped
│ │ └── webpack-sources@1.4.3 deduped
│ ├─┬ minimatch@3.0.4
│ │ └─┬ brace-expansion@1.1.11
│ │   ├── balanced-match@1.0.0
│ │   └── concat-map@0.0.1
│ ├─┬ open@7.0.4
│ │ ├── is-docker@2.1.1
│ │ └─┬ is-wsl@2.2.0
│ │   └── is-docker@2.1.1 deduped
│ ├── parse5@4.0.0
│ ├─┬ pnp-webpack-plugin@1.6.4
│ │ └── ts-pnp@1.2.0
│ ├─┬ postcss@7.0.31
│ │ ├── chalk@2.4.2 deduped
│ │ ├── source-map@0.6.1
│ │ └─┬ supports-color@6.1.0
│ │   └── has-flag@3.0.0
│ ├─┬ postcss-import@12.0.1
│ │ ├── postcss@7.0.31 deduped
│ │ ├── postcss-value-parser@3.3.1
│ │ ├─┬ read-cache@1.0.0
│ │ │ └── pify@2.3.0
│ │ └── resolve@1.17.0 deduped
│ ├─┬ postcss-loader@3.0.0
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├── postcss@7.0.31 deduped
│ │ ├─┬ postcss-load-config@2.1.2
│ │ │ ├── cosmiconfig@5.2.1 deduped
│ │ │ └─┬ import-cwd@2.1.0
│ │ │   └─┬ import-from@2.1.0
│ │ │     └── resolve-from@3.0.0 deduped
│ │ └─┬ schema-utils@1.0.0
│ │   ├── ajv@6.12.3 deduped
│ │   ├── ajv-errors@1.0.1 deduped
│ │   └── ajv-keywords@3.5.2 deduped
│ ├─┬ raw-loader@4.0.1
│ │ ├── loader-utils@2.0.0 deduped
│ │ └── schema-utils@2.7.1 deduped
│ ├── regenerator-runtime@0.13.5
│ ├─┬ resolve-url-loader@3.1.1
│ │ ├─┬ adjust-sourcemap-loader@2.0.0
│ │ │ ├─┬ assert@1.4.1
│ │ │ │ └─┬ util@0.10.3
│ │ │ │   └── inherits@2.0.1
│ │ │ ├── camelcase@5.0.0
│ │ │ ├─┬ loader-utils@1.2.3
│ │ │ │ ├── big.js@5.2.2 deduped
│ │ │ │ ├── emojis-list@2.1.0
│ │ │ │ └─┬ json5@1.0.1
│ │ │ │   └── minimist@1.2.5 deduped
│ │ │ ├── object-path@0.11.4
│ │ │ └── regex-parser@2.2.10
│ │ ├── camelcase@5.3.1 deduped
│ │ ├─┬ compose-function@3.0.3
│ │ │ └── arity-n@1.0.4
│ │ ├── convert-source-map@1.7.0 deduped
│ │ ├─┬ es6-iterator@2.0.3
│ │ │ ├─┬ d@1.0.1
│ │ │ │ ├── es5-ext@0.10.53 deduped
│ │ │ │ └── type@1.2.0
│ │ │ ├─┬ es5-ext@0.10.53
│ │ │ │ ├── es6-iterator@2.0.3 deduped
│ │ │ │ ├── es6-symbol@3.1.3 deduped
│ │ │ │ └── next-tick@1.0.0
│ │ │ └─┬ es6-symbol@3.1.3
│ │ │   ├── d@1.0.1 deduped
│ │ │   └─┬ ext@1.4.0
│ │ │     └── type@2.1.0
│ │ ├─┬ loader-utils@1.2.3
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@2.1.0
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├─┬ postcss@7.0.21
│ │ │ ├── chalk@2.4.2 deduped
│ │ │ ├── source-map@0.6.1 deduped
│ │ │ └─┬ supports-color@6.1.0
│ │ │   └── has-flag@3.0.0 deduped
│ │ ├─┬ rework@1.0.1
│ │ │ ├── convert-source-map@0.3.5
│ │ │ └─┬ css@2.2.4
│ │ │   ├── inherits@2.0.4 deduped
│ │ │   ├── source-map@0.6.1
│ │ │   ├─┬ source-map-resolve@0.5.3
│ │ │   │ ├── atob@2.1.2
│ │ │   │ ├── decode-uri-component@0.2.0
│ │ │   │ ├── resolve-url@0.2.1
│ │ │   │ ├── source-map-url@0.4.0
│ │ │   │ └── urix@0.1.0 deduped
│ │ │   └── urix@0.1.0
│ │ ├── rework-visit@1.0.0
│ │ └── source-map@0.6.1
│ ├─┬ rimraf@3.0.2
│ │ └── glob@7.1.6 deduped
│ ├─┬ rollup@2.10.9
│ │ └── UNMET OPTIONAL DEPENDENCY fsevents@2.1.3
│ ├── rxjs@6.5.5 deduped
│ ├─┬ sass@1.26.5
│ │ └── chokidar@3.4.2 deduped
│ ├─┬ sass-loader@8.0.2
│ │ ├─┬ clone-deep@4.0.1
│ │ │ ├─┬ is-plain-object@2.0.4
│ │ │ │ └── isobject@3.0.1
│ │ │ ├── kind-of@6.0.3
│ │ │ └─┬ shallow-clone@3.0.1
│ │ │   └── kind-of@6.0.3 deduped
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├── neo-async@2.6.2
│ │ ├── schema-utils@2.7.1 deduped
│ │ └── semver@6.3.0
│ ├── semver@7.3.2
│ ├── source-map@0.7.3
│ ├─┬ source-map-loader@1.0.0
│ │ ├─┬ data-urls@2.0.0
│ │ │ ├── abab@2.0.5
│ │ │ ├── whatwg-mimetype@2.3.0
│ │ │ └─┬ whatwg-url@8.3.0
│ │ │   ├── lodash.sortby@4.7.0
│ │ │   ├─┬ tr46@2.0.2
│ │ │   │ └── punycode@2.1.1
│ │ │   └── webidl-conversions@6.1.0
│ │ ├─┬ iconv-lite@0.5.2
│ │ │ └── safer-buffer@2.1.2 deduped
│ │ ├── loader-utils@2.0.0 deduped
│ │ ├── schema-utils@2.7.1 deduped
│ │ └── source-map@0.6.1
│ ├─┬ source-map-support@0.5.19
│ │ ├── buffer-from@1.1.1
│ │ └── source-map@0.6.1
│ ├─┬ speed-measure-webpack-plugin@1.3.3
│ │ └── chalk@2.4.2 deduped
│ ├─┬ style-loader@1.2.1
│ │ ├── loader-utils@2.0.0 deduped
│ │ └── schema-utils@2.7.1 deduped
│ ├─┬ stylus@0.54.7
│ │ ├─┬ css-parse@2.0.0
│ │ │ └── css@2.2.4 deduped
│ │ ├─┬ debug@3.1.0
│ │ │ └── ms@2.0.0
│ │ ├── glob@7.1.6 deduped
│ │ ├── mkdirp@0.5.5 deduped
│ │ ├── safer-buffer@2.1.2
│ │ ├── sax@1.2.4
│ │ ├── semver@6.3.0
│ │ └── source-map@0.7.3 deduped
│ ├─┬ stylus-loader@3.0.2
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├── lodash.clonedeep@4.5.0
│ │ └── when@3.6.4
│ ├─┬ terser@4.7.0
│ │ ├── commander@2.20.3 deduped
│ │ ├── source-map@0.6.1
│ │ └── source-map-support@0.5.19 deduped
│ ├─┬ terser-webpack-plugin@3.0.1
│ │ ├── cacache@15.0.3 deduped
│ │ ├── find-cache-dir@3.3.1 deduped
│ │ ├── jest-worker@26.0.0 deduped
│ │ ├─┬ p-limit@2.3.0
│ │ │ └── p-try@2.2.0 deduped
│ │ ├── schema-utils@2.7.1 deduped
│ │ ├─┬ serialize-javascript@3.1.0
│ │ │ └── randombytes@2.1.0 deduped
│ │ ├── source-map@0.6.1
│ │ ├── terser@4.7.0 deduped
│ │ └── webpack-sources@1.4.3 deduped
│ ├── tree-kill@1.2.2
│ ├─┬ webpack@4.43.0
│ │ ├─┬ @webassemblyjs/ast@1.9.0
│ │ │ ├── @webassemblyjs/helper-module-context@1.9.0 deduped
│ │ │ ├── @webassemblyjs/helper-wasm-bytecode@1.9.0
│ │ │ └─┬ @webassemblyjs/wast-parser@1.9.0
│ │ │   ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │   ├── @webassemblyjs/floating-point-hex-parser@1.9.0
│ │ │   ├── @webassemblyjs/helper-api-error@1.9.0 deduped
│ │ │   ├─┬ @webassemblyjs/helper-code-frame@1.9.0
│ │ │   │ └── @webassemblyjs/wast-printer@1.9.0 deduped
│ │ │   ├── @webassemblyjs/helper-fsm@1.9.0
│ │ │   └── @xtuc/long@4.2.2
│ │ ├─┬ @webassemblyjs/helper-module-context@1.9.0
│ │ │ └── @webassemblyjs/ast@1.9.0 deduped
│ │ ├─┬ @webassemblyjs/wasm-edit@1.9.0
│ │ │ ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │ ├── @webassemblyjs/helper-buffer@1.9.0
│ │ │ ├── @webassemblyjs/helper-wasm-bytecode@1.9.0 deduped
│ │ │ ├─┬ @webassemblyjs/helper-wasm-section@1.9.0
│ │ │ │ ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/helper-buffer@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/helper-wasm-bytecode@1.9.0 deduped
│ │ │ │ └── @webassemblyjs/wasm-gen@1.9.0 deduped
│ │ │ ├─┬ @webassemblyjs/wasm-gen@1.9.0
│ │ │ │ ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/helper-wasm-bytecode@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/ieee754@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/leb128@1.9.0 deduped
│ │ │ │ └── @webassemblyjs/utf8@1.9.0 deduped
│ │ │ ├─┬ @webassemblyjs/wasm-opt@1.9.0
│ │ │ │ ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/helper-buffer@1.9.0 deduped
│ │ │ │ ├── @webassemblyjs/wasm-gen@1.9.0 deduped
│ │ │ │ └── @webassemblyjs/wasm-parser@1.9.0 deduped
│ │ │ ├── @webassemblyjs/wasm-parser@1.9.0 deduped
│ │ │ └─┬ @webassemblyjs/wast-printer@1.9.0
│ │ │   ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │   ├── @webassemblyjs/wast-parser@1.9.0 deduped
│ │ │   └── @xtuc/long@4.2.2 deduped
│ │ ├─┬ @webassemblyjs/wasm-parser@1.9.0
│ │ │ ├── @webassemblyjs/ast@1.9.0 deduped
│ │ │ ├── @webassemblyjs/helper-api-error@1.9.0
│ │ │ ├── @webassemblyjs/helper-wasm-bytecode@1.9.0 deduped
│ │ │ ├─┬ @webassemblyjs/ieee754@1.9.0
│ │ │ │ └── @xtuc/ieee754@1.2.0
│ │ │ ├─┬ @webassemblyjs/leb128@1.9.0
│ │ │ │ └── @xtuc/long@4.2.2 deduped
│ │ │ └── @webassemblyjs/utf8@1.9.0
│ │ ├── acorn@6.4.2
│ │ ├── ajv@6.12.3 deduped
│ │ ├── ajv-keywords@3.5.2
│ │ ├─┬ chrome-trace-event@1.0.2
│ │ │ └── tslib@1.13.0
│ │ ├── enhanced-resolve@4.1.1 deduped
│ │ ├─┬ eslint-scope@4.0.3
│ │ │ ├─┬ esrecurse@4.3.0
│ │ │ │ └── estraverse@5.2.0
│ │ │ └── estraverse@4.3.0
│ │ ├── json-parse-better-errors@1.0.2
│ │ ├── loader-runner@2.4.0
│ │ ├─┬ loader-utils@1.4.0
│ │ │ ├── big.js@5.2.2 deduped
│ │ │ ├── emojis-list@3.0.0 deduped
│ │ │ └─┬ json5@1.0.1
│ │ │   └── minimist@1.2.5 deduped
│ │ ├─┬ memory-fs@0.4.1
│ │ │ ├── errno@0.1.7 deduped
│ │ │ └── readable-stream@2.3.7 deduped
│ │ ├─┬ micromatch@3.1.10
│ │ │ ├── arr-diff@4.0.0
│ │ │ ├── array-unique@0.3.2
│ │ │ ├─┬ braces@2.3.2
│ │ │ │ ├── arr-flatten@1.1.0
│ │ │ │ ├── array-unique@0.3.2 deduped
│ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ ├─┬ fill-range@4.0.0
│ │ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ │ ├─┬ is-number@3.0.0
│ │ │ │ │ │ └─┬ kind-of@3.2.2
│ │ │ │ │ │   └── is-buffer@1.1.6
│ │ │ │ │ ├── repeat-string@1.6.1
│ │ │ │ │ └─┬ to-regex-range@2.1.1
│ │ │ │ │   ├── is-number@3.0.0 deduped
│ │ │ │ │   └── repeat-string@1.6.1 deduped
│ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ ├── repeat-element@1.1.3
│ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ ├─┬ snapdragon-node@2.1.1
│ │ │ │ │ ├─┬ define-property@1.0.0
│ │ │ │ │ │ └─┬ is-descriptor@1.0.2
│ │ │ │ │ │   ├─┬ is-accessor-descriptor@1.0.0
│ │ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │ │   ├─┬ is-data-descriptor@1.0.0
│ │ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │ │   └── kind-of@6.0.3 deduped
│ │ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ │ └─┬ snapdragon-util@3.0.1
│ │ │ │ │   └─┬ kind-of@3.2.2
│ │ │ │ │     └── is-buffer@1.1.6
│ │ │ │ ├─┬ split-string@3.1.0
│ │ │ │ │ └── extend-shallow@3.0.2 deduped
│ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ ├─┬ define-property@2.0.2
│ │ │ │ ├─┬ is-descriptor@1.0.2
│ │ │ │ │ ├─┬ is-accessor-descriptor@1.0.0
│ │ │ │ │ │ └── kind-of@6.0.3 deduped
│ │ │ │ │ ├─┬ is-data-descriptor@1.0.0
│ │ │ │ │ │ └── kind-of@6.0.3 deduped
│ │ │ │ │ └── kind-of@6.0.3 deduped
│ │ │ │ └── isobject@3.0.1 deduped
│ │ │ ├─┬ extend-shallow@3.0.2
│ │ │ │ ├── assign-symbols@1.0.0
│ │ │ │ └─┬ is-extendable@1.0.1
│ │ │ │   └── is-plain-object@2.0.4 deduped
│ │ │ ├─┬ extglob@2.0.4
│ │ │ │ ├── array-unique@0.3.2 deduped
│ │ │ │ ├─┬ define-property@1.0.0
│ │ │ │ │ └─┬ is-descriptor@1.0.2
│ │ │ │ │   ├─┬ is-accessor-descriptor@1.0.0
│ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │   ├─┬ is-data-descriptor@1.0.0
│ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │   └── kind-of@6.0.3 deduped
│ │ │ │ ├─┬ expand-brackets@2.1.4
│ │ │ │ │ ├─┬ debug@2.6.9
│ │ │ │ │ │ └── ms@2.0.0 deduped
│ │ │ │ │ ├─┬ define-property@0.2.5
│ │ │ │ │ │ └── is-descriptor@0.1.6 deduped
│ │ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ │ ├── posix-character-classes@0.1.1
│ │ │ │ │ ├── regex-not@1.0.2 deduped
│ │ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ └── is-extendable@0.1.1
│ │ │ │ ├── fragment-cache@0.2.1 deduped
│ │ │ │ ├── regex-not@1.0.2 deduped
│ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ ├─┬ fragment-cache@0.2.1
│ │ │ │ └── map-cache@0.2.2
│ │ │ ├── kind-of@6.0.3 deduped
│ │ │ ├─┬ nanomatch@1.2.13
│ │ │ │ ├── arr-diff@4.0.0 deduped
│ │ │ │ ├── array-unique@0.3.2 deduped
│ │ │ │ ├── define-property@2.0.2 deduped
│ │ │ │ ├── extend-shallow@3.0.2 deduped
│ │ │ │ ├── fragment-cache@0.2.1 deduped
│ │ │ │ ├── is-windows@1.0.2
│ │ │ │ ├── kind-of@6.0.3 deduped
│ │ │ │ ├── object.pick@1.3.0 deduped
│ │ │ │ ├── regex-not@1.0.2 deduped
│ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ ├─┬ object.pick@1.3.0
│ │ │ │ └── isobject@3.0.1 deduped
│ │ │ ├─┬ regex-not@1.0.2
│ │ │ │ ├── extend-shallow@3.0.2 deduped
│ │ │ │ └─┬ safe-regex@1.1.0
│ │ │ │   └── ret@0.1.15
│ │ │ ├─┬ snapdragon@0.8.2
│ │ │ │ ├─┬ base@0.11.2
│ │ │ │ │ ├─┬ cache-base@1.0.1
│ │ │ │ │ │ ├─┬ collection-visit@1.0.0
│ │ │ │ │ │ │ ├─┬ map-visit@1.0.0
│ │ │ │ │ │ │ │ └── object-visit@1.0.1 deduped
│ │ │ │ │ │ │ └─┬ object-visit@1.0.1
│ │ │ │ │ │ │   └── isobject@3.0.1 deduped
│ │ │ │ │ │ ├── component-emitter@1.3.0 deduped
│ │ │ │ │ │ ├── get-value@2.0.6
│ │ │ │ │ │ ├─┬ has-value@1.0.0
│ │ │ │ │ │ │ ├── get-value@2.0.6 deduped
│ │ │ │ │ │ │ ├─┬ has-values@1.0.0
│ │ │ │ │ │ │ │ ├─┬ is-number@3.0.0
│ │ │ │ │ │ │ │ │ └─┬ kind-of@3.2.2
│ │ │ │ │ │ │ │ │   └── is-buffer@1.1.6 deduped
│ │ │ │ │ │ │ │ └─┬ kind-of@4.0.0
│ │ │ │ │ │ │ │   └── is-buffer@1.1.6
│ │ │ │ │ │ │ └── isobject@3.0.1 deduped
│ │ │ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ │ │ ├─┬ set-value@2.0.1
│ │ │ │ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ │ │ │ ├── is-extendable@0.1.1 deduped
│ │ │ │ │ │ │ ├── is-plain-object@2.0.4 deduped
│ │ │ │ │ │ │ └── split-string@3.1.0 deduped
│ │ │ │ │ │ ├─┬ to-object-path@0.3.0
│ │ │ │ │ │ │ └─┬ kind-of@3.2.2
│ │ │ │ │ │ │   └── is-buffer@1.1.6
│ │ │ │ │ │ ├─┬ union-value@1.0.1
│ │ │ │ │ │ │ ├── arr-union@3.1.0 deduped
│ │ │ │ │ │ │ ├── get-value@2.0.6 deduped
│ │ │ │ │ │ │ ├── is-extendable@0.1.1 deduped
│ │ │ │ │ │ │ └── set-value@2.0.1 deduped
│ │ │ │ │ │ └─┬ unset-value@1.0.0
│ │ │ │ │ │   ├─┬ has-value@0.3.1
│ │ │ │ │ │   │ ├── get-value@2.0.6 deduped
│ │ │ │ │ │   │ ├── has-values@0.1.4
│ │ │ │ │ │   │ └─┬ isobject@2.1.0
│ │ │ │ │ │   │   └── isarray@1.0.0 deduped
│ │ │ │ │ │   └── isobject@3.0.1 deduped
│ │ │ │ │ ├─┬ class-utils@0.3.6
│ │ │ │ │ │ ├── arr-union@3.1.0
│ │ │ │ │ │ ├─┬ define-property@0.2.5
│ │ │ │ │ │ │ └── is-descriptor@0.1.6 deduped
│ │ │ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ │ │ └─┬ static-extend@0.1.2
│ │ │ │ │ │   ├─┬ define-property@0.2.5
│ │ │ │ │ │   │ └── is-descriptor@0.1.6 deduped
│ │ │ │ │ │   └─┬ object-copy@0.1.0
│ │ │ │ │ │     ├── copy-descriptor@0.1.1
│ │ │ │ │ │     ├─┬ define-property@0.2.5
│ │ │ │ │ │     │ └── is-descriptor@0.1.6 deduped
│ │ │ │ │ │     └─┬ kind-of@3.2.2
│ │ │ │ │ │       └── is-buffer@1.1.6
│ │ │ │ │ ├── component-emitter@1.3.0 deduped
│ │ │ │ │ ├─┬ define-property@1.0.0
│ │ │ │ │ │ └─┬ is-descriptor@1.0.2
│ │ │ │ │ │   ├─┬ is-accessor-descriptor@1.0.0
│ │ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │ │   ├─┬ is-data-descriptor@1.0.0
│ │ │ │ │ │   │ └── kind-of@6.0.3 deduped
│ │ │ │ │ │   └── kind-of@6.0.3 deduped
│ │ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ │ ├─┬ mixin-deep@1.3.2
│ │ │ │ │ │ ├── for-in@1.0.2
│ │ │ │ │ │ └─┬ is-extendable@1.0.1
│ │ │ │ │ │   └── is-plain-object@2.0.4 deduped
│ │ │ │ │ └── pascalcase@0.1.1
│ │ │ │ ├─┬ debug@2.6.9
│ │ │ │ │ └── ms@2.0.0 deduped
│ │ │ │ ├─┬ define-property@0.2.5
│ │ │ │ │ └─┬ is-descriptor@0.1.6
│ │ │ │ │   ├─┬ is-accessor-descriptor@0.1.6
│ │ │ │ │   │ └─┬ kind-of@3.2.2
│ │ │ │ │   │   └── is-buffer@1.1.6
│ │ │ │ │   ├─┬ is-data-descriptor@0.1.4
│ │ │ │ │   │ └─┬ kind-of@3.2.2
│ │ │ │ │   │   └── is-buffer@1.1.6
│ │ │ │ │   └── kind-of@5.1.0
│ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ ├── map-cache@0.2.2 deduped
│ │ │ │ ├── source-map@0.5.7
│ │ │ │ ├── source-map-resolve@0.5.3 deduped
│ │ │ │ └── use@3.1.1
│ │ │ └─┬ to-regex@3.0.2
│ │ │   ├── define-property@2.0.2 deduped
│ │ │   ├── extend-shallow@3.0.2 deduped
│ │ │   ├── regex-not@1.0.2 deduped
│ │ │   └── safe-regex@1.1.0 deduped
│ │ ├── mkdirp@0.5.5 deduped
│ │ ├── neo-async@2.6.2 deduped
│ │ ├─┬ node-libs-browser@2.2.1
│ │ │ ├── assert@1.4.1 deduped
│ │ │ ├─┬ browserify-zlib@0.2.0
│ │ │ │ └── pako@1.0.11 deduped
│ │ │ ├─┬ buffer@4.9.2
│ │ │ │ ├── base64-js@1.3.1 deduped
│ │ │ │ ├── ieee754@1.1.13 deduped
│ │ │ │ └── isarray@1.0.0
│ │ │ ├── console-browserify@1.2.0
│ │ │ ├── constants-browserify@1.0.0
│ │ │ ├─┬ crypto-browserify@3.12.0
│ │ │ │ ├─┬ browserify-cipher@1.0.1
│ │ │ │ │ ├─┬ browserify-aes@1.2.0
│ │ │ │ │ │ ├── buffer-xor@1.0.3
│ │ │ │ │ │ ├── cipher-base@1.0.4 deduped
│ │ │ │ │ │ ├── create-hash@1.2.0 deduped
│ │ │ │ │ │ ├── evp_bytestokey@1.0.3 deduped
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ │ ├─┬ browserify-des@1.0.2
│ │ │ │ │ │ ├── cipher-base@1.0.4 deduped
│ │ │ │ │ │ ├─┬ des.js@1.0.1
│ │ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ │ └── minimalistic-assert@1.0.1 deduped
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ │ └─┬ evp_bytestokey@1.0.3
│ │ │ │ │   ├── md5.js@1.3.5 deduped
│ │ │ │ │   └── safe-buffer@5.1.2 deduped
│ │ │ │ ├─┬ browserify-sign@4.2.1
│ │ │ │ │ ├── bn.js@5.1.3
│ │ │ │ │ ├─┬ browserify-rsa@4.0.1
│ │ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ │ └── randombytes@2.1.0 deduped
│ │ │ │ │ ├── create-hash@1.2.0 deduped
│ │ │ │ │ ├── create-hmac@1.1.7 deduped
│ │ │ │ │ ├─┬ elliptic@6.5.3
│ │ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ │ ├── brorand@1.1.0
│ │ │ │ │ │ ├─┬ hash.js@1.1.7
│ │ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ │ └── minimalistic-assert@1.0.1 deduped
│ │ │ │ │ │ ├─┬ hmac-drbg@1.0.1
│ │ │ │ │ │ │ ├── hash.js@1.1.7 deduped
│ │ │ │ │ │ │ ├── minimalistic-assert@1.0.1 deduped
│ │ │ │ │ │ │ └── minimalistic-crypto-utils@1.0.1 deduped
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ ├── minimalistic-assert@1.0.1 deduped
│ │ │ │ │ │ └── minimalistic-crypto-utils@1.0.1
│ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ ├─┬ parse-asn1@5.1.6
│ │ │ │ │ │ ├─┬ asn1.js@5.4.1
│ │ │ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ │ ├── minimalistic-assert@1.0.1 deduped
│ │ │ │ │ │ │ └── safer-buffer@2.1.2 deduped
│ │ │ │ │ │ ├── browserify-aes@1.2.0 deduped
│ │ │ │ │ │ ├── evp_bytestokey@1.0.3 deduped
│ │ │ │ │ │ ├── pbkdf2@3.1.1 deduped
│ │ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ │ ├─┬ readable-stream@3.6.0
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ ├── string_decoder@1.1.1 deduped
│ │ │ │ │ │ └── util-deprecate@1.0.2 deduped
│ │ │ │ │ └── safe-buffer@5.2.1
│ │ │ │ ├─┬ create-ecdh@4.0.4
│ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ └── elliptic@6.5.3 deduped
│ │ │ │ ├─┬ create-hash@1.2.0
│ │ │ │ │ ├─┬ cipher-base@1.0.4
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ ├─┬ md5.js@1.3.5
│ │ │ │ │ │ ├─┬ hash-base@3.1.0
│ │ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ │ ├─┬ readable-stream@3.6.0
│ │ │ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ │ │ ├── string_decoder@1.1.1 deduped
│ │ │ │ │ │ │ │ └── util-deprecate@1.0.2 deduped
│ │ │ │ │ │ │ └── safe-buffer@5.2.1
│ │ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ │ ├─┬ ripemd160@2.0.2
│ │ │ │ │ │ ├── hash-base@3.1.0 deduped
│ │ │ │ │ │ └── inherits@2.0.4 deduped
│ │ │ │ │ └─┬ sha.js@2.4.11
│ │ │ │ │   ├── inherits@2.0.4 deduped
│ │ │ │ │   └── safe-buffer@5.1.2 deduped
│ │ │ │ ├─┬ create-hmac@1.1.7
│ │ │ │ │ ├── cipher-base@1.0.4 deduped
│ │ │ │ │ ├── create-hash@1.2.0 deduped
│ │ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ │ ├── ripemd160@2.0.2 deduped
│ │ │ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ │ │ └── sha.js@2.4.11 deduped
│ │ │ │ ├─┬ diffie-hellman@5.0.3
│ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ ├─┬ miller-rabin@4.0.1
│ │ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ │ └── brorand@1.1.0 deduped
│ │ │ │ │ └── randombytes@2.1.0 deduped
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ ├─┬ pbkdf2@3.1.1
│ │ │ │ │ ├── create-hash@1.2.0 deduped
│ │ │ │ │ ├── create-hmac@1.1.7 deduped
│ │ │ │ │ ├── ripemd160@2.0.2 deduped
│ │ │ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ │ │ └── sha.js@2.4.11 deduped
│ │ │ │ ├─┬ public-encrypt@4.0.3
│ │ │ │ │ ├── bn.js@4.11.9
│ │ │ │ │ ├── browserify-rsa@4.0.1 deduped
│ │ │ │ │ ├── create-hash@1.2.0 deduped
│ │ │ │ │ ├── parse-asn1@5.1.6 deduped
│ │ │ │ │ ├── randombytes@2.1.0 deduped
│ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ ├── randombytes@2.1.0 deduped
│ │ │ │ └─┬ randomfill@1.0.4
│ │ │ │   ├── randombytes@2.1.0 deduped
│ │ │ │   └── safe-buffer@5.1.2 deduped
│ │ │ ├── domain-browser@1.2.0
│ │ │ ├── events@3.2.0 deduped
│ │ │ ├── https-browserify@1.0.0
│ │ │ ├── os-browserify@0.3.0
│ │ │ ├── path-browserify@0.0.1
│ │ │ ├── process@0.11.10
│ │ │ ├── punycode@1.3.2
│ │ │ ├── querystring-es3@0.2.1
│ │ │ ├─┬ readable-stream@2.3.7
│ │ │ │ ├── core-util-is@1.0.2
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ ├── isarray@1.0.0 deduped
│ │ │ │ ├── process-nextick-args@2.0.1
│ │ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ │ ├── string_decoder@1.1.1 deduped
│ │ │ │ └── util-deprecate@1.0.2 deduped
│ │ │ ├─┬ stream-browserify@2.0.2
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ ├─┬ stream-http@2.8.3
│ │ │ │ ├── builtin-status-codes@3.0.0
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ ├── readable-stream@2.3.7 deduped
│ │ │ │ ├── to-arraybuffer@1.0.1
│ │ │ │ └── xtend@4.0.2
│ │ │ ├─┬ string_decoder@1.1.1
│ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ ├─┬ timers-browserify@2.0.11
│ │ │ │ └── setimmediate@1.0.5
│ │ │ ├── tty-browserify@0.0.0
│ │ │ ├── url@0.11.0 deduped
│ │ │ ├─┬ util@0.11.1
│ │ │ │ └── inherits@2.0.3
│ │ │ └── vm-browserify@1.1.2
│ │ ├─┬ schema-utils@1.0.0
│ │ │ ├── ajv@6.12.3 deduped
│ │ │ ├── ajv-errors@1.0.1 deduped
│ │ │ └── ajv-keywords@3.5.2 deduped
│ │ ├── tapable@1.1.3
│ │ ├─┬ terser-webpack-plugin@1.4.5
│ │ │ ├─┬ cacache@12.0.4
│ │ │ │ ├── bluebird@3.7.2 deduped
│ │ │ │ ├── chownr@1.1.4
│ │ │ │ ├── figgy-pudding@3.5.2 deduped
│ │ │ │ ├── glob@7.1.6 deduped
│ │ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ │ ├── infer-owner@1.0.4 deduped
│ │ │ │ ├── lru-cache@5.1.1 deduped
│ │ │ │ ├── mississippi@3.0.0 deduped
│ │ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ │ ├── move-concurrently@1.0.1 deduped
│ │ │ │ ├── promise-inflight@1.0.1 deduped
│ │ │ │ ├─┬ rimraf@2.7.1
│ │ │ │ │ └── glob@7.1.6 deduped
│ │ │ │ ├─┬ ssri@6.0.1
│ │ │ │ │ └── figgy-pudding@3.5.2 deduped
│ │ │ │ ├── unique-filename@1.1.1 deduped
│ │ │ │ └── y18n@4.0.0 deduped
│ │ │ ├─┬ find-cache-dir@2.1.0
│ │ │ │ ├── commondir@1.0.1 deduped
│ │ │ │ ├── make-dir@2.1.0 deduped
│ │ │ │ └── pkg-dir@3.0.0 deduped
│ │ │ ├── is-wsl@1.1.0
│ │ │ ├── schema-utils@1.0.0 deduped
│ │ │ ├── serialize-javascript@4.0.0 deduped
│ │ │ ├── source-map@0.6.1
│ │ │ ├── terser@4.7.0 deduped
│ │ │ ├── webpack-sources@1.4.3 deduped
│ │ │ └─┬ worker-farm@1.7.0
│ │ │   └── errno@0.1.7 deduped
│ │ ├─┬ watchpack@1.7.4
│ │ │ ├── chokidar@3.4.2 deduped
│ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ ├── neo-async@2.6.2 deduped
│ │ │ └─┬ watchpack-chokidar2@2.0.0
│ │ │   └─┬ chokidar@2.1.8
│ │ │     ├─┬ anymatch@2.0.0
│ │ │     │ ├─┬ micromatch@3.1.10
│ │ │     │ │ ├── arr-diff@4.0.0 deduped
│ │ │     │ │ ├── array-unique@0.3.2 deduped
│ │ │     │ │ ├── braces@2.3.2 deduped
│ │ │     │ │ ├── define-property@2.0.2 deduped
│ │ │     │ │ ├── extend-shallow@3.0.2 deduped
│ │ │     │ │ ├── extglob@2.0.4 deduped
│ │ │     │ │ ├── fragment-cache@0.2.1 deduped
│ │ │     │ │ ├── kind-of@6.0.3 deduped
│ │ │     │ │ ├── nanomatch@1.2.13 deduped
│ │ │     │ │ ├── object.pick@1.3.0 deduped
│ │ │     │ │ ├── regex-not@1.0.2 deduped
│ │ │     │ │ ├── snapdragon@0.8.2 deduped
│ │ │     │ │ └── to-regex@3.0.2 deduped
│ │ │     │ └─┬ normalize-path@2.1.1
│ │ │     │   └── remove-trailing-separator@1.1.0 deduped
│ │ │     ├── async-each@1.0.3 deduped
│ │ │     ├─┬ braces@2.3.2
│ │ │     │ ├── arr-flatten@1.1.0 deduped
│ │ │     │ ├── array-unique@0.3.2 deduped
│ │ │     │ ├─┬ extend-shallow@2.0.1
│ │ │     │ │ └── is-extendable@0.1.1 deduped
│ │ │     │ ├─┬ fill-range@4.0.0
│ │ │     │ │ ├─┬ extend-shallow@2.0.1
│ │ │     │ │ │ └── is-extendable@0.1.1 deduped
│ │ │     │ │ ├─┬ is-number@3.0.0
│ │ │     │ │ │ └─┬ kind-of@3.2.2
│ │ │     │ │ │   └── is-buffer@1.1.6
│ │ │     │ │ ├── repeat-string@1.6.1 deduped
│ │ │     │ │ └─┬ to-regex-range@2.1.1
│ │ │     │ │   ├── is-number@3.0.0 deduped
│ │ │     │ │   └── repeat-string@1.6.1 deduped
│ │ │     │ ├── isobject@3.0.1 deduped
│ │ │     │ ├── repeat-element@1.1.3 deduped
│ │ │     │ ├── snapdragon@0.8.2 deduped
│ │ │     │ ├── snapdragon-node@2.1.1 deduped
│ │ │     │ ├── split-string@3.1.0 deduped
│ │ │     │ └── to-regex@3.0.2 deduped
│ │ │     ├── UNMET OPTIONAL DEPENDENCY fsevents@1.2.13
│ │ │     ├─┬ glob-parent@3.1.0
│ │ │     │ ├─┬ is-glob@3.1.0
│ │ │     │ │ └── is-extglob@2.1.1 deduped
│ │ │     │ └── path-dirname@1.0.2 deduped
│ │ │     ├── inherits@2.0.4 deduped
│ │ │     ├─┬ is-binary-path@1.0.1
│ │ │     │ └── binary-extensions@1.13.1
│ │ │     ├── is-glob@4.0.1 deduped
│ │ │     ├── normalize-path@3.0.0 deduped
│ │ │     ├── path-is-absolute@1.0.1 deduped
│ │ │     ├─┬ readdirp@2.2.1
│ │ │     │ ├── graceful-fs@4.2.4 deduped
│ │ │     │ ├── micromatch@3.1.10 deduped
│ │ │     │ └── readable-stream@2.3.7 deduped
│ │ │     └── upath@1.2.0 deduped
│ │ └── webpack-sources@1.4.3 deduped
│ ├─┬ webpack-dev-middleware@3.7.2
│ │ ├─┬ memory-fs@0.4.1
│ │ │ ├── errno@0.1.7 deduped
│ │ │ └── readable-stream@2.3.7 deduped
│ │ ├── mime@2.4.6
│ │ ├── mkdirp@0.5.5 deduped
│ │ ├── range-parser@1.2.1 deduped
│ │ └─┬ webpack-log@2.0.0
│ │   ├── ansi-colors@3.2.4
│ │   └── uuid@3.4.0
│ ├─┬ webpack-dev-server@3.11.0
│ │ ├── ansi-html@0.0.7
│ │ ├─┬ bonjour@3.5.0
│ │ │ ├── array-flatten@2.1.2
│ │ │ ├─┬ deep-equal@1.1.1
│ │ │ │ ├── is-arguments@1.0.4
│ │ │ │ ├── is-date-object@1.0.2
│ │ │ │ ├─┬ is-regex@1.1.1
│ │ │ │ │ └── has-symbols@1.0.1 deduped
│ │ │ │ ├─┬ object-is@1.1.3
│ │ │ │ │ ├── define-properties@1.1.3 deduped
│ │ │ │ │ └── es-abstract@1.18.0-next.1 deduped
│ │ │ │ ├── object-keys@1.1.1
│ │ │ │ └─┬ regexp.prototype.flags@1.3.0
│ │ │ │   ├── define-properties@1.1.3 deduped
│ │ │ │   └─┬ es-abstract@1.17.7
│ │ │ │     ├── es-to-primitive@1.2.1 deduped
│ │ │ │     ├── function-bind@1.1.1 deduped
│ │ │ │     ├── has@1.0.3 deduped
│ │ │ │     ├── has-symbols@1.0.1 deduped
│ │ │ │     ├── is-callable@1.2.2 deduped
│ │ │ │     ├── is-regex@1.1.1 deduped
│ │ │ │     ├── object-inspect@1.8.0 deduped
│ │ │ │     ├── object-keys@1.1.1 deduped
│ │ │ │     ├── object.assign@4.1.1 deduped
│ │ │ │     ├── string.prototype.trimend@1.0.1 deduped
│ │ │ │     └── string.prototype.trimstart@1.0.1 deduped
│ │ │ ├── dns-equal@1.0.0
│ │ │ ├─┬ dns-txt@2.0.2
│ │ │ │ └── buffer-indexof@1.1.1
│ │ │ ├─┬ multicast-dns@6.2.3
│ │ │ │ ├─┬ dns-packet@1.3.1
│ │ │ │ │ ├── ip@1.1.5 deduped
│ │ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ │ └── thunky@1.1.0
│ │ │ └── multicast-dns-service-types@1.1.0
│ │ ├─┬ chokidar@2.1.8
│ │ │ ├─┬ anymatch@2.0.0
│ │ │ │ ├─┬ micromatch@3.1.10
│ │ │ │ │ ├── arr-diff@4.0.0 deduped
│ │ │ │ │ ├── array-unique@0.3.2 deduped
│ │ │ │ │ ├── braces@2.3.2 deduped
│ │ │ │ │ ├── define-property@2.0.2 deduped
│ │ │ │ │ ├── extend-shallow@3.0.2 deduped
│ │ │ │ │ ├── extglob@2.0.4 deduped
│ │ │ │ │ ├── fragment-cache@0.2.1 deduped
│ │ │ │ │ ├── kind-of@6.0.3 deduped
│ │ │ │ │ ├── nanomatch@1.2.13 deduped
│ │ │ │ │ ├── object.pick@1.3.0 deduped
│ │ │ │ │ ├── regex-not@1.0.2 deduped
│ │ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ │ └─┬ normalize-path@2.1.1
│ │ │ │   └── remove-trailing-separator@1.1.0
│ │ │ ├── async-each@1.0.3
│ │ │ ├─┬ braces@2.3.2
│ │ │ │ ├── arr-flatten@1.1.0 deduped
│ │ │ │ ├── array-unique@0.3.2 deduped
│ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ ├─┬ fill-range@4.0.0
│ │ │ │ │ ├─┬ extend-shallow@2.0.1
│ │ │ │ │ │ └── is-extendable@0.1.1 deduped
│ │ │ │ │ ├─┬ is-number@3.0.0
│ │ │ │ │ │ └─┬ kind-of@3.2.2
│ │ │ │ │ │   └── is-buffer@1.1.6
│ │ │ │ │ ├── repeat-string@1.6.1 deduped
│ │ │ │ │ └─┬ to-regex-range@2.1.1
│ │ │ │ │   ├── is-number@3.0.0 deduped
│ │ │ │ │   └── repeat-string@1.6.1 deduped
│ │ │ │ ├── isobject@3.0.1 deduped
│ │ │ │ ├── repeat-element@1.1.3 deduped
│ │ │ │ ├── snapdragon@0.8.2 deduped
│ │ │ │ ├── snapdragon-node@2.1.1 deduped
│ │ │ │ ├── split-string@3.1.0 deduped
│ │ │ │ └── to-regex@3.0.2 deduped
│ │ │ ├── UNMET OPTIONAL DEPENDENCY fsevents@1.2.13
│ │ │ ├─┬ glob-parent@3.1.0
│ │ │ │ ├─┬ is-glob@3.1.0
│ │ │ │ │ └── is-extglob@2.1.1 deduped
│ │ │ │ └── path-dirname@1.0.2
│ │ │ ├── inherits@2.0.4 deduped
│ │ │ ├─┬ is-binary-path@1.0.1
│ │ │ │ └── binary-extensions@1.13.1
│ │ │ ├── is-glob@4.0.1 deduped
│ │ │ ├── normalize-path@3.0.0 deduped
│ │ │ ├── path-is-absolute@1.0.1 deduped
│ │ │ ├─┬ readdirp@2.2.1
│ │ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ │ ├── micromatch@3.1.10 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ └── upath@1.2.0
│ │ ├─┬ compression@1.7.4
│ │ │ ├─┬ accepts@1.3.7
│ │ │ │ ├── mime-types@2.1.27 deduped
│ │ │ │ └── negotiator@0.6.2
│ │ │ ├── bytes@3.0.0
│ │ │ ├─┬ compressible@2.0.18
│ │ │ │ └── mime-db@1.44.0
│ │ │ ├─┬ debug@2.6.9
│ │ │ │ └── ms@2.0.0 deduped
│ │ │ ├── on-headers@1.0.2
│ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ └── vary@1.1.2
│ │ ├── connect-history-api-fallback@1.6.0
│ │ ├─┬ debug@4.2.0
│ │ │ └── ms@2.1.2
│ │ ├─┬ del@4.1.1
│ │ │ ├─┬ @types/glob@7.1.3
│ │ │ │ ├── @types/minimatch@3.0.3
│ │ │ │ └── @types/node@12.12.64 deduped
│ │ │ ├─┬ globby@6.1.0
│ │ │ │ ├─┬ array-union@1.0.2
│ │ │ │ │ └── array-uniq@1.0.3
│ │ │ │ ├── glob@7.1.6 deduped
│ │ │ │ ├── object-assign@4.1.1 deduped
│ │ │ │ ├── pify@2.3.0
│ │ │ │ └── pinkie-promise@2.0.1 deduped
│ │ │ ├── is-path-cwd@2.2.0
│ │ │ ├─┬ is-path-in-cwd@2.1.0
│ │ │ │ └─┬ is-path-inside@2.1.0
│ │ │ │   └── path-is-inside@1.0.2
│ │ │ ├── p-map@2.1.0
│ │ │ ├── pify@4.0.1 deduped
│ │ │ └─┬ rimraf@2.7.1
│ │ │   └── glob@7.1.6 deduped
│ │ ├─┬ express@4.17.1
│ │ │ ├── accepts@1.3.7 deduped
│ │ │ ├── array-flatten@1.1.1
│ │ │ ├── body-parser@1.19.0 deduped
│ │ │ ├─┬ content-disposition@0.5.3
│ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ ├── content-type@1.0.4 deduped
│ │ │ ├── cookie@0.4.0
│ │ │ ├── cookie-signature@1.0.6
│ │ │ ├─┬ debug@2.6.9
│ │ │ │ └── ms@2.0.0 deduped
│ │ │ ├── depd@1.1.2 deduped
│ │ │ ├── encodeurl@1.0.2
│ │ │ ├── escape-html@1.0.3
│ │ │ ├── etag@1.8.1
│ │ │ ├── finalhandler@1.1.2 deduped
│ │ │ ├── fresh@0.5.2
│ │ │ ├── merge-descriptors@1.0.1
│ │ │ ├── methods@1.1.2
│ │ │ ├── on-finished@2.3.0 deduped
│ │ │ ├── parseurl@1.3.3 deduped
│ │ │ ├── path-to-regexp@0.1.7
│ │ │ ├─┬ proxy-addr@2.0.6
│ │ │ │ ├── forwarded@0.1.2
│ │ │ │ └── ipaddr.js@1.9.1 deduped
│ │ │ ├── qs@6.7.0 deduped
│ │ │ ├── range-parser@1.2.1 deduped
│ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ ├─┬ send@0.17.1
│ │ │ │ ├─┬ debug@2.6.9
│ │ │ │ │ └── ms@2.0.0
│ │ │ │ ├── depd@1.1.2 deduped
│ │ │ │ ├── destroy@1.0.4
│ │ │ │ ├── encodeurl@1.0.2 deduped
│ │ │ │ ├── escape-html@1.0.3 deduped
│ │ │ │ ├── etag@1.8.1 deduped
│ │ │ │ ├── fresh@0.5.2 deduped
│ │ │ │ ├── http-errors@1.7.2 deduped
│ │ │ │ ├── mime@1.6.0 deduped
│ │ │ │ ├── ms@2.1.1
│ │ │ │ ├── on-finished@2.3.0 deduped
│ │ │ │ ├── range-parser@1.2.1 deduped
│ │ │ │ └── statuses@1.5.0 deduped
│ │ │ ├─┬ serve-static@1.14.1
│ │ │ │ ├── encodeurl@1.0.2 deduped
│ │ │ │ ├── escape-html@1.0.3 deduped
│ │ │ │ ├── parseurl@1.3.3 deduped
│ │ │ │ └── send@0.17.1 deduped
│ │ │ ├── setprototypeof@1.1.1
│ │ │ ├── statuses@1.5.0
│ │ │ ├── type-is@1.6.18 deduped
│ │ │ ├── utils-merge@1.0.1 deduped
│ │ │ └── vary@1.1.2 deduped
│ │ ├── html-entities@1.3.1
│ │ ├─┬ http-proxy-middleware@0.19.1
│ │ │ ├── http-proxy@1.18.1 deduped
│ │ │ ├── is-glob@4.0.1 deduped
│ │ │ ├── lodash@4.17.20 deduped
│ │ │ └─┬ micromatch@3.1.10
│ │ │   ├── arr-diff@4.0.0 deduped
│ │ │   ├── array-unique@0.3.2 deduped
│ │ │   ├─┬ braces@2.3.2
│ │ │   │ ├── arr-flatten@1.1.0 deduped
│ │ │   │ ├── array-unique@0.3.2 deduped
│ │ │   │ ├─┬ extend-shallow@2.0.1
│ │ │   │ │ └── is-extendable@0.1.1 deduped
│ │ │   │ ├─┬ fill-range@4.0.0
│ │ │   │ │ ├─┬ extend-shallow@2.0.1
│ │ │   │ │ │ └── is-extendable@0.1.1 deduped
│ │ │   │ │ ├─┬ is-number@3.0.0
│ │ │   │ │ │ └─┬ kind-of@3.2.2
│ │ │   │ │ │   └── is-buffer@1.1.6
│ │ │   │ │ ├── repeat-string@1.6.1 deduped
│ │ │   │ │ └─┬ to-regex-range@2.1.1
│ │ │   │ │   ├── is-number@3.0.0 deduped
│ │ │   │ │   └── repeat-string@1.6.1 deduped
│ │ │   │ ├── isobject@3.0.1 deduped
│ │ │   │ ├── repeat-element@1.1.3 deduped
│ │ │   │ ├── snapdragon@0.8.2 deduped
│ │ │   │ ├── snapdragon-node@2.1.1 deduped
│ │ │   │ ├── split-string@3.1.0 deduped
│ │ │   │ └── to-regex@3.0.2 deduped
│ │ │   ├── define-property@2.0.2 deduped
│ │ │   ├── extend-shallow@3.0.2 deduped
│ │ │   ├── extglob@2.0.4 deduped
│ │ │   ├── fragment-cache@0.2.1 deduped
│ │ │   ├── kind-of@6.0.3 deduped
│ │ │   ├── nanomatch@1.2.13 deduped
│ │ │   ├── object.pick@1.3.0 deduped
│ │ │   ├── regex-not@1.0.2 deduped
│ │ │   ├── snapdragon@0.8.2 deduped
│ │ │   └── to-regex@3.0.2 deduped
│ │ ├─┬ import-local@2.0.0
│ │ │ ├── pkg-dir@3.0.0 deduped
│ │ │ └─┬ resolve-cwd@2.0.0
│ │ │   └── resolve-from@3.0.0 deduped
│ │ ├─┬ internal-ip@4.3.0
│ │ │ ├─┬ default-gateway@4.2.0
│ │ │ │ ├─┬ execa@1.0.0
│ │ │ │ │ ├─┬ cross-spawn@6.0.5
│ │ │ │ │ │ ├── nice-try@1.0.5
│ │ │ │ │ │ ├── path-key@2.0.1
│ │ │ │ │ │ ├── semver@5.7.1
│ │ │ │ │ │ ├─┬ shebang-command@1.2.0
│ │ │ │ │ │ │ └── shebang-regex@1.0.0
│ │ │ │ │ │ └── which@1.3.1 deduped
│ │ │ │ │ ├── get-stream@4.1.0 deduped
│ │ │ │ │ ├── is-stream@1.1.0
│ │ │ │ │ ├─┬ npm-run-path@2.0.2
│ │ │ │ │ │ └── path-key@2.0.1 deduped
│ │ │ │ │ ├── p-finally@1.0.0
│ │ │ │ │ ├── signal-exit@3.0.3 deduped
│ │ │ │ │ └── strip-eof@1.0.0
│ │ │ │ └── ip-regex@2.1.0
│ │ │ └── ipaddr.js@1.9.1
│ │ ├── ip@1.1.5
│ │ ├── is-absolute-url@3.0.3
│ │ ├── killable@1.0.1
│ │ ├── loglevel@1.7.0
│ │ ├─┬ opn@5.5.0
│ │ │ └── is-wsl@1.1.0
│ │ ├─┬ p-retry@3.0.1
│ │ │ └── retry@0.12.0
│ │ ├─┬ portfinder@1.0.28
│ │ │ ├─┬ async@2.6.3
│ │ │ │ └── lodash@4.17.20 deduped
│ │ │ ├─┬ debug@3.2.6
│ │ │ │ └── ms@2.1.2
│ │ │ └── mkdirp@0.5.5 deduped
│ │ ├─┬ schema-utils@1.0.0
│ │ │ ├── ajv@6.12.3 deduped
│ │ │ ├── ajv-errors@1.0.1 deduped
│ │ │ └── ajv-keywords@3.5.2 deduped
│ │ ├─┬ selfsigned@1.10.8
│ │ │ └── node-forge@0.10.0
│ │ ├── semver@6.3.0
│ │ ├─┬ serve-index@1.9.1
│ │ │ ├── accepts@1.3.7 deduped
│ │ │ ├── batch@0.6.1
│ │ │ ├─┬ debug@2.6.9
│ │ │ │ └── ms@2.0.0 deduped
│ │ │ ├── escape-html@1.0.3 deduped
│ │ │ ├─┬ http-errors@1.6.3
│ │ │ │ ├── depd@1.1.2 deduped
│ │ │ │ ├── inherits@2.0.3
│ │ │ │ ├── setprototypeof@1.1.0
│ │ │ │ └── statuses@1.5.0 deduped
│ │ │ ├─┬ mime-types@2.1.27
│ │ │ │ └── mime-db@1.44.0 deduped
│ │ │ └── parseurl@1.3.3 deduped
│ │ ├─┬ sockjs@0.3.20
│ │ │ ├─┬ faye-websocket@0.10.0
│ │ │ │ └── websocket-driver@0.6.5 deduped
│ │ │ ├── uuid@3.4.0
│ │ │ └─┬ websocket-driver@0.6.5
│ │ │   └── websocket-extensions@0.1.4
│ │ ├─┬ sockjs-client@1.4.0
│ │ │ ├─┬ debug@3.2.6
│ │ │ │ └── ms@2.1.2
│ │ │ ├─┬ eventsource@1.0.7
│ │ │ │ └─┬ original@1.0.2
│ │ │ │   └── url-parse@1.4.7 deduped
│ │ │ ├─┬ faye-websocket@0.11.3
│ │ │ │ └── websocket-driver@0.6.5 deduped
│ │ │ ├── inherits@2.0.4 deduped
│ │ │ ├── json3@3.3.3
│ │ │ └─┬ url-parse@1.4.7
│ │ │   ├── querystringify@2.2.0
│ │ │   └── requires-port@1.0.0 deduped
│ │ ├─┬ spdy@4.0.2
│ │ │ ├─┬ debug@4.2.0
│ │ │ │ └── ms@2.1.2
│ │ │ ├── handle-thing@2.0.1
│ │ │ ├── http-deceiver@1.2.7
│ │ │ ├── select-hose@2.0.0
│ │ │ └─┬ spdy-transport@3.0.0
│ │ │   ├─┬ debug@4.2.0
│ │ │   │ └── ms@2.1.2
│ │ │   ├── detect-node@2.0.4
│ │ │   ├─┬ hpack.js@2.1.6
│ │ │   │ ├── inherits@2.0.4 deduped
│ │ │   │ ├── obuf@1.1.2 deduped
│ │ │   │ ├── readable-stream@2.3.7 deduped
│ │ │   │ └── wbuf@1.7.3 deduped
│ │ │   ├── obuf@1.1.2
│ │ │   ├─┬ readable-stream@3.6.0
│ │ │   │ ├── inherits@2.0.4 deduped
│ │ │   │ ├── string_decoder@1.1.1 deduped
│ │ │   │ └── util-deprecate@1.0.2 deduped
│ │ │   └─┬ wbuf@1.7.3
│ │ │     └── minimalistic-assert@1.0.1
│ │ ├─┬ strip-ansi@3.0.1
│ │ │ └── ansi-regex@2.1.1
│ │ ├─┬ supports-color@6.1.0
│ │ │ └── has-flag@3.0.0 deduped
│ │ ├─┬ url@0.11.0
│ │ │ ├── punycode@1.3.2 deduped
│ │ │ └── querystring@0.2.0
│ │ ├── webpack-dev-middleware@3.7.2 deduped
│ │ ├── webpack-log@2.0.0 deduped
│ │ ├─┬ ws@6.2.1
│ │ │ └── async-limiter@1.0.1
│ │ └─┬ yargs@13.3.2
│ │   ├─┬ cliui@5.0.0
│ │   │ ├── string-width@3.1.0 deduped
│ │   │ ├─┬ strip-ansi@5.2.0
│ │   │ │ └── ansi-regex@4.1.0
│ │   │ └─┬ wrap-ansi@5.1.0
│ │   │   ├── ansi-styles@3.2.1 deduped
│ │   │   ├── string-width@3.1.0 deduped
│ │   │   └── strip-ansi@5.2.0 deduped
│ │   ├─┬ find-up@3.0.0
│ │   │ └─┬ locate-path@3.0.0
│ │   │   ├─┬ p-locate@3.0.0
│ │   │   │ └── p-limit@2.3.0 deduped
│ │   │   └── path-exists@3.0.0
│ │   ├── get-caller-file@2.0.5 deduped
│ │   ├── require-directory@2.1.1 deduped
│ │   ├── require-main-filename@2.0.0 deduped
│ │   ├── set-blocking@2.0.0 deduped
│ │   ├─┬ string-width@3.1.0
│ │   │ ├── emoji-regex@7.0.3
│ │   │ ├── is-fullwidth-code-point@2.0.0
│ │   │ └── strip-ansi@5.2.0 deduped
│ │   ├── which-module@2.0.0 deduped
│ │   ├── y18n@4.0.0 deduped
│ │   └─┬ yargs-parser@13.1.2
│ │     ├── camelcase@5.3.1 deduped
│ │     └── decamelize@1.2.0 deduped
│ ├─┬ webpack-merge@4.2.2
│ │ └── lodash@4.17.20 deduped
│ ├─┬ webpack-sources@1.4.3
│ │ ├── source-list-map@2.0.1
│ │ └── source-map@0.6.1
│ ├─┬ webpack-subresource-integrity@1.4.1
│ │ └── webpack-sources@1.4.3 deduped
│ └─┬ worker-plugin@4.0.3
│   └─┬ loader-utils@1.4.0
│     ├── big.js@5.2.2 deduped
│     ├── emojis-list@3.0.0 deduped
│     └─┬ json5@1.0.1
│       └── minimist@1.2.5 deduped
├─┬ @angular/animations@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/cli@10.0.8
│ ├── @angular-devkit/architect@0.1000.8 deduped
│ ├── @angular-devkit/core@10.0.8 deduped
│ ├─┬ @angular-devkit/schematics@10.0.8
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ ├─┬ ora@4.0.4
│ │ │ ├─┬ chalk@3.0.0
│ │ │ │ ├─┬ ansi-styles@4.3.0
│ │ │ │ │ └─┬ color-convert@2.0.1
│ │ │ │ │   └── color-name@1.1.4
│ │ │ │ └─┬ supports-color@7.2.0
│ │ │ │   └── has-flag@4.0.0
│ │ │ ├── cli-cursor@3.1.0 deduped
│ │ │ ├── cli-spinners@2.4.0
│ │ │ ├── is-interactive@1.0.0
│ │ │ ├─┬ log-symbols@3.0.0
│ │ │ │ └── chalk@2.4.2 deduped
│ │ │ ├── mute-stream@0.0.8 deduped
│ │ │ ├─┬ strip-ansi@6.0.0
│ │ │ │ └── ansi-regex@5.0.0
│ │ │ └─┬ wcwidth@1.0.1
│ │ │   └─┬ defaults@1.0.3
│ │ │     └── clone@1.0.4
│ │ └── rxjs@6.5.5 deduped
│ ├─┬ @schematics/angular@10.0.8
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ └── @angular-devkit/schematics@10.0.8 deduped
│ ├─┬ @schematics/update@0.1000.8
│ │ ├── @angular-devkit/core@10.0.8 deduped
│ │ ├── @angular-devkit/schematics@10.0.8 deduped
│ │ ├── @yarnpkg/lockfile@1.1.0 deduped
│ │ ├── ini@1.3.5 deduped
│ │ ├── npm-package-arg@8.0.1 deduped
│ │ ├── pacote@9.5.12 deduped
│ │ ├── rxjs@6.5.5 deduped
│ │ ├── semver@7.3.2 deduped
│ │ └─┬ semver-intersect@1.4.0
│ │   └── semver@5.7.1
│ ├── @yarnpkg/lockfile@1.1.0
│ ├── ansi-colors@4.1.1
│ ├─┬ debug@4.1.1
│ │ └── ms@2.1.2
│ ├── ini@1.3.5
│ ├─┬ inquirer@7.1.0
│ │ ├─┬ ansi-escapes@4.3.1
│ │ │ └── type-fest@0.11.0
│ │ ├─┬ chalk@3.0.0
│ │ │ ├─┬ ansi-styles@4.3.0
│ │ │ │ └─┬ color-convert@2.0.1
│ │ │ │   └── color-name@1.1.4
│ │ │ └─┬ supports-color@7.2.0
│ │ │   └── has-flag@4.0.0
│ │ ├─┬ cli-cursor@3.1.0
│ │ │ └─┬ restore-cursor@3.1.0
│ │ │   ├─┬ onetime@5.1.2
│ │ │   │ └── mimic-fn@2.1.0
│ │ │   └── signal-exit@3.0.3
│ │ ├── cli-width@2.2.1
│ │ ├─┬ external-editor@3.1.0
│ │ │ ├── chardet@0.7.0
│ │ │ ├─┬ iconv-lite@0.4.24
│ │ │ │ └── safer-buffer@2.1.2 deduped
│ │ │ └─┬ tmp@0.0.33
│ │ │   └── os-tmpdir@1.0.2 deduped
│ │ ├─┬ figures@3.2.0
│ │ │ └── escape-string-regexp@1.0.5 deduped
│ │ ├── lodash@4.17.20 deduped
│ │ ├── mute-stream@0.0.8
│ │ ├── run-async@2.4.1
│ │ ├── rxjs@6.5.5 deduped
│ │ ├─┬ string-width@4.2.0
│ │ │ ├── emoji-regex@8.0.0
│ │ │ ├── is-fullwidth-code-point@3.0.0
│ │ │ └── strip-ansi@6.0.0 deduped
│ │ ├─┬ strip-ansi@6.0.0
│ │ │ └── ansi-regex@5.0.0
│ │ └── through@2.3.8
│ ├─┬ npm-package-arg@8.0.1
│ │ ├─┬ hosted-git-info@3.0.5
│ │ │ └─┬ lru-cache@6.0.0
│ │ │   └── yallist@4.0.0 deduped
│ │ ├── semver@7.3.2 deduped
│ │ └─┬ validate-npm-package-name@3.0.0
│ │   └── builtins@1.0.3
│ ├─┬ npm-pick-manifest@6.1.0
│ │ ├─┬ npm-install-checks@4.0.0
│ │ │ └── semver@7.3.2 deduped
│ │ ├── npm-package-arg@8.0.1 deduped
│ │ └── semver@7.3.2 deduped
│ ├── open@7.0.4 deduped
│ ├─┬ pacote@9.5.12
│ │ ├── bluebird@3.7.2
│ │ ├─┬ cacache@12.0.4
│ │ │ ├── bluebird@3.7.2 deduped
│ │ │ ├── chownr@1.1.4 deduped
│ │ │ ├── figgy-pudding@3.5.2 deduped
│ │ │ ├── glob@7.1.6 deduped
│ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ ├── infer-owner@1.0.4 deduped
│ │ │ ├── lru-cache@5.1.1 deduped
│ │ │ ├── mississippi@3.0.0 deduped
│ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ ├─┬ move-concurrently@1.0.1
│ │ │ │ ├── aproba@1.2.0
│ │ │ │ ├─┬ copy-concurrently@1.0.5
│ │ │ │ │ ├── aproba@1.2.0 deduped
│ │ │ │ │ ├── fs-write-stream-atomic@1.0.10 deduped
│ │ │ │ │ ├── iferr@0.1.5
│ │ │ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ │ │ ├─┬ rimraf@2.7.1
│ │ │ │ │ │ └── glob@7.1.6 deduped
│ │ │ │ │ └── run-queue@1.0.3 deduped
│ │ │ │ ├─┬ fs-write-stream-atomic@1.0.10
│ │ │ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ │ │ ├── iferr@0.1.5 deduped
│ │ │ │ │ ├── imurmurhash@0.1.4 deduped
│ │ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ │ ├─┬ rimraf@2.7.1
│ │ │ │ │ └── glob@7.1.6 deduped
│ │ │ │ └─┬ run-queue@1.0.3
│ │ │ │   └── aproba@1.2.0 deduped
│ │ │ ├── promise-inflight@1.0.1 deduped
│ │ │ ├── rimraf@2.7.1 deduped
│ │ │ ├── ssri@6.0.1 deduped
│ │ │ ├── unique-filename@1.1.1 deduped
│ │ │ └── y18n@4.0.0 deduped
│ │ ├── chownr@1.1.4
│ │ ├── figgy-pudding@3.5.2
│ │ ├─┬ get-stream@4.1.0
│ │ │ └─┬ pump@3.0.0
│ │ │   ├── end-of-stream@1.4.4 deduped
│ │ │   └── once@1.4.0 deduped
│ │ ├── glob@7.1.6 deduped
│ │ ├── infer-owner@1.0.4 deduped
│ │ ├── lru-cache@5.1.1 deduped
│ │ ├─┬ make-fetch-happen@5.0.2
│ │ │ ├─┬ agentkeepalive@3.5.2
│ │ │ │ └─┬ humanize-ms@1.2.1
│ │ │ │   └── ms@2.0.0 deduped
│ │ │ ├─┬ cacache@12.0.4
│ │ │ │ ├── bluebird@3.7.2 deduped
│ │ │ │ ├── chownr@1.1.4
│ │ │ │ ├── figgy-pudding@3.5.2 deduped
│ │ │ │ ├── glob@7.1.6 deduped
│ │ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ │ ├── infer-owner@1.0.4 deduped
│ │ │ │ ├── lru-cache@5.1.1 deduped
│ │ │ │ ├── mississippi@3.0.0 deduped
│ │ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ │ ├── move-concurrently@1.0.1 deduped
│ │ │ │ ├── promise-inflight@1.0.1 deduped
│ │ │ │ ├─┬ rimraf@2.7.1
│ │ │ │ │ └── glob@7.1.6 deduped
│ │ │ │ ├── ssri@6.0.1 deduped
│ │ │ │ ├── unique-filename@1.1.1 deduped
│ │ │ │ └── y18n@4.0.0 deduped
│ │ │ ├── http-cache-semantics@3.8.1
│ │ │ ├─┬ http-proxy-agent@2.1.0
│ │ │ │ ├── agent-base@4.3.0 deduped
│ │ │ │ └── debug@3.1.0 deduped
│ │ │ ├── https-proxy-agent@2.2.4 deduped
│ │ │ ├── lru-cache@5.1.1 deduped
│ │ │ ├── mississippi@3.0.0 deduped
│ │ │ ├─┬ node-fetch-npm@2.0.4
│ │ │ │ ├─┬ encoding@0.1.13
│ │ │ │ │ └─┬ iconv-lite@0.6.2
│ │ │ │ │   └── safer-buffer@2.1.2 deduped
│ │ │ │ ├── json-parse-better-errors@1.0.2 deduped
│ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ ├── promise-retry@1.1.1 deduped
│ │ │ ├─┬ socks-proxy-agent@4.0.2
│ │ │ │ ├─┬ agent-base@4.2.1
│ │ │ │ │ └── es6-promisify@5.0.0 deduped
│ │ │ │ └─┬ socks@2.3.3
│ │ │ │   ├── ip@1.1.5 deduped
│ │ │ │   └── smart-buffer@4.1.0
│ │ │ └─┬ ssri@6.0.1
│ │ │   └── figgy-pudding@3.5.2 deduped
│ │ ├── minimatch@3.0.4 deduped
│ │ ├─┬ minipass@2.9.0
│ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ └── yallist@3.1.1
│ │ ├─┬ mississippi@3.0.0
│ │ │ ├─┬ concat-stream@1.6.2
│ │ │ │ ├── buffer-from@1.1.1 deduped
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ ├── readable-stream@2.3.7 deduped
│ │ │ │ └── typedarray@0.0.6
│ │ │ ├─┬ duplexify@3.7.1
│ │ │ │ ├── end-of-stream@1.4.4 deduped
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ ├── readable-stream@2.3.7 deduped
│ │ │ │ └── stream-shift@1.0.1
│ │ │ ├─┬ end-of-stream@1.4.4
│ │ │ │ └── once@1.4.0 deduped
│ │ │ ├─┬ flush-write-stream@1.1.1
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ ├─┬ from2@2.3.0
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ ├─┬ parallel-transform@1.2.0
│ │ │ │ ├── cyclist@1.0.1
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ └── readable-stream@2.3.7 deduped
│ │ │ ├── pump@3.0.0 deduped
│ │ │ ├─┬ pumpify@1.5.1
│ │ │ │ ├── duplexify@3.7.1 deduped
│ │ │ │ ├── inherits@2.0.4 deduped
│ │ │ │ └─┬ pump@2.0.1
│ │ │ │   ├── end-of-stream@1.4.4 deduped
│ │ │ │   └── once@1.4.0 deduped
│ │ │ ├─┬ stream-each@1.2.3
│ │ │ │ ├── end-of-stream@1.4.4 deduped
│ │ │ │ └── stream-shift@1.0.1 deduped
│ │ │ └─┬ through2@2.0.5
│ │ │   ├── readable-stream@2.3.7 deduped
│ │ │   └── xtend@4.0.2 deduped
│ │ ├── mkdirp@0.5.5 deduped
│ │ ├─┬ normalize-package-data@2.5.0
│ │ │ ├── hosted-git-info@2.8.8
│ │ │ ├── resolve@1.17.0 deduped
│ │ │ ├── semver@5.7.1
│ │ │ └─┬ validate-npm-package-license@3.0.4
│ │ │   ├─┬ spdx-correct@3.1.1
│ │ │   │ ├── spdx-expression-parse@3.0.1 deduped
│ │ │   │ └── spdx-license-ids@3.0.6
│ │ │   └─┬ spdx-expression-parse@3.0.1
│ │ │     ├── spdx-exceptions@2.3.0
│ │ │     └── spdx-license-ids@3.0.6 deduped
│ │ ├── npm-normalize-package-bin@1.0.1
│ │ ├─┬ npm-package-arg@6.1.1
│ │ │ ├── hosted-git-info@2.8.8
│ │ │ ├── osenv@0.1.5 deduped
│ │ │ ├── semver@5.7.1 deduped
│ │ │ └── validate-npm-package-name@3.0.0 deduped
│ │ ├─┬ npm-packlist@1.4.8
│ │ │ ├─┬ ignore-walk@3.0.3
│ │ │ │ └── minimatch@3.0.4 deduped
│ │ │ ├─┬ npm-bundled@1.1.1
│ │ │ │ └── npm-normalize-package-bin@1.0.1 deduped
│ │ │ └── npm-normalize-package-bin@1.0.1 deduped
│ │ ├─┬ npm-pick-manifest@3.0.2
│ │ │ ├── figgy-pudding@3.5.2 deduped
│ │ │ ├── npm-package-arg@6.1.1 deduped
│ │ │ └── semver@5.7.1 deduped
│ │ ├─┬ npm-registry-fetch@4.0.7
│ │ │ ├── bluebird@3.7.2 deduped
│ │ │ ├── figgy-pudding@3.5.2 deduped
│ │ │ ├─┬ JSONStream@1.3.5
│ │ │ │ ├── jsonparse@1.3.1
│ │ │ │ └── through@2.3.8 deduped
│ │ │ ├── lru-cache@5.1.1 deduped
│ │ │ ├── make-fetch-happen@5.0.2 deduped
│ │ │ ├─┬ npm-package-arg@6.1.1
│ │ │ │ ├── hosted-git-info@2.8.8
│ │ │ │ ├── osenv@0.1.5 deduped
│ │ │ │ ├── semver@5.7.1
│ │ │ │ └── validate-npm-package-name@3.0.0 deduped
│ │ │ └── safe-buffer@5.2.1
│ │ ├─┬ osenv@0.1.5
│ │ │ ├── os-homedir@1.0.2
│ │ │ └── os-tmpdir@1.0.2
│ │ ├── promise-inflight@1.0.1 deduped
│ │ ├─┬ promise-retry@1.1.1
│ │ │ ├── err-code@1.1.2
│ │ │ └── retry@0.10.1
│ │ ├─┬ protoduck@5.0.1
│ │ │ └── genfun@5.0.0
│ │ ├─┬ rimraf@2.7.1
│ │ │ └── glob@7.1.6 deduped
│ │ ├── safe-buffer@5.1.2
│ │ ├── semver@5.7.1
│ │ ├─┬ ssri@6.0.1
│ │ │ └── figgy-pudding@3.5.2 deduped
│ │ ├─┬ tar@4.4.13
│ │ │ ├── chownr@1.1.4 deduped
│ │ │ ├─┬ fs-minipass@1.2.7
│ │ │ │ └── minipass@2.9.0 deduped
│ │ │ ├── minipass@2.9.0 deduped
│ │ │ ├─┬ minizlib@1.3.3
│ │ │ │ └── minipass@2.9.0 deduped
│ │ │ ├── mkdirp@0.5.5 deduped
│ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ └── yallist@3.1.1 deduped
│ │ ├── unique-filename@1.1.1 deduped
│ │ └── which@1.3.1 deduped
│ ├─┬ read-package-tree@5.3.1
│ │ ├─┬ read-package-json@2.1.2
│ │ │ ├── glob@7.1.6 deduped
│ │ │ ├── json-parse-even-better-errors@2.3.1
│ │ │ ├── normalize-package-data@2.5.0 deduped
│ │ │ └── npm-normalize-package-bin@1.0.1 deduped
│ │ ├─┬ readdir-scoped-modules@1.1.0
│ │ │ ├── debuglog@1.0.1
│ │ │ ├─┬ dezalgo@1.0.3
│ │ │ │ ├── asap@2.0.6
│ │ │ │ └── wrappy@1.0.2 deduped
│ │ │ ├── graceful-fs@4.2.4 deduped
│ │ │ └── once@1.4.0 deduped
│ │ └─┬ util-promisify@2.1.0
│ │   └─┬ object.getownpropertydescriptors@2.1.0
│ │     ├─┬ define-properties@1.1.3
│ │     │ └── object-keys@1.1.1 deduped
│ │     └─┬ es-abstract@1.17.7
│ │       ├─┬ es-to-primitive@1.2.1
│ │       │ ├── is-callable@1.2.2 deduped
│ │       │ ├── is-date-object@1.0.2 deduped
│ │       │ └─┬ is-symbol@1.0.3
│ │       │   └── has-symbols@1.0.1 deduped
│ │       ├── function-bind@1.1.1 deduped
│ │       ├── has@1.0.3 deduped
│ │       ├── has-symbols@1.0.1 deduped
│ │       ├── is-callable@1.2.2
│ │       ├── is-regex@1.1.1 deduped
│ │       ├── object-inspect@1.8.0
│ │       ├── object-keys@1.1.1 deduped
│ │       ├── object.assign@4.1.1 deduped
│ │       ├─┬ string.prototype.trimend@1.0.1
│ │       │ ├── define-properties@1.1.3 deduped
│ │       │ └─┬ es-abstract@1.17.7
│ │       │   ├── es-to-primitive@1.2.1 deduped
│ │       │   ├── function-bind@1.1.1 deduped
│ │       │   ├── has@1.0.3 deduped
│ │       │   ├── has-symbols@1.0.1 deduped
│ │       │   ├── is-callable@1.2.2 deduped
│ │       │   ├── is-regex@1.1.1 deduped
│ │       │   ├── object-inspect@1.8.0 deduped
│ │       │   ├── object-keys@1.1.1 deduped
│ │       │   ├── object.assign@4.1.1 deduped
│ │       │   ├── string.prototype.trimend@1.0.1 deduped
│ │       │   └── string.prototype.trimstart@1.0.1 deduped
│ │       └─┬ string.prototype.trimstart@1.0.1
│ │         ├── define-properties@1.1.3 deduped
│ │         └─┬ es-abstract@1.17.7
│ │           ├── es-to-primitive@1.2.1 deduped
│ │           ├── function-bind@1.1.1 deduped
│ │           ├── has@1.0.3 deduped
│ │           ├── has-symbols@1.0.1 deduped
│ │           ├── is-callable@1.2.2 deduped
│ │           ├── is-regex@1.1.1 deduped
│ │           ├── object-inspect@1.8.0 deduped
│ │           ├── object-keys@1.1.1 deduped
│ │           ├── object.assign@4.1.1 deduped
│ │           ├── string.prototype.trimend@1.0.1 deduped
│ │           └── string.prototype.trimstart@1.0.1 deduped
│ ├── rimraf@3.0.2 deduped
│ ├── semver@7.3.2 deduped
│ ├── symbol-observable@1.2.0
│ ├─┬ universal-analytics@0.4.20
│ │ ├── debug@3.1.0 deduped
│ │ ├─┬ request@2.88.2
│ │ │ ├── aws-sign2@0.7.0
│ │ │ ├── aws4@1.10.1
│ │ │ ├── caseless@0.12.0
│ │ │ ├─┬ combined-stream@1.0.8
│ │ │ │ └── delayed-stream@1.0.0
│ │ │ ├── extend@3.0.2 deduped
│ │ │ ├── forever-agent@0.6.1
│ │ │ ├─┬ form-data@2.3.3
│ │ │ │ ├── asynckit@0.4.0
│ │ │ │ ├── combined-stream@1.0.8 deduped
│ │ │ │ └── mime-types@2.1.27 deduped
│ │ │ ├─┬ har-validator@5.1.5
│ │ │ │ ├── ajv@6.12.3 deduped
│ │ │ │ └── har-schema@2.0.0
│ │ │ ├─┬ http-signature@1.2.0
│ │ │ │ ├── assert-plus@1.0.0
│ │ │ │ ├─┬ jsprim@1.4.1
│ │ │ │ │ ├── assert-plus@1.0.0 deduped
│ │ │ │ │ ├── extsprintf@1.3.0
│ │ │ │ │ ├── json-schema@0.2.3
│ │ │ │ │ └─┬ verror@1.10.0
│ │ │ │ │   ├── assert-plus@1.0.0 deduped
│ │ │ │ │   ├── core-util-is@1.0.2 deduped
│ │ │ │ │   └── extsprintf@1.3.0 deduped
│ │ │ │ └─┬ sshpk@1.16.1
│ │ │ │   ├─┬ asn1@0.2.4
│ │ │ │   │ └── safer-buffer@2.1.2 deduped
│ │ │ │   ├── assert-plus@1.0.0 deduped
│ │ │ │   ├─┬ bcrypt-pbkdf@1.0.2
│ │ │ │   │ └── tweetnacl@0.14.5 deduped
│ │ │ │   ├─┬ dashdash@1.14.1
│ │ │ │   │ └── assert-plus@1.0.0 deduped
│ │ │ │   ├─┬ ecc-jsbn@0.1.2
│ │ │ │   │ ├── jsbn@0.1.1 deduped
│ │ │ │   │ └── safer-buffer@2.1.2 deduped
│ │ │ │   ├─┬ getpass@0.1.7
│ │ │ │   │ └── assert-plus@1.0.0 deduped
│ │ │ │   ├── jsbn@0.1.1
│ │ │ │   ├── safer-buffer@2.1.2 deduped
│ │ │ │   └── tweetnacl@0.14.5
│ │ │ ├── is-typedarray@1.0.0
│ │ │ ├── isstream@0.1.2
│ │ │ ├── json-stringify-safe@5.0.1
│ │ │ ├── mime-types@2.1.27 deduped
│ │ │ ├── oauth-sign@0.9.0
│ │ │ ├── performance-now@2.1.0
│ │ │ ├── qs@6.5.2
│ │ │ ├── safe-buffer@5.1.2 deduped
│ │ │ ├─┬ tough-cookie@2.5.0
│ │ │ │ ├── psl@1.8.0
│ │ │ │ └── punycode@2.1.1
│ │ │ ├─┬ tunnel-agent@0.6.0
│ │ │ │ └── safe-buffer@5.1.2 deduped
│ │ │ └── uuid@3.4.0
│ │ └── uuid@3.4.0
│ └── uuid@8.1.0
├─┬ @angular/common@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/compiler@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/compiler-cli@10.0.14
│ ├── canonical-path@1.0.0
│ ├─┬ chokidar@3.4.2
│ │ ├─┬ anymatch@3.1.1
│ │ │ ├── normalize-path@3.0.0 deduped
│ │ │ └── picomatch@2.2.2 deduped
│ │ ├── braces@3.0.2 deduped
│ │ ├── UNMET OPTIONAL DEPENDENCY fsevents@2.1.3
│ │ ├── glob-parent@5.1.1 deduped
│ │ ├─┬ is-binary-path@2.1.0
│ │ │ └── binary-extensions@2.1.0
│ │ ├─┬ is-glob@4.0.1
│ │ │ └── is-extglob@2.1.1
│ │ ├── normalize-path@3.0.0 deduped
│ │ └─┬ readdirp@3.4.0
│ │   └── picomatch@2.2.2 deduped
│ ├─┬ convert-source-map@1.7.0
│ │ └── safe-buffer@5.1.2 deduped
│ ├── dependency-graph@0.7.2
│ ├─┬ fs-extra@4.0.2
│ │ ├── graceful-fs@4.2.4 deduped
│ │ ├─┬ jsonfile@4.0.0
│ │ │ └── graceful-fs@4.2.4 deduped
│ │ └── universalify@0.1.2
│ ├─┬ magic-string@0.25.7
│ │ └── sourcemap-codec@1.4.8 deduped
│ ├── minimist@1.2.5
│ ├── reflect-metadata@0.1.13
│ ├── semver@6.3.0
│ ├── source-map@0.6.1
│ ├── sourcemap-codec@1.4.8
│ ├── tslib@2.0.1 deduped
│ └─┬ yargs@15.3.0
│   ├─┬ cliui@6.0.0
│   │ ├── string-width@4.2.0 deduped
│   │ ├─┬ strip-ansi@6.0.0
│   │ │ └── ansi-regex@5.0.0
│   │ └─┬ wrap-ansi@6.2.0
│   │   ├─┬ ansi-styles@4.3.0
│   │   │ └─┬ color-convert@2.0.1
│   │   │   └── color-name@1.1.4
│   │   ├── string-width@4.2.0 deduped
│   │   └── strip-ansi@6.0.0 deduped
│   ├── decamelize@1.2.0
│   ├─┬ find-up@4.1.0
│   │ ├─┬ locate-path@5.0.0
│   │ │ └─┬ p-locate@4.1.0
│   │ │   └── p-limit@2.3.0 deduped
│   │ └── path-exists@4.0.0
│   ├── get-caller-file@2.0.5
│   ├── require-directory@2.1.1
│   ├── require-main-filename@2.0.0
│   ├── set-blocking@2.0.0
│   ├─┬ string-width@4.2.0
│   │ ├── emoji-regex@8.0.0
│   │ ├── is-fullwidth-code-point@3.0.0
│   │ └── strip-ansi@6.0.0 deduped
│   ├── which-module@2.0.0
│   ├── y18n@4.0.0
│   └─┬ yargs-parser@18.1.3
│     ├── camelcase@5.3.1 deduped
│     └── decamelize@1.2.0 deduped
├─┬ @angular/core@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/forms@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/platform-browser@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/platform-browser-dynamic@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @angular/router@10.0.14
│ └── tslib@2.0.1 deduped
├─┬ @aws-amplify/ui-angular@0.4.6
│ └─┬ @aws-amplify/ui-components@0.8.6
│   ├── @aws-amplify/auth@3.4.6 deduped
│   ├── @aws-amplify/core@3.6.0 deduped
│   ├── @aws-amplify/interactions@3.3.6 deduped
│   ├── @aws-amplify/storage@3.3.6 deduped
│   ├── @aws-amplify/xr@2.2.6 deduped
│   ├─┬ qrcode@1.4.4
│   │ ├─┬ buffer@5.6.0
│   │ │ ├── base64-js@1.3.1 deduped
│   │ │ └── ieee754@1.1.13 deduped
│   │ ├─┬ buffer-alloc@1.2.0
│   │ │ ├── buffer-alloc-unsafe@1.1.0
│   │ │ └── buffer-fill@1.0.0
│   │ ├── buffer-from@1.1.1 deduped
│   │ ├── dijkstrajs@1.0.1
│   │ ├── isarray@2.0.5
│   │ ├── pngjs@3.4.0
│   │ └── yargs@13.3.2 deduped
│   └── uuid@8.3.1
├── @types/jasmine@3.5.14
├─┬ @types/jasminewd2@2.0.8
│ └── @types/jasmine@3.5.14 deduped
├── @types/node@12.12.64
├─┬ aws-amplify@3.3.3
│ ├─┬ @aws-amplify/analytics@3.3.6
│ │ ├── @aws-amplify/cache@3.1.31 deduped
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├─┬ @aws-sdk/client-firehose@1.0.0-gamma.8
│ │ │ ├─┬ @aws-crypto/sha256-browser@1.0.0-alpha.0
│ │ │ │ ├─┬ @aws-crypto/ie11-detection@1.0.0-alpha.0
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ │ ├─┬ @aws-crypto/supports-web-crypto@1.0.0-alpha.0
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├─┬ @aws-sdk/util-locate-window@1.0.0-gamma.6
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├─┬ @aws-sdk/config-resolver@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/signature-v4@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/credential-provider-node@1.0.0-gamma.7
│ │ │ │ ├─┬ @aws-sdk/credential-provider-env@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├─┬ @aws-sdk/credential-provider-imds@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├─┬ @aws-sdk/credential-provider-ini@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/shared-ini-file-loader@1.0.0-gamma.6 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├─┬ @aws-sdk/credential-provider-process@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/credential-provider-ini@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/shared-ini-file-loader@1.0.0-gamma.6 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/fetch-http-handler@1.0.0-gamma.8
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/querystring-builder@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/hash-node@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/util-buffer-from@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/invalid-dependency@1.0.0-gamma.5
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-content-length@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-host-header@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-logger@1.0.0-gamma.1
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-retry@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/service-error-classification@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── UNMET PEER DEPENDENCY react-native@>=0.56
│ │ │ │ ├─┬ react-native-get-random-values@1.5.0
│ │ │ │ │ └── fast-base64-decode@1.0.0
│ │ │ │ ├── tslib@1.13.0
│ │ │ │ └── uuid@3.4.0
│ │ │ ├─┬ @aws-sdk/middleware-serde@1.0.0-gamma.6
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-signing@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/signature-v4@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-stack@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-user-agent@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/node-config-provider@1.0.0-gamma.2
│ │ │ │ ├── @aws-sdk/property-provider@1.0.0-gamma.7 deduped
│ │ │ │ ├─┬ @aws-sdk/shared-ini-file-loader@1.0.0-gamma.6
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/protocol-http@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/smithy-client@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├─┬ @aws-sdk/url-parser-browser@1.0.0-gamma.7
│ │ │ │ ├─┬ @aws-sdk/querystring-parser@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/url-parser-node@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/querystring-parser@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── tslib@1.13.0
│ │ │ │ └── url@0.11.0 deduped
│ │ │ ├─┬ @aws-sdk/util-base64-browser@1.0.0-gamma.6
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/util-base64-node@1.0.0-gamma.6
│ │ │ │ ├── @aws-sdk/util-buffer-from@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/util-body-length-browser@1.0.0-gamma.6
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/util-body-length-node@1.0.0-gamma.6
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/util-user-agent-node@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-kinesis@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/eventstream-serde-browser@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/eventstream-marshaller@1.0.0-gamma.7 deduped
│ │ │ │ ├─┬ @aws-sdk/eventstream-serde-universal@1.0.0-gamma.6
│ │ │ │ │ ├── @aws-sdk/eventstream-marshaller@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/eventstream-serde-config-resolver@1.0.0-gamma.6
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/eventstream-serde-node@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/eventstream-marshaller@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/eventstream-serde-universal@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-personalize-events@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-pinpoint@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/util-utf8-browser@1.0.0-gamma.6
│ │ │ └── tslib@1.13.0
│ │ ├── lodash@4.17.20 deduped
│ │ └── uuid@3.4.0
│ ├─┬ @aws-amplify/api@3.2.6
│ │ ├─┬ @aws-amplify/api-graphql@1.2.6
│ │ │ ├── @aws-amplify/api-rest@1.2.6 deduped
│ │ │ ├── @aws-amplify/auth@3.4.6 deduped
│ │ │ ├── @aws-amplify/cache@3.1.31 deduped
│ │ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ │ ├── @aws-amplify/pubsub@3.2.4 deduped
│ │ │ ├── graphql@14.0.0 deduped
│ │ │ ├── uuid@3.4.0
│ │ │ └── zen-observable-ts@0.8.19 deduped
│ │ └─┬ @aws-amplify/api-rest@1.2.6
│ │   ├── @aws-amplify/core@3.6.0 deduped
│ │   └── axios@0.19.0 deduped
│ ├─┬ @aws-amplify/auth@3.4.6
│ │ ├── @aws-amplify/cache@3.1.31 deduped
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├─┬ amazon-cognito-identity-js@4.4.0
│ │ │ ├─┬ buffer@4.9.1
│ │ │ │ ├── base64-js@1.3.1 deduped
│ │ │ │ ├── ieee754@1.1.13 deduped
│ │ │ │ └── isarray@1.0.0 deduped
│ │ │ ├── crypto-js@3.3.0 deduped
│ │ │ ├─┬ isomorphic-unfetch@3.1.0
│ │ │ │ ├── node-fetch@2.6.1
│ │ │ │ └── unfetch@4.2.0
│ │ │ └── js-cookie@2.2.1
│ │ └── crypto-js@3.3.0
│ ├─┬ @aws-amplify/cache@3.1.31
│ │ └── @aws-amplify/core@3.6.0 deduped
│ ├─┬ @aws-amplify/core@3.6.0
│ │ ├─┬ @aws-crypto/sha256-js@1.0.0-alpha.0
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/client-cognito-identity@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/credential-provider-cognito-identity@1.0.0-gamma.8
│ │ │ ├── @aws-sdk/client-cognito-identity@1.0.0-gamma.8 deduped
│ │ │ ├─┬ @aws-sdk/property-provider@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/node-http-handler@1.0.0-gamma.7
│ │ │ ├─┬ @aws-sdk/abort-controller@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/querystring-builder@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├─┬ @aws-sdk/util-uri-escape@1.0.0-gamma.6
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├── @aws-sdk/types@1.0.0-gamma.6
│ │ ├─┬ @aws-sdk/util-hex-encoding@1.0.0-gamma.6
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/util-user-agent-browser@1.0.0-gamma.7
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ universal-cookie@4.0.4
│ │ │ ├── @types/cookie@0.3.3
│ │ │ └── cookie@0.4.1
│ │ ├── url@0.11.0 deduped
│ │ └─┬ zen-observable-ts@0.8.19
│ │   ├── tslib@1.13.0
│ │   └── zen-observable@0.8.15
│ ├─┬ @aws-amplify/datastore@2.6.0
│ │ ├── @aws-amplify/api@3.2.6 deduped
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├── @aws-amplify/pubsub@3.2.4 deduped
│ │ ├── idb@5.0.2
│ │ ├── immer@6.0.1
│ │ ├── ulid@2.3.0
│ │ ├── uuid@3.3.2
│ │ ├── zen-observable-ts@0.8.19 deduped
│ │ └─┬ zen-push@0.2.1
│ │   └── zen-observable@0.7.1
│ ├─┬ @aws-amplify/interactions@3.3.6
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ └─┬ @aws-sdk/client-lex-runtime-service@1.0.0-gamma.8
│ │   ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │   ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │   ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │   ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │   ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │   ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │   ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │   ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │   ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │   └── tslib@2.0.1
│ ├─┬ @aws-amplify/predictions@3.2.6
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├── @aws-amplify/storage@3.3.6 deduped
│ │ ├─┬ @aws-sdk/client-comprehend@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ ├── tslib@2.0.1
│ │ │ └── uuid@3.4.0
│ │ ├─┬ @aws-sdk/client-polly@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-rekognition@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-textract@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/client-translate@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ ├── tslib@2.0.1
│ │ │ └── uuid@3.4.0
│ │ ├─┬ @aws-sdk/eventstream-marshaller@1.0.0-gamma.7
│ │ │ ├─┬ @aws-crypto/crc32@1.0.0-alpha.0
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-hex-encoding@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/util-utf8-node@1.0.0-gamma.6
│ │ │ ├─┬ @aws-sdk/util-buffer-from@1.0.0-gamma.6
│ │ │ │ ├─┬ @aws-sdk/is-array-buffer@1.0.0-gamma.6
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ └── tslib@1.13.0
│ │ │ └── tslib@1.13.0
│ │ └── uuid@3.4.0
│ ├─┬ @aws-amplify/pubsub@3.2.4
│ │ ├── @aws-amplify/auth@3.4.6 deduped
│ │ ├── @aws-amplify/cache@3.1.31 deduped
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├─┬ graphql@14.0.0
│ │ │ └── iterall@1.3.0
│ │ ├── paho-mqtt@1.1.0
│ │ ├── uuid@3.4.0
│ │ └── zen-observable-ts@0.8.19 deduped
│ ├─┬ @aws-amplify/storage@3.3.6
│ │ ├── @aws-amplify/core@3.6.0 deduped
│ │ ├─┬ @aws-sdk/client-s3@1.0.0-gamma.8
│ │ │ ├── @aws-crypto/sha256-browser@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-crypto/sha256-js@1.0.0-alpha.0 deduped
│ │ │ ├── @aws-sdk/config-resolver@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/credential-provider-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/eventstream-serde-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/eventstream-serde-config-resolver@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/eventstream-serde-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/fetch-http-handler@1.0.0-gamma.8 deduped
│ │ │ ├─┬ @aws-sdk/hash-blob-browser@1.0.0-gamma.7
│ │ │ │ ├─┬ @aws-sdk/chunked-blob-reader@1.0.0-gamma.6
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├─┬ @aws-sdk/chunked-blob-reader-native@1.0.0-gamma.6
│ │ │ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/hash-node@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/hash-stream-node@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/invalid-dependency@1.0.0-gamma.5 deduped
│ │ │ ├─┬ @aws-sdk/md5-js@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-apply-body-checksum@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/is-array-buffer@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├─┬ @aws-sdk/middleware-bucket-endpoint@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├─┬ @aws-sdk/util-arn-parser@1.0.0-gamma.3
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/middleware-content-length@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/middleware-expect-continue@1.0.0-gamma.7
│ │ │ │ ├─┬ @aws-sdk/middleware-header-default@1.0.0-gamma.7
│ │ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ │ └── tslib@1.13.0
│ │ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/middleware-host-header@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/middleware-location-constraint@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/middleware-logger@1.0.0-gamma.1 deduped
│ │ │ ├── @aws-sdk/middleware-retry@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/middleware-sdk-s3@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/util-arn-parser@1.0.0-gamma.3 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/middleware-serde@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/middleware-signing@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/middleware-ssec@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/middleware-user-agent@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/node-config-provider@1.0.0-gamma.2 deduped
│ │ │ ├── @aws-sdk/node-http-handler@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/url-parser-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/url-parser-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-base64-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-base64-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-body-length-node@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-user-agent-browser@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-user-agent-node@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-utf8-browser@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-utf8-node@1.0.0-gamma.6 deduped
│ │ │ ├─┬ @aws-sdk/xml-builder@1.0.0-gamma.6
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── fast-xml-parser@3.17.4
│ │ │ └── tslib@2.0.1
│ │ ├─┬ @aws-sdk/s3-request-presigner@1.0.0-gamma.7
│ │ │ ├── @aws-sdk/protocol-http@1.0.0-gamma.7 deduped
│ │ │ ├─┬ @aws-sdk/signature-v4@1.0.0-gamma.7
│ │ │ │ ├── @aws-sdk/is-array-buffer@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/util-hex-encoding@1.0.0-gamma.6 deduped
│ │ │ │ ├── @aws-sdk/util-uri-escape@1.0.0-gamma.6 deduped
│ │ │ │ └── tslib@1.13.0
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ ├── @aws-sdk/util-create-request@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/util-format-url@1.0.0-gamma.7 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/util-create-request@1.0.0-gamma.7
│ │ │ ├── @aws-sdk/middleware-stack@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/smithy-client@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ @aws-sdk/util-format-url@1.0.0-gamma.7
│ │ │ ├── @aws-sdk/querystring-builder@1.0.0-gamma.7 deduped
│ │ │ ├── @aws-sdk/types@1.0.0-gamma.6 deduped
│ │ │ └── tslib@1.13.0
│ │ ├─┬ axios@0.19.0
│ │ │ ├── follow-redirects@1.5.10 deduped
│ │ │ └── is-buffer@2.0.4
│ │ ├── events@3.2.0
│ │ └─┬ sinon@7.5.0
│ │   ├─┬ @sinonjs/commons@1.8.1
│ │   │ └── type-detect@4.0.8
│ │   ├─┬ @sinonjs/formatio@3.2.2
│ │   │ ├── @sinonjs/commons@1.8.1 deduped
│ │   │ └── @sinonjs/samsam@3.3.3 deduped
│ │   ├─┬ @sinonjs/samsam@3.3.3
│ │   │ ├── @sinonjs/commons@1.8.1 deduped
│ │   │ ├── array-from@2.1.1
│ │   │ └── lodash@4.17.20 deduped
│ │   ├── diff@3.5.0
│ │   ├── lolex@4.2.0
│ │   ├─┬ nise@1.5.3
│ │   │ ├── @sinonjs/formatio@3.2.2 deduped
│ │   │ ├── @sinonjs/text-encoding@0.7.1
│ │   │ ├── just-extend@4.1.1
│ │   │ ├─┬ lolex@5.1.2
│ │   │ │ └── @sinonjs/commons@1.8.1 deduped
│ │   │ └─┬ path-to-regexp@1.8.0
│ │   │   └── isarray@0.0.1
│ │   └── supports-color@5.5.0 deduped
│ ├── @aws-amplify/ui@2.0.2
│ ├─┬ @aws-amplify/xr@2.2.6
│ │ └── @aws-amplify/core@3.6.0 deduped
│ └── UNMET PEER DEPENDENCY @react-native-community/netinfo@^5.5.0
├─┬ buffer@5.6.0
│ ├── base64-js@1.3.1
│ └── ieee754@1.1.13
├─┬ codelyzer@6.0.1
│ ├── @angular/compiler@9.0.0
│ ├── @angular/core@9.0.0
│ ├── app-root-path@3.0.0
│ ├─┬ aria-query@3.0.0
│ │ ├── ast-types-flow@0.0.7
│ │ └── commander@2.20.3 deduped
│ ├─┬ axobject-query@2.0.2
│ │ └── ast-types-flow@0.0.7 deduped
│ ├─┬ css-selector-tokenizer@0.7.3
│ │ ├── cssesc@3.0.0 deduped
│ │ └── fastparse@1.1.2
│ ├─┬ cssauron@1.4.0
│ │ └── through@2.3.8 deduped
│ ├── damerau-levenshtein@1.0.6
│ ├── rxjs@6.5.5 deduped
│ ├─┬ semver-dsl@1.0.1
│ │ └── semver@5.7.1
│ ├── source-map@0.5.7
│ ├── sprintf-js@1.1.2
│ ├── tslib@1.13.0
│ └── zone.js@0.10.3 deduped
├── halfmoon@1.1.0
├── jasmine-core@3.5.0
├─┬ jasmine-spec-reporter@5.0.2
│ └── colors@1.4.0
├─┬ karma@5.0.9
│ ├─┬ body-parser@1.19.0
│ │ ├── bytes@3.1.0
│ │ ├── content-type@1.0.4
│ │ ├─┬ debug@2.6.9
│ │ │ └── ms@2.0.0 deduped
│ │ ├── depd@1.1.2
│ │ ├─┬ http-errors@1.7.2
│ │ │ ├── depd@1.1.2 deduped
│ │ │ ├── inherits@2.0.3
│ │ │ ├── setprototypeof@1.1.1 deduped
│ │ │ ├── statuses@1.5.0 deduped
│ │ │ └── toidentifier@1.0.0
│ │ ├─┬ iconv-lite@0.4.24
│ │ │ └── safer-buffer@2.1.2 deduped
│ │ ├─┬ on-finished@2.3.0
│ │ │ └── ee-first@1.1.1
│ │ ├── qs@6.7.0
│ │ ├─┬ raw-body@2.4.0
│ │ │ ├── bytes@3.1.0
│ │ │ ├── http-errors@1.7.2 deduped
│ │ │ ├─┬ iconv-lite@0.4.24
│ │ │ │ └── safer-buffer@2.1.2 deduped
│ │ │ └── unpipe@1.0.0
│ │ └─┬ type-is@1.6.18
│ │   ├── media-typer@0.3.0
│ │   └── mime-types@2.1.27 deduped
│ ├─┬ braces@3.0.2
│ │ └─┬ fill-range@7.0.1
│ │   └─┬ to-regex-range@5.0.1
│ │     └── is-number@7.0.0
│ ├── chokidar@3.4.2 deduped
│ ├── colors@1.4.0 deduped
│ ├─┬ connect@3.7.0
│ │ ├─┬ debug@2.6.9
│ │ │ └── ms@2.0.0 deduped
│ │ ├─┬ finalhandler@1.1.2
│ │ │ ├─┬ debug@2.6.9
│ │ │ │ └── ms@2.0.0 deduped
│ │ │ ├── encodeurl@1.0.2 deduped
│ │ │ ├── escape-html@1.0.3 deduped
│ │ │ ├── on-finished@2.3.0 deduped
│ │ │ ├── parseurl@1.3.3 deduped
│ │ │ ├── statuses@1.5.0 deduped
│ │ │ └── unpipe@1.0.0 deduped
│ │ ├── parseurl@1.3.3
│ │ └── utils-merge@1.0.1
│ ├── di@0.0.1
│ ├─┬ dom-serialize@2.2.1
│ │ ├── custom-event@1.0.1
│ │ ├── ent@2.2.0
│ │ ├── extend@3.0.2
│ │ └── void-elements@2.0.1
│ ├── flatted@2.0.2
│ ├── glob@7.1.6 deduped
│ ├── graceful-fs@4.2.4
│ ├─┬ http-proxy@1.18.1
│ │ ├── eventemitter3@4.0.7
│ │ ├─┬ follow-redirects@1.5.10
│ │ │ └── debug@3.1.0 deduped
│ │ └── requires-port@1.0.0
│ ├── isbinaryfile@4.0.6
│ ├── lodash@4.17.20
│ ├─┬ log4js@6.3.0
│ │ ├── date-format@3.0.0
│ │ ├─┬ debug@4.2.0
│ │ │ └── ms@2.1.2
│ │ ├── flatted@2.0.2 deduped
│ │ ├── rfdc@1.1.4
│ │ └─┬ streamroller@2.2.4
│ │   ├── date-format@2.1.0
│ │   ├─┬ debug@4.2.0
│ │   │ └── ms@2.1.2
│ │   └─┬ fs-extra@8.1.0
│ │     ├── graceful-fs@4.2.4 deduped
│ │     ├── jsonfile@4.0.0 deduped
│ │     └── universalify@0.1.2 deduped
│ ├── mime@2.4.6
│ ├── minimatch@3.0.4 deduped
│ ├── qjobs@1.2.0
│ ├── range-parser@1.2.1
│ ├── rimraf@3.0.2 deduped
│ ├─┬ socket.io@2.3.0
│ │ ├─┬ debug@4.1.1
│ │ │ └── ms@2.1.2
│ │ ├─┬ engine.io@3.4.2
│ │ │ ├── accepts@1.3.7 deduped
│ │ │ ├── base64id@2.0.0
│ │ │ ├── cookie@0.3.1
│ │ │ ├─┬ debug@4.1.1
│ │ │ │ └── ms@2.1.2
│ │ │ ├─┬ engine.io-parser@2.2.1
│ │ │ │ ├── after@0.8.2
│ │ │ │ ├── arraybuffer.slice@0.0.7
│ │ │ │ ├── base64-arraybuffer@0.1.4
│ │ │ │ ├── blob@0.0.5
│ │ │ │ └── has-binary2@1.0.3 deduped
│ │ │ └── ws@7.3.1
│ │ ├─┬ has-binary2@1.0.3
│ │ │ └── isarray@2.0.1
│ │ ├── socket.io-adapter@1.1.2
│ │ ├─┬ socket.io-client@2.3.0
│ │ │ ├── backo2@1.0.2
│ │ │ ├── base64-arraybuffer@0.1.5
│ │ │ ├── component-bind@1.0.0
│ │ │ ├── component-emitter@1.2.1
│ │ │ ├─┬ debug@4.1.1
│ │ │ │ └── ms@2.1.2
│ │ │ ├─┬ engine.io-client@3.4.4
│ │ │ │ ├── component-emitter@1.3.0
│ │ │ │ ├── component-inherit@0.0.3
│ │ │ │ ├── debug@3.1.0 deduped
│ │ │ │ ├── engine.io-parser@2.2.1 deduped
│ │ │ │ ├── has-cors@1.1.0 deduped
│ │ │ │ ├── indexof@0.0.1 deduped
│ │ │ │ ├── parseqs@0.0.6
│ │ │ │ ├── parseuri@0.0.6
│ │ │ │ ├─┬ ws@6.1.4
│ │ │ │ │ └── async-limiter@1.0.1 deduped
│ │ │ │ ├── xmlhttprequest-ssl@1.5.5
│ │ │ │ └── yeast@0.1.2
│ │ │ ├── has-binary2@1.0.3 deduped
│ │ │ ├── has-cors@1.1.0
│ │ │ ├── indexof@0.0.1
│ │ │ ├── object-component@0.0.3
│ │ │ ├─┬ parseqs@0.0.5
│ │ │ │ └─┬ better-assert@1.0.2
│ │ │ │   └── callsite@1.0.0
│ │ │ ├─┬ parseuri@0.0.5
│ │ │ │ └── better-assert@1.0.2 deduped
│ │ │ ├─┬ socket.io-parser@3.3.1
│ │ │ │ ├── component-emitter@1.3.0
│ │ │ │ ├─┬ debug@3.1.0
│ │ │ │ │ └── ms@2.0.0
│ │ │ │ └── isarray@2.0.1
│ │ │ └── to-array@0.1.4
│ │ └─┬ socket.io-parser@3.4.1
│ │   ├── component-emitter@1.2.1
│ │   ├─┬ debug@4.1.1
│ │   │ └── ms@2.1.2
│ │   └── isarray@2.0.1
│ ├── source-map@0.6.1
│ ├─┬ tmp@0.2.1
│ │ └── rimraf@3.0.2 deduped
│ ├── ua-parser-js@0.7.21
│ └─┬ yargs@15.4.1
│   ├─┬ cliui@6.0.0
│   │ ├── string-width@4.2.0 deduped
│   │ ├─┬ strip-ansi@6.0.0
│   │ │ └── ansi-regex@5.0.0
│   │ └─┬ wrap-ansi@6.2.0
│   │   ├─┬ ansi-styles@4.3.0
│   │   │ └─┬ color-convert@2.0.1
│   │   │   └── color-name@1.1.4
│   │   ├── string-width@4.2.0 deduped
│   │   └── strip-ansi@6.0.0 deduped
│   ├── decamelize@1.2.0 deduped
│   ├─┬ find-up@4.1.0
│   │ ├─┬ locate-path@5.0.0
│   │ │ └─┬ p-locate@4.1.0
│   │ │   └── p-limit@2.3.0 deduped
│   │ └── path-exists@4.0.0
│   ├── get-caller-file@2.0.5 deduped
│   ├── require-directory@2.1.1 deduped
│   ├── require-main-filename@2.0.0 deduped
│   ├── set-blocking@2.0.0 deduped
│   ├─┬ string-width@4.2.0
│   │ ├── emoji-regex@8.0.0
│   │ ├── is-fullwidth-code-point@3.0.0
│   │ └── strip-ansi@6.0.0 deduped
│   ├── which-module@2.0.0 deduped
│   ├── y18n@4.0.0 deduped
│   └─┬ yargs-parser@18.1.3
│     ├── camelcase@5.3.1 deduped
│     └── decamelize@1.2.0 deduped
├─┬ karma-chrome-launcher@3.1.0
│ └─┬ which@1.3.1
│   └── isexe@2.0.0
├─┬ karma-coverage-istanbul-reporter@3.0.3
│ ├── istanbul-lib-coverage@3.0.0
│ ├─┬ istanbul-lib-report@3.0.0
│ │ ├── istanbul-lib-coverage@3.0.0 deduped
│ │ ├─┬ make-dir@3.1.0
│ │ │ └── semver@6.3.0
│ │ └─┬ supports-color@7.2.0
│ │   └── has-flag@4.0.0
│ ├─┬ istanbul-lib-source-maps@3.0.6
│ │ ├─┬ debug@4.2.0
│ │ │ └── ms@2.1.2
│ │ ├── istanbul-lib-coverage@2.0.5
│ │ ├─┬ make-dir@2.1.0
│ │ │ ├── pify@4.0.1 deduped
│ │ │ └── semver@5.7.1
│ │ ├─┬ rimraf@2.7.1
│ │ │ └── glob@7.1.6 deduped
│ │ └── source-map@0.6.1
│ ├─┬ istanbul-reports@3.0.2
│ │ ├── html-escaper@2.0.2
│ │ └── istanbul-lib-report@3.0.0 deduped
│ └── minimatch@3.0.4 deduped
├─┬ karma-jasmine@3.3.1
│ └── jasmine-core@3.5.0 deduped
├── karma-jasmine-html-reporter@1.5.4
├─┬ protractor@7.0.0
│ ├── @types/q@0.0.32
│ ├── @types/selenium-webdriver@3.0.17
│ ├─┬ blocking-proxy@1.0.1
│ │ └── minimist@1.2.5 deduped
│ ├─┬ browserstack@1.6.0
│ │ └─┬ https-proxy-agent@2.2.4
│ │   ├─┬ agent-base@4.3.0
│ │   │ └─┬ es6-promisify@5.0.0
│ │   │   └── es6-promise@4.2.8
│ │   └── debug@3.1.0 deduped
│ ├─┬ chalk@1.1.3
│ │ ├── ansi-styles@2.2.1
│ │ ├── escape-string-regexp@1.0.5
│ │ ├─┬ has-ansi@2.0.0
│ │ │ └── ansi-regex@2.1.1
│ │ ├─┬ strip-ansi@3.0.1
│ │ │ └── ansi-regex@2.1.1
│ │ └── supports-color@2.0.0
│ ├── glob@7.1.6 deduped
│ ├─┬ jasmine@2.8.0
│ │ ├── exit@0.1.2
│ │ ├── glob@7.1.6 deduped
│ │ └── jasmine-core@2.8.0
│ ├── jasminewd2@2.2.0
│ ├── q@1.4.1
│ ├─┬ saucelabs@1.5.0
│ │ └── https-proxy-agent@2.2.4 deduped
│ ├─┬ selenium-webdriver@3.6.0
│ │ ├─┬ jszip@3.5.0
│ │ │ ├─┬ lie@3.3.0
│ │ │ │ └── immediate@3.0.6
│ │ │ ├── pako@1.0.11
│ │ │ ├── readable-stream@2.3.7 deduped
│ │ │ └── set-immediate-shim@1.0.1
│ │ ├─┬ rimraf@2.7.1
│ │ │ └── glob@7.1.6 deduped
│ │ ├─┬ tmp@0.0.30
│ │ │ └── os-tmpdir@1.0.2 deduped
│ │ └── xml2js@0.4.23 deduped
│ ├─┬ source-map-support@0.4.18
│ │ └── source-map@0.5.7
│ ├─┬ webdriver-js-extender@2.1.0
│ │ ├── @types/selenium-webdriver@3.0.17 deduped
│ │ └── selenium-webdriver@3.6.0 deduped
│ ├─┬ webdriver-manager@12.1.7
│ │ ├── adm-zip@0.4.16
│ │ ├── chalk@1.1.3 deduped
│ │ ├─┬ del@2.2.2
│ │ │ ├─┬ globby@5.0.0
│ │ │ │ ├─┬ array-union@1.0.2
│ │ │ │ │ └── array-uniq@1.0.3 deduped
│ │ │ │ ├── arrify@1.0.1
│ │ │ │ ├── glob@7.1.6 deduped
│ │ │ │ ├── object-assign@4.1.1 deduped
│ │ │ │ ├── pify@2.3.0 deduped
│ │ │ │ └── pinkie-promise@2.0.1 deduped
│ │ │ ├── is-path-cwd@1.0.0
│ │ │ ├─┬ is-path-in-cwd@1.0.1
│ │ │ │ └─┬ is-path-inside@1.0.1
│ │ │ │   └── path-is-inside@1.0.2 deduped
│ │ │ ├── object-assign@4.1.1 deduped
│ │ │ ├── pify@2.3.0
│ │ │ ├─┬ pinkie-promise@2.0.1
│ │ │ │ └── pinkie@2.0.4
│ │ │ └── rimraf@2.7.1 deduped
│ │ ├── glob@7.1.6 deduped
│ │ ├── ini@1.3.5 deduped
│ │ ├── minimist@1.2.5 deduped
│ │ ├── q@1.4.1 deduped
│ │ ├── request@2.88.2 deduped
│ │ ├─┬ rimraf@2.7.1
│ │ │ └── glob@7.1.6 deduped
│ │ ├── semver@5.7.1
│ │ └─┬ xml2js@0.4.23
│ │   ├── sax@1.2.4 deduped
│ │   └── xmlbuilder@11.0.1
│ └─┬ yargs@15.4.1
│   ├─┬ cliui@6.0.0
│   │ ├── string-width@4.2.0 deduped
│   │ ├─┬ strip-ansi@6.0.0
│   │ │ └── ansi-regex@5.0.0
│   │ └─┬ wrap-ansi@6.2.0
│   │   ├─┬ ansi-styles@4.3.0
│   │   │ └─┬ color-convert@2.0.1
│   │   │   └── color-name@1.1.4
│   │   ├── string-width@4.2.0 deduped
│   │   └─┬ strip-ansi@6.0.0
│   │     └── ansi-regex@5.0.0
│   ├── decamelize@1.2.0 deduped
│   ├─┬ find-up@4.1.0
│   │ ├─┬ locate-path@5.0.0
│   │ │ └─┬ p-locate@4.1.0
│   │ │   └── p-limit@2.3.0 deduped
│   │ └── path-exists@4.0.0
│   ├── get-caller-file@2.0.5 deduped
│   ├── require-directory@2.1.1 deduped
│   ├── require-main-filename@2.0.0 deduped
│   ├── set-blocking@2.0.0 deduped
│   ├─┬ string-width@4.2.0
│   │ ├── emoji-regex@8.0.0
│   │ ├── is-fullwidth-code-point@3.0.0
│   │ └─┬ strip-ansi@6.0.0
│   │   └── ansi-regex@5.0.0
│   ├── which-module@2.0.0 deduped
│   ├── y18n@4.0.0 deduped
│   └─┬ yargs-parser@18.1.3
│     ├── camelcase@5.3.1 deduped
│     └── decamelize@1.2.0 deduped
├─┬ rxjs@6.5.5
│ └── tslib@1.13.0
├─┬ ts-node@8.3.0
│ ├── arg@4.1.3
│ ├── diff@4.0.2
│ ├── make-error@1.3.6
│ ├── source-map-support@0.5.19 deduped
│ └── yn@3.1.1
├── tslib@2.0.1
├─┬ tslint@6.1.3
│ ├─┬ @babel/code-frame@7.10.4
│ │ └─┬ @babel/highlight@7.10.4
│ │   ├── @babel/helper-validator-identifier@7.10.4 deduped
│ │   ├── chalk@2.4.2 deduped
│ │   └── js-tokens@4.0.0
│ ├── builtin-modules@1.1.1
│ ├─┬ chalk@2.4.2
│ │ ├─┬ ansi-styles@3.2.1
│ │ │ └─┬ color-convert@1.9.3
│ │ │   └── color-name@1.1.3
│ │ ├── escape-string-regexp@1.0.5 deduped
│ │ └─┬ supports-color@5.5.0
│ │   └── has-flag@3.0.0 deduped
│ ├── commander@2.20.3
│ ├── diff@4.0.2
│ ├── glob@7.1.6 deduped
│ ├─┬ js-yaml@3.14.0
│ │ ├─┬ argparse@1.0.10
│ │ │ └── sprintf-js@1.0.3
│ │ └── esprima@4.0.1
│ ├── minimatch@3.0.4 deduped
│ ├─┬ mkdirp@0.5.5
│ │ └── minimist@1.2.5 deduped
│ ├─┬ resolve@1.17.0
│ │ └── path-parse@1.0.6
│ ├── semver@5.7.1
│ ├── tslib@1.13.0
│ └─┬ tsutils@2.29.0
│   └── tslib@1.13.0
├── typescript@3.9.7
├── uuid@8.3.1
└── zone.js@0.10.3


</details>


## Comment

---------------

Author: @ashika01

Thanks. I tested in ang 8,9 its working. I am gonna work on testing in angular 10 today.
## Comment

---------------

Author: @ashika01

Okay, tested with angular `~10.1.4` and I dont have any problem with put. I think your policy setup might be causing this.

![Screen Shot 2020-10-08 at 4 57 13 PM](https://user-images.githubusercontent.com/35131273/95524859-61bddd80-0987-11eb-914c-cc5ae79a084a.png)


My IAM policy config looks like,

![Screen Shot 2020-10-08 at 5 00 58 PM](https://user-images.githubusercontent.com/35131273/95525160-443d4380-0988-11eb-8bc8-b09983edfb24.png)
![Screen Shot 2020-10-08 at 5 00 12 PM](https://user-images.githubusercontent.com/35131273/95525162-47d0ca80-0988-11eb-9c27-8fad2a040252.png)

Full read policy
![Screen Shot 2020-10-08 at 5 02 26 PM](https://user-images.githubusercontent.com/35131273/95525218-659e2f80-0988-11eb-8671-c5da49bd0fbe.png)


I use `Amplify add storage` to create this, I would suggest you cross check your permissions to this or roll out permissions using s3 bucket created thru Amplify CLI.

Moving the issue to discussion since it is not a bug and continue further discussion with the community.
## Comment

---------------

Author: @edoardo849

I think I understand what was causing the issue. But I think it's a bug. I had previously created, deleted and re-created a bucket using the Amplify CLI. The error came on the new bucket. Upon further inspection, the old bucket name was still present in `aws-exports.js`. In other words, when creating the new bucket, the CLI didn't modify `aws-exports.js`
## Comment

---------------

Author: @Nagasai97

i am getting [ERROR] 19:34.60 axios-http-handler - Network Error, can anyone help me whether its configuration issue or anyother

---------------

---------------

# Is there way to programatically change between Authenticator UI states

---------------

Author: @advissor
Upvotes: 1
Comments: 0

Hi, 

Is there way to programmatically change between Authenticator UI states? 

For example, through TS code switch from Sign-in to Sign up, or from Signup to Confirm Sign up?

I do see functions in API, but they require to pass the input info to submit to Auth API, not just for switching between page


---------------

---------------

# Is it possible to implement Google One tap sign up and sign in with AWS Amplify?

---------------

Author: @oahmaro
Upvotes: 2
Comments: 1

I have seen this feature implemented on many sites like Linkedin.com, or Medium.com, and i would like to know if this is something possible to integrate with aws amplify?

here is a link for the documentation from google.
[https://developers.google.com/identity/gsi/web](https://developers.google.com/identity/gsi/web)
## Comment

---------------

Author: @jysung

Did you find a solution? Is it possible?

---------------

---------------

# Angular amplify-authenticator  : How to restore the state of UI to the "Email confirmation" step

---------------

Author: @advissor
Upvotes: 1
Comments: 0

HI, 
I am working on chrome extension and using amplify-authenticator with Angular 

The issue I have right now is with the Email confirmation code
As, when you leave the focuses off the chrome extension popup, it is being closed

So, when you re-open again the pop-up, you have to again enter the email + password, to get back to email verification

Is there a way to restore the UI to the state with email confirmation?
Like that I can save that session in browser store & it it exist, load it back to UI to eliminate that extra repeatable step

---------------

---------------

# Angular Amplify Service and new UI

---------------

Author: @alexvdvalk
Upvotes: 1
Comments: 6

The new documentation suggests suggests that developers remove the amplify service when migrating to the new auth UI. Does this mean the amplifyservice is being deprecated, or can I continue to use it? Or what is the best practice? I've been using the $authStateChange observable in my app component which works really well, but I'm not sure if this is the best approach moving forward.

Anyone got any code samples or suggestions?

The new authenticator UI also lacks some of the configuration options but I hope these will become available soon.
## Comment

---------------

Author: @lkowalski-smartbusiness

I'm in the same boat as @alexvdvalk. Would love to test the newest modules but I'm stuck with the old logic that cannot be overridden yet..
## Comment

---------------

Author: @jordanranz

Hey @alexvdvalk @lkowalski-smartbusiness

I am working on a PR now to expose a callback prop on the `amplify-authenticator` component:
https://github.com/aws-amplify/amplify-js/pull/5930

`onAuthUIStateChange` should work as well but the preferred method will be the callback prop mentioned above.

Looking to pull this out of draft soon. Also looking to add documentation around this asap.
## Comment

---------------

Author: @alexvdvalk

@lkowalski-smartbusiness thank you for sharing this. I'm on my second attempt at getting the new authenticator working. The changeDetenction is breaking when I add the "onAuthUIStateChange" into my app.component.ts. I've tried addedin it in the constructor and NgOnInit. 

Do you have any code snippets you can share with me around how you've implemented this?
## Comment

---------------

Author: @alkhwarizmix

Hi, I am using Hub as described here https://github.com/aws-amplify/amplify-js/issues/5303

```javascript
interface IAuthState {
  state: string;
  user: any;
}

  public ngOnInit() {
    Hub.listen("auth", data => {
      this.authStateChange({
        state: data.payload.event === "signIn" ? "signedIn" : data.payload.event,
        user: data.payload.data
      });
    });
  }

  private authStateChange(authState: IAuthState) {
    this.signedIn = authState.state === "signedIn";
    if (this.signedIn) {
      if (!authState.user) {
        this.user = null;
      } else {
        this.user = authState.user;
        this.greeting = "Hello " + this.user.username;
        this.router.navigate(["/tabs"]);
      }
    }
  }
```
## Comment

---------------

Author: @lkowalski-smartbusiness

@alexvdvalk I finally found the time to debug this some more, chatted a while with jordanranz too.
Here's my take on the authorization for now (see the explanation in comment block):
https://github.com/lkowalski-smartbusiness/amplify-tester/blob/8aa5314ecc40c8e1eecfe83a698883174694fe66/src/app/app.component.ts#L24
Battle tested this one and so far it's working, tho I found other small glitches in the package

I'm still leaning towards @alkhwarizmix solution as it seems less hacky (and aligns with what I used to do in the legacy component) but would need to test it through with my solution.
## Comment

---------------

Author: @kewur

So, it's unclear from the answers, is there an alternative now to the AmplifyService? 

---------------

---------------

# When call mutation update grapql, how to replace all array instead of append to array

---------------

Author: @hoan-pham-duy
Upvotes: 1
Comments: 0

Hi everyone,
Currently, I met a problem related to call mutation graphql update.
I **_want to replace all elements of the existed array_** with an input array but when I do the test, **_graphql seems to append the input array to existed array_**.

**_Example:_**  
The input array is [3.3] and the existed array is [1.1,2.2]
**_Query:_**
<img width="528" alt="image" src="https://user-images.githubusercontent.com/14135094/130209000-21d04805-5fbd-4561-9666-36ec0d59ac64.png">

**_Result:_**
<img width="497" alt="image" src="https://user-images.githubusercontent.com/14135094/130209178-20f14a4a-ed02-4814-9848-96bbb841d5a1.png">
I'm also considering is it a bug too? 
Is there any way that I can replace all the elements of the array with the input array?
Hope for your help!
Thanks and Best Regards,

---------------

---------------

# DataStore integration for existing non-amplify project

---------------

Author: @phineas629
Upvotes: 1
Comments: 0

** Which Category is your question related to? **
DataStore

** What AWS Services are you utilizing? **
aws-amplify
api gateway
dynamodb
aws lambda (dynamodb is  provisioned with serverless framework and served through apoll-graphql-lambda)


** Provide additional details e.g. code snippets **
I am using aws-amplify libraries: auth and api. Works great!
The project is not created through amplify admin ui or amplify cli.
We're using config file to get the current setup working.
Below is my config file.

I want to add the aws-amplify dataStore library and it's persistance feature for offline-first usage. 
Is it possible to get the syncing ability without me having to rebuild the project in amplify ui or amplify cli now? 
I see an old issue related to the problem I am encountering. 
https://github.com/aws-amplify/amplify-js/issues/4704


`  import '@aws-amplify/ui-vue'
import Amplify, { Auth, API, graphqlOperation } from 'aws-amplify'

export default async ({ Vue }) => {
  Amplify.configure({
    Auth: {
      ...process.env.AWS.Auth
    },
    API: {
      ...process.env.AWS.API,
      graphql_headers: async () => ({
        Authorization: (await Auth.currentSession()).getIdToken().getJwtToken()
      })
    }
  })
  const $graphql = (query, variables) => API.graphql(graphqlOperation(query, variables))

  Vue.$graphql = $graphql
  Vue.prototype.$graphql = $graphql`



---------------

---------------

# set cookie storage expires to 'session' not days

---------------

Author: @bambbamnenim
Upvotes: 2
Comments: 1

````
Auth.configure({
  cookieStorage: {
    domain: "localhost",
    expires: 0 // <- i want to set this for 'session' 
    secure: false,
  },
});````

but the docs only talks about in days, so how do i do this?
(doc i looked up : https://docs.amplify.aws/lib/auth/start/q/platform/js#re-use-existing-authentication-resource)
## Comment

---------------

Author: @robixdf

I believe 
```
expires: undefined
```
should do the trick

---------------

---------------

# Is there a note on Amplify limitation when used in a service worker?

---------------

Author: @Jun711
Upvotes: 1
Comments: 0

I am using Amplify in a web app and I notice that it uses local storage quite a bit. 
Since local storage is not accessible when in a service worker and possibly other limitations, I wonder which Amplify functions do not work when it is used in a service worker. 
Is there a note somewhere that I can check? Thanks

---------------

---------------

# DataStore persistence for own rolled aws backend

---------------

Author: @phineas629
Upvotes: 1
Comments: 0

We are currently using amplify and want to add the datastore library.
Is it possible to get DataStore persistence feature  if our  graphql and dynamodb is set up without using amplify cli?   We wrote our own schema for graphql, provisioned apollo graphql serverless in aws lambda, dynamodb is set up on out own also. We have got our infrastructure  configured and working with amplify. I know we can get DataStore but would really benefit from the persistence feature. How can we configure datastore to add persistence feature without amplify cli? 

---------------

---------------

# Auth.currentAuthenticatedUser returns The user is not authenticated in a dynamic route in next.js

---------------

Author: @levelingup
Upvotes: 1
Comments: 0

I'm getting `The user is not authenticated` when I run `await Auth.currentAuthenticatedUser();`

In my file **pages/activations/[id].js**

I have this:

```
export async function getStaticPaths({ req }) {
  const { API, Auth } = withSSRContext({ req });
  const user = await Auth.currentAuthenticatedUser();
  console.log("static paths");
  const activationData = await API.graphql({
    query: listActivations,
  });
  console.log("activationData", user);
  const paths = activationData.data.listActivations.items.map((activation) => ({
    params: { id: activation.id },
  }));
  return {
    paths,
    fallback: true,
  };
}
```

I know that I'm already signed in because if I have similar code in other pages where I know I'm signed in, but I'm not sure if this is the issue because of dynamic routing?

---------------

---------------

# MFA - is it possible to change the issuer name in the authenticator instead of AWSCognito to show custom name

---------------

Author: @joejanho
Upvotes: 1
Comments: 0

After scanning the QR code, will it be possible to change 'AWSCognito' in the authenticator app to something else(custom)
I am using react UI components 

---------------

---------------

# amplify-ui-components @aws-amplify/ui-vue How to sign in using custom submit button?

---------------

Author: @filonik
Upvotes: 2
Comments: 1

I would like to disable the sign in button in some cases, so I thought I could use the `primary-footer-content` slot to override the default button. However, as soon as I do this, the sign in button stops working entirely. Can anybody help me out?

```
<template>
  <div id="app">
    <amplify-authenticator>
      <amplify-sign-in header-text="My Custom Sign In Header" slot="sign-in">
        <div slot="primary-footer-content">
          <amplify-button type="submit">Sign In</amplify-button>
        </div>
      </amplify-sign-in>
      <HelloWorld msg="Welcome to Your Vue.js App"/>
      <amplify-sign-out></amplify-sign-out>
    </amplify-authenticator>
  </div>
</template>
```
## Comment

---------------

Author: @filonik

Anyone? Surely this can't be too difficult to accomplish...

---------------

---------------

# Authentication with phone_number or email

---------------

Author: @ricardoribas
Upvotes: 1
Comments: 1

I am using a cognito application to authenticate users on the application i am helping to build. The old version was only allowing users to authenticate with the phone number. Happens that right now, we are going to allow users to authenticate through email. 

Do we need to have a special care on this topic. Old users have their username in a phone_number format (for instance +351XXXXXXXX) and have one of the attributes as email (for instance example@domain.com). If I try to login with the email for this kind of users, i get a **UserNotFoundException**. That might be returned as the property username is not the email. In order to solve this issue, i need to create a cognito trigger (pre-signin) that will try to get a user from cognito using email or phone_number?

For this particular topics, i might have two use cases:
1 - A user signup with the phone_number and property email
2 - A user signup with the email and property phone_number
## Comment

---------------

Author: @evcodes

Checkout this [link](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html#:~:text=longer%20in%20use.-,Overview%20of%20Aliases,-You%20can%20allow) to set up custom aliases that will allow you to sign in with custom identifiers

---------------

---------------

# @searchable data consistency

---------------

Author: @azgorov
Upvotes: 1
Comments: 0

This is more of a question if someone have a solution...

For example - create simple react app + amplify TODO example and make model searchable:

type Todo @model @searchable {
  id: ID!
  name: String!
  description: String
}

Then just  add/delete and then search. For example: 

    const random = nanoid()
    const newItem = await API.graphql(graphqlOperation(createTodo, {input: {id: random, description: random, name: random}}));
    console.log(newItem);
    const result1 = await API.graphql(graphqlOperation(searchTodos));
    console.log(result1)
    const deleteItem = await API.graphql(graphqlOperation(deleteTodo, {input: {id: random}}));
    console.log(deleteItem);
    const result2 = await API.graphql(graphqlOperation(searchTodos));
    console.log(result2)

Result2 data still contains deleted item.
This is normal as ddb stream waits 1 sec to send data to es and then es index refresh time is 1 second.

How you solve this possible 1-2 sec period between mutation and search?



---------------

---------------

# Call "amplify function" via API interface?

---------------

Author: @martinmeinke
Upvotes: 1
Comments: 0

I am currently working on a vue.js + amplify project featuring.
- Auth 
- API (graphql)
- (free) Functions

```
| Category | Resource name    | Operation | Provider plugin   |
| -------- | ---------------- | --------- | ----------------- |
| Function | myapifunction    | No Change | awscloudformation |
....
```

I have been trying to find some resources on calling the `Functions` via the 
`API` library like this:

```
import { API } from "aws-amplify";
API.get("myapifunction", "/", {})
```

I have not been successful in getting it to work so far. ("API myapifunction does not exist")
Is there some documentation available?

I plan on using the Auth/GraphQL functionality from within the Lambda Functions.

Thank you very much for your support


---------------

---------------

# Using the Location Search in the Geo service, can I filter by street addresses only?

---------------

Author: @cmaycumber
Upvotes: 1
Comments: 0

I'd like to filter by street addresses only and even more ideally, residential street addresses. Is this currently possible? It would be extremely helpful for our use case. 

---------------

---------------

# Can the `next build` command be overriden?

---------------

Author: @WarcraftYax
Upvotes: 1
Comments: 0

My repo has `package.json` at the root, but has a `cms` folder that contains the `pages` directory used for my Next.js app.

I can build this fine by running `next build ./cms`.

I have this specified in my `amplify.yml` like this:

```yml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - npm run cms:build
  artifacts:
    baseDirectory: cms/.next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
```

Where `npm run cms:build` maps to `next build ./cms` in my `package.json`.

However, when I try to build this app in Amplify, the `npm run cms:build` command succeeds fine, but then Amplify starts trying to do another SSR build (which fails because it expects `pages` to be at the root-level)? Am I right in assuming that Amplify magically injects a `next build` command into the build process? If so, can this command be customised so I can add the `./cms` parameter to it? I can't find any information about this in the docs, and it's not a setting that you can specify using `next.config.js`.

---------------

---------------

# Is there a way to see server logs?

---------------

Author: @marlonmarcello
Upvotes: 2
Comments: 0

Hi there!
I am using NextJS with SSR on Amplify but I am getting a 500 Internal Server Error on all my routes.
How can I see what's going on? Where can I find the server logs?

---------------

---------------

# Why isn't the owner field explicitly passed when doing a graphql query?

---------------

Author: @charlesloubao
Upvotes: 1
Comments: 0

I have a graphql model like this

```
type Thing @model @auth(rules: [{allow: owner}]) {
  id: ID!
  name: String!
}
```

From what I understand, when doing a create/update/delete the owner field will be automatically added to the request for me. Why isn't it the case when subscribing or doing a get query? I have to pass the owner field myself every time.

```
API.graphql(graphqlOperation(subscriptions.onUpdateThing, {id, owner: user.attributes.sub }))
    .subscribe((value => console.log(value)))
```

Without it I get an **unauthorized error**
```
API.graphql(graphqlOperation(subscriptions.onUpdateThing, {id}))
    .subscribe((value => console.log(value)))
```
Error:
```
Connection failed: {"errors":[{"errorType":"Unauthorized","message":"Not Authorized to access onUpdatePet on type Subscription"}]}
```


Is that normal or did I miss something in the docs?
PS: I am new to GraphQL

---------------

---------------

# Amplify not including zip file inside React project

---------------

Author: @jacksonHendric
Upvotes: 1
Comments: 0

Hi all,

I use amplify for CI/CD, the react project has a amplify.yml file that is used to automatically build when pushed into releases/production.
This works great but if I use the leaflet library and have a .zip file that has map routing information, when the build is complete the routing information is missing. The zip file is essentially removed or not included in the build somehow.

If I manually build the project locally and upload the build directory into amplify that zip is all good and the routes can be seen on the map after deployment on amplify.

Is there a way to allow the zip file to be included in my CI/CD?

( zip file location in project --> src --> routes.zip )

Thanks

---------------

---------------

# How admin to call `initiateAuth` or `adminInitiateAuth` from admin to another user

---------------

Author: @matart15
Upvotes: 1
Comments: 0

I implemented passwordless sms login which is working fine with userside.
https://aws.amazon.com/blogs/mobile/implementing-passwordless-email-authentication-with-amazon-cognito/

But when user changes phone number admin have top send SMS to his new phone number.

For that i have to call one of `initiateAuth` or `adminInitiateAuth`.

1. if I call Auth.signIn on admin side my admin logs out and changes to user
2. If i try to call adminInitiateAuth directly I cant find any instance of Cognito user from AdminQueries.getUser. 

how do I call `CognitoUser.initiateAuth` ?

---------------

---------------

# PinPoint Query Audience Data

---------------

Author: @wezside
Upvotes: 1
Comments: 0

Is there no way currently to query data or more specifically event data which is recorded using Amplify's `Analytics.record` function? I have a use case where all I need to show is views for a specific page on a dashboard. 

---------------

---------------

# Customer Provided SSE Key for Storage.Get not supported?

---------------

Author: @bmw46033
Upvotes: 1
Comments: 0

A recent PR fixed the Storage.Put to properly set the SSE header values.  However, I am now encounter a similar problem with the Storage.Get.  Check the typescript code, there is no logic to handle adding SSE header values to the getObject request.  Is there a reason for this?  Just an omission?

The AWS-SDK specifications:
https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html#:~:text=If%20you%20encrypt,Provided%20Encryption%20Keys).

---------------

---------------

# How to setup AWS SNS on amplify

---------------

Author: @matart15
Upvotes: 1
Comments: 0

followed this tutorial 
- https://techinscribed.com/passwordless-phone-number-authentication-using-aws-amplify-cognito/
- https://github.com/mobilequickie/amplify-passwordless-sms-auth/blob/master/backend/lambda-triggers/create-auth-challenge/create-auth-challenge.js
- https://gist.github.com/praveen001/57b0d8262e1a2ef0c539d0715a3649e1

amplify function calling AWS SNS gives 
 - `Invalid parameter: TopicArn or TargetArn Reason: no value for required parameter` error

manually creating AWS SNS topic and adding `TopicArn` fixed it.
```ts
const sns = new AWS.SNS({
  apiVersion: '2010-03-31',
  region: 'ap-northeast-1',
  TopicArn: TOPIC_ARN,
});
```

but my question is why a lot of people wrote it without `TopicArn`. am I missing something?

---------------

---------------

# Customize signup form with signUpConfig parameter using withAuthenticator

---------------

Author: @StreetLamp05
Upvotes: 1
Comments: 0

I followed the following instructions [here ](https://medium.com/@coryschimmoeller/customizing-the-authentication-experience-of-amplifys-withauthenticator-e6f2089ff469)but no effect. Any advice is welcome. 

code: [https://prnt.sc/1hw3x57](https://prnt.sc/1hw3x57)

export default withAuthenticator(App, {
  signUpConfig: {
    hiddenDefaults: ["phone_number"],
    signUpFields: [
      {
        label: "First Name",
        key: "given_name",
        required: true,
        type: "string",
      },
      {
        label: "Last Name",
        key: "family_name",
        required: true,
        type: "string",
      },
    ],
  },
});

---------------

---------------

# Creating Amplify project and assign repository through cloudformation

---------------

Author: @juliandm
Upvotes: 1
Comments: 0

Hello has anybody here found out how i can successfully assign a repository to an Amplify project with the following spec?
https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-amplify-app.html

I tried both an S3 BucketName and a CodeCommit name and received the following error:
```
Resource handler returned message: "Invalid request provided: Repository provider not supported. (Service: Amplify, Status Code: 400, Request ID: a12af1b1-b7bd-4643-96af-3945de1a9fed, Extended Request ID: null)" (RequestToken: dc1dc831-f742-cb7d-a59a-d5d9a93ebd2a, HandlerErrorCode: InvalidRequest)
```

Unfortunately it's not documented what this attribute requires exactly

---------------

---------------

# Check if user is authenticated on API route

---------------

Author: @marco910
Upvotes: 2
Comments: 0

Hi there,

I'm using Amplify with an existing Cognito backend on my Next.js app and try to check on an API route if a user is signed in or not.

That's the code for the route:
```
import Amplify, { withSSRContext } from "aws-amplify";
import awsconfig from "../../aws-exports.js";

Amplify.configure({ ...awsconfig, ssr: true });

export default async (req, res) => {
  const { Auth } = withSSRContext({ req });

  try {
    const user = await Auth.currentAuthenticatedUser();
    res.json({ user });
  } catch (error) {
    res.json({ error });
  }
};
```

I'm getting always an error that no user is signed in. Although, when a user is signed in. Where is the problem in my code/config?

---------------

---------------

# Not getting the data upon querying in Appsync even though the data is persent in DynamoDB

---------------

Author: @sourabpramanik
Upvotes: 1
Comments: 1

So I am building an e-commerce using Gatsby and AWS. So for the payment process and creating the sucessful order I am using Lambda functions using the pipeline re-solvers. Everything is working fine but when I query the listOrders in the Appsync I get the total of the order and the customer name but not the products even though I can see those products in my dynamoDB table. Actually the orders table and products table are having many-to-many relationship.  Below are the related code.

**SCHEMA**

```
type Orders @model 
  @auth(
    rules: [
      # only owner can see his orders
      { allow: owner, identityClaim: "email", ownerField: "customer" }
      # allow admins to view orders
      # { allow: groups, groups: ["Admin"] }
    ]
  )
  @key(name: "byUser", fields: ["user"]) 
{
  id: ID!
  user: String!
  total: String
  date: String
  products: [OrdersProducts] @connection(keyName: "byOrders", fields: ["id"])
}

type Products @model @auth(rules: [{allow: public}]) {
  id: ID!
  name: String!
  image: String!
  current_value: String!
  original_value: String
  category: [String]
  orders: [OrdersProducts] @connection(keyName: "byProducts", fields: ["id"])
}

type OrdersProducts 
  @model
  @key(name: "byProducts", fields: ["productsID", "ordersID"]) 
  @key(name: "byOrders", fields: ["ordersID", "productsID"]) 
  @auth(
    rules: [
      # allow admins to create bookorders for customers by using customer email in lambda
      { allow: owner, identityClaim: "email", ownerField: "customer" }
      # { allow: groups, groups: ["Admin"] }
    ]
  ) 
  {
    id: ID!
    productsID: ID!
    ordersID: ID!
    products: Products! @connection(fields: ["productsID"])
    orders: Orders! @connection(fields: ["ordersID"])
    customer: String
  }
 
enum OrderStatus {
  SUCCESS
  FAILED
}

input CartItem {
  id: ID!
  name: String
  image: String
  current_value: String
  original_value: String
  category: [String]
  quantity:Int
  updatedAt:String
  _lastChangedAt:String
  _deleted:String
  createdAt:String
  _version:String
  
}

input ProcessOrderInput {
  id: ID!
  cart: [CartItem]
  total: Float!
  name: String
  token: String!
  address: String
}
type Mutation 
{
  processOrder(input: ProcessOrderInput!): OrderStatus
    @auth(rules: [{ allow: owner }])
    @function(name: "processPayment-${env}")
    @function(name: "createOrder-${env}")
}
```

**QUERY FOR listOrders**

```
query MyQuery {
  listOrders {
    items {
      id
      user
      customer
      products {
        items {
          id
          ordersID
          products {
            id
            image
            name
            current_value
            category
          }
        }
      }
      total
    }
  }
}
```
**QUERY RESULT**
```
{
  "data": {
    "listOrders": {
      "items": [
        {
          "id": "bb4927ee-c668-4e78-b5da-cd2321fedfe",
          "user": "eb7d92bf-9d70-4c10-9aae-wre43244234",
          "customer": "drekrode@gmail.com",
          "products": {
            "items": []
          },
          "total": "2799"
        },
        {
          "id": "26d0b283-2912-450e-9adc-fffeww32423",
          "user": "eb7d92bf-9d70-4c10-9aae-fewrer3242er32",
          "customer": "drekrode@gmail.com",
          "products": {
            "items": []
          },
          "total": "3057"
        },
        {
          "id": "83eaaaa6-df0c-4ec7-a038-fdwf41212",
          "user": "eb7d92bf-9d70-4c10-9aae-cd32143dw",
          "customer": "drekrode@gmail.com",
          "products": {
            "items": []
          },
          "total": "1900"
        }
      ]
    }
  }
}
```
**CREATE ORDER LAMBDA FUNCTION**

```
const { v4: uuidv4 } = require("uuid");
const AWS = require("aws-sdk");
const documentClient = new AWS.DynamoDB.DocumentClient();

const ORDER_TABLE = "Orders-xxxxxxxxxxxxxxxxxxxxx";
const ORDER_TYPE = "Orders";
const PRODUCT_ORDER_TABLE = "OrdersProducts-xxxxxxxxxxx";
const PRODUCT_ORDER_TYPE = "OrdersProducts";

const createOrder = async (payload) => {
  const { order_id, username, email, total } = payload;
  var params = {
    TableName: ORDER_TABLE,
    Item: {
      id: order_id,
      __typename: ORDER_TYPE,
      customer: email,
      user: username,
      total: total,
      updatedAt: new Date().toISOString(),
      createdAt: new Date().toISOString()
    }
  };
  console.log(payload);
  await documentClient.put(params).promise();
};

const createProductOrder = async (payload) => {
  let productOrders = [];
  console.log(payload)
  for (let i = 0; i < payload.cart.length; i++) {
    const cartItem = payload.cart[i];
    
    productOrders.push({
      PutRequest: {
        Item: {
          id: uuidv4(),
          __typename: PRODUCT_ORDER_TYPE,
          product_id: cartItem.id,
          order_id: payload.order_id,
          customer: payload.email,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        }
      }
    });
  }
  let params = {
    RequestItems: {}
  };
  params["RequestItems"][PRODUCT_ORDER_TABLE] = productOrders;
  
  await documentClient.batchWrite(params).promise();
};

/*
 * Get order details from processPayment lambda
 * Create an order
 * Link products to the order - Users can see the past orders and admins can view orders by user
 * Email the invoice (Will be added later)
 */
exports.handler = async (event) => {
  try {
    let payload = event.prev.result;
    payload.order_id = uuidv4();

    // create a new order
    await createOrder(payload);

    // links Products with the order
    await createProductOrder(payload);

    // Note - You may add another function to email the invoice to the user

    return "SUCCESS";
  } catch (err) {
    console.log(err);
    return new Error(err);
  }
};
```
## Comment

---------------

Author: @AndyW22

the ownerField `customer` doesn't exist in your schema, when you are creating items they don't have an owner, so when you query them you're not going to get any results since the owner doesn't match. even though you added it into the dynamoDB table, the API doesn't know what the `customer` field is.  you can change the ownerField to `user` for example, and that should give results from the query for the owner.

Also, to test theres not another reason as to why they arent being returned, add `{allow: private, provider: iam}` and query using IAM from appsync console or a lambda function.

note: you have no operations rules, so anyone can delete products on your database and owners/admins can read, update, delete, and create orders

---------------

---------------

# My test cannot find a module in Lambda Layer

---------------

Author: @bob-lee
Upvotes: 1
Comments: 1

After I moved my `helper.js` from lambda function to lambda layer `Dry`, my jest test for function is broken with error:

>Cannot find module '/opt/helper' from 'backend.js'

Tried to add below path to `jest.config.js` didn't help:

>modulePaths: [
    "<rootDir>/amplify/backend/function/Dry/lib/nodejs/node_modules/",
    "<rootDir>/amplify/backend/function/Dry"
  ],

Any idea?
## Comment

---------------

Author: @bob-lee

Solved by `moduleNameMapper` in `jest.config.js` that looks like below now:
```js
  moduleNameMapper: {
    '/opt/(.*)': '<rootDir>/amplify/backend/function/Dry/opt/$1'
  },
  modulePaths: [
    "<rootDir>/amplify/backend/function/Dry/lib/nodejs/node_modules/"
  ],

```

---------------

---------------

# Limited experience with Lambda Triggers and Destinations in AWS Amplify

---------------

Author: @vbbandeira
Upvotes: 1
Comments: 0

Hello everyone, I'm trying to set up a project within AWS Amplify to automate the creation of an Events framework based on Lambda functions, with the intention of deploying a backup of the event framework.

In the project, my goal is to add a trigger from the Alexa Skill Kit, to trigger a lambda function that targets the AmazonEvent Bridge.

However, when I try to configure within AWS Amplify my settings for triggers are limited to the web application itself and in user-dependent situations like login authentication, email verification, and the like.

Does anyone know if it's possible to add extrinsic triggers to the application and if it's possible to add destinations for when a lambda function is executed because I couldn't identify this configuration option in any step within AWS Amplify? If so, which path should I follow to achieve this result?

This image below is how it was done in the original event-based project, I want to replicate something like this within Amplify.

![printscreen](https://user-images.githubusercontent.com/25926739/127555073-2e171631-cb9f-4b10-bda0-b7f060ec81cf.png)

Thanks!

---------------

---------------

# Remove "Sign in with AWS" but keep Facebook sign in button using @aws-amplify/ui-components

---------------

Author: @countryst
Upvotes: 2
Comments: 1

I'm using "@aws-amplify/ui-components": "^1.2.0", quasar and Vue
I'm following https://docs.amplify.aws/ui/auth/authenticator/q/framework/vue

I want to remove ""Sign in with AWS"
![Screenshot](https://i.ibb.co/PQzTRTt/Screen-Shot-2021-04-22-at-3-06-30-PM.png)

Here is my App.vue:

```
<template>
  <div id="q-app">
    <div>
      <div v-if="authState !== 'signedin'">You are signed out.</div>
      <amplify-authenticator :federated.prop="federatedIds">
        <div v-if="authState === 'signedin' && user">
          <div>Hello, {{user.username}}</div>
        </div>
        <amplify-sign-out></amplify-sign-out>
      </amplify-authenticator>
    </div>
  </div>
</template>
<script lang="ts">
import { defineComponent } from '@vue/composition-api'
import { onAuthUIStateChange } from '@aws-amplify/ui-components'

export default defineComponent({
  name: 'App',
  created() {
    this.unsubscribeAuth = onAuthUIStateChange((authState, authData) => {
      this.authState = authState;
      this.user = authData;
    })
  },
  data() {
    return {
      user: undefined,
      authState: undefined,
      unsubscribeAuth: undefined,
      federatedConfig: { provider: "Facebook" },
      federatedIds: {
        facebookAppId: "****"
      },
      formFields: [
        {
          type: "email",
        },
        {
          type: "password",
        },
      ],
    }
  },
  beforeUnmount() {
    this.unsubscribeAuth();
  }
})
</script>

```

I followed this https://github.com/aws-amplify/amplify-js/issues/6670#issuecomment-697768053 to remove federated buttons, but it removes the facebook button too., any suggestion for how to remove the "Sign in with AWS" but keep facebook button

      <amplify-authenticator :federated.prop="federatedIds">
        <amplify-sign-in slot="sign-in">
          <div slot="federated-buttons"></div>
        </amplify-sign-in>
        <div v-if="authState === 'signedin' && user">
          <div>Hello, {{user.username}}</div>
        </div>
        <amplify-sign-out></amplify-sign-out>
      </amplify-authenticator>

![Changed](https://i.ibb.co/9cYhcxg/Screen-Shot-2021-04-22-at-3-10-11-PM.png)
## Comment

---------------

Author: @countryst

Duplicate of https://github.com/aws-amplify/amplify-js/issues/7199

I'm sure there is a better way of doing this, but here is what I'm using for now

```
  updated() {
    setTimeout(() => {
      document.querySelector("amplify-authenticator")
        .shadowRoot.querySelector("amplify-sign-in")
        .shadowRoot.querySelector("amplify-federated-buttons")
        .shadowRoot.querySelector("amplify-oauth-button")
        .style.display = "none";
    }, 100);
  },
```

---------------

---------------

# Cannot get any scopes in Access Token

---------------

Author: @zsid
Upvotes: 1
Comments: 9

**Describe the bug**
We are using `aws-amplify` to authorise with Cognito and need to get scopes i.e. `openid, profile, custom-scopes`. There are a lot of issues associated with this. For example, there is a very [similar one for custom scopes](https://github.com/aws-amplify/amplify-js/issues/5147) which has been closed. It seems like there has been [a release](https://github.com/aws-amplify/amplify-js/blob/master/packages/auth/CHANGELOG.md) as well but testing it out custom scopes or any other scope is not working at all


**To Reproduce**

* Set up the custom scopes in Cognito as well as `openid` one.
* Add custom scope to amplify config
* Make request
* Expected behavior
* The custom scope and openid one should be contained within the token
 
Version: ` "aws-amplify": "^3.0.13",`
Here is my config
```
{
    Auth: {
      region: 'yourRegion',
      userPoolId: 'userPoolId',
      userPoolWebClientId: 'userPoolWebClientId',
      oauth: {
        domain: 'yourDomain',
        scope: ['phone', 'email', 'profile', 'openid', 'aws.cognito.signin.user.admin', 'custom-scope-one', 'custom-scope-two'],
        redirectSignIn: 'http://localhost:3000/',
        redirectSignOut: 'http://localhost:3000/',
        responseType: 'code',
      },
    },
  }
```


**Expected behavior**
The custom scope and the other ones (i.e. `openid`, `profile`) should be within the token.
The custom scope should be contained within the token
## Comment

---------------

Author: @elorzafe

@zid
As I mentioned on the issue #5935 and #5921. Previous the change you mention the library was sending the query string param `scopes` instead of `scope` which is the correct param. The default behavior by Cognito when the scope param is missing is that it will return (as is mentioned on this [Authorization endpoint Cognito docs]()) all the scopes available.

Can you check if the scope you have configured are present on AllowedOAuthScopes on your App client (clientId) settings. You can check those on Cognito console under App Integration>App client settings or using aws cli aws cognito-idp describe-user-pool-client --user-pool-id us-west-2_xxxxxxxxx --client-id xxxxxxxxxxxxxxxx

What might happen in your case is that custom scopes on Cognito has a prefix with the resource server identifier. For example the resource server identifiers is `server-1` and I have a scope named `weather`. The custom scope should be `server-1/weather`.
## Comment

---------------

Author: @zid

Looks like you meant to ping @zsid 
## Comment

---------------

Author: @zsid

@elorzafe This is still not working. The name for the custom scopes I am using is similar to what you have pointed out i.e. `https://examlpe.com/Hello` and it is selected in the app client settings.

In addition, I am also not getting `openid, profile, email` which are the rest as well. So coming back to your point, looks like they are not included at all and we are getting the default behaviour which is to return the admin.

Some additional context that might be helpful is we are using the `Authenticator` from `aws-amplify-react` as a HOC for our login. We are not hitting the end points directly but the aws package is doing it for us.

## Comment

---------------

Author: @elorzafe

> Looks like you meant to ping @zsid

Thanks @zid 
## Comment

---------------

Author: @zsid

@elorzafe, did you manage to replicate it? 
## Comment

---------------

Author: @elorzafe

@zsid `Authenticator` components doesn't use OAuth flow, OAuth flows are available using Cognito HostedUI and is the mechanism that Cognito returns custom scope on the access token.
## Comment

---------------

Author: @zsid

@elorzafe getting scopes (custom and standard ones) on the token via the `Authenticator` is a big requirement for us. 

What are the plans to get them outside the `HostedUI`? Speaking to fellow colleagues, only getting the scopes via `HostedUI` have pushed people to use other providers rather than `Cognito` and is seeing as big blocker. I am also getting in big arguments with other suppliers to move to other authentication solutions since we cannot get the scopes via  `Authenticator` which we are using in our applications
## Comment

---------------

Author: @kamce1999

@elorzafe Do you have a response to @zsid?  I need the open id scope but don't want to use the hosted UI.  I'm trying to keep everything contained in AWS so I would prefer to use cognito.  We might have to look at other providers as well.  Is the fix on the road map?
## Comment

---------------

Author: @vmary2014

Has there been any progress on this issue? We're having the same problem.

---------------

---------------

# Guest access with temporary password or token

---------------

Author: @TPI79
Upvotes: 2
Comments: 1

Hello everyone, 
I have a general question about authentication and Guest access with temporary password or token. 

I am currently planning a app with multiple user roles. There should be registered users but also guests. 
Registered users shouldn't be a problem with amplify, but what about guests?

There should be areas on the website that guests can enter, but with a temporary password or token (which a registered user has given to the guest)
However, the guests should not have to register, but should simply be able to access the released area with the help of the password or token.

Is such a scenario basically possible with the help of amplify and cognito?
If so, how would be the approach? Is there any helpful documentation how can this be done?

Thanks in advance
## Comment

---------------

Author: @hyprstack

Would like to know the same!

---------------

---------------

# Wrong name in providers's federated signin screen

---------------

Author: @marcolino
Upvotes: 1
Comments: 0

Why the (Google in this case) provider's federated signin screen shows "CHOOSE AN ACCOUNT to continue to **amazoncognito.com** ?

I'd expect "CHOOSE AN ACCOUNT to continue to **mydomain.com**" ...

A [screenshot](https://pasteboard.co/Kd8os9S.png) is worth a thousand words...

---------------

---------------

# Why does Amplify.Auth.signout() opens up the webbrowser on android when user logs out ?

---------------

Author: @irfanelahidev
Upvotes: 1
Comments: 0

I've been using the globalSignout(true) option for my android app until now and it all seemed to work really well. However now that I needed to change this option and set the globalSignOut(false)  whenever I tend to logout from the app it opens the webbrowser with the webdomain url that is provided in the amplifyconfiguration.json files. 
How can I avoid this behavior and logout the user safely without having to redirect to the webbrowser ?

---------------

---------------

# Customize MqttOverWSProvider into PubSub package

---------------

Author: @fabel84
Upvotes: 1
Comments: 1

I have to customize the behaviour of MqttOverWSProvider into PubSub package? Is possible to customize MqttOverWSProvider and is there a way to inject it in Amlify PubSub plugin?
## Comment

---------------

Author: @fabel84

I've found by myself the response to these question, but maybe someone could be interested.
These are the steps:

- Create a custom class that extend AWSIoTProvider, and in this class customize the methods that you want( in my case only publish method);


```
import { AWSIoTProvider } from '@aws-amplify/pubsub';

export class MqttOverWSProviderCustom extends AWSIoTProvider {

	async publish(topics: string[] | string, msg: any) {
		const targetTopics = ([] as string[]).concat(topics);
		const message = msg===''?'':JSON.stringify(msg);
		const url = await this.endpoint;
		const client = await this.connect(this.clientId, { url });
		targetTopics.forEach(topic => client.send(topic, message));
	}
}

```
- Replace the custom provider in main.ts;

```
Amplify.addPluggable(new MqttOverWSProviderCustom({
    aws_pubsub_region: environment.aws.region,
    aws_pubsub_endpoint: 'wss://'+environment.aws.iotEndpoint+'/mqtt',
  }));
```




That's all folks.


---------------

---------------

# DataStore - Owner Relationship Authorization Issue

---------------

Author: @gmreburn
Upvotes: 1
Comments: 1

How do you prevent users from posting on other user's blogs (and use DataStore)? Anyone can save a Post with blogID = somebody else's blog. I was hoping that this would have been handled by the server side resolver when @auth directive is used.

```graphql
type Blog
	@model
	@auth(rules: [{ allow: owner, operations: [create, update, delete] }]) {
	id: ID!
	title: String!
	Posts: [Post] @connection(keyName: "byBlog", fields: ["id"])
}
type Post
	@model
	@auth(rules: [{ allow: owner, operations: [create, update, delete] }])
	@key(name: "byBlog", fields: ["blogID"]) {
	id: ID!
	title: String!
	blogID: ID!
	Blog: Blog @connection
}
```

Login as user1:
```javascript
const blog = await DataStore.save(
    new Blog({
		"title": "Lorem ipsum dolor sit amet",
	})
);
console.log(blog.id); // 1d183105-6fe2-4525-9208-df589955b943
```

Login as user2:
```javascript
const post = await DataStore.save(
    new Post({
		"title": "Lorem ipsum dolor sit amet",
		blogID: "1d183105-6fe2-4525-9208-df589955b943"
	})
);
```

### My attempt:
I tried requiring the owner field and using it in the `@key` but DataStore falls apart quickly because it does not appear to support setting the owner field. It sometimes returns owner: null from sync events which updates the local DS owner to null and then causes remote auth issues during future update requests.

```graphql
type Blog
	@model
	@auth(rules: [{ allow: owner, operations: [create, update, delete] }]) {
	id: ID!
	title: String!
	owner: String!
	Posts: [Post] @connection(keyName: "byBlog", fields: ["owner", "id"])
}
type Post
	@model
	@auth(rules: [{ allow: owner, operations: [create, update, delete] }])
	@key(name: "byBlog", fields: ["blogID"]) {
	id: ID!
	title: String!
	blogID: ID!
	Blog: Blog @connection
}
```

### DynamoDB Post  Table
You can see the same blogID twice, one for the owner of the blog and another from a different user.
id (S) | __typename (S) | _lastChangedAt (N) | _version (N) | blogID (S) | createdAt (S) | owner (S) | postBlogId (NULL) | title (S) | updatedAt (S)
-- | -- | -- | -- | -- | -- | -- | -- | -- | --
b2ec27db-1bbb-42ae-955a-56e4b00325d5 | Post | 1.61E+12 | 1 | 5a2c03ce-514f-482a-8b55-f52101b01be3 | 2020-12-30T20:36:15.851Z | abf560bb-7c69-4fbc-b787-00df561ce4b8 | TRUE | Lorem ipsum dolor sit amet| 2020-12-30T20:36:15.851Z
b85792a8-a6b1-41b4-b1d6-1c8aaf765078 | Post | 1.61E+12 | 1 | 5a2c03ce-514f-482a-8b55-f52101b01be3 | 2020-12-30T20:34:26.075Z | 90e134b7-b090-4981-b16a-ce93cf7b6de3 | TRUE | Lorem ipsum dolor sit amet| 2020-12-30T20:34:26.075Z

@iartemiev
## Comment

---------------

Author: @djbuch

Hello, did you find any solution for your use case ?

Regards

---------------

---------------

# AWS Cognito User pool ID in forgotPassword

---------------

Author: @ShadabFaiz
Upvotes: 1
Comments: 0

AWS Cognito does not ask for cognito pool id for **forgotPassword** functionality. So how does aws knows which pool should it check or does it checks all the pool across the region?

---------------

---------------

# onCreate Subscription Works on AWS Console, Not Through React Native App -- Breaks Realtime Texting Functionality

---------------

Author: @IsitaB
Upvotes: 1
Comments: 0

I am working on creating a react native frontend and aws amplify backend texting feature. The messaging part should update in realtime. The onCreateMessage subscription throws an error

Here is my code:
```
useEffect(() => {
    console.log("subscription goes through")
    const subscription = API.graphql(
      graphqlOperation(onCreateMessage)
    ).subscribe({
      error: err => console.log("error caught", err),
      next: (data) => {
        if(data) {
          console.log(data)
          const newMessage = data.value.data.onCreateMessage;
        } else {
          console.log("failed")
        }
        fetchMessages();
      }});

    return () => subscription.unsubscribe();
  }, [])```

Here is the error I get in my terminal whenever I create a message

```
error caught Object {
  "error": Object {
    "errors": Array [
      Object {
        "message": "AppSync Realtime subscription init error: undefined",
      },
    ],
  },
  "provider": AWSAppSyncRealTimeProvider {
    "_config": Object {},
    "keepAliveTimeout": 300000,
    "promiseArray": Array [],
    "socketStatus": 0,
    "subscriptionObserverMap": Map {
      "39e4e9fc-5057-4b1b-88e4-75e9ea0d5188" => Object {
        "observer": SubscriptionObserver {
          "_subscription": Subscription {
            "_cleanup": undefined,
            "_observer": undefined,
            "_queue": undefined,
            "_state": "closed",
          },
        },
        "query": "subscription OnCreateMessage {
```

The subscription works on AWS Appsync console
I believe there might be a problem with the behind the scenes websocket connection since we got`"AppSync Realtime subscription init error: undefined"` but other sources say that there could be a mismatch between the return values of the create mutation and the subscription https://github.com/aws-amplify/amplify-js/issues/4832

---------------

---------------

# Can I use multiple apps with a single api?

---------------

Author: @jakobpack
Upvotes: 1
Comments: 1

I currently have one app created, from which I created an API.
I would like to create a second app, that makes use of the existing API.

Is that possible?
## Comment

---------------

Author: @jakobpack

Got it. Adding endpoints into config by hand as stated in the [documentation](https://docs.amplify.aws/lib/auth/start/q/platform/js#re-use-existing-authentication-resource) and using `amplify add codegen --appId XXXX` to get the GraphQL statements.

---------------

---------------

# Can DataStore work as a proxy for types that use selectively sync'ed rules?

---------------

Author: @PeteDuncanson
Upvotes: 3
Comments: 1

Taking this for a spin https://docs.amplify.aws/lib/datastore/sync/q/platform/js#selectively-syncing-a-subset-of-your-data

I wondered if we could exclude some types from being sync'ed up to save on bandwidth and start up times by using selective syncing rules to say exclude types with a status of "Archieved" or similar. I hoped that if I ask DataStore for some data and it doesn't have it locally it might still go and hit up GraphQL to see if it exists up there but in my limited testing that doesn't seem to be the case.

If I add a sync rule to exclude everything of one type, nothing of that comes down the wire and if I try querying it via DataStore it still doesn't go up to check it.

Is there a way to opt in to getting DataStore to act like a proxy or local cache for types which have selective sync rules? As is my app is pulling down 80Mb of data on a cold start and is only going to grow!
## Comment

---------------

Author: @PeteDuncanson

Some discussion of this in the Discord channel which was interesting:

https://discordapp.com/channels/705853757799399426/831604049928257556/863199506174181409 and https://discordapp.com/channels/705853757799399426/831604049928257556/863201312187613204

@renebrandel makes the suggestion of a Predicate.NONE which wouldn't sync anything (I'm currently doing this with a function that does a comparison that can never be true). But what I'd really like it to have handy data my user is likely to need locally and then the big stuff kept on the cloud and only pulled down if needed/requested.

---------------

---------------

# How to check if email is confirmed without logging in?

---------------

Author: @opqpop
Upvotes: 2
Comments: 0

Is there a way to pass ONLY an email and check if that email is confirmed?

I am trying to handle this case:
- user creates account with email and does not verify, account remains unconfirmed
- user forgets password and tries to reset password, but cognito doesn't send password code for unconfirmed account

I would like to detect if the email is unconfirmed, and tell user to first verify the email before trying to reset the password.

From browsing around, it seems like the only way to check if an email is confirmed is to also have the password to catch the UserNotConfirmedException during sign-in.

---------------

---------------

# how sign up with just phone number and password then SMS to user to verify his phone number

---------------

Author: @OmarHadidKaito
Upvotes: 1
Comments: 0

i try sign in and sign up with phone number and password when i sign in the cognito don't send the SMS to my phone 
i wrote code like some that

```
  async function signUp() {
    try {
        await Auth.signUp({ username: phoneNumber, password, attributes: { phone_number: phoneNumber } });
    } catch (err) {
      console.log({ err });
    }
  }
```

```
  async function signIn() {
    try {
        await Auth.signIn(phoneNumber, password);
    } catch (err) {
      console.log({ err });
    }
  }
```

---------------

---------------

# styles customisation

---------------

Author: @OSorokin
Upvotes: 1
Comments: 0

Hi,  i am trying to customise  **amplify-input** element styles to make it smaller, but it is not possible. **!important** rule is not working in my custom styles.  Changing css variables  do nothing. It seems like default componet styles have highest priority.
 "@angular/core": "9.1.13",
 "@aws-amplify/ui-angular": "^1.0.10",
 "@aws-amplify/ui-components": "^1.3.2",

---------------

---------------

# Authenticator not displaying error messages

---------------

Author: @gomesp
Upvotes: 1
Comments: 1

I have noticed that the `AmplifyAuthenticator` does not display any error message on my app. Any message coming in the response header 'x-amzn-errormessage', e.g. Incorrect username or password, is silently ignored (although I can see the 400 response in the web developer console).

Am I missing a configuration in the react component? I am using the following versions:
```
    "@aws-amplify/ui-react": "^1.2.4",
    "aws-amplify": "^4.1.2",
```

```javascript
const LoginComponent = () => {
  return (
    <AmplifyAuthenticator initialAuthState="signup" usernameAlias="email">
      <AmplifySignUp
        slot="sign-up"
        usernameAlias="email"
        validationErrors="signupErrors"
        formFields={[
          {
            type: "name",
            label: "Full Name *",
            placeholder: "Enter your full name",
            inputProps: { required: true, autocomplete: "name" },
          },
          {
            type: "email",
            inputProps: { required: true, autocomplete: "username" },
          },
          {
            type: "password",
            inputProps: { required: true, autocomplete: "new-password" },
          },
          {
            type: "phone_number",
            dialCode: "+64",
          },
        ]}
      />
      <AmplifySignIn slot="sign-in" usernameAlias="email" />
    </AmplifyAuthenticator>
  );
};
const Login = () => {
  const { isUserAuthenticated } = useAuth();
  return isUserAuthenticated ? (
    <Redirect to={{ pathname: "/" }} />
  ) : (
    <LoginComponent />
  );
};

export default Login;
```
## Comment

---------------

Author: @gomesp

Moved to https://github.com/aws-amplify/amplify-js/issues/8560

---------------

---------------

# How to keep alive - when using Hosted UI and amplify-js

---------------

Author: @iongion
Upvotes: 1
Comments: 1

I am using Hosted UI, then in my app I have

```javascript
const AWS_CONFIG = {
  Auth: {
    region: AWS_REGION,
    userPoolId: AWS_USER_POOL_ID,
    userPoolWebClientId: AWS_USER_POOL_WEB_CLIENT_ID,
    mandatorySignIn: false,
    cookieStorage: {
      domain: APP_DOMAIN,
      path: '/',
      expires: 365,
      secure: true,
    },
  },
};
const AWS_AUTH = {
  domain: AWS_HOSTED_DOMAIN,
  scope: AWS_OAUTH,
  redirectSignIn: APP_DOMAIN_URL,
  redirectSignOut: APP_DOMAIN_URL,
  responseType: 'token',
};
```

The basic client is

```javascript
document.addEventListener('DOMContentLoaded', () => {
  const { Amplify, Auth, Hub } = aws_amplify;
  async function entryPoint() {
    Amplify.configure(AWS_CONFIG);
    Auth.configure({ oauth: AWS_AUTH });
    try {
      // listen for changes - see https://docs.amplify.aws/lib/auth/auth-events/q/platform/js
      Hub.listen('auth', ({ payload: { event, data } }) => {
        console.debug('Hub event', event);
        switch (event) {
          case 'signIn':
          case 'cognitoHostedUI':
            console.debug('Cognito sign-in', data);
            break;
          case 'signIn_failure':
          case 'cognitoHostedUI_failure':
            console.error('Sign in failure', data);
            break;
          case 'signOut':
            console.debug('Signed out');
            break;
          case 'tokenRefresh':
            console.debug('token refresh succeeded');
            break;
          case 'tokenRefresh_failure':
            console.error('token refresh failed');
            break;
          case 'configured':
            console.debug('the Auth module is configured');
            break;
          default:
            break;
        }
      });
      // start the flow
      // const user = await Auth.currentAuthenticatedUser();
      // const info = await Auth.currentUserInfo();
      const session = await Auth.currentSession();
      const appUserProfile = decodeProfile(session.idToken);
      console.debug('Current profile', appUserProfile);
      updateUI(null, appUserProfile);
    } catch (error) {
      console.error('Error during authentication flow', error);
      updateUI(error);
    }
  }
  function updateUI(error, profile) {
    const isAnonymous = [
      'No current user',
      'The user is not authenticated',
      'Error: Cannot retrieve a new session. Please authenticate.', // This happens
    ].includes(error ? error.toString() : null);
    if (isAnonymous) {
      Auth.federatedSignIn();
    } else {
      console.debug('Hello', profile);
      // keep alive
      setInterval(() => {
        console.debug('Refreshing token');
        Auth.currentSession()
          .then(() => {
            console.debug('Token refreshed');
          })
          .catch((error) => {
            console.error('Token refresh failure', error);
          });
      }, 5000);
    }
  }
  entryPoint();
});
```

I try to update the token every 5 seconds, but at a certain moment it does reach `Token refresh failure`

I cannot understand why or what I am doing wrong.
## Comment

---------------

Author: @iongion

To answer my own question, moved to `code` flow instead of `token` - this did it

---------------

---------------

# Does aws amplify supports phone with google?

---------------

Author: @nickyeung425
Upvotes: 1
Comments: 0

Does aws amplify support phones without google? (I.e. huawei phones that are not shipped with google service?)

I am working on a poc recently and build an apk with android studio. When i test on my phone everything is fine. But with test with my colleague's phone which is an huawei phone with no google shipped on it. His phone were unable to call and get the data while mine is working fine.

---------------

---------------

# Unable to implement DataStore event listener and making edit functionality work

---------------

Author: @rupam-kundu
Upvotes: 1
Comments: 0

I am trying to implement CRUD+L functionality in an application using AWS Amplify Admin UI. However, while trying to implement the edit functionality, my edit form is not displaying the existing record. I am suspecting there could be a delay in record fetching as it is an asynchronous process. I tried to listen for the "ready" event so that I could populate the form only when all the data is available. However, the listener is not getting invoked. Please help me implement the DataStore event listener correctly. The following is the code for staff.js where I am trying to implement the said listener function.

```
import React, { useState, useEffect } from "react";
import Table from "react-bootstrap/Table";
import Form from "react-bootstrap/Form";
import Container from "react-bootstrap/Container";
import Row from "react-bootstrap/Row";
import Col from "react-bootstrap/Col";
import Button from "react-bootstrap/Button";
import Pagination from "react-bootstrap/Pagination";
import Alert from "react-bootstrap/Alert";
import Sidebar from "./Sidebar";
import { DataStore } from "@aws-amplify/datastore";
import { Hub } from "aws-amplify";
import { Staff } from "../models";
import { Users } from "../models";

const StaffManagement = ({ user }) => {
  const [staff, setStaff] = useState([]);
  const [staffMember, setStaffMember] = useState({
    first_name: "",
    middle_name: "",
    last_name: "",
    name: "",
    email: "",
    staff_id: "",
    title: "",
    phone: "",
    active : "Yes",
    comments : "",
  });
  
  const initialFormState = {
    firstName: staffMember ? staffMember.first_name : "",
    middleName: staffMember ? staffMember.middle_name : "",
    lastName: staffMember ? staffMember.last_name : "",
    fullName: staffMember ? staffMember.name : "",
    emailAddress: staffMember ? staffMember.email : "",
    staffId: staffMember ? staffMember.staff_id : "",
    title: staffMember ? staffMember.title : "",
    countryCode: "+1",
    areaCode: "",
    phoneNumber: "",
    active: staffMember ? staffMember.active : "Yes",
    comments: staffMember ? staffMember.comments : ""
  };
  const [formData, setFormData] = useState(initialFormState);
  const [validated, setValidated] = useState(false);
  const [message, setMessage] = useState("");
  const [show, setShow] = useState(true);
  let today = new Date().toISOString().split("T")[0] + "Z";

  useEffect(() => {
    fetchStaff();
  }, []);

  async function fetchBusiness() {
    try {
      let userEmail = user.attributes.email;
      const userModels = await DataStore.query(Users);
      const userModel = userModels.filter((u) => u.email === userEmail);
      let businessIDVal = JSON.stringify(userModel[0].businessID);
      businessIDVal = businessIDVal.toString();
      console.log(businessIDVal);
      return businessIDVal;
    } catch (e) {
      console.log(e);
    }
  }

  async function fetchStaff() {
    const businessIDValue = await fetchBusiness();
    console.log(businessIDValue);
    let staffModels = await DataStore.query(Staff);
    staffModels = staffModels.filter(
      (staffModel) => staffModel.businessID === businessIDValue
    );
    console.log(staffModels);
    setStaff(staffModels);
  }

  async function createStaff() {
    await DataStore.save(
      new Staff({
        first_name: formData.firstName,
        middle_name: formData.middleName,
        last_name: formData.lastName,
        name:
          formData.firstName +
          " " +
          formData.middleName +
          " " +
          formData.lastName,
        email: formData.emailAddress,
        staff_id: formData.staffId,
        title: formData.title,
        phone:
          formData.countryCode +
          " " +
          formData.areaCode +
          " " +
          formData.phoneNumber,
        active: formData.active,
        comments: formData.comments,
        created_by: user.attributes.name,
        created_date: today,
        last_modified_by: user.attributes.name,
        last_modified_date: today,
        businessID: await fetchBusiness(),
        AppointmentNotes: [],
      })
    );
    setFormData(initialFormState);
  }

const listener = id => {
  Hub.listen("datastore", async hubData => {
    const  { event, data } = hubData.payload;
    if (event === "ready") {
      const modelToEdit = await DataStore.query(Staff, id);
        console.log(modelToEdit);
        setStaffMember(modelToEdit);
        setFormData(modelToEdit);
        console.log(staffMember);
        console.log(initialFormState);
        console.log(formData);    
    }
  });
}

  async function editStaff({ id }) {
    console.log(id);
    listener(id);
  }

  async function deleteStaff({ id }) {
    const newStaffArray = staff.filter(staffMember => staffMember.id !== id);
    setStaff(newStaffArray);
    const modelToDelete = await DataStore.query(Staff, id);
    DataStore.delete(modelToDelete);
    setMessage("Staff member has been successfully deleted.");
    console.log(message);
    if (!show) {
      setShow(true);
    }
    window.scrollTo(0, 0);
  }

  const handleSubmit = (event) => {
    const form = event.currentTarget;
    if (form.checkValidity() === false) {
      event.preventDefault();
      event.stopPropagation();
    }
    setValidated(true);
    console.log(formData);
    createStaff();
    setMessage("Staff member has been successfully added.");
    console.log(message);
    if (!show) {
      setShow(true);
    }
    window.scrollTo(0, 0);
  };

  const handleReset = (event) => {
    setFormData(initialFormState);
  };

  return (
    <>
      <style type="text/css">
        {`
                .btn {
                  background-color: #4d0d73;
                }
              `}
      </style>
      <Container fluid>
        <Row>
          <Col sm={3}>
            <Sidebar />
          </Col>
          <Col sm={9}>
            <Row>
              <Col>
                <h1
                  style={{
                    textAlign: "center",
                    marginTop: "3%",
                    marginBottom: "3%",
                  }}
                >
                  Manage your staff members
                </h1>
              </Col>
            </Row>
            <Row>
              <Col>
                <Form inline style={{ float: "right" }}>
                  <Form.Label htmlFor="inlineFormSearch" srOnly>
                    Search
                  </Form.Label>
                  <Form.Control
                    type="search"
                    className="mb-2 mr-sm-2"
                    id="inlineFormSearch"
                    placeholder="Search..."
                  />
                  <Button type="submit" className="mb-2">
                    Search
                  </Button>
                </Form>
              </Col>
            </Row>
            {message && (
              <Row>
                <SuccessAlert message={message} show={show} setShow={setShow} />
              </Row>
            )}
            <Row>
              <Col>
                <h3 style={{ textAlign: "left", marginTop: "3%" }}>
                  Staff list
                </h3>
                <Table bordered hover responsive style={{ marginTop: "1%" }}>
                  <thead style={{ backgroundColor: "#cecede" }}>
                    <tr>
                      <th>#</th>
                      <th>First name</th>
                      <th>Middle name</th>
                      <th>Last name</th>
                      <th>Full name</th>
                      <th>Email address</th>
                      <th>Staff Id</th>
                      <th>Title</th>
                      <th>Phone number</th>
                      <th>Active</th>
                      <th>Comments</th>
                      <th></th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    {staff.map((staffMember, index) => (
                      <tr key={staffMember.id}>
                        <td>{index + 1}</td>
                        <td>{staffMember.first_name}</td>
                        <td>{staffMember.middle_name}</td>
                        <td>{staffMember.last_name}</td>
                        <td>{staffMember.name}</td>
                        <td>{staffMember.email}</td>
                        <td>{staffMember.staff_id}</td>
                        <td>{staffMember.title}</td>
                        <td>{staffMember.phone}</td>
                        <td>{staffMember.active ? "Yes" : "No"}</td>
                        <td>{staffMember.comments}</td>
                        <td>
                          <Button type="button" onClick={() => editStaff(staffMember)}>Edit</Button>
                        </td>
                        <td>
                          <Button type="button" onClick={() => deleteStaff(staffMember)}>Delete</Button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </Table>
              </Col>
            </Row>
            <Row style={{ marginTop: "1%" }}>
              <Col>
                <Pagination>
                  <Pagination.First />
                  <Pagination.Prev />
                  <Pagination.Item active>{1}</Pagination.Item>
                  <Pagination.Item>{2}</Pagination.Item>
                  <Pagination.Item>{3}</Pagination.Item>
                  <Pagination.Item>{4}</Pagination.Item>
                  <Pagination.Item>{5}</Pagination.Item>
                  <Pagination.Next />
                  <Pagination.Last />
                </Pagination>
              </Col>
            </Row>
            <Row>
              <Col>
                <h3
                  style={{
                    textAlign: "left",
                    marginTop: "3%",
                    marginBottom: "3%",
                  }}
                >
                  Add a staff member
                </h3>
                <Form
                  noValidate
                  validated={validated}
                  onSubmit={handleSubmit}
                  style={{ marginBottom: "5%" }}
                >
                  <Form.Group as={Row} controlId="FirstName">
                    <Form.Label column sm={2}>
                      First name *
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        required
                        type="text"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            firstName: e.target.value,
                          });
                        }}
                        value={formData.firstName}
                      />
                      <Form.Control.Feedback type="invalid">
                        First name is required.
                      </Form.Control.Feedback>
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="MiddleName">
                    <Form.Label column sm={2}>
                      Middle name
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        type="text"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            middleName: e.target.value,
                          });
                        }}
                        value={formData.middleName}
                      />
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="LastName">
                    <Form.Label column sm={2}>
                      Last name *
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        required
                        type="text"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            lastName: e.target.value,
                          });
                        }}
                        value={formData.lastName}
                      />
                      <Form.Control.Feedback type="invalid">
                        Last name is required.
                      </Form.Control.Feedback>
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="EmailAddress">
                    <Form.Label column sm={2}>
                      Email address *
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        required
                        type="email"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            emailAddress: e.target.value,
                          });
                        }}
                        value={formData.emailAddress}
                      />
                      <Form.Control.Feedback type="invalid">
                        Email address is required.
                      </Form.Control.Feedback>
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="StaffId">
                    <Form.Label column sm={2}>
                      Staff Id
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        type="text"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({ ...formData, staffId: e.target.value });
                        }}
                        value={formData.staffId}
                      />
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="Title">
                    <Form.Label column sm={2}>
                      Title
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        type="text"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({ ...formData, title: e.target.value });
                        }}
                        value={formData.title}
                      />
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="PhoneNumber">
                    <Form.Label column sm={2}>
                      Phone number
                    </Form.Label>
                    <Col sm="auto">
                      <Form.Control
                        as="select"
                        custom
                        onChange={null}
                        value={formData.countryCode}
                      >
                        <option value="+1">+1</option>
                      </Form.Control>
                    </Col>
                    <Col sm={2}>
                      <Form.Control
                        type="tel"
                        pattern="[0-9]{3}"
                        placeholder="Area code"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            areaCode: e.target.value,
                          });
                        }}
                        value={formData.areaCode}
                      />
                      <Form.Control.Feedback type="invalid">
                        Area code needs to be 3 digits long.
                      </Form.Control.Feedback>
                    </Col>
                    <Col sm={3}>
                      <Form.Control
                        type="tel"
                        pattern="[0-9]{7}"
                        placeholder="Phone number"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            phoneNumber: e.target.value,
                          });
                        }}
                        value={formData.phoneNumber}
                      />
                      <Form.Control.Feedback type="invalid">
                        Phone number needs to be 7 digits long.
                      </Form.Control.Feedback>
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="Active">
                    <Form.Label column sm={2}>
                      Active
                    </Form.Label>
                    <Col sm={2}>
                      <Form.Control
                        as="select"
                        custom
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({ ...staffMember, active: e.target.value });
                        }}
                        value={formData.active}
                      >
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                      </Form.Control>
                    </Col>
                  </Form.Group>
                  <Form.Group as={Row} controlId="Comments">
                    <Form.Label column sm={2}>
                      Comments
                    </Form.Label>
                    <Col sm={6}>
                      <Form.Control
                        as="textarea"
                        rows={3}
                        name="comments"
                        onChange={(e) => {
                          console.log(e.target.value);
                          setFormData({
                            ...formData,
                            comments: e.target.value,
                          });
                        }}
                        value={formData.comments}
                      />
                    </Col>
                  </Form.Group>
                  <Form.Row>
                    <Col
                      sm={2}
                      style={{
                        display: "flex",
                        justifyContent: "center",
                        alignItems: "center",
                      }}
                    >
                      <Button type="reset" onClick={handleReset}>
                        Reset
                      </Button>
                    </Col>
                    <Col
                      sm={6}
                      style={{
                        display: "flex",
                        justifyContent: "center",
                        alignItems: "center",
                      }}
                    >
                      <Button type="submit">Submit</Button>
                    </Col>
                  </Form.Row>
                </Form>
              </Col>
            </Row>
          </Col>
        </Row>
      </Container>
    </>
  );
};

const SuccessAlert = ({ message, show, setShow }) => {
  if (show) {
    return (
      <Alert
        variant="success"
        style={{ marginLeft: "25%", marginRight: "25%" }}
        onClose={() => setShow(false)}
        dismissible
      >
        {message}
      </Alert>
    );
  } else {
    return null;
  }
};

export default StaffManagement;
```
Please find below the contents of my package.json file.
```
{
  "name": "saasapp",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@aws-amplify/ui-react": "^1.0.7",
    "@testing-library/jest-dom": "^5.11.8",
    "@testing-library/react": "^11.2.2",
    "@testing-library/user-event": "^12.6.0",
    "aws-amplify": "^3.3.27",
    "bootstrap": "^4.5.3",
    "i18next": "^19.8.4",
    "react": "^17.0.2",
    "react-bootstrap": "^1.4.0",
    "react-dom": "^17.0.1",
    "react-i18next": "^11.8.5",
    "react-router-dom": "^5.2.0",
    "react-scripts": "4.0.1",
    "web-vitals": "^0.2.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```
Please find below the console screenshot.

![Console log](https://user-images.githubusercontent.com/56736881/124315028-f6f5a780-db90-11eb-83dd-2007daf3909b.png)

What is also surprising is that when I click the "Edit" button the Edit form gets populated with only the "Title" field. Please find below the related screenshot.
![image](https://user-images.githubusercontent.com/56736881/124961933-ae7c3500-e03b-11eb-95cc-6716bae34321.png)

Please note the warning in the console which says "A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component."

Please help me resolve the issue.

---------------

---------------

# Possible to use Lambda creds for Amplify usage?

---------------

Author: @slikk66
Upvotes: 1
Comments: 0

Hi, I'm trying to use Amplify.graphql inside of a Lambda function.  I need my function (which is an AppSync resolver) to be allowed to query back the API to get information.

I tried using Apollo and AWSAppSyncClient directly, but they both had problems with the fragments/interfaces, where straight Amplify does not:

````
const AWS = require("aws-sdk");
const API = require("aws-amplify").API;
const Amplify = require("aws-amplify").default;

Amplify.configure({
    aws_project_region: "us-west-2",
    aws_appsync_graphqlEndpoint: "https://AAAAAAAAAAAAAAAAA.appsync-api.us-west-2.amazonaws.com/graphql",
    aws_appsync_region: "us-west-2",
    aws_appsync_authenticationType: "AWS_IAM",
});

....

const response = await API.graphql({
    query: getTheQuery,
    variables: { id: "3ee9c69e-fca4-46c8-9083-ed9da850e859" },
});
````

With above I get a "no credentials" error.  Locally, and on Lambda, there are environment variables with the session token, key etc.

If I change the auth type to `API_KEY` and supply the key, then it works, but with AWS_IAM type, it doesn't.  Is it not possible to allow the Amplify system to inherit the permissions of the Lambda function?  The function policy includes `appsync:*` so it should have ability to query the API.

Is it possible to do what I'm asking so that I don't need to manually rotate the API KEY in my function?

---------------

---------------

# Using a Custom Endpoint for Cognito/Auth

---------------

Author: @atomdmac
Upvotes: 1
Comments: 2

I'd like to be able to point the `Auth` module to a fake/mocked `Cognito` endpoint when developing locally.  

Under the hood, it looks like the `amazon-cognito-identity-js` library (which the `Auth` module uses [here](https://github.com/aws-amplify/amplify-js/blob/main/packages/auth/src/Auth.ts#L175))  accepts an [`endpoint` parameter](https://github.com/aws-amplify/amplify-js/blob/main/packages/amazon-cognito-identity-js/src/CognitoUserPool.js#L42).

However, there doesn't seem to be an opportunity to pass an `endpoint` parameter through to the `CognitoUserPool` instance when using the `Auth` module (again, as seen [here](https://github.com/aws-amplify/amplify-js/blob/main/packages/auth/src/Auth.ts#L175)).

Passing the `endpoint` param through the `Amplify.configure()` call seems trivial (and I'm happy to submit a PR for it) but I'm curious: **Is there another way to accomplish this that anyone else is aware of?**
## Comment

---------------

Author: @atomdmac

I found an (admittedly hacky) way to accomplish this.  I'm not sure if there are any side-effects to doing it this way but it seems to be working for my purposes.

```javascript
import Amplify, { Auth } from 'aws-amplify';
Amplify.configure({
  ...your configuration
});
Auth.userPool.client.endpoint = 'http://localhost:9229';
```
## Comment

---------------

Author: @dhutchison

As of 3.2.0 this has been possible as part of the `Amplify.configure()` call by setting `Auth.endpoint` in the configuration object. 

Confirmed this worked with a mock cognito implementation a few days ago.

The feature was added in this commit: https://github.com/aws-amplify/amplify-js/commit/92d4fc16783fc232626350b57adfbcfed6a9d248 

---------------

---------------

# Amplify not importing proper oauth domain from aws-exports.js

---------------

Author: @jackbh0120
Upvotes: 1
Comments: 0

I am trying to remove an old auth and import a new one into an existing amplify environment, which is continuously linked to a BitBucket repository for deployment. I have been doing this through the Amplify CLI using amplify remove auth and then amplify import auth, and then an amplify push. When I import my auth and push it using my specified user pool from Cognito, my aws-exports.js file and awsmobile variable is populated with the proper information (as well as all my backend configuration files) for my newly specified user pool and the new oauth domain. Currently my frontend environment is set up for continuous redeployment on every commit to BitBucket. When I commit and push the updated aws-exports.js file to BitBucket for redeployment, the old user pool is still somehow being used despite the awsmobile variable in the aws-exports.js file containing the correct information (user pool id, oauth domain, app client id) for the new user pool I wish to use. If anybody has any insight into this issue I would greatly appreciate it. Thank you!

---------------

---------------

# Errors when building on Ubuntu (e.g. via Docker) but not on Windows (e.g. via Webstorm)

---------------

Author: @ixel1
Upvotes: 1
Comments: 1

I've encountered a problem which I'm hoping someone can provide some insight into.

I have a project in Angular which uses aws-amplify, and for a while it's been fine. Recently my colleague has discovered that it's no longer building via Docker (on Ubuntu). However, on my Windows system which uses Webstorm it's fine if I do yarn build:prod directly. If however I go via Docker again it fails.

These are the errors I get:
> #31 73.41
> #31 73.41
> #31 73.41
> #31 73.41 Error: node_modules/@aws-amplify/ui-components/dist/types/common/Translations.d.ts:126:35 - error TS2694: Namespace '"/opt/enfluence/frontend/node_modules/@aws-amplify/auth/lib-esm/common/AuthErrorStrings".AuthErrorStrings' has no exported member 'EMPTY_EMAIL'.
> #31 73.41
> #31 73.41 126     EMPTY_EMAIL: AuthErrorStrings.EMPTY_EMAIL;
> #31 73.41                                       ~~~~~~~~~~~
> #31 73.41
> #31 73.41
> #31 73.41 Error: node_modules/@aws-amplify/ui-components/dist/types/common/Translations.d.ts:127:35 - error TS2694: Namespace '"/opt/enfluence/frontend/node_modules/@aws-amplify/auth/lib-esm/common/AuthErrorStrings".AuthErrorStrings' has no exported member 'EMPTY_PHONE'.
> #31 73.41
> #31 73.41 127     EMPTY_PHONE: AuthErrorStrings.EMPTY_PHONE;
> #31 73.41                                       ~~~~~~~~~~~
> #31 73.41
> #31 73.41
> #31 73.41 Error: node_modules/@aws-amplify/ui-components/dist/types/common/Translations.d.ts:137:37 - error TS2694: Namespace '"/opt/enfluence/frontend/node_modules/@aws-amplify/auth/lib-esm/common/AuthErrorStrings".AuthErrorStrings' has no exported member 'NETWORK_ERROR'.
> #31 73.41
> #31 73.41 137     NETWORK_ERROR: AuthErrorStrings.NETWORK_ERROR;
> #31 73.41                                         ~~~~~~~~~~~~~
> #31 73.41
> #31 73.41
> #31 73.41 Error: node_modules/@aws-amplify/ui-components/dist/types/common/Translations.d.ts:138:37 - error TS2694: Namespace '"/opt/enfluence/frontend/node_modules/@aws-amplify/auth/lib-esm/common/AuthErrorStrings".AuthErrorStrings' has no exported member 'DEVICE_CONFIG'.
> #31 73.41
> #31 73.41 138     DEVICE_CONFIG: AuthErrorStrings.DEVICE_CONFIG;
> #31 73.41                                         ~~~~~~~~~~~~~
> #31 73.41
> #31 73.41
> #31 73.41 Error: node_modules/@aws-amplify/ui-components/dist/types/components.d.ts:17:10 - error TS2614: Module '"../../../auth/lib-esm"' has no exported member 'SignUpParams'. Did you mean to use 'import SignUpParams from "../../../auth/lib-esm"' instead?
> #31 73.41
> #31 73.41 17 import { SignUpParams } from "@aws-amplify/auth";

My colleague doesn't understand why this is happening and neither do I. We've also tried going back several commits to see if it was something we did unintentionally without knowing, however the same errors persist when building via Docker but not on Windows direct to yarn and not going via Docker.

Does anyone have any idea why this is happening? Let me know if there's something else you need me to post to help further analyse the cause of this. Thanks in advance.

EDIT: Thought I posted this in the wrong repo but I can't find another one which seems suitable so maybe this is the right place.
## Comment

---------------

Author: @ixel1

This has now been resolved, thanks anyway.

---------------

---------------

# It is posible to cancel a query operation in datastore?

---------------

Author: @LuisPerez94
Upvotes: 1
Comments: 0

It is posible to cancel a query operation in datastore?

---------------

---------------

# aws-sdk-js doesn't support local dev

---------------

Author: @annymosse
Upvotes: 1
Comments: 0

Everything related to the FrontEnd side work well except when try to access the resources locally ,ex: if you upload a file with mocking amplify you can get it work to get/put/.. data of AppSync (dynamodb) or S3 also; Whenever trying to access these files/ database you can't get them since the SDK try to retrieve these resources from the cloud instead local dev and this end up with not found keys files/ items, Is there a way to get it work locally or i should submit a bug issue in aws-sdk-* (js) repository ?

---------------

---------------

# Unable to setup MFA, it gives Code Mismatch  and fail enable Software Token MFA

---------------

Author: @furkangercek
Upvotes: 2
Comments: 1

I have a Cognito user pool that has MFA set to Optional with TOTP only.

I'm trying to set up a page that enables MultiFactorAuthentication for the user for the first time following this  [AWS Documentation.](https://docs.amplify.aws/lib/auth/mfa/q/platform/js#setup-totp)

As my component mounts, I generate a QR code and show it on screen using qrcode.react

```
  useEffect(() => {
Auth.currentAuthenticatedUser({ bypassCache: true }).then(user => {
  setUser(user);
  Auth.setupTOTP(user).then(code => {
    const authCode = "otpauth://totp/AWSCognito:" + user.username + "?secret=" + code + "&issuer=Invent";
    setQrCode(authCode);
  });
});
}, []);
```


Then, when the user puts the input, I verify it and call the setPrefferredMFA. Now here, I checked if "input" is correctly passed and no issues there.

```
const setupMFA = input => {
Auth.setupTOTP(user).then(() => {
  Auth.verifyTotpToken(user, input)
    .then(() => {
      Auth.setPreferredMFA(user, "TOTP").then(() => {
        props.setShowModal(false);
      });
    })
    .catch(e => {
      // Token is not verified
    });
});
};
```

I'm still getting Code mismatch and fail enable Software Token MFA error and failing to set a MFA to the user.
## Comment

---------------

Author: @furkangercek

I solved it.

Auth.verifyTotpToken() is not supposed to be in the .then() block of setupTOTP.

Pfft. Removing the Auth.setupTOTP in the setupMFA function made it work.

---------------

---------------

# Datastore several syncs in react capacitor native app

---------------

Author: @LuisPerez94
Upvotes: 1
Comments: 0

I have an app made with reactjs and we use capacitor to make it a native app.   this app use the amplify authenticator component to protect paths inside the app. Once the user succesfully sign in I trigger a Datastore.start() function in order to get a full sync.  Until this point everything is ok. The problem comes when the application goes to second plane / background and then I come back to it, so several full syncs happens over and over and this make the app very slow. somebody knows if I am missing something? I would like the app makes only one full sync. this behaivor is in ios and android.

---------------

---------------

# API Gateway cloudformation template - reference environment specific cognito userpool ARN

---------------

Author: @ChapterSevenSeeds
Upvotes: 1
Comments: 0

Hello everyone. So, in the cloudformation template for a REST API gateway, there is a section called "securityDefinitions" where you can define a gateway authorizer (such as a cognito userpool). Given my sincere lack of familiarity of cloudformation intrinsics, I am seeking a way to add in a cognito authorizer for the gateway for a specific environment and region. This image shows the exported security definitions for the gateway in my dev environment:
![asdf](https://user-images.githubusercontent.com/63123355/124141841-f6e99080-da46-11eb-9d58-aa56b573fe28.png)

Essentially, I'm hoping to learn how to replace the providerARNs string literal with a reference to the cognito userpool based on the environment and region. I know that you can use cloudformation intrinsics to construct ARNs from references like the image below: 
![image](https://user-images.githubusercontent.com/63123355/124142331-60699f00-da47-11eb-8f69-99890ab070da.png)

But, I am unsure how to do this with a cognito userpool ARN. Does anybody have any ideas?

---------------

---------------

# DataStore How can i set some items of an Entity as public?

---------------

Author: @mattmeye
Upvotes: 1
Comments: 0

Hello,

i want to find a solution to the following problem:

- Users can CRUD their own Notifications, also a property called "public".
- If an entity is flagged as "public" - then all users should be able to read this notification (only read, not update nor delete).

```
type Notification
    @model
    @auth(
        rules: [
            { allow: owner, operations: [read, update, delete, create] }
            { allow: public, operations: [read], provider: iam } // <= this should only catch notifications with a property public.
        ]
    ) {
    id: ID!
    title: String!
    public: Boolean! // <= 
}
````

What is the best solution for this? Maybe another Entity called "PublicNotification" and some business logic to copy these items?

Thanks.

---------------

---------------

# How do I get the authentication-error toast lower on the screen? as it is currently hidden by my nav bar.

---------------

Author: @johnny-chivers
Upvotes: 2
Comments: 0

Hi All, 

I have my webapp configured for a log in for certain parts of my site. 

As such its laid out 
```
<Nav/>
<UserHome/>
<footer/>
```

UserHome is wrapped like so  

`export default withAuthenticator(HomeSignedIn, true);`

and imported 

`import { withAuthenticator} from '@aws-amplify/ui-react';`

However, the toast which display the error message when user types in an incorrect username or password is currently behind my nav bar and I can't figure out how to apply the style so it is displayed below the navbar - rather than behind it. I've attached a screen shot of the code when render, so you can see how it is set behind my Nav bar. 
<img width="1788" alt="Screenshot 2021-06-30 at 10 43 23" src="https://user-images.githubusercontent.com/64025427/123940075-baf3f400-d990-11eb-835d-412e2b9ebef5.png">

---------------

---------------

# Cognito Implementation for Chrome Extension

---------------

Author: @ravipula
Upvotes: 5
Comments: 0

Hello,

I am trying to implement Cognito Auth in a chrome extension. We are already using Cognito on our web app. So while implementing it in chrome extension the login with email and password works fine. However if i do try to SignUp/Login with a provider nothing happens and in the source it says `No resource with given URL found`. What does that actually mean and how i can get this up and running? Any help is appreciated. Thanks in Advance.

---------------

---------------

# AmplifyAuthenticator fails silently. How to surface the validation errors?

---------------

Author: @gomesp
Upvotes: 1
Comments: 0

I have a react app with the following snippet as a login component. When I try to register a user and the user registration details do not pass the validation I get a ```400 Bad request``` on the browser console, but no error messages are displayed on the page itself. 

The documentation for the [sign up](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react#sign-up) component mentions a validationErrors attribute, but no example is given and the description is quite vague. 

Has anyone been able to surface the validation errors to the page? Have I setup my ```AmplifyAuthenticator``` incorrectly?

I am using the following package versions:
```
"@aws-amplify/ui-react": "^1.2.4",
"aws-amplify": "^4.1.2",
```

```javascript
const LoginComponent = () => {
  return (
    <AmplifyAuthenticator initialAuthState="signup" usernameAlias="email">
      <AmplifySignUp
        slot="sign-up"
        usernameAlias="email"
        formFields={[
          {
            type: "name",
            label: "Full Name *",
            placeholder: "Enter your full name",
            inputProps: { required: true, autocomplete: "name" },
          },
          {
            type: "email",
            inputProps: { required: true, autocomplete: "username" },
          },
          {
            type: "password",
            inputProps: { required: true, autocomplete: "new-password" },
          },
          {
            type: "phone_number",
            dialCode: "+64",
          },
        ]}
      />
      <AmplifySignIn slot="sign-in" usernameAlias="email" />
    </AmplifyAuthenticator>
  );
};
```

---------------

---------------

# "Getting Unregistered or Expired Token" error/ "BadDeviceToken  error when using Amplify + Pinpoint+Expo

---------------

Author: @eaddingtonwhite
Upvotes: 5
Comments: 1

Hi 👋 

I am trying to configure push notifications for my react native app built using Expo, AWS amplify, and Pinpoint.

I was going off these guides 
* https://docs.expo.io/push-notifications/sending-notifications-custom/
* https://docs.amplify.aws/lib/analytics/getting-started/q/platform/js#update-endpoint


I have some code written in app like this for trying to configure AWS Pinpoint with the device token I have captured from expo-notification library

```typescript
import * as Notifications from 'expo-notifications';

const bootstrapPushNotifcations = (u: User) => {
    const { status: existingStatus } = await Notifications.getPermissionsAsync();
    let finalStatus = existingStatus;
    if (existingStatus !== 'granted') {
      const { status } = await Notifications.requestPermissionsAsync();
      finalStatus = status;
    }
    if (finalStatus !== 'granted') {
      alert('Failed to get push token for push notification!');
      return;
    }
    const token = (await Notifications.getDevicePushTokenAsync()).data;
    await Analytics.updateEndpoint({
        address: token,
        channelType: 'APNS_SANDBOX',
        userId: u.uid, // our apps userID
        userAttributes: {
            // CustomUserAttributes
        },
    });
}
```

This seems to be working and I can see the following details on pinpoint:

My APNS_Sandbox channel set up with auth (ive tried both using key and cert for auth this is example with key)
```console
aws pinpoint get-apns-sandbox-channel --application-id XXXXXXX --region us-west-2 | jq .
{
  "APNSSandboxChannelResponse": {
    "ApplicationId": "XXXXXXX",
    "CreationDate": "2021-02-03T18:57:11.845Z",
    "DefaultAuthenticationMethod": "TOKEN",
    "Enabled": true,
    "HasCredential": false,
    "HasTokenKey": true,
    "Id": "apns_sandbox",
    "IsArchived": false,
    "LastModifiedDate": "2021-02-04T17:54:52.696Z",
    "Platform": "APNS_SANDBOX",
    "Version": 5
  }
}
```

I can see this user endpoint  configured properly with stored device token I got from calling expo `await Notifications.getDevicePushTokenAsync()` 

```console
 aws pinpoint get-endpoint --application-id XXXX --endpoint-id XXX --region us-west-2
{
    "EndpointResponse": {
        "Address": "XXXX", // Token from `getDevicePushTokenAsync`
        "ApplicationId": "XXXXX",
        "Attributes": {},
        "ChannelType": "APNS_SANDBOX",
        "CohortId": "82",
        "CreationDate": "2021-02-04T16:52:50.023Z",
        "Demographic": {
            "AppVersion": "ios/14.2.1",
            "ModelVersion": "14.2.1",
            "Platform": "ios"
        },
        "EffectiveDate": "2021-02-04T17:16:23.271Z",
        "EndpointStatus": "ACTIVE",
        "Id": "XXXXX",
        "Location": {},
        "Metrics": {},
        "OptOut": "NONE",
        "RequestId": "153d9ed1-6dd2-4472-8fc7-69514bc34ecc",
        "User": {
            "UserAttributes": {
                   //User Attributes here ......
            },
            "UserId": "XXXX"
        }
    }
}
```

Every time I try to send a push notification to that endpoint ID or devidToken I get the following error using AWS pinpoint send test notification page saying the device token is expired or not formatted correctly
<img width="1602" alt="BadDeviceTokenErrorRedacted" src="https://user-images.githubusercontent.com/5491827/107126740-637cac80-6866-11eb-8264-7fd037f9a736.png">


My question is has anyone else gotten set up this way working with AWS Amplify, Pinpoint, and Expo? I have not been able to work around this error. Is there a specific way to format the device token so that I can register it with pinpoint properly as address for users notifications? 

I have been looking online and cannot find anyone else doing like this yet exactly the way I'm doing yet but I feel like it should work and I am close. I have fallen back to using expo's hosted push notification service in mean time as stop gap but would much rather use pinpoint so I don't have to maintain back-end API to store expo push notification service token as well as so I can take advantage of Pinpoint managing push notifications and tying it all back together nicely with our analytics which were also currently sending to pinpoint.

Any help/insight would be appreciated if someone else has gotten this working. 🙏 

Thanks!
## Comment

---------------

Author: @magicmove

Have the same problem and cant figure it out ! Did you found a solution ?

---------------

---------------

# Default FirebaseApp is not initialized in this process

---------------

Author: @MedNabilEssefaihi
Upvotes: 1
Comments: 0

Dear network,

I am try to use **push notification** with react native app
I got this error when I tried to implement 
`import PushNotification from '@aws-amplify/pushnotification';`

this my code 
![3](https://user-images.githubusercontent.com/74948380/123259384-4df1e180-d4ec-11eb-809e-d8b0141c0773.png)


this is the error I got
![Screenshot_20210624_130040_com nativerezervini](https://user-images.githubusercontent.com/74948380/123266206-b7c1b980-d4f3-11eb-9892-bb382362eb07.jpg)





in this case I added

```
//connect to AWS
Amplify.configure({...config, ...PushNotification._config}); 
```

it works
but the problem is how to use it next to get a token and push notification ?
in the documentation: https://docs.amplify.aws/lib/push-notifications/working-with-api/q/platform/js

PushNotification has 3 functions, are onNotification, onRegister and onNotificationOpened 
but in when I cheked the  PushNotification object, they did exist i find these:

```
addEventListenerForIOS: ƒ ()
handleNotificationOpened: ƒ ()
handleNotificationReceived: ƒ ()
parseMessageData: ƒ (rawMessage)
updateEndpoint: ƒ ()
_androidInitialized: true
_checkIfOpenedByNotification: ƒ ()
_config: {requestIOSPermissions: true, appId: "xxxxxxxx", aws_project_region: "xxxxx", aws_appsync_graphqlEndpoint: "xxxxx", aws_appsync_region: "xxxx", …}
_currentState: "active"
_iosInitialized: false
_notificationOpenedHandlers: []
__proto__: Object
```

---------------

---------------

# How to initialize amplify on gatsby ssr?

---------------

Author: @theJsTsGuy
Upvotes: 1
Comments: 0

Hi,

I am currently trying to use aws-amplify with gatsby. The problem is when I initialize amplify on gatsby ssr file, I keep getting this error:

![image](https://user-images.githubusercontent.com/40920737/123221092-01a4a280-d4e8-11eb-97e3-029f85f92fbe.png)
In terminal:
![image](https://user-images.githubusercontent.com/40920737/123221332-46c8d480-d4e8-11eb-99b7-63d28769ae9b.png)

I tried using hooks, checking `if typeof window !== "undefined"` but no success.

Here is the link to the repo: https://github.com/theJsTsGuy/public-gatsby-issue-repo

Thanks in advance.

---------------

---------------

# How to properly use TypeScript with DataStore query, observe, etc.?

---------------

Author: @Jahans3
Upvotes: 1
Comments: 2

I'm having some issues using the provided type definitions for my DataStore models, happens using the models as generic arguments as well as using them explicitly.

For example, the below code produces the following errors: 

`TS2344: Type 'T' does not satisfy the constraint 'Readonly{ id: string; } & Record >'.`

`TS2488: Type 'T' must have a '[Symbol.iterator]()' method that returns an iterator.`

```ts
export function useModel<T>(
  model: T,
  predicate: string | ProducerModelPredicate<T> <--- Error TS2344
): { data: T | Record<string, unknown>, loading: boolean, error: boolean } {
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);
  const [data, setData] = useState({});

  useEffect(() => {
    const observable = DataStore.observe<T/* <--- Error TS2344 */>(model, predicate).subscribe(
      (updatedModel) => {
        setData(updatedModel.element ?? {});
        setError(false);
        setLoading(false);
      }
    );

    DataStore.query<T/* <--- Error TS2344 */>(model, predicate)
      .then(([queryResult]/* <--- Error TS2488 */) => {
        setData(queryResult || {});
        setError(false);
        setLoading(false);
      })
      .catch(() => setError(true));

    return () => observable.unsubscribe();
  }, []);

  return { data, loading, error };
}
```

I get different errors if I use the models explicitly, like this:

```ts
const observable = DataStore.observe<PersistentModelConstructor<User>/* <--- Error TS2344 */>(
      model,
      predicate
    )
```

Produces: 
```
TS2344: Type 'PersistentModelConstructor<User>' does not satisfy the constraint 'Readonly<{ id: string; } & Record<string, any>>'.   Property 'id' is missing in type 'PersistentModelConstructor<User>' but required in type 'Readonly<{ id: string; } & Record<string, any>>'.
```

And `query` using a model directly like this:

```ts
DataStore.query<User>(model/* <--- Error TS2769 */, predicate)
```

Produces this:
```
TS2769: No overload matches this call.   Overload 1 of 2, '(modelConstructor: PersistentModelConstructor<User>, id: string): Promise<User>', gave the following error.     Argument of type 'T' is not assignable to parameter of type 'PersistentModelConstructor<User>'.   Overload 2 of 2, '(modelConstructor: PersistentModelConstructor<User>, criteria?: typeof PredicateAll | ProducerModelPredicate<User> | undefined, pagination?: PaginationInput | undefined): Promise<...>', gave the following error.     Argument of type 'T' is not assignable to parameter of type 'PersistentModelConstructor<User>'.
```

Any tips would be really appreciated :)
## Comment

---------------

Author: @gruckionvit

Did you fix this?
## Comment

---------------

Author: @themse

`TS2344: Type 'T' does not satisfy the constraint 'Readonly{ id: string; } & Record >'.` typescript will help you.  Discover error message.
With predicate typing, I also have type error and have temporary found workaround.
```
export function useModel<T extends PersistentModel>(
  model: PersistentModelConstructor<T>,
  predicate?: ProducerModelPredicate<T>,
  pagination?: ProducerPaginationInput<T>
): { data: T | Record<string, unknown>, loading: boolean, error: boolean } {
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);
  const [data, setData] = useState({});

  useEffect(() => {
    const observable = DataStore.observe<T>(model, predicate).subscribe(
      (updatedModel) => {
        setData(updatedModel.element ?? {});
        setError(false);
        setLoading(false);
      }
    );

    DataStore.query<T>(model, predicate ?? Predicates.ALL, pagination)
      .then(([queryResult]) => {
        setData(queryResult || {});
        setError(false);
        setLoading(false);
      })
      .catch(() => setError(true));

    return () => observable.unsubscribe();
  }, []);

  return { data, loading, error };
}
```

Look up here for more details:
`source code` - https://github.com/aws-amplify/amplify-js/blob/a047ce73/packages/datastore/src/datastore/datastore.ts#L802
`data store api` - https://aws-amplify.github.io/amplify-js/api/classes/datastore.html

---------------

---------------

# TOTP MFA Setup not shown in AmplifyAuthenticator when set to Optional in Cognito

---------------

Author: @ahouck
Upvotes: 1
Comments: 1

If I create a pool where MFA is required (TOTP only) and insert a user via the AWS Console.  The first time that user logs in they are prompted with a QR Code to associate a device to their account.

However if I do the same thing but configure the pool to have MFA `optional` there is nothing in the user's first time logging in to setup MFA.  Is there something I am missing?

I'm using the `@aws-amplify/ui-react` package to interact with AWS Cognito.  The user pool has the below setup:

1. MFA set to optional
2. TOTP - enabled
3. MFA via SMS - disabled
4. Ability for users to sign themselves up - disabled

And as the `AmplifyAuthenticator` setup is below.  


```
import {
  AmplifyAuthenticator,
  AmplifySignIn,
  AmplifySelectMfaType,
} from '@aws-amplify/ui-react';

const RoutedApp = () => {
  const { userSession } = useSession();

  if (!userSession) {
    return (
      <Router>
        <AmplifyAuthenticator>
          <AmplifySignIn
            slot="sign-in"
            hideSignUp
            usernameAlias="email"
            formFields={[
              {
                type: 'email',
                label: 'Email Address',
                placeholder: 'Enter your email address',
                required: true,
                disabled: true,
                value: cognito.email,
              },
              {
                type: 'password',
                label: 'Password',
                placeholder: 'Enter your password',
                required: true,
              },
            ]}
          >
            <AmplifySelectMfaType MFATypes={{ SMS: false, TOTP: true, Optional: true }} />
          </AmplifySignIn>
        </AmplifyAuthenticator>
      </Router>
    );
  }
  return <TopApplicationComponent />;
};
```
## Comment

---------------

Author: @ahouck

Should I file this as a bug?

---------------

---------------

# Does users device number have a limit to access to AWS Amplify project ?

---------------

Author: @MedNabilEssefaihi
Upvotes: 1
Comments: 0

Dear network, 

I am using AWS Amplify with GraphQL API, cognito with auth and unauth users. I pass more than 150 users already. the problem is some of my users can't access to backend.
Does amplify have a limit of 100 subscriber ? if Yes. how to increase this number? if not, what's the problem of access ? 


---------------

---------------

# Angular app- AWS Amplify - Auth Error

---------------

Author: @SKTest
Upvotes: 1
Comments: 1

Hello all,

I am new to amplify and went through this [tutorial ](https://docs.amplify.aws/start/getting-started/installation/q/integration/angular)to deploy a sample app. I am encountering the below error. I referred to multiple blogs and ensured that I do not have duplicates in node modules and that latest version of below are installed. Would appreciate any pointers on how to resolve this issue. Many Thanks!
--- from package.json--
"@aws-amplify/ui-angular": "^1.0.12",
    "aws-amplify": "^4.1.1",
    "aws-amplify-angular": "^6.0.3",
--- 

[ERROR] 11:58.497 AuthError - 
            Error: Amplify has not been configured correctly. 
            The configuration object is missing required auth properties.
            This error is typically caused by one of the following scenarios:

            1. Did you run `amplify push` after adding auth via `amplify add auth`?
                See https://aws-amplify.github.io/docs/js/authentication#amplify-project-setup for more information

            2. This could also be caused by multiple conflicting versions of amplify packages, see (https://docs.amplify.aws/lib/troubleshooting/upgrading/q/platform/js) for help upgrading Amplify packages.


Regards,
Sujith
## Comment

---------------

Author: @SKTest

Got a hint from another thread. Adding below to aws-exports.ts resolved the issue.  Though I am not sure how this would work if we are maintaining different pools for DEV, TEST and PROD. Should the exports file be modified every time before deploying to DEV/PROD.

"aws_cognito_region": "us-east-1",
    "aws_user_pools_id": "us-east-1_<XXXXX>",
    "aws_user_pools_web_client_id": "<xxxx>"

Thanks,
Sujith.

---------------

---------------

# Use ui-react without webpack

---------------

Author: @danielfdsilva
Upvotes: 1
Comments: 0

Is it possible to use the ui-react package with another build system besides webpack?

When I try to use the package (currently using Parcel) I get `Cannot find module './amplify-authenticator.cjs.entry.js'` when doing `import { AmplifyAuthenticator } from '@aws-amplify/ui-react';`

From looking into the code this is happening because the components are lazy loaded using a dynamic require:

From file: `@aws-amplify/ui-components/dist/cjs/index-6d44143a.js`
![image](https://user-images.githubusercontent.com/1090606/122552005-a9742900-d02d-11eb-9fe6-c16bcedf7d89.png)

This seems to be the result of the way Stencil js is setup within Amplify, and I wasn't able to find a way to make this work

Is there a way to load the components without using this dynamic require?
Has anyone been through this?

---------------

---------------

# Configuring a REST API with a Cognito authorizer and API Key

---------------

Author: @ChapterSevenSeeds
Upvotes: 1
Comments: 0

Hello. In the Amplify CLI, is it possible to configure a REST API gateway to use both Cognito and an API Key for authorization? This image is what I'm looking to achieve: 
<img width="514" alt="asdf2" src="https://user-images.githubusercontent.com/63123355/122304879-2cc53b80-cec3-11eb-9802-19b72c723177.png">

Notice that the route that I screenshotted is using both Cognito as an authorizer and an API key is required. Is it possible to do this same thing in the Amplify CLI rather than in the AWS console? 

---------------

---------------

# Is it possible to implement an additional authentication challenge with the prebuilt-UI

---------------

Author: @ddurham2
Upvotes: 1
Comments: 1

I'm interested in protecting my SPA from bot's signing up.  Not wanting to require a phone number of my users, and not believing the email validation is a real protection, my first choice would be to initiate a re-captcha during authentication.

The word on the street is to use a lambda as the server side to receive and validate the challenge's response.  At some point in this flow you call Auth.signup/signin.  However, I'm using the prebuilt-UI for auth and that I'm never involved in such a call.

So, is it possible to insert a new challenge phase during authentication using the prebuilt UI?

Are there alternatives, other than building all the UI myself and using the API?  Is doing a hybrid possible? i.e. signup involves a re-captcha, but signin, verify email, reset password, etc is still using the prebuilt UI?
## Comment

---------------

Author: @ahouck

You can also use TOTP MFA, this doesn't use a phone directly but some authenticator app like Authy or Google Authenticator.  If you mark it as required on your Cognito pool the setup is automatic and you don't have to do anything (assuming you are using the `@aws-amplify/ui-react` `AmplifyAuthenticator` component). However I am running into this issue (https://github.com/aws-amplify/amplify-js/discussions/8448) when trying to have it be optional.

As for captcha's directly. We implemented `react-google-recaptcha` (https://www.npmjs.com/package/react-google-recaptcha) its fairly straight forward plugging it into the `AmplifySignIn` component and overriding the `handleSubmit` to include the captcha info. 

---------------

---------------

# withAuthenticator React HOC signupOptions vs. Authenticator formFields

---------------

Author: @gomesp
Upvotes: 1
Comments: 1

Hi team

I am writing an app with a mix of public/protected content with Amplify (full public repo [here](https://github.com/gomesp/public-sample-app)). So, for that I have 2 sets of routes in my react-router:

```javascript
const App = () => {
  return (
    <Router>
      <Switch>
        <Route path="/" exact render={() => <Home />} />
        <Route path="/dashboard" render={() => <Dashboard />} />
      </Switch>
    </Router>
  );
};

export default App;
```

and

```javascript
const Dashboard = () => {
  return (
    <>
      <AmplifySignOut />
      <h1>Dashboard</h1>
      <hr />
      <div>
        <Switch>
          <Route path="/dashboard" exact render={() => <AdminDashboard />} />
          <Route path="/dashboard/users" exact render={() => <Users />} />
        </Switch>
      </div>
    </>
  );
};

export default withAuthenticator(Dashboard);
```

In an app that is completely protected, I would usually make use of the ```AmplifyAuthenticator``` component instead of the ```withAuthenticator``` HOC, and here is where I don't know how to work out my issue.

When using the ```AmplifyAuthenticator``` I can customise my signup fields however I like at ease. For example, bellow I added an additional field to the signup component and changed the default country code for the phone number field (following these [instructions](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react#custom-form-fields)):

```javascript
<AmplifyAuthContainer>
    <AmplifyAuthenticator usernameAlias="email">
    <AmplifySignUp
        slot="sign-up"
        usernameAlias="email"
        formFields={[
        {
            type: "name",
            label: "Full Name *",
            placeholder: "Enter your full name",
            inputProps: { required: true, autocomplete: "name" },
        },
        {
            type: "email",
            inputProps: { required: true, autocomplete: "username" },
        },
        {
            type: "password",
            inputProps: { required: true, autocomplete: "new-password" },
        },
        {
            type: "phone_number",
            dialCode: "+64",
        },
        ]}
    />
    <AmplifySignIn slot="sign-in" usernameAlias="email" />
    <App />
    </AmplifyAuthenticator>
</AmplifyAuthContainer>
```

I cannot find a way in the documentation to do the same configuration using the ```withAuthenticator``` HOC. I have been trying to pass the ```signupConfig``` object as a parameter to it, but the [documentation](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react#props-attr-amplify-authenticator) does not show me how to add fields or change attributes like the country dialCode like above? Am I missing something here?

Thanks!
## Comment

---------------

Author: @gomesp

It turns out that the ```withAuthenticator``` HOC had a bunch of attributes deprecated. I achieved the same outcome with the following code:

```javascript
const SignedInDashboard = ({ username }) => {
  return (
    <>
      <h1>Dashboard</h1>
      <hr />
      <div>
        <div>Hello, {username}</div>
        <AmplifySignOut />
      </div>
      <div>
        <Switch>
          <Route path="/dashboard" exact render={() => <AdminDashboard />} />
          <Route path="/dashboard/users" exact render={() => <Users />} />
        </Switch>
      </div>
    </>
  );
};

const SignedOutDashboard = () => {
  return (
    <AmplifyAuthenticator usernameAlias="email">
      <AmplifySignUp
        slot="sign-up"
        usernameAlias="email"
        formFields={[
          {
            type: "name",
            label: "Full Name *",
            placeholder: "Enter your full name",
            inputProps: { required: true, autocomplete: "name" },
          },
          {
            type: "email",
            inputProps: { required: true, autocomplete: "username" },
          },
          {
            type: "password",
            inputProps: { required: true, autocomplete: "new-password" },
          },
          {
            type: "phone_number",
            dialCode: "+64",
          },
        ]}
      />
      <AmplifySignIn slot="sign-in" usernameAlias="email" />
    </AmplifyAuthenticator>
  );
};

const Dashboard = () => {
  const [authState, setAuthState] = React.useState();
  const [user, setUser] = React.useState();

  React.useEffect(() => {
    return onAuthUIStateChange((nextAuthState, authData) => {
      setAuthState(nextAuthState);
      setUser(authData);
    });
  }, []);

  return authState === AuthState.SignedIn && user ? (
    <SignedInDashboard username={user.username} />
  ) : (
    <SignedOutDashboard />
  );
};

export default Dashboard;
```

---------------

---------------

# Cannot convert undefined or null to object

---------------

Author: @rahulnainwal107
Upvotes: 1
Comments: 0

I am getting and error cannot convert undefined or null to object when i am trying to create Photo record using Photo modal in my project. All what i am trying to do is creating multiple record using promise.all getting this error.
Complete error
Cannot convert undefined or null to object
    at Function.getPrototypeOf (<anonymous>)
    at storage.js:159
    at Array.forEach (<anonymous>)
    at StorageClass.<anonymous> (storage.js:143)
    at step (tslib.js:141)
    at Object.next (tslib.js:122)
    at fulfilled (tslib.js:112)
    at tryCallOne (core.js:37)
    at core.js:123
    at JSTimers.js:274
    
  What i am trying: I have an array of images on which i am using map
  
  const photosPromise = newPhotoData.map((item) =>
          DataStore.save(new Photo(item)),
        );
        const newPhotos = await Promise.all(photosPromise);
        
        After that i am getting this error. I think issue is there DataStore.save(new Photo(item)).

---------------

---------------

# Setting Default Country Code for Phone

---------------

Author: @shaungc-su
Upvotes: 1
Comments: 1

Hi guys, our team is trying to upgrade from `aws-amplify-react` to the latest `@aws-amplify/ui-react`. We are using the HOC `withAuthenticator()` for including the SignUp/Login/.. UI. However, I can't find a way to configure default country code for phone number in the new package `@aws-amplify/ui-react`.

Previously, `withAuthenticator()` from package `aws-amplify-react` will allow you to set the default country code via the 2nd argument `authenticatorProps` like this:

```js
const signUpConfig = {
  defaultCountryCode: '1' // set default country code for phone number 
}
export default withAuthenticator(Dashboard, { signUpConfig });
```

However, for the new `withAuthenticator()` in package `@aws-amplify/ui-react`, the field `signUpConfig` no longer exists on `authenticatorProps`, so I can't find a way to set the default country code.

The [doc contains some info about migration](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react#migration) for `withAuthenticator()`, but it eventually just links to the new property spec for `withAuthenticator()` and does not contain info about how to deal with fields that are removed, what alternatives we should go for, etc. So I'm not even sure if there's an option for this somewhere in `ui-react` or not. 

Does anyone know what is the way to set the default country code?
## Comment

---------------

Author: @gomesp

Hi @shaungc-su did you get a solution for this?

---------------

---------------

# Amplify Auth SSR Cache  (with Nuxt.js)

---------------

Author: @regenrek
Upvotes: 3
Comments: 1

Hi,

### Problem:

If `Cache-Control` for an application is enabled we experience shared User Logins. So user1 is logged in and a second stranger user2 is logged in with user1 account.

```
  res.setHeader('Cache-Control', 's-maxage=10, stale-while-revalidate')
```

### Demo for Reproduce:

I've created a small boilerplate with two demo links:

https://nuxt-aws-amplify-auth-bepxlqbvg.vercel.app/ (no cache)
https://nuxt-aws-amplify-auth-o76ccy6cd.vercel.app/ (cache enabled -> stranger login problem)

[Github Repo](https://github.com/regenrek/nuxt-aws-amplify-auth)

1. Login with a user account.
2. Open page in a new icognito tab and see how users are logged in.

 ### Code snippets.

Basically nuxt has a `nuxtServerInit` function (only server-side) where we ask for a loggedin user.

```js
  async nuxtServerInit({ dispatch }, ctx) {
    // check if user is logged in  
    try {
      const { Auth } = withSSRContext(ctx)
      const cognitoUser = await Auth.currentAuthenticatedUser()
      // save current user in store
     } catch(e) {
      console.error('No User found', error)
     }
  },
```

### Solutions

I'm a bit lost at this point in how to solve this issue.

1. Move everything to clientside and ignore Server Side authentication. This is probably the easiest approach but you will experience some delays with for example protected routes. For example, if you not loggedin and navigate to the route `/restricted` you will get redirected a few seconds later.

2. Disable API Caching. Using `Cache-Control: Private` for API routes to avoid Caching a response. But I'm not sure how I can control this with amplify/cognito . Would appreciate some examples here. What I've done so far is excluding /auth routes from caching but this didn't work since you need auth state on every page. 

3. Using a service worker. Maybe the best approach but I couldn't find some suitable example for using a service worker with amplify in terms of auth. Firebase has some similar approach here https://firebase.nuxtjs.org/tutorials/ssr


Thank you in advance
Regards!

## Comment

---------------

Author: @shresthapradip

Are you able to fix this issue? Having same issue

---------------

---------------

# Getting 401 Access Denied when deploying Next.JS SSR app

---------------

Author: @bajcmartinez
Upvotes: 2
Comments: 0

Hi all,

I built a Next.JS app that works perfectly locally or when deployed to other providers, however, when adding hosting to amplify it does not recognize the app as SSR, and thus after successful deployment and visiting the website I get the following error:

```
<Error>
<Code>AccessDenied</Code>
<Message>Access Denied</Message>
<RequestId>K5GXFGXAV81V53SN</RequestId>
<HostId>K+w3b/dy/7tpI8zHcDzKeMmRQpzWKoSADXyn9t7c87skIyiFOqpBQY/CranewHI5/Qu8d8Nh/Uw=</HostId>
</Error>
```

The app is a mix of static pages, incremental site generation pages, and server-side rendered pages, with 2 API endpoints for now.

Here is the build log:

```
2021-06-09T09:03:52.557Z [INFO]: # Starting phase: preBuild
                                 # Executing command: npm ci
2021-06-09T09:03:52.878Z [WARNING]: npm
2021-06-09T09:03:52.879Z [WARNING]: WARN
2021-06-09T09:03:52.879Z [WARNING]: prepare removing existing node_modules/ before installation
2021-06-09T09:03:59.680Z [INFO]: > cypress@7.5.0 postinstall /codebuild/output/src512330736/src/jobs-app/node_modules/cypress
                                 > node index.js --exec install
2021-06-09T09:04:00.040Z [INFO]: 
2021-06-09T09:04:00.040Z [INFO]: Cypress 7.5.0 is installed in /root/.cache/Cypress/7.5.0
2021-06-09T09:04:00.041Z [INFO]: 
2021-06-09T09:04:00.058Z [INFO]: added 919 packages in 7.205s
2021-06-09T09:04:00.067Z [INFO]: # Completed phase: preBuild
2021-06-09T09:04:00.068Z [INFO]: # Starting phase: build
                                 # Executing command: npm run build
2021-06-09T09:04:00.230Z [INFO]: > jobs-app@1.0.0 build /codebuild/output/src512330736/src/jobs-app
                                 > next build
2021-06-09T09:04:00.774Z [INFO]: info  - Using webpack 5. Reason: no custom webpack configuration in next.config.js https://nextjs.org/docs/messages/webpack5
2021-06-09T09:04:00.881Z [WARNING]: warn  - Detected next.config.js, no exported configuration found. https://nextjs.org/docs/messages/empty-configuration
2021-06-09T09:04:00.883Z [INFO]: warn  - No build cache found. Please configure build caching for faster rebuilds. Read more: https://nextjs.org/docs/messages/no-cache
2021-06-09T09:04:00.916Z [INFO]: Attention: Next.js now collects completely anonymous telemetry regarding usage.
2021-06-09T09:04:00.917Z [INFO]: This information is used to shape Next.js' roadmap and prioritize features.
                                 You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
                                 https://nextjs.org/telemetry
2021-06-09T09:04:00.950Z [INFO]: info  - Checking validity of types...
2021-06-09T09:04:05.890Z [INFO]: info  - Creating an optimized production build...
2021-06-09T09:04:36.519Z [INFO]: info  - Compiled successfully
2021-06-09T09:04:36.521Z [INFO]: info  - Collecting page data...
2021-06-09T09:04:37.776Z [INFO]: info  - Generating static pages (0/8)
2021-06-09T09:04:38.770Z [INFO]: info  - Generating static pages (2/8)
2021-06-09T09:04:38.828Z [INFO]: info  - Generating static pages (4/8)
2021-06-09T09:04:38.889Z [INFO]: info  - Generating static pages (6/8)
2021-06-09T09:04:39.157Z [INFO]: info  - Generating static pages (8/8)
2021-06-09T09:04:39.157Z [INFO]: info  - Finalizing page optimization...
2021-06-09T09:04:39.161Z [INFO]: 
2021-06-09T09:04:39.171Z [INFO]: Page                                Size     First Load JS
                                 ┌ ● / (ISR: 60 Seconds)             7.22 kB         415 kB
                                 ├   /_app                           0 B             367 kB
                                 ├ ○ /404                            3.82 kB         371 kB
                                 ├ ○ /about                          3.59 kB         371 kB
                                 ├ λ /api/checkout                   0 B             367 kB
                                 ├ λ /api/stripe-webhooks            0 B             367 kB
                                 ├ λ /listings/[listingId]           3.5 kB          412 kB
                                 ├ ● /post-job (ISR: 60 Seconds)     59.7 kB         468 kB
                                 ├   └ css/33ad5f8d63222286290d.css  1.55 kB
                                 ├ ○ /privacy-policy                 18.4 kB         385 kB
                                 ├ ○ /terms-of-service               3.46 kB         406 kB
                                 └ ○ /thanks                         4 kB            371 kB
                                 + First Load JS shared by all       367 kB
                                 ├ chunks/framework.2f6124.js      42.4 kB
                                 ├ chunks/main.c8b51c.js           19.5 kB
                                 ├ chunks/pages/_app.c0a762.js     304 kB
                                 ├ chunks/webpack.277c75.js        1.04 kB
                                 └ css/71656b30ed78cc000fee.css    6.29 kB
2021-06-09T09:04:39.172Z [INFO]: λ  (Server)  server-side renders at runtime (uses getInitialProps or getServerSideProps)
                                 ○  (Static)  automatically rendered as static HTML (uses no initial props)
                                 ●  (SSG)     automatically generated as static HTML + JSON (uses getStaticProps)
                                 (ISR)     incremental static regeneration (uses revalidate in getStaticProps)
2021-06-09T09:04:39.391Z [INFO]: # Completed phase: build
2021-06-09T09:04:39.392Z [INFO]: ## Build completed successfully
2021-06-09T09:04:39.393Z [INFO]: # Starting caching...
2021-06-09T09:04:39.483Z [INFO]: Creating cache artifact...
2021-06-09T09:04:45.298Z [INFO]: # Cache artifact is: 389MB
2021-06-09T09:04:45.448Z [INFO]: # Uploading cache artifact...
```

And the deployment log:

```
2021-06-09T09:05:39 [INFO]: Beginning deployment for application d3j1pf4ne60orh, branch:dev, buildId 0000000011
2021-06-09T09:05:39 [INFO]: Got archive: 18030319 bytes
2021-06-09T09:05:39 [INFO]: Archive unzipped: 61 files
2021-06-09T09:05:42 [INFO]: Deployment complete
```

I believe the deployment log is already wrong, as it should be adding some information about lambdas@edge being deployed and it does not.

Lately, here is my build log:

```
version: 1
backend:
  phases:
    build:
      commands:
        - '# Execute Amplify CLI with the helper script'
        - amplifyPush --simple
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
test:
  artifacts:
    baseDirectory: cypress
    configFilePath: "**/mochawesome.json"
    files:
      - "**/*.png"
      - "**/*.mp4"
  phases:
    preTest:
      commands:
        - npm install
        - npm install wait-on
        - npm install mocha mochawesome mochawesome-merge mochawesome-report-generator
        - "npm start & npx wait-on http://127.0.0.1:3000"
    test:
      commands:
        - 'npx cypress run --reporter mochawesome --reporter-options "reportDir=cypress/report/mochawesome-report,overwrite=false,html=false,json=true,timestamp=mmddyyyy_HHMMss"'
    postTest:
      commands:
        - npx mochawesome-merge@4 cypress/report/mochawesome-report/*.json > cypress/report/mochawesome.json
```

Not sure what to do, could be a bug on the Amplify side, but not sure how to register it. I generated a technical support ticket on AWS, but so far havent' heard anything.

Thanks

---------------

---------------

# how to use Content-MD5 when using S3.Put

---------------

Author: @nomoreboredom
Upvotes: 1
Comments: 0

i would like to verify the integrity of the file, however cant seem to be able to attach Content-MD5 header to the request when calling s3.Put. Any ideas?

---------------

---------------

# PreventUserExistenceErrors throw "too" generic error message

---------------

Author: @FrapperColin
Upvotes: 1
Comments: 0

Hello, 
I have a question when using API Auth with aws-amplify.
I have an App client with the security configuration set to legacy, when I call the signIn API like this in your example with wrong user parameter
```
async function signIn() {
    try {
        const user = await Auth.signIn(username, password);
    } catch (error) {
        console.log('error signing in', error);
    }
}
```
I get an error like this ;
`{
    "code": "UserNotFoundException",
    "name": "UserNotFoundException",
    "message": "User does not exist."
}`
which is quite correct but in my opinion lead to security issue. I guess that is why there is another option inside security configuration which is PreventUserExistenceErrors, that's good when making the same call above we now got the classic 
```
{
  "code": "NotAuthorizedException",
  "name": "NotAuthorizedException",
  "message": "Incorrect username or password."
}
```
The problem I got is whenever there is an user in FORCE_CHANGE_PASSWORD, the legacy security conf throw an error for those use case 
`// When user is in account status FORCE_CHANGE_PASSWORD but the code sent is expired
{
  "code": "NotAuthorizedException",
  "name": "NotAuthorizedException",
  "message": "Temporary password has expired and must be reset by an administrator."
}
 
// when user is in account status RESET_REQUIRED => should design special message to tell him to use the forgot password flow
{
  "code": "PasswordResetRequiredException",
  "name": "PasswordResetRequiredException",
  "message": "Password reset required for the user"
}
 `
But when setting PreventUserExistenceErrors option, it always throw the same message saying that Incorrect username or password which is quite terrible in terms of UI :/ do you have any advice about this ? 

I understand that security always come with a price in terms of UI but still, the fact that we cannot even say to the user that the temporary password has expired and should contact the support is quite hard

---------------

---------------

# Warning during 'npx amplify-app@lastest'

---------------

Author: @reberthkss
Upvotes: 3
Comments: 0

I got the logging warning below, tried find something about but without success. Does someone know about it?

npm WARN invalid config only="dev" set in command line options
npm WARN invalid config Must be one of: null, prod, production

![image](https://user-images.githubusercontent.com/54030471/120891115-1f63a380-c5dd-11eb-8ea3-95990583a463.png)

---------------

---------------

# Syntax for Amplify-JS REST call using temporary credentials?

---------------

Author: @slimandslam
Upvotes: 1
Comments: 0

I've generated temp credentials for the UNauthenticated Cognito user. That required using three calls:
GetIdCommand()
GetOpenIdTokenCommand()
AssumeRoleWithWebIdentityCommand()
I had to use the Cognito UNauthenticated role ARN, as well as the Identity Pool ID. 

Now, I want to use Amplify-JS to make REST calls using these generated credentials:
const tempCredentials = {
      accessKeyId: AccessKeyId,
      secretAccessKey: SecretAccessKey,
      sessionToken: SessionToken,
    };

What is the syntax for such a call?

---------------

---------------

# DataStore syncExpression change filter at runtime

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

Hi
I can successfully use a syncExpression and change the filter at runtime by changing the field value. So, in my case I have an Order model and use the customerId as the filter. I can then, at runtime switch between the different customers and get the relevant orders associated with that customer.

I can do the same by using the merchantId as a filter and change it at runtime to get the orders associated with that particular merchant.

what I would like to do and would appreciate some help here, is to switch at runtime between the customerId and merchantId filters. As the syncExpressions "get evaluated whenever DataStore starts" and there can only be one syncExpression per model, how do I swop between the two filters?

I've tried this:

`syncExpression(Order, () => {
      if (this.stateCognitoGroup.isCustomer) {
        return order => order.customerId('eq', customer_id)
      } else if (this.stateCognitoGroup.isMerchant) {
        return order => order.merchantId('eq', merchant_id)
      }
    })`

which unsurprisingly does not work. How can I accomplish this?

thanks

---------------

---------------

# amazon-cognito-identity-js callback consistency...

---------------

Author: @shaunhurley
Upvotes: 1
Comments: 0

Hey folks,

Mainly curious about a design decision that appears to have been made around structure of callbacks in the amazon-cognito-identity-js library (and possibly elsewhere).

The majority of functions (and examples) use a pretty generic callback structure such as:
```
function(err, result) {
	if (err) {
		alert(err.message || JSON.stringify(err));
		return;
	}
	console.log('call result: ' + result);
}
```
Then a couple of specific functions (I'm looking at you, authenicateUser!) go and pass in a collection of callbacks such as this:
```
{
	onSuccess: function(result) {
		console.log('call result: ' + result);
	},
	onFailure: function(err) {
		alert(err.message || JSON.stringify(err));
	},
}
```
Does anyone have the time to explain why the variation?  Why authenticateUser couldn't be adequately served by a function(err, result){} call for consistency?

Cheers!

Shaun

---------------

---------------

# Pagination in Datastore sync

---------------

Author: @ramakrishnan
Upvotes: 2
Comments: 1

Datastore can be configured to take `maxRecordsToSync`
Consider `maxRecordsToSync` is set to `1000` and there are `10000` documents in the model to get synced to local IndexedDB.
When a sync happens DataStore will only fetch `1000` as per `maxRecordsToSync` and sets a `mextToken` value.

Can I know how to use the nextToken and perform the remaining sync to get all the `10000` documents to local.

On a side note does the pagination follow any order? (ie) the documents should be sorted in an order to maintain uniqueness across each paginated set. 
## Comment

---------------

Author: @mcshiz

Does datastore automatically fetch all 10,000 records by using the nextToken? Or is the client code responsible for using the next token to fetch all records?

---------------

---------------

# Unable to query many to many relationship as mentioned in amplify datastore docs.

---------------

Author: @abdulqudoos
Upvotes: 1
Comments: 1


type Company
  @model
  @auth(rules: [{ allow: owner }, { allow: groups, groupsField: "invites" }]) {
  id: ID!
  name: String
  users: [UserCompany] @connection(keyName: "byCompany", fields: ["id"])
  reference: String
  description: String
  location: String
}




type UserCompany
  @model
  @key(name: "byOwner", fields: ["owner"])
  @key(name: "byUser", fields: ["userID", "companyID"])
  @key(name: "byCompany", fields: ["companyID", "userID"])
  @auth(
    rules: [{ allow: owner }, { allow: groups, groupsField: "accessors" }]
  ) {
  id: ID!
  userID: ID
  companyID: ID
  user: User! @connection(fields: ["userID"])
  company: Company! @connection(fields: ["companyID"])
  owner: String
  accessors: [String]
}

type User
  @model
  @aws_api_key
  @aws_cognito_user_pools
  @auth(
    rules: [
      { allow: public, provider: apiKey }
      { allow: owner }
      { allow: groups, groupsField: "user_group" }
      { allow: groups, groupsField: "tenant_group" }
      { allow: groups, groups: ["SuperAdmin"] }
    ]
  ) {
  id: ID!
  company_name: String
  company_address: String
  contact_name: String
  profile_image: String
  email: String
  phone: String  
  UserCompanys: [UserCompany]
    @connection(keyName: "byUser", fields: ["id"])  
  owner: String
  tenant_group: [String]
  user_group: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
};



I was getting UserCompany like this

this.users = (await DataStore.query(UserCompany)).filter(
      (item) => item.user.id === id
    );
    
    
    and it was working fine
    but from last Friday suddenly I am facing this error.
    
    
    core.js:6140 ERROR Error: Uncaught (in promise): Error: Field user is required
Error: Field user is required
    at datastore.js:219
    at datastore.js:276
    at Array.forEach (<anonymous>)
    at initializeInstance (datastore.js:274)
    at datastore.js:284
    at e.i.produce (immer.esm.js:1)
    at new UserCompany (datastore.js:283)
    at IndexedDBAdapter.modelInstanceCreator (datastore.js:211)
    at IndexedDBAdapter.js:516
    at Array.map (<anonymous>)
    at resolvePromise (zone-evergreen.js:798)
    at zone-evergreen.js:705
    at rejected (tslib.es6.js:74)
    at ZoneDelegate.invoke (zone-evergreen.js:364)
    at Object.onInvoke (core.js:28513)
    at ZoneDelegate.invoke (zone-evergreen.js:363)
    at Zone.run (zone-evergreen.js:123)
    at zone-evergreen.js:857
    at ZoneDelegate.invokeTask (zone-evergreen.js:399)
    at Object.onInvokeTask (core.js:28500)
    
After this error system is unable to run other functions.
## Comment

---------------

Author: @abdulqudoos

> type Company
> @model
> @auth(rules: [{ allow: owner }, { allow: groups, groupsField: "invites" }]) {
> id: ID!
> name: String
> users: [UserCompany] @connection(keyName: "byCompany", fields: ["id"])
> reference: String
> description: String
> location: String
> }
> 
> type UserCompany
> @model
> @key(name: "byOwner", fields: ["owner"])
> @key(name: "byUser", fields: ["userID", "companyID"])
> @key(name: "byCompany", fields: ["companyID", "userID"])
> @auth(
> rules: [{ allow: owner }, { allow: groups, groupsField: "accessors" }]
> ) {
> id: ID!
> userID: ID
> companyID: ID
> user: User! @connection(fields: ["userID"])
> company: Company! @connection(fields: ["companyID"])
> owner: String
> accessors: [String]
> }
> 
> type User
> @model
> @aws_api_key
> @aws_cognito_user_pools
> @auth(
> rules: [
> { allow: public, provider: apiKey }
> { allow: owner }
> { allow: groups, groupsField: "user_group" }
> { allow: groups, groupsField: "tenant_group" }
> { allow: groups, groups: ["SuperAdmin"] }
> ]
> ) {
> id: ID!
> company_name: String
> company_address: String
> contact_name: String
> profile_image: String
> email: String
> phone: String
> UserCompanys: [UserCompany]
> @connection(keyName: "byUser", fields: ["id"])
> owner: String
> tenant_group: [String]
> user_group: String
> createdAt: AWSDateTime
> updatedAt: AWSDateTime
> };
> 
> I was getting UserCompany like this
> 
> this.users = (await DataStore.query(UserCompany)).filter(
> (item) => item.user.id === id
> );
> 
> ```
> and it was working fine
> but from last Friday suddenly I am facing this error.
> 
> 
> core.js:6140 ERROR Error: Uncaught (in promise): Error: Field user is required
> ```
> 
> Error: Field user is required
> at datastore.js:219
> at datastore.js:276
> at Array.forEach ()
> at initializeInstance (datastore.js:274)
> at datastore.js:284
> at e.i.produce (immer.esm.js:1)
> at new UserCompany (datastore.js:283)
> at IndexedDBAdapter.modelInstanceCreator (datastore.js:211)
> at IndexedDBAdapter.js:516
> at Array.map ()
> at resolvePromise (zone-evergreen.js:798)
> at zone-evergreen.js:705
> at rejected (tslib.es6.js:74)
> at ZoneDelegate.invoke (zone-evergreen.js:364)
> at Object.onInvoke (core.js:28513)
> at ZoneDelegate.invoke (zone-evergreen.js:363)
> at Zone.run (zone-evergreen.js:123)
> at zone-evergreen.js:857
> at ZoneDelegate.invokeTask (zone-evergreen.js:399)
> at Object.onInvokeTask (core.js:28500)
> 
> After this error system is unable to run other functions.

Issue solved

---------------

---------------

# How to logout when refresh token has expired

---------------

Author: @Sandeepbadri
Upvotes: 1
Comments: 0

I am using react and react-router for my project. I am able to observe that when refresh token has expired and I am making an API call using amplify, I'm getting Network error as response every time. I know why this is happening. It's because whenever refresh token expires, all tokens in local storage are deleted hence when an API call is made without any tokens I get Network error. But I have implemented amplify in react-native but there I would get response with status code 403 so I could handle it there easily. Do I have any other way to detect whether refresh token has expired or not and logout the user from the app? Please help me with this  

---------------

---------------

# [ERROR] 18:14.429 OAuth - Error handling auth response. [TypeError: Network request failed]

---------------

Author: @Anupamchap
Upvotes: 2
Comments: 0

On react-native application, We are trying to implement social sign-in. For IOS it's working fine, but for android after Google or Facebook sign in, I am getting below error and application is getting crashed. Please let me know what mistake I am doing.

```
[Tue Jun 01 2021 16:18:11.689]  LOG      cognito parsingCallbackUrl {"url": null}
[Tue Jun 01 2021 16:18:11.690]  LOG      parsingCallbackUrl {"url": null}
[Tue Jun 01 2021 16:18:13.581]  LOG      URLS https://myappf2077acb-f2077acb-dev.auth.ap-southeast-1.amazoncognito.com/oauth2/authorize?redirect_uri=myapp%3A%2F%2F&response_type=code&client_id=7kpeug5cf2tdb7ri3n1tceubrb&identity_provider=Google&scope=phone%20email%20openid%20profile%20aws.cognito.signin.user.admin&state=eXavpAJAD7x8RhGY5HQQGuHV1BMjOrfS&code_challenge=9jig9ys6LEqbuWlcHKbFoaGvnBISoFqYHN7VICSwwPo&code_challenge_method=S256 Redirect myapp://
[Tue Jun 01 2021 16:18:14.793]  LOG      cognito parsingCallbackUrl {"url": "myapp://?code=210db3a4-1e90-4a64-b16d-1bb4c45d2760&state=eXavpAJAD7x8RhGY5HQQGuHV1BMjOrfS"}
[Tue Jun 01 2021 16:18:14.794]  LOG      parsingCallbackUrl {"url": "myapp://?code=210db3a4-1e90-4a64-b16d-1bb4c45d2760&state=eXavpAJAD7x8RhGY5HQQGuHV1BMjOrfS"}
[Tue Jun 01 2021 16:18:14.797]  LOG      cognito codeFlow {}
[Tue Jun 01 2021 16:18:14.803]  LOG      codeFlow {}
[Tue Jun 01 2021 16:18:15.320]  ERROR    [ERROR] 18:14.429 OAuth - Error handling auth response. [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.407]  LOG      cognito signIn_failure [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.408]  LOG      signIn_failure [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.441]  LOG      cognito cognitoHostedUI_failure [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.442]  LOG      Sign in failed [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.443]  LOG      cognito customState_failure [TypeError: Network request failed]
[Tue Jun 01 2021 16:18:15.445]  LOG      customState_failure [TypeError: Network request failed]
```

PFB my config details
```
const awsmobile = {
  aws_project_region: 'XXXXXXXX',
  aws_cognito_identity_pool_id:
    'XXXXXXXX',
  aws_cognito_region: 'XXXXXXXX',
  aws_user_pools_id: 'XXXXXXXX',
  aws_user_pools_web_client_id: 'XXXXXXXX',
  oauth: {
    domain: 'XXXXXXXX-southeast-1.amazoncognito.com',
    scope: [
      'phone',
      'email',
      'openid',
      'profile',
      'aws.cognito.signin.user.admin',
    ],
    redirectSignIn: 'myapp://',
    redirectSignOut: 'myapp://',
    responseType: 'code',
  },
  federationTarget: 'COGNITO_USER_POOLS',
};

export default awsmobile;
```


---------------

---------------

# Can Amplify cache the S3 images that are retrieved via Amplify Storage and use it while the app goes offline

---------------

Author: @jana247
Upvotes: 4
Comments: 1

Want to know if Amplify can cache the images it downloaded from S3 bucket via Amplify Storage and when the app goes offline instead of calling the S3 bucket again can it retrieve from offline cache ? 

I have not seen any discussion around this particular scenario. Can any one explain if this is possible in Amplify ?
## Comment

---------------

Author: @monscamus

Yep, I'd also like to see this. At the moment you have to avoid all use of Storage.get when you go offline and write wrapper code around file interactions to use either the WebAPI Cache or IndexDB to locally store files for offline use. It strikes me that this would be an easy thing for Storage to handle or at least allow hooks for. At the moment, when offline, you can't use Storage.get to tell you the URL it would have used to get a file which would be nice to retrieve the fetch response from Cache.

---------------

---------------

# Hub event triggered on API.graphql

---------------

Author: @maximelebastard
Upvotes: 1
Comments: 1

Hello,

I'd like to do a little circuit breaker for my React app.
How can I listen to all api calls made on the app ? Is there any Hub event triggered ?
## Comment

---------------

Author: @jeremydrichardson

Hi there,

I'm wondering if you ever figured this out.

From what I can tell there are at least no event triggered on the "api" channel for GET requests. Not sure about other requests.

I tried sending my own events on the "api" channel but got warnings that it could result in unintended consequences. I ended up just creating my own channel and sending my own custom events. 

It would be nice if this was better documented and we could see all the potential events on the protected channels.


---------------

---------------

# DataStore subscriptions and model sync

---------------

Author: @dmcd2
Upvotes: 1
Comments: 0

Hi,

In our React DataStore application I have noticed that when a background model sync happens (some time after the initial sync),  subscriptions are triggered for all the items in the models. This is having a performance impact on our application as various caches are being updated using additional queries based on the subscription. Due to the number of records in our models it takes a while for all the subscriptions to clear after the sync.

Questions:
* Should I expect a model sync, full or delta to trigger subscription events? 
* If the data hasn't changed after the sync why is is propagated up as a subscription event?
* What is the frequency of the model syncs? Is there any user control over this?
* Is there any way of knowing when a sync is about to start so I could disable my subscription handling until the sync has completed?

We are using aws-amplify 3.3.14

Thanks.

---------------

---------------

# DataStore: How to handle a partial sync up to AppSync?

---------------

Author: @PeteDuncanson
Upvotes: 1
Comments: 2

I've run into a bit of a problem and I don't know enough about DataStore to know how to fix it. In short how should I handle a partial sync from DataStore to AppSync when only half of a relation has been pushed up?

Last week our whole app (its an internal CRM tool) just died after you logged in. On investigation it seems that an entity (Address in this case) had a reference to another entity (Customer) that didn't exist. The Address had the Customer ID but in DynamoDB there wasn't an Customer record to match. 

Checking the timestamps we saw something odd, we store a "signUpDateTime" field that we set ourselves in our code, this was for the day before the create time timestamp that AppSync adds in for us! Logically what we think happened is that when someone entered a Customer and Address via the App it saved it all locally via DataStore and then got stopped from syncing half way through, so it synced the Address but was prevented from syncing the Customer (our guess is laptop got shut as it was at the end of the work day).

Come the next morning everyone logs in and starts syncing down from AppSync in their browsers, DataStore hits the broken relation and gets stuck on retrying it which blocked the whole app.

It blocked the app as we wait until DataStore has finished syncing before we let the users loose (via a "please wait" modal), we did this as we had issues with half views or other errors if data was initially missing when new users logged in so we went the brute force option of just stopping them doing anything until DataStore hub tells us its ready.

To fix the issue quickly we created a new Customer with the missing ID via AppSync UI which got unstuck and then we had to do some digging to try to piece together missing contract details for the customer.

**Possible solutions/ideas that I could do**

I could remove that pop up that blocks any interactions and just let DataStore keep retrying under the hood, this would make the app responsive at least. However in that instance we have had a data lose. That Customer doesn't exist and we currently wouldn't have any way to know that they are missing, how would I catch that data lose and flag it up some how?

I could try to catch the error and handle it some how, seems dangerous though to be trying to guess or patch what DataStore would have done?

Other than that I'm out of ideas. I'm hoping this is a known "thing" and there is a pattern or advice on how to handle it gracefully, hence this issue! :)

**Which Category is your question related to?**

DataStore


**Amplify CLI Version** 

v4.46.1

**What AWS Services are you utilizing?**

AppSync, ElasticSearch

**Provide additional details e.g. code snippets**

Error syncing:
![image](https://user-images.githubusercontent.com/1674590/114544342-6757f100-9c52-11eb-87ac-389d48a8d4bd.png)


Timestamps:
![image](https://user-images.githubusercontent.com/1674590/114544442-8787b000-9c52-11eb-8e38-86b55a049967.png)


## Comment

---------------

Author: @PeteDuncanson

One idea, we don't do much error trapping or retries when it comes to DataStore, we treat it currently as fire and forget assuming that its doing a lot of the smart retry stuff under the hood. Should we be adding in more error catching to try to catch a missed/bad sync and retrying? I don't think so, seems a bit of a duplication but I could be wrong. That raises a whole other question about best practise usage of DataStore with error handling, I might put that in another issue though.
## Comment

---------------

Author: @chrisbonifacio

Hey 👋 Thanks for raising this! After reading over this issue, it appears to be more of a general question or topic for discussion and will be labeled as such. This is to differentiate it from the other types of issues and make sure it receives the attention it deserves. 

I have also asked a member of the team that, to my knowledge, is focused on this area of Amplify to take a look and give their feedback when/if they can.

I hope that helps!

---------------

---------------

# Hosted UI returns tokens, but Hub and onAuthUIStateChange continue to give login error.

---------------

Author: @jmarshall9120
Upvotes: 1
Comments: 0

This maybe a bug, but I'm starting here.

I have successfully authenticated against the Hosted UI with both a Username & Password and a SAML federated login.  However both the the given library API's for accepting the tokens returned in the URL do not seem to work. 

I'm using Vue and have a vue component with the following:

```
<script>
import { Auth, Hub, Cache } from 'aws-amplify'
import { onAuthUIStateChange } from '@aws-amplify/ui-components';

//.... removed boiler plate code here....
 data: () => {
    signedIn: false as boolean,
    username: null as any,
}
created () {
    this.unsubscribeAuth = onAuthUIStateChange((authState, authData) => {
      console.log(authState);
      console.log(authData);
    })
  },

  mounted () {
    console.log("HelloWorld mounted()");
    Hub.listen("auth", ({ payload: { event, data } }) => {
      console.log(`Auth event: ${event}`);
      switch (event) {
        case "signIn":
          console.log("signIn data: " + JSON.stringify(data));
          this.signedIn = true;
          this.username = data.username;
          break;
        case "signOut":
          this.signedIn = false;
          this.username = null;
          break;
      }
    });
    Auth.currentAuthenticatedUser()
      .then(user => {
        console.log("Username: " + user.username);
        console.log("Refreshing access and id tokens");
        Auth.currentSession()
          .then(data => console.log(data))
          .catch(err => console.log("Error refreshing tokens: " + err));
        this.signedIn = true;
        this.username = user.username;
      })
      .catch(err => console.log("Auth.currentAuthenticatedUser(): " + err));
  }
```

I get this as a result:

![CognitoFailLogin](https://user-images.githubusercontent.com/30184747/119273131-51790c80-bbbe-11eb-9552-6be1795b8f01.png)

I've probably spent two days doing nothing but troubleshooting this, so its getting quite frustrating.  I don't think I'll be able to move forward till I can get better diagnostic strategies.  Anyone know how to run this down and determine the cause of the failure events? 

###EDIT 1###

Those failed calls in the source that came up 400 had this error message:

```
1 validation error detected: Value '{cognito-idp.us-west-2.amazonaws.com/us-west-2_c3c3ZULfA=}' at 'logins' failed to satisfy constraint: Map value must satisfy constraint: [Member must have length less than or equal to 50000, Member must have length greater than or equal to 1]
```

Not sure what to make of that yet. 

##EDIT 2##
Starting to think the malformed URL (missing a '?' after the path) might be involved.  There have been other such issues on the Issue tracker such as [#7468](https://github.com/aws-amplify/amplify-js/issues/7468)


---------------

---------------

# AWS Appsync Batch Resolver returns null

---------------

Author: @saurabh53
Upvotes: 1
Comments: 0

Custom BatchGetItem Resolver in AWS Amplify returns null value

My Table Posts has 1-1 relation with Bookmark Table. I want to get all Posts based on Bookmark Id.

Tried changing postsBookmarkId in req.vtl to id but still the code returns

req.vtl file

```
```
 #set($ids = [])
#foreach($id in ${ctx.args.ids})
    #set($map = {})
    $util.qr($map.put("postsBookmarkId", $util.dynamodb.toString($id)))
    $util.qr($ids.add($map))
#end
```

{
    "version" : "2018-05-29",
    "operation" : "BatchGetItem",
    "tables" : {
        "Posts": {
            "keys": $util.toJson($ids),
            "consistentRead": true
        }
    }
}
```
res.vtl file (response mapping )

`$utils.toJson($ctx.result.data.Posts)`

Custom Resources.json

```
"BatchGetResolver": {
      "Type": "AWS::AppSync::Resolver",
      "Properties": {
        "ApiId": {
          "Ref": "AppSyncApiId"
        },
        "DataSourceName": "PostsTable",
        "TypeName": "Query",
        "FieldName": "batchGet",
        "RequestMappingTemplateS3Location": {
          "Fn::Sub": [
            "s3://${S3DeploymentBucket}/${S3DeploymentRootKey}/resolvers/Query.batchGet.req.vtl",
            {
              "S3DeploymentBucket": {
                "Ref": "S3DeploymentBucket"
              },
              "S3DeploymentRootKey": {
                "Ref": "S3DeploymentRootKey"
              }
            }
          ]
        },
        "ResponseMappingTemplateS3Location": {
          "Fn::Sub": [
            "s3://${S3DeploymentBucket}/${S3DeploymentRootKey}/resolvers/Query.batchGet.res.vtl",
            {
              "S3DeploymentBucket": {
                "Ref": "S3DeploymentBucket"
              },
              "S3DeploymentRootKey": {
                "Ref": "S3DeploymentRootKey"
              }
            }
          ]
        }
      }
    }
```
Schema

```
type Posts {
  id: ID!
  Post: String!
  Bookmark: Bookmark @connection
  More: String
}

```
```
type Query {
    batchGet(ids: [ID]): [Posts]
}
```
Every time it returns the below response without any error

```
{
  "data": {
    "batchGet": null
  }
}
```
GraphQl query

```
const batchGet = /* GraphQL */ `
  query BatchGet($ids: [ID]) {
    batchGet(ids: $ids) {
      id
      Post
      Bookmark {
        id
        bookmark
        
      }
    }
  }
`;
```

---------------

---------------

# Identity token vs Access token

---------------

Author: @kldeb
Upvotes: 1
Comments: 0

We are using a pre token generation lambda and we noticed that the data we're adding that are needed to grant access are not being used by `API.graphql` function because it uses the access token. 

So we added an API `graphql_headers` to override the header with a `session.getIdToken().getJwtToken()` instead of the default used by `amplify-js`: `session.getAccessToken().getJwtToken()`

We do this because access token doesn't contain the information we need added to the id token. Is this correct? 



---------------

---------------

# Datastore failed to handle hash and range key

---------------

Author: @Blockchainforcommons
Upvotes: 1
Comments: 2

I wrote a simple scheme that would create a DynamoDB table with id (hash) and sort (range) keys : 

type FieldData @model 
  @key(fields: ["id","sort"]) {  
  id: ID!
  sort: String!
  type: String
} 

I then have a python lambda function that writes to the table, and included the fields: 
* _lastChangedAt, 
* _version, 
* _deleted, 
* createdAt, 
* updatedAt

However, calling:   

const analysis = await DataStore.query(FieldData)
console.log(analysis) 

**will result in 12 items, 1 item per available HASH key, not the entire table (107 items).** 

modelSynced:  
Object
counts: {new: 0, updated: 107, deleted: 0}
isDeltaSync: false
isFullSync: true
model: ƒ Model(init)
__proto__: Object

What am i missing here, they are clearly locally, how can i retrieve them? 
const analysis = (await DataStore.query(FieldData, (a) => a.sort("eq", 'PROP'))) doesnt work.

Thanks
## Comment

---------------

Author: @sammartinez

@iartemiev Any feedback on this? 
## Comment

---------------

Author: @iartemiev

@Blockchainforcommons, we don't fully support customized primary indexes with DataStore at the moment (i.e., anything other than the default `id` with no sort key). We are working on adding compatibility for this, and I'll make sure to post an update here once we do.

Could you please share your use case with us? We'll try to suggest a workaround for the time being.

---------------

---------------

# Upload file to AWS S3 bucket using cognito temporary credentials

---------------

Author: @Valarzzzzzz
Upvotes: 1
Comments: 1

I can directly use ‘aws_access_key_id’ and ‘aws_secret_access_key’ to access s3, but CognitoIdentityCredentials does not work. 
Upload file to AWS S3 bucket using temporary credentials then occur following problem:

There was an error uploading your file:  CredentialsError: Missing credentials in config, if using AWS_CONFIG_FILE, set AWS_SDK_LOAD_CONFIG=1
    at Request.extractError (http://localhost:4200/vendor.js:41530:27  )
    at Request.callListeners (http://localhost:4200/vendor.js:166781:20  )
    at Request.emit (http://localhost:4200/vendor.js:166753:10  )
    at Request.emit (http://localhost:4200/vendor.js:208037:14  )
    at Request.transition (http://localhost:4200/vendor.js:207371:10  )
    at AcceptorStateMachine.runTo (http://localhost:4200/vendor.js:32250:12  )
    at http://localhost:4200/vendor.js:32262:10  
    at Request.<anonymous> (http://localhost:4200/vendor.js:207387:9  )
    at Request.<anonymous> (http://localhost:4200/vendor.js:208039:12  )
    at Request.callListeners (http://localhost:4200/vendor.js:166791:18  )


The source code:
 AWSService.config.update({
        region: "us-east-2",
        credentials: new AWS.CognitoIdentityCredentials({
                RoleArn: "arn:aws:iam::950759593847:role/Cognito_FrontV2IDPoolAuth_Role",
                IdentityPoolId: "us-east-2:76ccbc67-3d47-493e-9399-da263e7e4fb8",
                LoginId: 'songzhou96@163.com',
                Logins: {
                  'cognito-idp.us-east-2.amazonaws.com/us-east-2_Oi3rGr6yP': window.localStorage.idtoken,
                  },
                RoleSessionName: 'web',
        })
    });
    
    const bucket = new AWSService.S3({
        apiVersion: '2012-10-17',
        params: { Bucket: 'housingdocuments'}
    });
    const params = {
        Bucket: 'housingdocuments',
        Key: "transactiondocs/"+file.name,   
        Body: file,
        ACL: 'private',
        ContentType: contentType
    };  
    bucket.upload(params, function (err, data) {
        if (err) {
            console.log('There was an error uploading your file: ', err);
            return false;
        }
        console.log('Successfully uploaded file.', data);
        alert("Successfully uploaded file.");
        return true;
    });
}
![test screenshot](https://user-images.githubusercontent.com/74666765/118449436-bb5c6680-b725-11eb-826b-0571c9a75391.jpeg)

The IAM policy is as follows: {
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "mobileanalytics:PutEvents",
                "cognito-sync:*",
                "cognito-identity:*"
            ],
            "Resource": [
                "*"
            ]
        },
        {
            "Sid": "ReadWriteDoc",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": [
                "arn:aws:s3:::housingdocuments/*"
            ]
        }
    ]
}



## Comment

---------------

Author: @reesscot

Hi @Valarzzzzzz,
Have you tried using the Amplify Storage module? 
https://docs.amplify.aws/lib/storage/getting-started/q/platform/js
https://docs.amplify.aws/lib/storage/upload/q/platform/js

---------------

---------------

# syncexpression how to Load related model

---------------

Author: @prafullatandel
Upvotes: 1
Comments: 0

Which Category is your question related to?
Datastore

What AWS Services are you utilizing?
Appsync
Datastore

Provide additional details e.g. code snippets
In DataStore syncExpression is it possible to get the related model.

Say for example

type induction @model @key(name: "byInduction", fields: ["id", "name"])  {
  id: ID!
  name: String!
  description: String!
  ... other properties
}

type UserInduction @model {
  id: ID!
  inductionId: ID!
  userId: String! 
  enrollDateTime: AWSDateTime
  completionDateTime: AWSDateTime
  Induction: [Induction] @connection(keyName: "byInduction", fields: ["inductionId"])
}

So now I know i can have sync expression for userIduction on userId

DataStore.configure({
  syncExpressions: [
    syncExpression(UserInduction, () => {
		return UserInduction => UserInduction.userId('eq',( user !== undefined ? user.username : ''));
    }),
  ],
})

the index.ts has the model as

 export declare class UserInduction {
  readonly id: string;
  readonly inductionId: string;
  readonly userId: string;
  readonly enrollDateTime?: string;
  readonly completionDateTime?: string;
  readonly Induction?: (Induction | null)[];
  constructor(init: ModelInit<UserInduction>);
  static copyOf(source: UserInduction, mutator: (draft: MutableModel<UserInduction>) => MutableModel<UserInduction> | void): UserInduction;
}

then Induction field in the above model is never loaded in the Datastore.query(UserInduction)

am i missing any expression which can load the Induction array object inside the userInduction class ?
Just the induction object on the inductionid present in the Userinduction .

---------------

---------------

# cant import aws-amplify

---------------

Author: @emanuelcsm
Upvotes: 1
Comments: 0

Hi, I'm starting to learn how to use aws amplify with my node js projects, and I created a simple project using amplify init, then I added an api using amplify add api.
For this api I dont't use any resources, ant it does not need authentication.
Then I added authentication using amplify add auth

In the lamda function created for the api mentioned before I simply add the line import Auth from ('aws-amplfy') and when I send a request I get the message "Internal Server Error", removing this line I receive the defoult "Hello from lambda".

I tried to run npm install aws-amplify in the root directory of my project as well as in the src directory of my function, and the same error keeps happening... 

This error occurs for all libraries and frameworks that I tested, the import only works for files inside the src folder.

What can I do to import a library, more especific Auth from aws-amplify?


---------------

---------------

# 5/13/2021 Discord Office Hours

---------------

Author: @mauerbac
Upvotes: 1
Comments: 8

Notes for our Office Hours
## Comment

---------------

Author: @warrenmcquinn

- Amplify CLI changelogs: who makes them, and how often are they updated? 
- Does anyone have any multi-region architecture / failover solutions for CLI environments? 
## Comment

---------------

Author: @billygerhard

Is there any easy way to add custom oauth providers? I added an issue https://github.com/aws-amplify/amplify-adminui/issues/166 to add more natively, but the questions comes up quite often because the default list is very limited especially on major social platforms. There is basically Google, and Facebook. Not even Twitter or Instagram which are huge. Let alone Twitch which Amazon owns.
## Comment

---------------

Author: @rupam-kundu

Is it possible to develop multi-tenant SaaS applications using AWS Amplify? Is there any reference multi-tenant SaaS application built using AWS Amplify?
## Comment

---------------

Author: @warrenmcquinn

Clock skew causing 403 errors for Amplify API requests: just want to confirm that clock skew has a tolerance of ~5 mins now?
## Comment

---------------

Author: @paddlefish

Is there any plan to add support for graphql subscriptions that return a stream (Observable) in Amplify API (much like Apollo graphql client)?  For changing data, a simple promise API is not sufficient.
## Comment

---------------

Author: @n10000k

Options to have multiple API's, last thing you want is a big application and just one appsync graphql api that the schema is 10k lines long, you might want to segment out services to certain teams etc
## Comment

---------------

Author: @paddlefish

If you have time for another question ...  is it supported to sync down via DataStore an objects using the graphql API (e.g. via AppSync console).  Right now I get this error:

```
DataStore - Skipping incoming subscription. Messages: Cannot return null for non-nullable type <numerous different fields>
```

for any object created directly by graphql.  OTOH if I create it via DataStore.save() then it syncs to peers without error.

This has been asked three times that I can find in the discord history, fwiw.
## Comment

---------------

Author: @NikolaBo

Not sure if this is intended sort of question, but I'll ask anyway (I feel pretty new here).

I'm running into a technical issue with my Auth setup where I am signing in with provider (google) and getting an `invalid-grant` response when requesting the token from Cognito. I'm not sure where to find useful explanations of this error [this](https://docs.aws.amazon.com/cognito/latest/developerguide/token-endpoint.html) describes invalid-grant but I'm not sure how it applies. Federated sign in still works normally locally and in other hosted branches, but has stopped functioning when I pushed to production with custom domain?

Any resource I can look at?

---------------

---------------

# How can I edit a phone number of a user after user is confirmed and before the user is authenticated?

---------------

Author: @raghavgoel1994
Upvotes: 1
Comments: 0

Steps to replicate the issue:

1. User enters details on the signup page in UI (First and last name, Email, Phone Number and Password (Wrong phone number by mistake))
2. AWS send OTP confirmation code to email
3. The user enters OTP in the UI, the email field is verified and the user is **confirmed**
4. The user tries to log in and AWS tries to send OTP to the user's phone number (MFA Enabled)

But the user will never get the OTP in his phone number because the user entered the wrong number on the signup page.
So I ask the user to update the number, but when I tried to update it in AWS, they returned the exception "the user is not authentic". How can I update the number to the correct number after the user just signup(confirmed) and still not authenticated?

Development URL -

dev-webapp.myhomey.io

---------------

---------------

# Amplify graphql custom type in models

---------------

Author: @CarlJoven
Upvotes: 1
Comments: 1

# I am wondering if this is possible?
```graphql
type Person @model {
 id: ID!
 userInfo: PersonInfo
}

type PersonInfo {
 name: String!
 age: Int!
}
```

Thanks in advance!
## Comment

---------------

Author: @apoorvmote

Use has one connection

```graphql
type Person @model {
  id: ID!
  userInfo: PersonInfo @connection
}

type PersonInfo @model {
  id: ID!
  name: String!
  age: Int!
}
```
For more information visit the documentation
https://docs.amplify.aws/cli/graphql-transformer/connection#has-one

---------------

---------------

# Is `api-graphql` smaller than `api` package?

---------------

Author: @apoorvmote
Upvotes: 1
Comments: 0

I don't need SSR so I only install packages that I need. 

For example instead of `aws-amplify` I only install `@aws-amplify/core`, `@aws-amplify/auth` and `@aws-amplify/api`.

I only use graphql api and don't use rest api. Also I don't mutate with graphql only run queries with graphql.

And today I found out about `@aws-amplify/api-graphql` package. 

My question is can I replace `@aws-amplify/api` with `@aws-amplify/api-graphql` for graphql queries?

Is there benefit of reduced package size?

---------------

---------------

# AmplifyAuthenticator doesn't display UI message for "incorrect username or password" error

---------------

Author: @seantcoyote
Upvotes: 1
Comments: 1

After much searching, I've found no definitive answer: Should AmplifyAuthenticator (@aws-amplify/ui-react version 1.0.7 and aws-amplify 3.3.27) display an error message in the UI when Cognito returns `{"__type":"NotAuthorizedException", "message":"Incorrect username or password."}`?

Login works as expected for a signin with valid user credentials, but incorrect username or password  fails silently for the end user. I've seen indications in online discussions suggesting both, either that we need to build UI error messaging ourselves, or that it should be included out-of-the-box. If the former, I haven't found documentation for adding UI error messaging without having to build the entire auth flow from scratch. If the latter, is this a bug or am I missing some configuration?

My code:

```
import React from 'react';
import {AmplifyAuthenticator, AmplifySignIn} from '@aws-amplify/ui-react';

<AmplifyAuthenticator usernameAlias="email">
    <AmplifySignIn headerText="Sign In" slot="sign-in" hideSignUp></AmplifySignIn>
</AmplifyAuthenticator>
```
## Comment

---------------

Author: @amhinson

There should be a toast component that shows at the top of the screen when a failed login occurs. Do you not see that in your application? I copied your code and this is what I get when attempting to login with an incorrect password:

![image](https://user-images.githubusercontent.com/17091790/117475191-9b9c9580-af10-11eb-810f-e6e4ced834cd.png)

---------------

---------------

# What's the behavior of Amplify Analytics when mobile native app is offline (React Native iOS)?

---------------

Author: @pisaacs
Upvotes: 1
Comments: 0

I am trying to understand how Amplify Analytics works for React Native iOS app while offline..
1) are events queued, saved in storage and sent when there's network connectivity?
2) Is there a period limit, limit on queue size?
3) are there specific API options for controlling the behavior?  

---------------

---------------

# How to filter nested tables using API in aws-amplify (AppSync)

---------------

Author: @AyazAI
Upvotes: 1
Comments: 0


I am able to filter out one table which is top-level table (SpUser) using

### Appsync console
![image](https://user-images.githubusercontent.com/45338553/117255647-53736980-ae63-11eb-8c3a-2f4e418672d5.png)

### aws-amplify
```
let filter = {
      first_name: {
        eq: "Mo",
      },
 };
```

```
await API.graphql({
        query: queries.listSpUsers,
        variables: {
          filter: filter,
     },
});
```

where schema is

```

type SpUser @model @key(name: "byCompany", fields: ["companyID"]) {
  id: ID!
  services: [SpAssignedService] @connection(keyName: "bySpUser", fields: ["id"])
}

type SpAssignedService @model @key(name: "bySpUser", fields: ["sID"]) {
  id: ID!
  sID: ID
  category: String
}

```

**The question is how can I filter out nested data, which is of **SpAssignedService****

### Appsync console (Working)
![image](https://user-images.githubusercontent.com/45338553/117255883-9fbea980-ae63-11eb-9083-eb7587d8c546.png)

### aws-amplify (Not Working)

```
let filter = {
      items: {
        services: {
          filter: { category: { eq: "Scaling" } },
        },
    },
};

let response = await API.graphql({
        query: queries.listSpUsers,
        variables: {
          filter: filter,
        },
 });
```
For nested filter:
Well the **Appsync** is returning results but **aws-amplify** is not returning any results

---------------

---------------

# Add New User Pool and Custom Policies

---------------

Author: @billycolley
Upvotes: 1
Comments: 0

We have a need to add a new user pool, as well as a custom policy for each user pool. Currently our workflow is:
run `amplify update auth`
Choose `Create or update Cognito user pool groups`
Just hit enter without selecting anything to delete.
When it asks if you want to add another user pool group type `y` and hit enter.
Name the new pool and hit enter.
Choose `N` when it asks if you want to add another user group, unless you do.

That successfully adds a new user pool group. Good so far. Now to add the custom policy.

Navigate to user-pool-group-precedence.json and find the new pool you just added in the above steps. Add a custom policy with the below template:
```
{
        "groupName": "testGroup",
        "precedence": 2,
        "customPolicies": [
            {
                "PolicyName": "testName",
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Action": [
                                "s3:PutObject",
                                "s3:GetObject",
                                "s3:ListBucket",
                                "s3:DeleteObject"
                            ],
                            "Resource": [
                                "arn:aws:s3:::bucket-name/*"
                            ],
                            "Effect": "Allow"
                        },
                        {
                            "Action": "s3:ListBucket",
                            "Resource": [
                                "arn:aws:s3:::bucket-name"
                            ],
                            "Effect": "Allow"
                        }
                    ]
                }
            }
        ]
    },
```
Then, after the code is pushed, we run `amplify push/publish`. This correctly creates the new user pool, and attaches the policy to it. Good so far. Then another developer uses `amplify pull` to sync their local environment. Still good. Finally the user runs `amplify update auth` again to add a new user pool group, but the custom policy is removed from the user-pool-group-precedence.json file for all user pool groups. 

What is the correct process for doing this? Are we missing a step? Do we add the policy to the user-pool-group-precedence.json file the first time, which then adds it to the template.json file, and we don't need it in the precedence file anymore?

---------------

---------------

# Multiple Authorization methods GraphQL (Cognito and IAM) Angular

---------------

Author: @cytrix86
Upvotes: 1
Comments: 0

Hello everyone,

I am trying to use IAM for unauthenticated and Cognito User Pools for authenticated users in an Angular app.
Cognito is configured as my primary source of authentication in AppSync and IAM is added as my secondary source.
In the AppSync Queries Interface everything works as expected. 

When I try to list from my Angular app when the user is not authenticated via Cognito I get **No current user**.

I was able to solve the issue with the following workaround:
```javascript
 if (this.auth.isAuthenticated) {
        Amplify.configure({
          aws_appsync_authenticationType: 'AMAZON_COGNITO_USER_POOLS',
        });
        console.log('changed to Congnito');
      } else {
        Amplify.configure({
          aws_appsync_authenticationType: 'AWS_IAM',
        });
        console.log('changed to IAM');
      };
```
before I qurey.

My modal looks like this:

```qraphql
type Test
  @model(timestamps: { createdAt: "createdOn", updatedAt: "updatedOn" })
  @auth(
    rules: [
      { allow: public, provider: iam, operations: [read] }
      { allow: owner, ownerField: "owner" }
      { allow: groups, groups: ["Admins"] }
    ]
  ) {
  id: ID
  title: String
  views: Int @aws_iam
  owner: String
}
```

Updating the views field on this object works in the AppSync interface but not from Angular. 
As soon as i am authenticated everything works as expected.

My APIService is created by the Amplify CLI code generator. 

I am thankful for any suggestions. 

Angular: 11.2.10
Amplify CLI: 4.50.0
aws-amplify: 3.3.27

---------------

---------------

# I need to add client_secret ?

---------------

Author: @MMay1992
Upvotes: 1
Comments: 0

I need to add client_secret in OAuth.prototype._handleCodeFlow
Example:
Calling token endpoint: https://cpalloidc.auth.ap-southeast-1.amazoncognito.com/oauth2/token with 
client_id: ""
**### client_secret: "" // It can't add /// Help me pls.**
code: ""
code_verifier: ""
grant_type: ""
redirect_uri: ""

In this file.
https://github.com/aws-amplify/amplify-js/blob/main/packages/auth/src/OAuth/OAuth.ts

---------------

---------------

# How to add identityPoolId in config of Auth.federatedSignIn

---------------

Author: @xenowits
Upvotes: 1
Comments: 2

Hi all. I am trying to use firebase as IdP for cognito Identity pools. I need to add cognito IdentityPoolId in the federatedSignIn function of Auth. If I don't add the id, i get an error saying `Error: Federation requires either a User Pool or Identity Pool in config`. How to place it and where is my concern?
Any help is very much appreciated!

```
Auth.federatedSignIn(
    {
       domain: "securetoken.google.com/{PROJECT_ID}",
   //   identityPoolId: "AWS_REGION:POOL_ID",
    {
      token: token,
      expires_at: expiresIn * 1000 + new Date().getTime(),
    },
    user
  )
    .then((cred) => {
      // If success, you will get the AWS credentials
      console.log(cred);
      return Auth.currentAuthenticatedUser();
    })
    .then((user) => {
      // If success, the user object you passed in Auth.federatedSignIn
      console.log(user);
    })
    .catch((e) => {
      console.log(e);
    });
```
## Comment

---------------

Author: @xenowits

https://kumar-abhishek111b.medium.com/configuring-federated-signin-in-amplify-9b06ec20ab8
## Comment

---------------

Author: @xenowits

This discussion is closed. I hv written a small article on this. Restart the discussion if it still isn't working for u!

---------------

---------------

# How to add oidc to CognitoHostedUIIdentityProvider

---------------

Author: @hf-qin
Upvotes: 1
Comments: 0

I'm trying to add azure ad OIDC to Cognito and want to develop a federated sign-in using Amplify. But it seems that CognitoHostedUIIdentityProvider only supports Facebook, Google, and LWA. 

Had anyone tried providing "Login in with Microsoft" using Amplify + Cognito?

Any hints will be appreciated!

Thanks

---------------

---------------

# AWS Amplify DataStore 100 hard limit of subscriptions

---------------

Author: @CarlJoven
Upvotes: 1
Comments: 0

# Problem
I am about to reach the limit set by the Appsync and I am worried because the web app that I am developing may still require additional features. It means additional models and datastore always require that the model must be sync in order for it to work so I cannot disable the subscriptions. 

# Things that I have done
- Turn the subscriptions param of the model directive into null of models which I don't need subscriptions but it does not work and it is not syncing because like I mentioned before datastore relies on subscriptions in order for the syncing to work.
- Tried to go to the support center but It is not listed as one of the options in the service limit increase. So my only option is to upgrade my plan in the support center but before I do that I have a question. Will my issue be resolved? Because based on issue #6260  which is the continuation of issue #5050 it is not possible.

**Please help and guide me I am really worried right now**

---------------

---------------

# How to increment field by 1 from DynamoDB using AWS Amplify with GraphQL

---------------

Author: @MedNabilEssefaihi
Upvotes: 1
Comments: 0

Hello there!

I am building a **react native** application with **AWS Amplify** fro backend, I want to increment a value by 1 in **Table of Posts**.
in graphQL there's a simple way by suing operator call **_inc: {valueToIncrement: 1}**

### the solution exists:

```
mutation update_post{
  update_post(
where:{id : {_eq: xxxxxxxxxx}},
_inc: {valueToIncrement: 1}
){
 // returns
}

}
```

**My need** 
I am looking for the same method with **AWS Amplify with GraphQL**

---------------

---------------

# Unable to make Many-to-Many Relationship in DataStore

---------------

Author: @kenchoong
Upvotes: 1
Comments: 0

I have this 2 model, `Product` and `Order`. 
I want it have Many-to-Many Relationship. 
So `Product` in many `Order` 
`Order` will have many `Product` like in this picture 

![115989227-fb7d6d00-a5ef-11eb-8527-dbb2b329f852](https://user-images.githubusercontent.com/8010129/115996962-ec101b00-a613-11eb-80ff-ff3d810a3ebd.png)

So I click "Add relationship" in `Order `model like this: 

![115989267-2bc50b80-a5f0-11eb-84e4-77cbe4275027](https://user-images.githubusercontent.com/8010129/115997005-13ff7e80-a614-11eb-9f3e-d07b2a81dc45.png)

Then what I got is this, it only create as 1:m relationship: 
![115989318-5ca54080-a5f0-11eb-9fd9-5380b78e99c4](https://user-images.githubusercontent.com/8010129/115997017-237ec780-a614-11eb-9b67-9731db237e93.png)

I also unable to selete M:n relationship in the dropdown menu 
![115989378-9aa26480-a5f0-11eb-9637-0596adad7390](https://user-images.githubusercontent.com/8010129/115997048-35606a80-a614-11eb-959e-6eb56eac3804.png)

So now I unable to make M:n relationship in my data model. 

Then I try to make the same order and relationship in a[ Amplify sandbox ](https://sandbox.amplifyapp.com/schema-design/f6c23bfd-9d98-41b5-9649-d6ce68bd411c)
![115989429-e5bc7780-a5f0-11eb-8c0a-48bb06611130](https://user-images.githubusercontent.com/8010129/115997123-853f3180-a614-11eb-8d29-d86f43147006.png)

As you can see, both `Order` and `Product` is having the relationship for each other, but I unable to do that in my Amplify Admin UI. 

Then I try to edit the `schema.graphql` in my local file by following [this example in amplify docs](https://docs.amplify.aws/lib/datastore/relational/q/platform/js#many-to-many)

I also not able to create the relationship, which I create this issue 5 days ago here: https://github.com/aws-amplify/amplify-js/issues/8139

**My goal is**
1.  Create the Many to many relationship for `Product` and `Order` 
2.  Able to get all ProductId given a OrderID

But I unable to do that, and I not sure why is this happen

For more information, please refer: 
1. [Amplify UI issue](https://github.com/aws-amplify/amplify-adminui/issues/188)
2. [Amplify js issue](https://github.com/aws-amplify/amplify-js/issues/8139)
3. [SO question](https://stackoverflow.com/questions/67201435/unable-to-query-many-to-many-relationship-in-amplify-datastore)
4. [Amplify discord discussion for attempt to solve this](https://discord.com/channels/705853757799399426/831604049928257556/834434325889679440)

I hope this clear, please provide any possible help. If still need any information please let me know. 

---------------

---------------

# Remove shadow DOM from UI Components

---------------

Author: @ericclemmons
Upvotes: 2
Comments: 2


## Summary

`@aws-amplify/ui-components` are Web Components, built by StencilJS with bindings for frameworks (e.g. `@aws-amplify/ui-react`).

Many of these components use the Shadow DOM for encapsulation, but that's **needlessly restrictive**, preventing customers from styling their components via normal CSS selectors.

https://github.com/aws-amplify/amplify-js/blob/06bfecbd32751dee61d5abb6d5be9430ecaeca5a/packages/amplify-ui-components/src/components/amplify-sign-in/amplify-sign-in.tsx#L31-L35

## Motivation

1. Shadow DOM is helpful for encapsulating 3rd party widgets (e.g. a Disqus chat box) so that on-page styles don't cascade to the 3rd party widget.

2. Amplify UI Components **are not intended to be fully sandboxed**, but rather a 1st Class component in your application that _looks_ like your app.

Amplify has attempted to solve #2 via CSS Variables, but ultimately leveraging CSS' built-in specificity is the best way to override styles.  Using CSS Variables + Shadow DOM as the only external API to override styles makes the customization experience frustrating and, in some cases, impossible.

## Proposal

Remove `shadow: true` references. This should allow `amplify-sign-in form-section { width: 100% }` to work as expected.  CSS Variables will also continue to work as before.

## Drawbacks

This would be a breaking change, as any customers using `:host` or piercing selectors will have to update their styles.

The good news is that UI Components aren't v1 yet, so there's an opportunity to bump to v1 with any other breaking changes.

The biggest drawback is that, like any other UI framework, **the markup becomes an implicit API contract that can break between releases**.  For example, wrapping a `<button>` inside of a `<div>` to fix a layout issue would break custom `form > button` selectors:
> ![workflow](https://user-images.githubusercontent.com/15182/104044430-28695980-5192-11eb-9466-2e1bd31d30dd.png)
> – https://xkcd.com/1172/


## Adoption Strategy

This would require _less_ documentation & support (e.g. Discord, GitHub), because CSS would "just work".

## Related Issues

- https://discord.com/channels/705853757799399426/708383821401161738/794346824633679872
- https://github.com/aws-amplify/amplify-js/discussions/6984
- https://github.com/aws-amplify/amplify-js/discussions/6891
- https://github.com/aws-amplify/amplify-js/discussions/6200
- https://github.com/aws-amplify/amplify-js/discussions/5536
- https://github.com/aws-amplify/amplify-js/discussions/6047
- https://codesandbox.io/s/amplify-ui-cant-hide-toast-5h4my?file=/styles.css

## Comment

---------------

Author: @tjleing

I'd also like to toss #7199 into the pile -- looking forward to the discussion!
## Comment

---------------

Author: @ericclemmons

Let's get this done with https://github.com/aws-amplify/amplify-js/milestone/32

---------------

---------------

# Facebook login results in "No Cognito Federated Identity pool provided" using @aws-amplify/ui-components

---------------

Author: @countryst
Upvotes: 1
Comments: 1

I'm using "@aws-amplify/ui-components": "^1.2.0", quasar and Vue
I'm following https://docs.amplify.aws/ui/auth/authenticator/q/framework/vue
When I click on "Sign in with facebook", nothing changes on UI, but I see following error in console log:
`Uncaught (in promise) No Cognito Federated Identity pool provided`

The issue might be that Amplify is setting the redirect uri to `localhost`
`https://www.facebook.com/v5.0/dialog/oauth?app_id=237235604209826&cbt=1619122407853&channel_url=https%3A%2F%2Fstaticxx.facebook.com%2Fx%2Fconnect%2Fxd_arbiter%2F%3Fversion%3D46%23cb%3Df333aef24e397e%26domain%3Dlocalhost%26origin%3Dhttps%253A%252F%252Flocalhost%253A8080%252Ff1ff362458255c8%26relation%3Dopener&client_id=237235604209826&display=popup&domain=localhost&e2e=%7B%7D&fallback_redirect_uri=https%3A%2F%2Flocalhost%3A8080%2F%23%2F&locale=en_US&logger_id=f3b39c68cff96d8&origin=1&redirect_uri=https%3A%2F%2Fstaticxx.facebook.com%2Fx%2Fconnect%2Fxd_arbiter%2F%3Fversion%3D46%23cb%3Df1d22f64a476e88%26domain%3Dlocalhost%26origin%3Dhttps%253A%252F%252Flocalhost%253A8080%252Ff1ff362458255c8%26relation%3Dopener%26frame%3Df3e7e88ce452e44&response_type=token%2Csigned_request%2Cgraph_domain&scope=public_profile%2Cemail&sdk=joey&version=v5.0`
I assume it should redirect to `https://<your-user-pool-domain>/oauth2/idpresponse` so Cognito can handle this properly

I found this that talks about HOC, but it using react https://github.com/aws-amplify/amplify-js/issues/5528

Here is my App.vue:

```
<template>
  <div id="q-app">
    <div>
      <div v-if="authState !== 'signedin'">You are signed out.</div>
      <amplify-authenticator :federated.prop="federatedIds">
        <div v-if="authState === 'signedin' && user">
          <div>Hello, {{user.username}}</div>
        </div>
        <amplify-sign-out></amplify-sign-out>
      </amplify-authenticator>
    </div>
  </div>
</template>
<script lang="ts">
import { defineComponent } from '@vue/composition-api'
import { onAuthUIStateChange } from '@aws-amplify/ui-components'

export default defineComponent({
  name: 'App',
  created() {
    this.unsubscribeAuth = onAuthUIStateChange((authState, authData) => {
      this.authState = authState;
      this.user = authData;
    })
  },
  data() {
    return {
      user: undefined,
      authState: undefined,
      unsubscribeAuth: undefined,
      federatedConfig: { provider: "Facebook" },
      federatedIds: {
        facebookAppId: "****"
      },
      formFields: [
        {
          type: "email",
        },
        {
          type: "password",
        },
      ],
    }
  },
  beforeUnmount() {
    this.unsubscribeAuth();
  }
})
</script>

```

Here is my boot file:

```
import Amplify from 'aws-amplify';
import awsconfig from '../aws-exports';
import {
  applyPolyfills,
  defineCustomElements,
} from '@aws-amplify/ui-components/loader';

applyPolyfills().then(() => {
  defineCustomElements(window);
});
Amplify.configure(awsconfig);
```

Here is my amplify-meta.json file:

```
{
  "providers": {
    "awscloudformation": {
      "AuthRoleName": "*******",
      "UnauthRoleArn": "*******",
      "AuthRoleArn": "*******",
      "Region": "*******",
      "DeploymentBucketName": "*******",
      "UnauthRoleName": "*******",
      "StackName": "*******",
      "StackId": "*******",
      "AmplifyAppId": "*******"
    }
  },
  "auth": {
    "media70a63f67": {
      "service": "Cognito",
      "serviceType": "imported",
      "providerPlugin": "awscloudformation",
      "dependsOn": [],
      "customAuth": false,
      "output": {
        "UserPoolId": "*******",
        "UserPoolName": "*******",
        "AppClientID": "*******",
        "AppClientIDWeb": "*******",
        "HostedUIDomain": "*******",
        "OAuthMetadata": "*******"
      },
      "lastPushTimeStamp": "*******"
    }
  }
}
```
## Comment

---------------

Author: @countryst

The issue is that corrent library doesn't support this feature, here is related feature request https://github.com/aws-amplify/amplify-js/issues/8171

---------------

---------------

# DynamoDB:ApiCallTimeoutException how to replicate

---------------

Author: @malcomm
Upvotes: 2
Comments: 1

I am using AWS Amplify and Angular. I will get a DynamoDB:ApiCallTimeoutException from time to time and I'm having trouble replicating this so that I can handle the errors properly. 

My question is: is there a way I can throw something similar so that I can properly handle these types of errors and test it?

Here's an example error message:

```
Error: Uncaught (in promise): Object:
{
  "data": {
    "getFoo": {
      "__typename": "Foo",
      "id": "8df58cab-81de-402d-bd77-1e72300e8b2",
      "updatedAt": "2020-09-24T22:43:20.236Z",
      ....
    }
  },
  "errors": [
    {
      "path": [
        "getFoo",
        ....
      ],
      "data": null,
      "errorType": "DynamoDB:ApiCallTimeoutException",
      "errorInfo": null,
      "locations": [
        {
          "line": 726,
          "column": 11,
          "sourceName": null
        }
      ],
      "message": "Client execution did not complete before the specified timeout configuration: 10000 millis"
    }
  ]
}
```

Thanks!
## Comment

---------------

Author: @warrenmcquinn

I am actively encountering this error - it is causing havoc on my production workload. I've contacted AWS Support for any information about a fix.

---------------

---------------

# Add a hidden custom attribute during signup

---------------

Author: @swapnil0545
Upvotes: 1
Comments: 1

Hi,

I have some custom attribute in the signup process which needs to be filled in eg. custom:role, custom:tenant_id.
I am using angular and amplify sdk.
` {
      type: "custom:role",
      value: "user",
      required: true,
      disabled: true,
      inputProps: { name: "role" },
    }`

but when I use type : hidden, then the signup doesnt work as the key name is taken as 'hidden'.
There is no property named 'key' entertained by the function.

Any help regarding how I can solve this will be greatful.

Thanks,
Swapnil
## Comment

---------------

Author: @swapnil0545

Bump anyone?

---------------

---------------

# Does Amplify automatically refresh security tokens in React Native?

---------------

Author: @joebernard
Upvotes: 1
Comments: 0

https://docs.amplify.aws/lib/auth/manageusers/q/platform/js#managing-security-tokens

I noticed the docs now seem to indicate that Amplify will automatically handle refreshing security tokens for React Native. Previously React Native apps had to handle refreshing manually. I'm trying to track down which version of Amplify this was introduced in.

https://github.com/aws-amplify/amplify-js/pull/7288
This PR seems to have touched on it which was introduced in 3.4.15. Is that when it was changed?

I need to know if I can safely pull out all our manual token refresh logic once I upgrade.

---------------

---------------

# Incorrect username and password exception during CUSTOM_AUTH

---------------

Author: @epratik
Upvotes: 1
Comments: 1

I am trying to do a username/password login with custom email OTP using CUSTOM_AUTH.
Below are the steps -
1.Auth.signIn(username, password)
2.This executes the first 2 cases of define auth challange lambda trigger
3.The input json to define auth challange lambda looks like this -
{
challengeName: 'SRP_A',
challengeResult: true,
challengeMetadata: null
},
{
challengeName: 'PASSWORD_VERIFIER',
challengeResult: true,
challengeMetadata: null
}
4.Its clear that password is validated.
5.It now sets the challange to CUSTOM_CHALLANGE.
6.At this point the client fails with NotAuthorizedException instead of asking for the challange answer.

My define auth challange lambda is like this -

exports.handler = async (event, context) => {
console.log(event.request.session)
if (event.request.session.length == 1 && event.request.session[0].challengeName == 'SRP_A') {
event.response.issueTokens = false;
event.response.failAuthentication = false;
event.response.challengeName = 'PASSWORD_VERIFIER';
}
else if (event.request.session.length == 2 && event.request.session[1].challengeName == 'PASSWORD_VERIFIER' && event.request.session[1].challengeResult == true) {
event.response.issueTokens = false;
event.response.failAuthentication = false;
event.response.challengeName = 'CUSTOM_CHALLENGE';
}
else if (event.request.session.length == 3 && event.request.session[2].challengeName == 'CUSTOM_CHALLENGE' && event.request.session[2].challengeResult == true) {
event.response.issueTokens = true;
event.response.failAuthentication = false;
}
else {
console.log('Failing Authentication')
event.response.issueTokens = false;
event.response.failAuthentication = true;
}
context.done(null, event);
}

Is this supported by amplify?
Documentation referred - https://docs.amplify.aws/lib/auth/switch-auth/q/platform/js#custom_auth-flow
This suggests you to not provide a password but that does not work either.
## Comment

---------------

Author: @epratik

I found the issue. My create auth lambda was wrong. The if statement in my lambda was
if (!event.request.session || event.request.session.length === 0) {

but should be

if (event.request.session.length === 2 && event.request.challengeName === 'CUSTOM_CHALLENGE') {

I had a console.log(event) inside the create auth lambda before the if statement but that was not writing log to cloud watch which led me to believe that the lambda was not getting fired. I created a new lambda function which fixed the logging issue.

---------------

---------------

# AWS Cognito UI configured using Amplify in quasar/Vue3 doesn't show Facebook login button

---------------

Author: @countryst
Upvotes: 1
Comments: 1

I'm using amplify to add auth UIs for AWS Cognito to my quasar/Vue3 website. Facebook login button is not displayed.

![Screenshot](https://i.ibb.co/LgSyxcx/Screen-Shot-2021-04-22-at-9-35-38-AM.png)


I used ```amplify import auth``` since I already have Cognito userpool configured sepratly.

Here is my sample App.vue

    <template>
      <div id="q-app">
        <div>
          <div v-if="authState !== 'signedin'">You are signed out.</div>
          <amplify-authenticator :federated="federatedIds">
            <div v-if="authState === 'signedin' && user">
              <div>Hello, {{user.username}}</div>
            </div>
            <amplify-sign-out></amplify-sign-out>
          </amplify-authenticator>
        </div>
      </div>
    </template>

    <script lang="ts">
    import { defineComponent } from '@vue/composition-api'
    import { onAuthUIStateChange } from '@aws-amplify/ui-components'
    
    export default defineComponent({
      name: 'App',
      created() {
        this.unsubscribeAuth = onAuthUIStateChange((authState, authData) => {
          this.authState = authState;
          this.user = authData;
        })
      },
      data() {
        return {
          user: undefined,
          authState: undefined,
          unsubscribeAuth: undefined,
          federatedConfig: { provider: "Facebook" },
          federatedIds: {
            facebookAppId: "*******"
          }
        }
      },
      beforeUnmount() {
        this.unsubscribeAuth();
      }
    })
    </script>

Here is my boot file:

    import Amplify from 'aws-amplify';
    import awsconfig from '../aws-exports';
    import {
      applyPolyfills,
      defineCustomElements,
    } from '@aws-amplify/ui-components/loader';
    
    applyPolyfills().then(() => {
      defineCustomElements(window);
    });
    Amplify.configure(awsconfig);

Here is my amplify-meta.json file:

```
{
  "providers": {
    "awscloudformation": {
      "AuthRoleName": "*******",
      "UnauthRoleArn": "*******",
      "AuthRoleArn": "*******",
      "Region": "*******",
      "DeploymentBucketName": "*******",
      "UnauthRoleName": "*******",
      "StackName": "*******",
      "StackId": "*******",
      "AmplifyAppId": "*******"
    }
  },
  "auth": {
    "media70a63f67": {
      "service": "Cognito",
      "serviceType": "imported",
      "providerPlugin": "awscloudformation",
      "dependsOn": [],
      "customAuth": false,
      "output": {
        "UserPoolId": "*******",
        "UserPoolName": "*******",
        "AppClientID": "*******",
        "AppClientIDWeb": "*******",
        "HostedUIDomain": "*******",
        "OAuthMetadata": "*******"
      },
      "lastPushTimeStamp": "*******"
    }
  }
}
```

I have spent hours looking for a solution, here are a few links
* https://www.npmjs.com/package/@aws-amplify/ui-components#vue
* https://github.com/aws-amplify/amplify-js/issues/3818
* https://stackoverflow.com/questions/65818865/amplify-federated-buttons-not-showing-up
## Comment

---------------

Author: @countryst

In case someone faces similar issue, you need to add `.prop` for amplify's properties:

`<amplify-authenticator :federated="federatedIds">` has to change to `<amplify-authenticator :federated.prop="federatedIds">`

I had to do the same thing for
```
<amplify-sign-up slot="sign-up" username-alias="email" :form-fields.prop="formFields">
</amplify-sign-up>
```

Reference: https://github.com/aws-amplify/amplify-js/issues/5298#issuecomment-621124576

---------------

---------------

# Is it possible to change the username?

---------------

Author: @DeniferSantiago
Upvotes: 1
Comments: 0

I don't think it is possible to change username when creating amplify userpool by choosing to login with username.
![image](https://user-images.githubusercontent.com/41799285/115755183-12f7f400-a36b-11eb-8604-4e0fa92101fb.png)

As seen in the image the option "Also allow sign in with preferred username (a username that your users can change)" is disabled and there is no way to activate any of these options from amplify cli, it is not clear how I can use the class Auth to change username so maybe it's a problem for amplify-cli and amplify-js.

I will create this as a discussion in amplify-js and as a issue in amplify-cli

---------------

---------------

# How not display notification when app is in foreground

---------------

Author: @kalek
Upvotes: 1
Comments: 0

I'm using lambda function to send push notification with type alert and in ReactNative app I always see notify even app is in foreground mode, How can I don't display notify when app is active ?

---------------

---------------

# How to query a model sort by many to many relation

---------------

Author: @renanbronchart
Upvotes: 1
Comments: 0

Hi everybody, 
I have this schema : 
```

type Brand @model
  @key(name: "ByName", fields: ["name"])
  @searchable
{
  id: ID!
  name: String!
  link: String
  image: String
  bio: String
  votes: [Vote] @connection(keyName: "byBrand", fields: ["id"])
}


type Vote @model
  @key(name: "byUser", fields: ["userID"]) ## BelongsTo User. Index by userId
  @key(name: "byBrand", fields: ["brandID", "userID"], queryField: "voteByBrand")
  @searchable
{
  id: ID!
  userID: String!
  userPhone: String!
  brandID: ID!
  # productTypeID: ID!
  image: String
  comment: String
  # BelongTo User
  user: User! @connection(fields: ["userID"])
  # BelongTo Brand
  brand: Brand! @connection(fields: ["brandID"])
}
```


I want to query all Brand and sort by Brand which have the most votes.

Brand 1 -> 20 votes ; Brand 2 -> 15 votes ; Brand 3 -> 8 votes ; Brand 4 -> 5 votes ; 

On appSync, it seems not possible. Can you help me for that?

---------------

---------------

# Determine Email Address (Gmail) used By Google SignUp/Login

---------------

Author: @windupurnomo
Upvotes: 1
Comments: 0

I have web app using Reactjs that have two method of login: using email-password and Google.

Attempts:

1. User (with email foo@gmail.com) signin/signup by Google
2. User Sign Out
3. User login again by email foo@gmail.com and random password

Normal behavior: In the 3rd attempt, user will get an error UserNotFoundException
Expected response: my web will inform user, that he should login by google
Is there mechanism to check email address availability that used by federated sign in (Google)?

---------------

---------------

# Problems accessing storage from Lambda function

---------------

Author: @ApollonSeven
Upvotes: 1
Comments: 1

## What I want to do?
I want to create REST API that returns data from my DynamoDB table which is being created by GraphQL model.

## What I've done

1. Create GraphQL model
```graphql
type Public @model {
  id: ID!
  name: String!
}
```

2. Create REST API with Lambda Function with access to my `PublicTable`
```sh
$ amplify add api
? Please select from one of the below mentioned services: REST
? Provide a friendly name for your resource to be used as a label for this category in the project: rest
? Provide a path (e.g., /book/{isbn}): /items
? Choose a Lambda source Create a new Lambda function
? Provide an AWS Lambda function name: listPublic
? Choose the runtime that you want to use: NodeJS
? Choose the function template that you want to use: Hello World

Available advanced settings:
- Resource access permissions
- Scheduled recurring invocation
- Lambda layers configuration

? Do you want to configure advanced settings? Yes
? Do you want to access other resources in this project from your Lambda function? Yes
? Select the category storage
? Storage has 8 resources in this project. Select the one you would like your Lambda to access Public:@model(appsync)
? Select the operations you want to permit for Public:@model(appsync) create, read, update, delete

You can access the following resource attributes as environment variables from your Lambda function
        API_MYPROJECT_GRAPHQLAPIIDOUTPUT
        API_MYPROJECT_PUBLICTABLE_ARN
        API_MYPROJECT_PUBLICTABLE_NAME
        ENV
        REGION
? Do you want to invoke this function on a recurring schedule? No
? Do you want to configure Lambda layers for this function? No
? Do you want to edit the local lambda function now? No
Successfully added resource listPublic locally.

Next steps:
Check out sample function code generated in <project-dir>/amplify/backend/function/listPublic/src
"amplify function build" builds all of your functions currently in the project
"amplify mock function <functionName>" runs your function locally
"amplify push" builds all of your local backend resources and provisions them in the cloud
"amplify publish" builds all of your local backend and front-end resources (if you added hosting category) and provisions them in the cloud
Succesfully added the Lambda function locally
? Restrict API access No
? Do you want to add another path? No
Successfully added resource rest locally
```

4. Edit my Lambda function
```javascript
/* Amplify Params - DO NOT EDIT
	API_MYPROJECT_GRAPHQLAPIIDOUTPUT
	API_MYPROJECT_PUBLICTABLE_ARN
	API_MYPROJECT_PUBLICTABLE_NAME
	ENV
	REGION
Amplify Params - DO NOT EDIT */

const AWS = require("aws-sdk");
const region = process.env.REGION

AWS.config.update({ region });

const docClient = new AWS.DynamoDB.DocumentClient();

const params = {
    TableName: "PublicTable"
}

async function listItems(){
    try {
      const data = await docClient.scan(params).promise()
      return data
    } catch (err) {
      return err
    }
}

exports.handler = async (event) => {
    try {
        const data = await listItems()
        return { body: JSON.stringify(data) }
      } catch (err) {
        return { error: err }
    }
};
```

4. Push my updates

```sh
$ amplify push
```
5. Open my REST API endpoint `/items`
```json
{
  "message": "User: arn:aws:sts::829736458236:assumed-role/myprojectLambdaRolef4f571b-dev/listPublic-dev is not authorized to perform: dynamodb:Scan on resource: arn:aws:dynamodb:us-east-1:8297345848236:table/Public-ssrh52tnjvcdrp5h7evy3zdldsd-dev",
  "code": "AccessDeniedException",
  "time": "2021-04-21T21:21:32.778Z",
  "requestId": "JOA5KO3GVS3QG7RQ2V824NGFVV4KQNSO5AEMVJF66Q9ASUAAJG",
  "statusCode": 400,
  "retryable": false,
  "retryDelay": 28.689093010346657
}
```
## Problems

1. What I did wrong?
2. How do I access my table and why I didn't get it when I created it?
3. Why `API_MYPROJECT_PUBLICTABLE_NAME` and other constants are needed?
## Comment

---------------

Author: @ApollonSeven

## Decision
The problem turned out to be either the `NodeJS` version or the `amplify-cli` version. After updating `amplify-cli` and installing the node on the `14.16.0` version, everything worked.
I also changed the name of the table to what Amplify creates for us, although this code did not work before. The code became like this:

```javascript
/* Amplify Params - DO NOT EDIT
	API_MYPROJECT_GRAPHQLAPIIDOUTPUT
	API_MYPROJECT_PUBLICTABLE_ARN
	API_MYPROJECT_PUBLICTABLE_NAME
	ENV
	REGION
Amplify Params - DO NOT EDIT */

const AWS = require("aws-sdk");
const region = process.env.REGION
const tableName = process.env.API_MYPROJECT_PUBLICTABLE_NAME

AWS.config.update({ region });

const docClient = new AWS.DynamoDB.DocumentClient();

const params = {
    TableName: tableName
}

async function listItems(){
    try {
      const data = await docClient.scan(params).promise()
      return data
    } catch (err) {
      return err
    }
}

exports.handler = async (event) => {
    try {
        const data = await listItems()
        return { body: JSON.stringify(data) }
      } catch (err) {
        return { error: err }
    }
};
```

---------------

---------------

# How to initialize Amplify JS from the saved user tokens?

---------------

Author: @Stvad
Upvotes: 1
Comments: 1

### What I want to do

I want to be able to delegate auth state to an additional client application (js extension running within https://roamresearch.com/ app). Where I'd like to use Amplify JS library to call my API's & access S3 storage.

**How I think it should/can work:**
- Configure my appclient refresh token to have a long expiration time. (Maybe create a dedicated app client for this, but that can lead to somewhat awkward UX)
- Give users a JS snippet to run
- That snippet would include the relevant keys (including a long-lasting refresh key)
- An instance of the extension makes use of that snippet, initializes Amplify library and can access my app backend resources.

### The question
My question is how to accomplish the last step in this scenario - that is - how does one go about initializing Amplify current user state from a set of known tokens (vs having it automagically retrieve things from localstorage & such)

One Idea I had is to provide a custom implementation of the [storage](https://docs.amplify.aws/lib/auth/manageusers/q/platform/js#managing-user-attributes) that would return the saved tokens when queried. But that seems like a convoluted/complicated solution. So I was wondering if there is a better way?

### Should I be doing this?
While writing this it occurred to me that maybe I should just embed my amplify app settings into the extension and just let users go through the Auth flow in the context of the extension. Which can probably be an option, but I'd prefer to make the flow described above work first if it's possible :) 
## Comment

---------------

Author: @ET-CS

+1

@Stvad Did you found how to authenticate to Amplify using token?

---------------

---------------

# Is it possible to add a 'show password' button to reveal the password in plain text?

---------------

Author: @vomc
Upvotes: 1
Comments: 0

We want to provide our users a way to see the password that they are typing when they sign up. Our app uses the React Amplify Cognito components. Searching the docs I was not able to find anything related to this. 

Is there any documentation (or links) available that someone could point me to in terms of how we could implement this. Essentially it would be a little button as commonly found in many websites where a user can see the password in plain text as they are typing it.

Thank you!

---------------

---------------

# Client State Management for Amplify AppSync WebApp

---------------

Author: @SaileshKumar
Upvotes: 1
Comments: 0

Hi all,

I have built an app using Amplify/AppSync/Cognito  for React JS. I'm looking to add a library that can handle state management. Specific use cases would be something like:

If on the same page, I have a list of objects queried from graphql, and then I click a button that adds an object to that same list via a mutation, I want to see the object without having to refresh the page. I know I can do it manually, but when I worked with React last I used Relay and it took care of this caching and management automatically.

Is there anything like this I can use? I was reading about Apollo too, but it doesn't look like it plays well with AppSync. If I want to scale this project is AppSync even the right way to go, or should I switch off to a better management service while it's not too heavy?

---------------

---------------

# Looking for help on AWS AppSync GraphQL Schema design

---------------

Author: @SaileshKumar
Upvotes: 1
Comments: 0

Hi! I'm trying to uplevel my AppSync skills with Schema design, and am having issues with this model I want to create.

I'm building a basic twitch clone for fun, but am having trouble with the user privacy of streamers vs users. I want to do something like this where any user can watch and subscribe to streams, but only streamers can have profiles, and be publicly scrollable. 

Currently I have something like this:

type User @model {
  id: ID!
  name: String!
  last_name: String!
  profile_picture: String
  subscribed_streams: [Stream] @connection
  streamer_info: TeacherInfo
  streams: [Streams] @connection(keyName: "byStreamer", fields: ["id"])
}

type StreamerInfo {
  instagram_url: String
  bio: String
}

type Stream @model @key(name: "byStreamer", fields: ["streamerID"]) {
  id: ID!
  title: String!
  teacherID: ID!
  description: String!
  streamer: User @connection(fields: ["streamerID"]) 
}

I wanted to have a separate type for "Streamer", so that only Streamers would be publicly accessible, and only Streamers could have the @connection for streams (as in their OWN streams), but I couldn't figure out how to do that without making it its own model with its own ID. I want only Streamers to be able to create Streams, but also be able to watch streams as normal users. I also want public users (not logged in) to be able to execute a query for all Streamers, but NOT for all Users.

Is there a way to have Streamers still be Users, but with "elevated" privileges? That way I could use Cognito User Groups to elevate users to "Streamer" when they are that status.

Thank you in advance!


---------------

---------------

# Amplify not working after upgrade from 3.3.14 to 3.3.27

---------------

Author: @aj120426394
Upvotes: 1
Comments: 0

We try to upgrade the version of `aws-amplify` then the Auth seems not working. 

Our current setup use Cognito user poll for auth role and IAM for unauth role. Everything is working at `amplify: 3.3.14`

After the audit result says there is a high risk vulnerability at `3.3.14`. We ran `npm audit fix` and it upgrade `amplify` to `3.3.27` which is the latest version. Then all the graphql connection is not working. We have tried only upgrade `amplfy` to `3.3.27` without using `npm audit fix`, and it still not working.

We do have the below code at `index.ts`
```
import Amplify, { Auth } from 'aws-amplify'
import awsconfig from './aws-exports'

Amplify.configure(awsconfig)
```
Few error message we can see at Query:
```
18:11.837 GraphQLAPI - ensure credentials error No Cognito Identity pool provided for unauthenticated access
GraphQLAPI.ts:138 Uncaught (in promise) Error: No credentials
    at GraphQLAPIClass.<anonymous> (GraphQLAPI.ts:138)
    at step (v4.js:29)
    at Object.next (v4.js:29)
    at fulfilled (v4.js:29)
```
at Subscribe:
```
Subscribe only available for AWS AppSync endpoint
```

Already stuck on this for a while, any idea?

---------------

---------------

# Auth with vanilla js - How?

---------------

Author: @Pazago
Upvotes: 1
Comments: 0

Hi everyone,

currently I want to setup a website with vanilla js and later on with some bootstrap. But I'm not able to SignUp/SignIn a user over Cognito. I tried it multible time from scratch with the offical documentation (https://docs.amplify.aws/lib/auth/getting-started/q/platform/js). But I'm always getting different kinds on errors:

- ![grafik](https://user-images.githubusercontent.com/32204316/115120511-293e3280-9fae-11eb-84bb-5733d88d0350.png)

-![grafik](https://user-images.githubusercontent.com/32204316/115120520-378c4e80-9fae-11eb-9282-fbe253609e0b.png)

Those are the most common once depending wether I make the src import with "module" or without.

Here is the code for the login.html:

<!-- === Login form === -->
        <section class="form-wrap">
          <h1>Sign In</h1>
          <form id="signinForm" onSubmit="return signIn()">
            <input type="username" id="usernameInputSignin" placeholder="username" required>
            <input type="password" id="passwordInputSignin" placeholder="Password" pattern=".*" required>
        
            <input type="submit" value="SignIn">
        
          </form>
        </section>
               
        
        <!-- === SignUp form === -->
        <section class="form-wrap">
          <h1>Sign Up</h1>
          <form action="javascript:signUp()" id="signupForm">
            <input type="username" id="usernameInputSignup" placeholder="username" required>
            <input type="password" id="passwordInputSignup" placeholder="Password" pattern=".*" required>
        
            <input type="submit" value="SignUp">
        
          </form>
        </section>

    <script src="dist/main.bundle.js"></script>
    <script src="src/app.js"></script>


Here is the relevant code from the app.js:
import Amplify, { API, graphqlOperation, Auth } from "aws-amplify";

 import awsconfig from "./aws-exports";
 import { createTodo } from "./graphql/mutations";
 import { listTodos } from "./graphql/queries";
 import { onCreateTodo } from "./graphql/subscriptions";

 Amplify.configure(awsconfig);

export async function signUp() {
    try {
        const { user } = await Auth.signUp({
            username,
            password,
            attributes: {
                email,          // optional
                phone_number,   // optional - E.164 number convention
                // other custom attributes 
            }
        });
        console.log(user);
    } catch (error) {
        console.log('error signing up:', error);
    }
} 
 
 async function signIn() {
    try {
        const user = await Auth.signIn(username, password);
    } catch (error) {
        console.log('error signing in', error);
    }
}
 
 async function signOut() {
    try {
        await Auth.signOut();
    } catch (error) {
        console.log('error signing out: ', error);
    }
}

If you need anything else don't hesitate to ask. Can also share my testing file but I think it will be to much input for the start.
Thanks a lot in advance
~paz

---------------

---------------

# amplify-confirm-sign-up don't show up toast (angular)?

---------------

Author: @franklt69
Upvotes: 1
Comments: 1

Hi, I have this code in the sign-up process, but the toast does not appear when validation fails. Could someone give me a hint on how to show the toast when an error occurs?

```
 onSignUpSubmit =  async event => {
        event.preventDefault();
        try {
            const formData = {
                username: this.userEmail,
                password: this.userPassword,
                attributes: {
                    profile: this.globalService.issuer,
                    phone_number: this.userPhoneNumber ? this.userDialCode + this.userPhoneNumber : null
                }
            }
            const data = await Auth.signUp(formData);
           
            Hub.dispatch(UI_AUTH_CHANNEL, {
                event: AUTH_STATE_CHANGE_EVENT,
                message: AuthState.ConfirmSignUp,
                data: {
                    ...data.user,
                    signUpAttrs: formData
                }
            });
        }
        catch (e) {
            console.log(e); //==>  **Here I need to show up the error in the amplify toast (like default behavior), but I don't find documentation about it.**
        }
    }
```

Thanks
Frank
## Comment

---------------

Author: @franklt69

Thanks,  Looking in the source code of amplify I found this solution.

```
 onSignUpSubmit =  async event => {
        event.preventDefault();
        try {
            const formData = {
                username: this.userEmail,
                password: this.userPassword,
                attributes: {
                    profile: this.globalService.issuer,
                    phone_number: this.userPhoneNumber ? this.userDialCode + this.userPhoneNumber : null
                }
            }
            const data = await Auth.signUp(formData);

            Hub.dispatch(UI_AUTH_CHANNEL, {
                event: AUTH_STATE_CHANGE_EVENT,
                message: AuthState.ConfirmSignUp,
                data: {
                    ...data.user,
                    signUpAttrs: formData
                }
            });
        }
        catch (error) {
            Hub.dispatch(UI_AUTH_CHANNEL, {
                event: TOAST_AUTH_ERROR_EVENT,
                message: error.message,
            });
        }
    }
```

Thanks
Frank

---------------

---------------

# Use custom components to navigate Cognito UI

---------------

Author: @flo-mair
Upvotes: 1
Comments: 0

I want to use custom React Components within <AmplifyAuthenticator> (replacing SignIn and SignUp). How do i navigate between the slots, when i set AuthState the UI does not change.

```import {AmplifyAuthenticator, AmplifySignIn,} from "@aws-amplify/ui-react";
import React, {useState} from "react";
import { AuthState } from '@aws-amplify/ui-components';


const Login = () =>{

    const [authState, setAuthState] = React.useState();

    const moveToSignUp = (e) => {
        e.preventDefault()
        setAuthState(AuthState.SignUp)
    }

    return (
        <AmplifyAuthenticator>
            <div slot="sign-in"><button onClick={ e => moveToSignUp(e)} >Move to signUp</button></div>
            <div slot="sign-up">Test SignUp</div>
        </AmplifyAuthenticator>
    );
}

export default Login```

---------------

---------------

# Running NextJS with Amplify

---------------

Author: @Mortuie
Upvotes: 3
Comments: 0

Current Setup:
- Client Side Rendering with Create React App
- ReactJS
- Hooks 
- Redux
- AWS Serverless / Amplify / AppSync / Cognito Pools

Obviously client side rendering is much nicer but I have now encountered a use case, where good/dynamic SEO is required for the next phase of development for our product.

Thus I have started doing some experimentation with Nextjs and Amplify (which is my backend stack) and now I have encountered some questions:
- For every new page I render let's say /profile -> There are three use cases (the persons own profile needs to be able to edit - one case), someone else's a profile (whether or not your logged in - so 2 different cases)
- Per request to this `/profile` page do I need to 
```javascript
export async function getServerSideProps({ req }) {
  const SSR = withSSRContext({ req });

  let user = await SSR.Auth.currentAuthenticatedUser();
  user = user.signInUserSession.idToken.payload["cognito:username"];
```

Just to get the user info i.e. cognitoid then if I want to get the details for that specific user I would have to send another request to the server with `getUserProfile(cognitoid)`

Q1: Does the userid/cognito id not get stored in a cookie/parameter as part of `getServerSideProps(req)` this just adds so much overhead to each new page load that I would assume that it is really slow as you end up doing many more requests that required (in this example 2 instead of 1).


Q2: Does anyone have experience running Auth.federatedSignIn with Nextjs.
As this redirects to facebook/google within the page and the Listener.hub module is used to listen for successful/non successful auth.

What is a common pattern of setting that up with SSR as I assume it is going to be different to the CSR usecase?
 

---------------

---------------

# Where i can get default directives SDL? My IDE show error @model directive not exists

---------------

Author: @MaxmaxmaximusAWS
Upvotes: 1
Comments: 1

![image](https://user-images.githubusercontent.com/69426460/113976277-8ff27c00-9849-11eb-939a-29845fae773b.png)

![image](https://user-images.githubusercontent.com/69426460/113976249-80733300-9849-11eb-8860-4e4a6f578e07.png)
## Comment

---------------

Author: @MaxmaxmaximusAWS

Answe, in this page https://docs.amplify.aws/cli/graphql-transformer/directives we can click any directive and get definition.

---------------

---------------

# refreshHandlers for react native

---------------

Author: @ionutmiftode
Upvotes: 1
Comments: 0

Hello community,

Does someone have an example of refreshHandlers functions for a react-native app for Google, Facebook and Apple sign in?

---------------

---------------

# How can I upload large video file to S3 using amplify?

---------------

Author: @midohree
Upvotes: 2
Comments: 0

I am trying to upload a video to s3 using amplify in Reactjs.
Uploading small files is okay. (The test file size is 1.4MB)
But I want to upload a large size video. (About 60MB to 1GB).
But at the end of the file upload, an upload failure and an two error messages popped up.
I searched the official documentation, but there is no answer to this.
Can you give me a solution? 
Are there any more options I need to add?

```
[ERROR] 54:32.190 axios-http-handler Error: Request failed with status code 400

[ERROR] 54:32.195 AWSS3ProviderManagedUpload - error happened while finishing the upload. Cancelling the multipart upload Error: Request failed with status code 400
```

```javascript
import React, { useEffect, useState } from "react";
import { useDropzone } from "react-dropzone";
import Amplify, { Storage } from "aws-amplify";
import awsExports from "./aws-exports";

Amplify.configure(awsExports);

const App = () => {
  const [imageUrl, setImageUrl] = useState(null);
  const [isLoading, setLoading] = useState(false);
  const [file, setFile] = useState(null);

  const {
    getRootProps,
    getInputProps,
    isDragAccept,
    isDragActive,
    isDragReject,
  } = useDropzone({
    accept: "video/*",
    onDrop: (files) => {
      console.log(files)
      setFile(files[0]);
    },
  });

  useEffect(() => {
    if (file) {
    (async function () {
      try {
        setLoading(true);

        await Storage.put(file.name, file, {
          contentType: file.type,
          progressCallback(progress) {
            console.log(`Uploaded: ${progress.loaded}/${progress.total}`);
          },
        });

        const url = await Storage.get(file.name);

        setImageUrl(url);
        setLoading(false);
      } catch (err) {
        console.log(err);
      }
    })();
  }
  }, [file]);

  return (
    <div className="App">
      <h1> Upload an Image </h1>
      {isLoading ? (
        <h3>Uploading...</h3>
      ) : (
        <Container
          {...getRootProps({ isDragAccept, isDragActive, isDragReject })}
        >
          <input {...getInputProps()} />
          <p>Drag 'n' drop some files here, or click to select files</p>
        </Container>
      )}
      <div>
        {imageUrl ? (
          <img style={{ width: "30rem" }} src={imageUrl} alt="preview" />
        ) : (
          <span />
        )}
      </div>
    </div>
  );
};

export default App;

```

---------------

---------------

# Angular - Interceptor not workign with Amplify

---------------

Author: @Max161
Upvotes: 1
Comments: 0

Dear all, 

currently, I'm trying to use Cognito authentication with my web app. 
I have integrated the amplify correctly in my web app and I'm able to use the sign-up, sign-in and all the other functions in my web app. 
However, I have a spinner interceptor that is showing a loading bar while any of the HTTP requests are ongoing, but it's not intercepting any of the Amplify requests. 

Do you have any idea why it's not working?  All the other requests are correctly intercepted. 
 

---------------

---------------

# Can we add scope in ID token from pre generation lamda script?

---------------

Author: @shyamsohane
Upvotes: 1
Comments: 0

Can we add Scope in ID token from pre generation lamda script? Has anyone modified it?

---------------

---------------

# Auth | Hub | Federated signUp event

---------------

Author: @shaharkazaz
Upvotes: 2
Comments: 0

Hey,

I need to know when a user uses a provider (google in my case) to perform sign-up/log-in what action took place.
I tried listening to the Hub events but looking at [the source code](https://github.com/aws-amplify/amplify-js/blob/df95ea3724eb6406f64b03f25086cd3e8644cb5f/packages/auth/src/Auth.ts#L2064) looks like the federated response handler only emits `signIn` events and doesn't distinguish between log-in and sign-up.

I have seen in several places a suggestion to use the lambda trigger and in fact, we are using them, but the UI needs to redirect to one place in the case of `signIn` and to another in case of `signUp` and as far as I could see there is no way I can pass parameters from the triggers back to the client.

Any way I can achieve that using Cognito? maybe pass some custom response from the lambda trigger? or any other option? or do I have to implement something myself? 

I **really** need help on this one 🙏 

Thanks in advance for any response!

---------------

---------------

# Custom attributes for IAM role policy

---------------

Author: @agoldis
Upvotes: 1
Comments: 0

There're plenty of AWS source describing the use of custom attributes for role polices. 

That seems to be working only for 3rd part auth providers, but not with Cognito User Pool custom attributes.

Event though they are customizable in Cognito Identity Pool console:

<img width="1198" alt="Screen Shot 2021-04-02 at 12 57 14 AM" src="https://user-images.githubusercontent.com/1637928/113395383-9c10a200-934e-11eb-84ce-f9c38802e47a.png">


I am trying to use `${aws:PrincipalTag/orgId}` in a policy without any success.

```json
...

            "Condition": {
                "StringLike": {
                    "s3:prefix": [
                        "${cognito-identity.amazonaws.com:sub}/*",
                        "${aws:PrincipalTag/orgId}/*",
                    ]
                }
            }
```

- Is it actually available? 
- How can I troubleshot access to S3 and / or see the principal tags issues by STS? 

Reference: https://docs.aws.amazon.com/cognito/latest/developerguide/using-attributes-for-access-control-policy-example.html

---------------

---------------

# pubsub clean session and QoS

---------------

Author: @shahbour
Upvotes: 1
Comments: 0

Hello 

I am trying to use amplify pubsub to connect to aws iot , but i need to set clean_session= false , to persist the messages and also i need to set the qos of messages to at least 1 .

Any idea how we can do this using amplify library .


---------------

---------------

# Attempt limit exceeded, please try after some time.

---------------

Author: @gruckionvit
Upvotes: 1
Comments: 0

When writing code and littering on a feature I am getting blocked by `LimitExceededException` which is slowing down my development effort. I have to park that task go to something else and come back to it later and hope I get it solved without submitting as much next time.

This isn't ideal, is there a way to extend this limit for staging environments?

---------------

---------------

# DataStore query a model with predicates 'contains'...

---------------

Author: @myfairshare
Upvotes: 1
Comments: 0

Hello,

    I have a model called Tenancy that looks like..

type Tenancy @model {
  id: ID!
 invitedEmails: [String]
}

So lets say I want to find the instance with 'jim@gmail.com' is in invitedEmails

My understanding is I can search DataStore using the 'contains' predicate like below..

```
const inviteCheck = await DataStore.query(Tenancy, (t) =>
        t.invitedEmails('contains', 'jim@gmail.com')
      )
      console.log(inviteCheck)
```
I expect to receive back an array of 1 object because it found this email address in one instance.

By data is synching to dynamodb and local database...

But I get the error..

TypeError: Cannot read property 'indexOf' of null
    at validatePredicateField (util.ts:103)
    at util.ts:65
    at Array.every (<anonymous>)
    at validatePredicate (util.ts:60)
    at IndexedDBAdapter.ts:404
    at Array.filter (<anonymous>)
    at IndexedDBAdapter.<anonymous> (IndexedDBAdapter.ts:403)
    at step (InMemoryStore.ts:41)
    at Object.next (InMemoryStore.ts:41)
    at fulfilled (InMemoryStore.ts:41)

Am I making a silly mistake or misunderstanding something, thanks for any tips!

---------------

---------------

# Code splitting wih Amplify

---------------

Author: @sakihayashi
Upvotes: 1
Comments: 0

Hi everyone,
I have an app using React and MongoDB SDK.
I use Amplify only hosting the app so do not use any SDK for auth. I use SSR with Amplify.

But, my lighthouse speed score is 3 out of 100 although it does not look that bad. The first contentful paint takes more than 8 secs for mobile.

The biggest issue is chunk.js is like over 800kb on every page and I tried to reduce it by using the lodable-component.
But it does not really work. 

Does anyone have experience in reducing the size?

---------------

---------------

# Module not found: Can't resolve '../src/aws-exports'

---------------

Author: @j4nos
Upvotes: 1
Comments: 1

Do I need to run `amplify configure` to be able to support SSR in my Next.js Amplify app? 

Or how can I avoid this error? I would run Next.js with SSR support. Do I really need IAM to run my app?

```
Module not found: Can't resolve '../src/aws-exports'
```
## Comment

---------------

Author: @sammartinez

Hello, @j4nos. You are correct that you will need to run the above command `amplify configure` in order to use SSR with Next.js

---------------

---------------

# Access Denied or Too Many Redirects when trying to open a page in a new tab using React Link

---------------

Author: @sbganesh
Upvotes: 1
Comments: 0

Hi All,

I'm developing a React application hosted in Amplify platform. I wanted to have a page opened in a separate tab, so I used 

"<Link to={`/newPage/${rowData.id}`} target="_blank">", 

I have the rewrite configured and without target "blank" it works well by opening the page in the same window. When I use the "blank" option I'm getting too many redirects, removing the rewrite is giving the access denied issue. 

Kindly let me know how I can open a page in a new tab for the react application hosted in Amplify. 

---------------

---------------

# Admin UI login credentials

---------------

Author: @MachariaK
Upvotes: 1
Comments: 0

Which credentials should I use to log in to the Admin UI? The console and other user credentials do not work.

---------------

---------------

# How to set the active state

---------------

Author: @SanderKnape
Upvotes: 1
Comments: 0

I can't figure out how to set the active state that Amplify should show. For example, when my users navigate to `/signup` they should see the SignUp page. Right now the only way I'm able to view this page is by clicking the "Sign up" link on the Sign in page.

How do I associate a page/URL with an active state? The same goes for states like forgotpassword, settingMFA and others.

---------------

---------------

# Handling grant code in Authorization Code Grant + PKCE in JS API? (infinite redirects)

---------------

Author: @rally25rs
Upvotes: 1
Comments: 1

Trying to use the Cognito hosted UI in an oauth2 "Authorization Code Grant + PKCE" manor (with react and react-router).

It seems that calling `Auth.federatedSignIn()` ends up redirecting the browser to `{redirectSignIn}?code=...`

In other words, if you made a react view (and assume this is part of the `localhost:3000/` view)

```
import React from 'react';
import Amplify, {Auth} from 'aws-amplify';

export default function LoginTest() {
  const signin = React.useCallback(async () => {
    const response = await Auth.federatedSignIn();
  }, []);

  React.useEffect(() => {
    Amplify.configure({
      aws_project_region: 'us-east-2',
      aws_cognito_identity_pool_id: 'us-east-2:...',
      aws_cognito_region: 'us-east-2',
      aws_user_pools_id: '...',
      aws_user_pools_web_client_id: '...',
      Auth: {
        oauth: {
          redirectSignIn: 'http://localhost:3000/',
          redirectSignOut: 'http://localhost:3000/',
          scope: ['email', 'profile', 'openid'],
          domain: '....us-east-2.amazoncognito.com,
          responseType: 'code',
        },
      },
    });

    signin();
  }, []);

  return (
    <div>
      <h1>Test</h1>
    </div>
  );
}
```

it just infinite refresh loops hosted cognito ui => `localhost:3000/?code=...` => hosted cognito ui => `localhost:3000/?code=...` => ...etc

#3005 makes it sound like the "Authorization Code Grant + PKCE" cycle of validating the `code` should be handled magically somehow. 🤔 I'm not sure if it's my fault, or an Amplify issue, or a variation of issue #3391 , or what.

Any advice would be greatly appreciated.

(aws-amplify v3.3.25)

-----

_Edit 1:_

Made some progress by making sure my app does not re-invoke `federatedSignIn` if there is a `code=` on my URL (oops).

Now Amplify seems to make a `POST  https://cognito-identity.us-east-2.amazonaws.com/` passing an `IdentityId` and `Logins` which ends up returning

> Invalid identity pool configuration. Check assigned IAM roles for this pool.

The docs around any of this are real vague but I was under the impression that Amplify `federatedSignIn` would attempt an "Authorization Code Grant" login flow, which I expected to just taken the `code` off the URL and then called `POST https://....amazoncognito.com/oauth2/token?code=...&...` 
i.e. exchange the auth code using the oauth2 token endpoint https://docs.aws.amazon.com/cognito/latest/developerguide/token-endpoint.html

Is there a way to make it just do that instead of ... whatever this `https://cognito-identity.us-east-2.amazonaws.com` thing is?

-----

_Edit 2:_

OK so I had copy/pasted config settings from another post, and defining `aws_cognito_identity_pool_id` in the config makes it try to POST to `https://cognito-identity.us-east-2.amazonaws.com` (to the identity pool) instead of POST to the expected `oauth2/token` endpoint (to the user pool).

Phwew. Crisis averted. Maybe this will help someone else in the future 🤷 
## Comment

---------------

Author: @rally25rs

_Posting my own solution so that I can mark this as "answered"..._

Calling `await Auth.currentSession();` got me the result of the decoded token from the auth flow which I could then use to decide whether or not to call `federatedSignIn()`

Originally I was trying to call `currentCredentials()` which was getting an Identity Pool error. I guess that call is only if you are using id pools.

```
import {React} from '@vht/react-components/libs';
import Amplify, {Auth} from 'aws-amplify';

export default function LoginTest() {
  const [claims, setClaims] = React.useState();

  const signin = React.useCallback(async () => {
    const currentSession = await Auth.currentSession();
    if (currentSession) {
      setClaims(currentSession.getIdToken().decodePayload());
    } else {
      await Auth.federatedSignIn();
    }
  }, []);

  React.useEffect(() => {
    Amplify.configure({
      aws_project_region: 'us-east-2',
      aws_cognito_region: 'us-east-2',
      aws_user_pools_id: 'us-east-2_...',
      aws_user_pools_web_client_id: '...,
      Auth: {
        oauth: {
          redirectSignIn: `${window.location.origin}/`,
          redirectSignOut: `${window.location.origin}/`,
          scope: ['email', 'profile', 'openid'],
          domain: '...',
          responseType: 'code',
        },
      },
    });

    signin();
  }, []);

  return (
    <div>
      <h1>Test</h1>
      {claims && (
        <code>
          <pre>{JSON.stringify(claims, null, 2)}</pre>
        </code>
      )}
    </div>
  );
}
```

---------------

---------------

# Dynamic Group Authorization - best way for Dashboard SAAS Accounts?

---------------

Author: @davidbiller
Upvotes: 2
Comments: 0

https://docs.amplify.aws/cli/graphql-transformer/auth#dynamic-group-authorization


I have a dashboard where partners can log in. Here they can see users who have signed up through their link on the platform. 

So that not only one user can see this, but several users of the partner, I wanted to use the groups @auth option. 

So I would create a separate group in Cognito for each partner. Then, when the partner invites their employees, I would assign the accounts to the group. 

Now I have seen that there is a maximum of 10k groups. It will be a long time before we get to that amount of partners, but is that the way to go? 




---------------

---------------

# Parameter Store from Lambda

---------------

Author: @gyurobenjamin
Upvotes: 1
Comments: 1

Trying to use SM Parameter Store, but with amplify this would be a custom resource.

I have a lambda function inside the amplify that needs to access a manually configured Parameter Store.
Can anyone tell me what is the right was to setup the roles? Could this IAM config be in amplify codebase?

Thanks in advance!
## Comment

---------------

Author: @jncheung

It depends on how do you want the lambda to get value from the SSM.

One of the ways that I did is to edit the cloudformation-template.json and reference the SSM parameters dynamically using this syntax: `{{resolve:ssm:<your-ssm-nameor-its-path>:<version>}}` 


For example, if I have a SSM parameter named `/a/b/c/d/e` and i wish to using the third version of it to be the lambda environment variable.  I can do it in this way:

```javascript
{ 
 ... //in your lambda-fns-cloudformation-template.json
   "Environment": {
        "Variables": {
            "ABDCEFG":  "{{resolve:ssm:/a/b/c/d/e/f/g:3}}",
        }
    }
    ...
}
```

In this way, you do not require to set any IAM or anything as long as both amplify and SSM are set with in the same account and same region.

---------------

---------------

# Is Cognito / AWS forum actively managed?

---------------

Author: @Jun711
Upvotes: 1
Comments: 1

Hi, 

I know some issues are caused by Cognito but not Amplify but a lot of posts in Cognito forum get no replies / answers after months or years. 

Should we post Amplify and Cognito related questions here as well? 
## Comment

---------------

Author: @undefobj

For official tracking by the Cognito team please post service related questions in the AWS Cognito forum. This repo is for Amplify library questions.

---------------

---------------

# next.js | Requests from server-side are many times slower than from the client-side

---------------

Author: @marco-streng
Upvotes: 2
Comments: 0

Currently I'm developing an app which uses AWS Cognito for authentication and AWS AppSync as a GraphQL server.

I like to protect routes on the server side, so I implement a quite simple call to AWS Cognito using the Amplify package (like shown in the AWS tutorials)


```javascript
import { withSSRContext } from 'aws-amplify'

export async function getServerSideProps ({ req }) {
  const { Auth } = withSSRContext({ req })

  try {
    const user = await Auth.currentAuthenticatedUser()

    return {
      props: {
        authenticated: true,
        user: user.username
      }
    }
  } catch (err) {
    return {
      redirect: {
        destination: '/login'
      }
    }
  }
}
```



**The Problem**

I've deployed the app to Vercel (production mode) and wondered about the slow performance (high FCP). After some research I found out, that this request takes about **400-500ms** on server-side.
But the same request done on the client-side run's in less than **15ms**.

The same difference appears when I want to fetch data from the AppSync endpoint (ServerSide: ~**900ms**, ClientSide: ~**150ms**)

At first I thought on a geographical distance Issue. But my AWS recources are all deployed in eu-central-1 (Frankfurt, Germany) and the Vercel functions in eu-west-3 (Paris, France). In other words: There is no atlantic ocean in between.

The duration is measured by comparing the unix timestamp right before and after the request runs.

Maybe someone has got an idea or made a similar experience?
Thanks a lot!


---------------

---------------

# error 304 - incompleteSignatureException when passing Cognito headers to Amplify Rest Api

---------------

Author: @ZalgirisKaunas
Upvotes: 1
Comments: 0

I really need to access the user group names of the user pool in the rest API lambda functions but I'm not sure how to do that. I've tried to pass the JWT token in the authorization header like that:

```
const user = await Auth.currentAuthenticatedUser();
const token = user.signInUserSession.idToken.jwtToken;

const result = await API.get(data.apiName, data.dbPath, {
  headers: {
    Authorization: token,
  },
});
```

but it returned incompleteSignatureException from cloudfront. 

I've also tried

```
      headers: { 
        Authorization: `Bearer ${(await Auth.currentSession()).getIdToken().getJwtToken()}`,
      },
```

and without  `Bearer ` but error is always the same. 
It is also interesting that passing the authorization header to Admin Queries API works fine and it's possible to get group names from the request context in there.

---------------

---------------

# SSR: ReferenceError: window is not defined

---------------

Author: @kristianjabilles-ms
Upvotes: 2
Comments: 0

I am posting it here first as we are not sure if this is a bug or we might just be missing something in our approach.

### SSR: ReferenceError: window is not defined

```
ReferenceError: window is not defined
    at UniversalStorage.setUniversalItem (/node_modules/@aws-amplify/core/lib/UniversalStorage/index.js:88:21)
    at UniversalStorage.setItem (/node_modules/@aws-amplify/core/lib/UniversalStorage/index.js:69:22)
    at CognitoUser.cacheTokens (/node_modules/amazon-cognito-identity-js/lib/CognitoUser.js:1412:18)
    at /node_modules/amazon-cognito-identity-js/lib/CognitoUser.js:1391:17
    at /node_modules/amazon-cognito-identity-js/lib/Client.js:127:31
```

We have created a wrapper library for `aws-amplify` that can be used within multiple applications.
- We have an `identity provider application` that  that let the user logs in and 
- Redirects them to the `dashboard application`.
- The session is shared across the applications that is using the wrapper library, one of that application is a server side rendered product listing app that shows the users info in the header.

The issue occurs when the `refresh token` is triggered and attempts to update the `tokens` which are in the cookie.


### Steps to reproduce the behavior:

1. Login
2. Visit the SSR listing app (The token is still valid in this moment, so we can still see the logged in user's info in the header)
3. Close the SSR listing app and wait for the token expriy (In our case it is 1 hr)
4. Visit the SSR listing app again (This is the stage that the error is thrown)


Is anyone experiencing the same issue like this?

---------------

---------------

# DataStore NotAuthorizedException

---------------

Author: @kannieWeesNie
Upvotes: 2
Comments: 0

In an amplify project (using Vue) I have auth and dataStore api installed. I have set up the api to use an api key for authentication and the auth category to allow users to sign in to my app.

I do not have @auth in my data models but when I try and sync the datastore when not logged in, I get "Unauthenticated access is not supported for this identity pool". Why is this and what do I need to do to make sync work for unauthenticated users?

much appreciated

---------------

---------------

# Amplify to S3 "Uncaught (in promise) No credentials"

---------------

Author: @ncyaodi
Upvotes: 1
Comments: 0

Hi,

I am connecting Amplify to S3 using unauthenticated access.

I pretty much follow [the procedure here](https://aws.amazon.com/blogs/mobile/use-an-existing-s3-bucket-for-your-amplify-project/),  the difference is I built it for my own website by static generation. (using Next.js)

I am getting warnings and errors 

![image](https://user-images.githubusercontent.com/12124635/110231297-c300c300-7ecb-11eb-8c02-348e99fc2e1c.png)

Could you suggest how I can tackle this issue?

Thanks,

---------------

---------------

# How to find out the automatically assigned ID of an object created by a datastore.save operation

---------------

Author: @Ama-dou
Upvotes: 1
Comments: 0

Am working on a react app and i have table name user with some informations
I have form and when the user filled the form it creates a new model in my table.
But i want to check if the user existe and update the existinf user else create a new one.
) I have no idea how to get the ID. I can see that an ID is generated by Amplify (looks to be a UUID or similar), but when I do use DataStore.save, there's no response as far as I can tell that says 'here's a value' that I can use to query for the item in the future using this query in the docs:
`const original = await DataStore.query(Post, "123");

await DataStore.save(
  Post.copyOf(original, updated => {
    updated.title = `title ${Date.now()}`;
    updated.status =
      updated.status === PostStatus.ACTIVE
        ? PostStatus.INACTIVE
        : PostStatus.ACTIVE;
  })
);`
In this code block from the docs, you have "123" on the first line, which is the ID? And that's where I'm stuck.


this is my submit function

`  handleSubmit = async () => {
    const CURRENT_USER = await DataStore.query(User, Predicates.ALL);

    await DataStore.save(
      User.copyOf(CURRENT_USER, user => {
        user.nom = this.state.nom;
        user.discipline = this.state.discipline;
        user.date_de_creation = this.state.date_de_creation;
        user.Statut_juridique_du_club = this.state.Statut_juridique_du_club;
        user.budget = this.state.budget;
        user.part_allouee_a_la_formation = this.state.part_allouee_a_la_formation;
        user.nb_total_salarie = this.state.nb_total_salarie;
      })
    );
}
   `

this is my shema

`
type User @model @auth(rules: [{allow: public}]) {
  id: ID!
  nom: String!
  discipline: String
  date_de_creation: String
  Statut_juridique_du_club: String
  budget: String
  part_allouee_a_la_formation: String
  nb_total_salarie: String
}
`

---------------

---------------

# After verifyTotpToken - using setPreferredMFA will lead to NotAuthorizedException in all actions afterwards

---------------

Author: @doron-mil
Upvotes: 1
Comments: 0

I have an application that is using totp setup.
All is working except for the initial sign-in with totp setup.
If the user logout and re-login everything is working as well.

The problem arrises only on the first sign in.
I have the code :
`Auth.verifyTotpToken(user,  totp).then(() => {`
         ` Auth.setPreferredMFA(user, 'TOTP')`
`....`
`});`

Every action that I'm doing afterwards using Auth will result in NotAuthorizedException.
The Amplify Hub doesn't indicate sign-out, but it does indicate tokenRefresh_failure events.

I've tried to not use the setPreferredMFA, because the MFA is already set as needed (checked) - but then, if the user tries something like Auth.updateUserAttributes, the same problem arises and user is cut from possible way to retain Auth.currentAuthenticatedUser()

Does anyone know where is all this coming from ? Maybe a configuration problem in AWS ?

---------------

---------------

# How to utilize Analytics.record for CLI created Kinesis Stream?

---------------

Author: @casendler
Upvotes: 1
Comments: 0

I am currently using Pinpoint for in app analytics for my project. However, I recently added a kinesis stream for my project using the Amplify CLI. Looking through the [docs](https://docs.amplify.aws/lib/analytics/getting-started/q/platform/js) and [API reference](https://aws-amplify.github.io/amplify-js/api/classes/analyticsclass.html) the Analytics category only seems to deal with Pinpoint? I there currently a way to use the `Analytics.record()` method to send data to a stream from the client? 

I saw in the [legacy docs](https://haverchuck.github.io/docs/js/analytics#using-amazon-kinesis) (?) that this used to be achieved via pluggable? 

Thanks!

---------------

---------------

# Get/Update GraphQL request from Lambda not working

---------------

Author: @Neuroforge
Upvotes: 1
Comments: 2

Hello,

I am using https://docs.amplify.aws/guides/functions/graphql-from-lambda/q/platform/ios as a guide on how to call GraphQL from a lambda. And it seems to work great for List Queries and Create Mutations. It does not seem to work from GetQuery and UpdateMutations

However, when i tried to use UpdateDirectory and GetDirectory I get the following error. It appears to be the same error for both the operations. I am using the graphQL queries generated by Amplify from client side model declarations.

Here is my generic method that works fine for CreateMutations but not UpdateMutations GetQueries operations...

`const executeAppSyncQuery = async (operationName, query, item) => {
    const req = new AWS.HttpRequest(appsyncUrl, region);

    req.method = 'POST';
    req.path = '/graphql';
    req.headers.host = endpoint;
    req.headers['Content-Type'] = 'application/json';

    req.body = JSON.stringify({
        query: query,
        operationName: operationName,
        variables: item,
    });

    const signer = new AWS.Signers.V4(req, 'appsync', true);
    signer.addAuthorization(AWS.config.credentials, AWS.util.date.getDate());

    const data = await new Promise((resolve, reject) => {
        const httpRequest = https.request({ ...req, host: endpoint }, (result) => {
            result.on('data', (data) => {
                resolve(JSON.parse(data.toString()));
            });
        });
        httpRequest.write(req.body);
        httpRequest.end();
    });
    return data;
};`

The item with id exists in DynamoDB and was created from a GraphQL Mutation below using the above code.

`query {
      getDirectory(id: "${id}") {
        id
        directoryName
        _version
        _deleted
        _lastChangedAt
        createdAt
        updatedAt
      }
    }`
`
When using this new payload to update the directory name.

`            const item = {
                input: {
                    id: directoryId,
                    directoryName: "Updated Directory Name"
                }
            };`
`

This is the mutation query that does not seem to perform correctly.

`
 `mutation UpdateDirectory(
        $input: UpdateDirectoryInput!
        $condition: ModelDirectoryConditionInput
      ) {
        updateDirectory(input: $input, condition: $condition) {
          id
          directoryName
          _version
          _deleted
          _lastChangedAt
          createdAt
          updatedAt
        }
      }
    `,
`

The lambda throws an error when using an update mutation. I 

2021-03-05T02:39:27.646Z	6b25d092-994a-49eb-a600-bb019b9602ea	ERROR	Uncaught Exception 	{"errorType":"SyntaxError","errorMessage":"Unexpected end of JSON input","stack":["SyntaxError: Unexpected end of JSON input","    at JSON.parse (<anonymous>)","    at IncomingMessage.<anonymous> (/var/task/index.js:31:30)","    at IncomingMessage.emit (events.js:314:20)","    at IncomingMessage.EventEmitter.emit (domain.js:483:12)","    at IncomingMessage.Readable.read (_stream_readable.js:507:10)","    at flow (_stream_readable.js:1007:34)","    at resume_ (_stream_readable.js:988:3)","    at processTicksAndRejections (internal/process/task_queues.js:84:21)"]}
END RequestId: 6b25d092-994a-49eb-a600-bb019b9602ea

Other people seem to have issues like this, but the solutions do not seem to work well.

https://stackoverflow.com/questions/55400909/graphql-axios-variables-injection
https://stackoverflow.com/questions/53168160/graphql-apollo-client-issue-network-error-syntaxerror-unexpected-end-of-js

Any advice on where to look would be most appreciated.

Kind regards,
## Comment

---------------

Author: @Neuroforge

Appears to be a limitation in node https.
## Comment

---------------

Author: @Neuroforge

Ok. Appears response is coming back in chunks.

Solution... 

`
    const data = await new Promise((resolve, reject) => {
        const httpRequest = https.request({ ...req, host: endpoint }, (response) => {
            let data = '';
            response.on('data', (chunk) => {
                data += chunk;
            });
            response.on('end', () => {
                const body = JSON.parse(data);
                console.log(body);
            });
        });
        httpRequest.write(req.body);
        httpRequest.end();
    });
`

---------------

---------------

# How to get Unauth Role working for IAM: Appsync Api.

---------------

Author: @BrianMagus
Upvotes: 1
Comments: 0

There really isn't enough documentation on this either in the AWS docs or in the Github, so hopefully someone here has tackled a similar issue.

I have a react app with backend api hosted on AWS, using appsync, dynamoDB, and cognito-user-pools. My IAM policies are set up to allow unauth users read-only permission to some public tables. I tried the public api key but that didn't do anything. I'm trying to get the IAM unauth role permissions set up but even when I experimentally added literally every service and every action to the unauth role, I still get "no current user" when attempting to make the API call without logging in. 

Use case is for public author pages, where information about an author along with their currently available books is listed. Users should not have to sign in to see this page, an author should be able to drop a link to the page to anyone, whether they have a login for the app or not. 

This is my graphql schema for the relevant types, it gets no errors:
```
type PublicBook @model @auth(rules: [{ allow: owner, operations: [create, update, delete], provider: userPools },
{allow: public, operations: [read], provider: iam}])
@key(name:"byPublicWorld", fields: ["publicWorldId", "indexOrder"])
@key(name:"byPublicSeries", fields: ["publicSeriesId", "indexOrder"]){
  id: ID!
  publicWorldId: ID
  publicSeriesId: ID
  indexOrder: Int!
  cover: FileObject @connection 
  description: String 
  amazon: String
  ibooks: String
  smashwords: String 
  kobo: String 
  goodreads: String 
  audible: String 
  barnesnoble: String 
  sample: String
}
type PublicSeries @model @auth(rules: [{ allow: owner, operations: [create, update, delete], provider: userPools },
{allow: public, operations: [read], provider: iam}])
@key(name:"byPublicWorld", fields: ["publicWorldId", "indexOrder"]){
  id: ID!
  publicWorldId: ID!
  indexOrder: Int!
  logo: FileObject @connection 
  description: String
  genre: String
  books: [PublicBook]@connection(keyName:"byPublicSeries", fields: ["id"])
}
type PublicWorld @model @auth(rules: [{ allow: owner, operations: [create, update, delete], provider: userPools },
{allow: public, operations: [read], provider: iam}])
@key(name:"byAuthorPage", fields: ["authorPageId", "indexOrder"]){
  id: ID!
  authorPageId: ID!
  logo: FileObject @connection
  description: String
  genre: String 
  indexOrder: Int!
  series: [PublicSeries]@connection(keyName:"byPublicWorld", fields: ["id"])
  books: [PublicBook]@connection(keyName:"byPublicWorld", fields: ["id"])
}
type AuthorPage @model @auth(rules: [{ allow: owner, operations: [create, update, delete], provider: userPools },
{allow: public, operations: [read], provider: iam}])
@key(name:"byPenName", fields: ["penId"])
@key(name:"byPenDisplayName", fields: ["penDisplayName"], queryField: "authorPageByPen"){
  id: ID!
  authorName: String 
  penDisplayName: String
  penId: ID!
  bio: String 
  photo: FileObject @connection 
  logo: FileObject @connection
  penFBProfile: String
  penFBGroup: String
  penFBPage: String
  penTwitter: String
  penInstagram: String
  penAmazon: String
  penWebsite: String
  penNewsletter: String
  penGoodreads: String
  penPatreon: String
  posts: [AuthorPost]@connection(keyName:"byAuthorPage", fields: ["id"])
  worlds: [PublicWorld]@connection(keyName:"byAuthorPage", fields: ["id"])
}
type AuthorPost @model @auth(rules: [{ allow: owner, operations: [create, update, delete], provider: userPools },
{allow: public, operations: [read], provider: iam}])
@key(name:"byAuthorPage", fields: ["authorPageId", "timeCreated"]){
  id: ID!
  authorPageId: ID!
  timeCreated: AWSTimestamp!
  content: String!
  title: String!
  subtitle: String
  type: PostType!
}
```
Each of these types is set to owner/cognito permissions for creating, updating, and deleting, and then there is a public auth using iam to read. Seems straight forward enough. 

The main type here is Author page, and I have the query set up to pull all the connected relevant cascading information. When logged in, this works fine and shows an author page with all the bits and bobs:
```
export const authorPageByPen = /* GraphQL */ `
  query AuthorPageByPen(
    $penDisplayName: String
    $sortDirection: ModelSortDirection
    $filter: ModelAuthorPageFilterInput
    $limit: Int
    $nextToken: String
  ) {
    authorPageByPen(
      penDisplayName: $penDisplayName
      sortDirection: $sortDirection
      filter: $filter
      limit: $limit
      nextToken: $nextToken
    ) {
      items {
        id
        authorName
        penDisplayName
        penId
        bio
        photo {
          location
        }
        logo {
          location
        }
        penFBProfile
        penFBGroup
        penFBPage
        penTwitter
        penInstagram
        penAmazon
        penWebsite
        penNewsletter
        penGoodreads
        penPatreon
        posts {
          nextToken
          startedAt
        }
        worlds {
          nextToken
          startedAt
        }
        _version
        _deleted
        _lastChangedAt
        createdAt
        updatedAt
        owner
      }
      nextToken
      startedAt
    }
  }
`;
```
On the page itself (although in production this just happens at app.js and persists throughout the app), I'm pulling current credentials and logging them to make sure that some kind of IAM identity is being created, and it appears to be:
```
accessKeyId: "BUNCHANUMBERSKEY"
authenticated: false
expiration: Thu Mar 04 2021 13:18:04 GMT-0700 (Mountain Standard Time) {}
identityId: "us-west-2:48cd766c-4854-4cc6-811a-f82127670041"
secretAccessKey: "SecretKeyBunchanumbers"
sessionToken:"xxxxxbunchanumbers"
```
That ```identityId``` on line 4 is present in my identity pool as an unauth identity, so it *is* getting back to the pool, which seems to be what's supposed to happen. 

So, this identity pool has two roles associated with it, which is standard: auth and unauth, and my Unauthenticated Identities Setting has the box for ```Enable Access to Unauthenticated Identities``` checked. 

In my unauth role, I've got the following as the inline policy json:
```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "appsync:GraphQL"
            ],
            "Resource": [
                "arn:aws:appsync:us-west-2:MyAccountID:apis/MyAppsyncApiId/types/Mutation/fields/authorPageByPen"
            ]
        }
    ]
}
```
I wasn't sure if this needed to be mutation, or query, or what, so I've tried them all. I tried them in combination with 'fields' and with 'index', I've tried writing the JSON, and adding the policies from the inline editor, which gives me the following which also does not work:
```
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "appsync:GraphQL",
                "dynamodb:GetItem",
                "dynamodb:Query"
            ],
            "Resource": [
                "arn:aws:dynamodb:us-west-2:MyAccountID:table/AuthorPage-bunchanumbers-dev",
                "arn:aws:dynamodb:us-west-2:MyAccountID:table/AuthorPage-bunchanumbers-dev/index/byPenDisplayName",
                "arn:aws:appsync:us-west-2:852511622901:apis/APIID/types/AuthorPage/fields/authorPageByPen",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID/types/FileObject/fields/*",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID/types/AuthorPost/fields/*",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID/types/PublicWorld/fields/*",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID/types/PublicSeries/fields/*",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID/types/PublicBook/fields/*",
                "arn:aws:appsync:us-west-2:MyAccountID:apis/APIID"
            ]
        }
    ]
}
```
Account ID and API ID replaced in the above. What bit am I missing here? I could understand getting some error about not being allowed to access a resource, but the only error that logs is ```No Current User```, and that happens immediately after the log *showing* the user. 

---------------

---------------

# Mutations via AppSync have to include all fields otherwise DataStore records are incomplete

---------------

Author: @PeteDuncanson
Upvotes: 1
Comments: 1

I'm still digging into this one but thought I would raise it.

If you have to update a record via AppSync (in a Lambda for instance). You have to return every field for the model in the mutation results otherwise the data in DataStore seems to only get back the fields you requested. This seems to be the case for updates and creations.

This seems counter intuitive (and also I can't find it documented anywhere).

Guessing that the subscription event is just passed the fields from the mutation and DataStore is taking them at face value. I think it should really though just update the fields that changed rather than just the ones returned. I can understand that that is tricky to know which fields to include.

This also leads to some tech debt and bear traps in the future, if my schema changes I have to remember to go find all my AppSync mutations and update them to include the new field otherwise DataStore won't see it. Tricky.

What is the best way around this? Is this the right way? Could it be done better?

Could a subscription just include the whole record by default? Could it trigger a refetch of that record in whole?
## Comment

---------------

Author: @nubpro

 > If you have to update a record via AppSync (in a Lambda for instance). You have to return every field for the model in the mutation results otherwise the data in DataStore seems to only get back the fields you requested. This seems to be the case for updates and creations.

I think the doc should be improved to include this CRUCIAL information where all fields must be included when making mutations otherwise subscription will return `null` for excluded fields.

Maybe on these parts of the docs:
https://docs.amplify.aws/lib/graphqlapi/mutate-data/q/platform/js
https://docs.amplify.aws/lib/graphqlapi/subscribe-data/q/platform/js

---------------

---------------

# Confusion over packages — should we install '@amplify-aws/core' or 'aws-amplify'

---------------

Author: @sc0ttdav3y
Upvotes: 1
Comments: 1

Hi,

I'm confused. Sorry if this is a braindead question.

Some docs say to use non-namespaced NPM packages whereas others say to use packages namespaced with the `@aws-amplify` namespace. 

As a result, I've got a project that has a mix of both, and I'm concerned I'm not doing it right.

For example, the [GitHub README for aws-amplify](https://github.com/aws-amplify/amplify-js/blob/main/README.md#installation) says this about getting started with React:

```
npm install aws-amplify --save
npm install aws-amplify-react --save
``` 

But the [Amplify Docs site](https://docs.amplify.aws/ui/q/framework/react) says to do this:

```
yarn add aws-amplify @aws-amplify/ui-react
```

And the getting started section in the same docs says to do this, hinting that the namespaced package approach is the way to go:

```
npm install -g @aws-amplify/cli
```

And [this popular blogger](https://medium.com/@dabit3/modular-imports-with-aws-amplify-daeb387b6985) says the NPM package `aws-amplify` includes all the `@aws-amplify/*` modules.

I'm trying to make sense of it all.

For example, is [@aws-amplify/ui-react](https://www.npmjs.com/package/@aws-amplify/ui-react) the same as [aws-amplify-react](https://www.npmjs.com/package/aws-amplify-react)?  

If so, why are the version numbers different? And if not, what is the difference between the two?

Is there some documentation that explains all this and gives us a directory of the packages?

Thanks!
## Comment

---------------

Author: @sammartinez

Hello @sc0ttdav3y,

Thanks for this feedback and you are right that it is confusing from our README to our documentation site. We recommend installing Amplify JavaScript as directed within our documentation site. For correction to the confusion, I have created an [issue](https://github.com/aws-amplify/amplify-js/issues/7868) to resolve the confusion we have within our README and to provide consistency between our documentation site and here. 

As for the callout related to `@aws-amplify/ui-react`, last year we released our second version of our UI Components with writing the implementations in Web Components format. The `@aws-amplify/ui-react` is the second version of our UI Components and what we currently maintain. `aws-amplify-react` is our first version of our UI Components and are looking to place deprecation warnings on this later this year. Our recommendation is to use the `@aws-amplify/ui-react` for your application. 

Please let me know if you have questions about the above or anything else I can clarify. Thanks!

---------------

---------------

# Auth custom storage

---------------

Author: @pieterbergmans
Upvotes: 1
Comments: 0

Hi...I've implemented Amplify Auth and it's currently storing tokens in localStorage, which I know is not a best practice from a security standpoint. I read in the Amplify docs that you can create your own custom storage. Since cookies has inherent flaws as well, I was wondering if storing tokens in my app's memory, like redux, is a good solution?  

I noticed the docs stub out some code (below) but, to be honest, I really don't know a good starting point.  I've googled extensively but I can find any examples that will help me implement this.  Any suggestions from anyone who's done this?  

This is the code from the Amplify docs...

```
class MyStorage {
  // get item with the key
  static getItem(key: string): string;
  // remove item with the key
  static removeItem(key: string): void;
  // clear out the storage
  static clear(): void;
  // If the storage operations are async(i.e AsyncStorage)
  // Then you need to sync those items into the memory in this method
  static sync(): Promise<void>;
}
```

```
Auth.configure({
  region: region,
  userPoolId: userPoolId,
  userPoolWebClientId: appClientId,
  storage: MyStorage
});
```

---------------

---------------

# How to customize the Authenticator in Vue?

---------------

Author: @FrancescoMussi
Upvotes: 1
Comments: 1

I need to customize the component, but I am not really able to do it, besides changing few variables.

All I managed to do so far is this:

```css
:root {
  --amplify-background-color: transparent;
  --amplify-secondary-color: white;
  --amplify-primary-contrast: white;
  --amplify-primary-color: #E00C1D;
}
```

<img width="290" alt="Screenshot 2021-03-02 at 10 44 48" src="https://user-images.githubusercontent.com/5312907/109622049-580a6180-7b44-11eb-9668-c402d69b7647.png">



But by setting `--amplify-secondary-color` to white, then the input text is also white.
I am trying to change the font of the input text, but it seems not possible.

I need to change other things, such as the `amplify-toast`.

I see that the input has a `.input` class, and the toast has a `.toast` class, but I am not able to target them.

Do you know how can I do that?
## Comment

---------------

Author: @CharlieDigital

I recently fought the same battle and gave up; I ended up writing a custom UI and honestly it did not take more than a day and maybe 20-30 lines of code and 30-40 lines of markup.  The main API calls are all built into `Auth` already so there's not nearly as much value in bashing your head against this as you might think.

Here's the whole implementation for signup and login including federation with FB, Office 365, and Google:

```javascript
        // https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js#sign-up
        async function createAccount() {
            // Check if it's valid.
            const isValid = await registrationForm.value?.validate() || false

            if (!isValid) {
                return
            }

            registering.value = true
            errorMessage.value = ''

            try {
                await Auth.signUp({
                    username: email.value,
                    password: password.value,
                    attributes: {
                        email: email.value,
                        name: `${firstName.value} ${lastName.value}`,
                        given_name: firstName.value,
                        family_name: lastName.value
                    }
                })

                registering.value = false
                registered.value = true
            }
            catch (error) {
                console.log(error)

                errorMessage.value = error.message
            }
        }

        // https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js#sign-up
        async function loginAccount() {
            authenticating.value = true
            errorMessage.value = ''

            try {
                await Auth.signIn(email.value, password.value)

                authenticating.value = false

                await root.$router.push({ name: 'Home' })
            }
            catch (error) {
                authenticating.value = false

                console.log(error)

                errorMessage.value = error.message
            }
        }

        // https://docs.amplify.aws/lib/auth/social/q/platform/js#setup-frontend
        // https://github.com/aws-amplify/amplify-js/issues/3611#issuecomment-509735881
        async function continueWithGoogle() {
            await Auth.federatedSignIn({ provider: CognitoHostedUIIdentityProvider.Google, customState: invitationId.value })
        }

        // https://docs.amplify.aws/lib/auth/social/q/platform/js#setup-frontend
        // https://github.com/aws-amplify/amplify-js/issues/3611#issuecomment-509735881
        async function continueWithFacebook() {
            await Auth.federatedSignIn({ provider: CognitoHostedUIIdentityProvider.Facebook, customState: invitationId.value })
        }

        // https://docs.amplify.aws/lib/auth/social/q/platform/js#setup-frontend
        // https://github.com/aws-amplify/amplify-js/issues/3611#issuecomment-509735881
        async function continueWithMicrosoft() {
            await Auth.federatedSignIn({ customProvider: 'Office365', customState: invitationId.value })
        }

        const passwordsMatch = computed(() => {
            return password.value === confirmPassword.value
        })
```

Obviously a lot of stuff specific to my app, but it's very straight forward.

Registering and login with the federated providers both use the same exact call `Auth.federatedSignIn`.  If you need to create a profile for your user in your application space after registration, you can hook into Lambda triggers on Cognito (specifically, the [post confirmation trigger](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-lambda-post-confirmation.html))

Because the backend calls will do the validation anyways (e.g. invalid email address), you don't necessarily even need to implement the front-end validation (though I did as you can see by that last `computed`).  It is honestly a great library and featureset, but lacking in straight forward, practical examples at the moment.  Good news is that rolling your own using the `Auth` APIs is not that big of a leap.

I put it this way: in the time it takes you to figure out the workarounds and limitations of the pre-built Vue UI components, you could have easily solved the issue using the API instead and end up with a UI that better matches the rest of your application.

---------------

---------------

# Contributions Workflow what branch do I submit pull request to?

---------------

Author: @mgoral2
Upvotes: 1
Comments: 0

Hi.  I am interested in contributing to this project and am very excited about Amplify.  I was wondering, I have a year of experience working in software and when I submitted a pull request for my company it was always to the QA1 branch.  There were several QA branches and as the software went along it would get checked.  If I worked on some of the good first issue problems, where do I submit my pull request to?  Is it the main branch or some other branch or does it differ for each issue?  Thanks!

---------------

---------------

# Enable rtl in withAuthenticator to display Arabic login

---------------

Author: @berenddeboer
Upvotes: 1
Comments: 0

Is Arabic supported with withAuthenticator? If so how?

Here's how I initialise my app:

```
I18n.setLanguage("ar")
I18n.putVocabularies(authScreenLabels)

export default withAuthenticator(App, false, [
    <SignIn/>,
    <RequireNewPassword/>,
    <ForgotPassword/>,
    <AuthLoading/>
])
```

i.e. I'm just wrapping my app. But the form should be rtl.

---------------

---------------

# Google Federated auth: Token is not from a supported provider of this identity pool

---------------

Author: @Stf-F
Upvotes: 1
Comments: 0

Hi, 

I have spent countless hours already trying to figure this out myself before posting here and I have also looked at the numerous very similar posts on SO but no luck so far. 

So here we go, what I am trying to do:
- In a Vue 3 app, use the  `<amplify-google-button>` ([link](https://github.com/aws-amplify/amplify-js/tree/main/packages/amplify-ui-components/src/components/amplify-google-button)) component to trigger the Google sign-in federated authentication flow. I _do not want_ to use the hosted UI and am using Amplify Auth as an abstraction layer above the native Cognito SDK to speed up my implementation. Last thing, I am not using amplify to bootstrap my services but rather using an existing backend.

The problem:
- I am consistently getting the following error in the console:  `NotAuthorizedException: Token is not from a supported provider of this identity pool`

According to the [results on SO](https://stackoverflow.com/search?q=Token+is+not+from+a+supported+provider+of+this+identity+pool&s=c06066af-0e63-4f29-a23b-66c2c48ef23c&s=02e3267d-db91-4cbb-9544-9edc0da8a48c), this problem usually comes from a mismatch between the IDs or references to the User Pool used in the Federated Identity pool or lack of configuration of _a_ Federated Identity pool. This is not my case, the Federated Identity pool is setup and referencing correctly the User Pool.

2 things to mention at this point:
The hosted UI flow works
The regular email / password flow works 

My understanding:
- By setting up the federated identities in the User Pool, Cognito will manage the creation of users and their authentication and retrieval of profile information.
The identity pool needs to be setup to use Cognito as an Authentication provider to access the other AWS resources. I **should not have to setup Google+ (deprecated) or OpenID as Authentication providers** in the Federated Identities section as the users' tokens will be issued by Cognito. Is this correct?  Some posts [say otherwise and suggest creating an Identity Provider in IAM first](https://stackoverflow.com/a/45120365). Confusing.  

Now, my configuration:
- main.js

``` javascript
import { applyPolyfills, defineCustomElements } from '@aws-amplify/ui-components/loader'
import Amplify from 'aws-amplify'
import { createApp } from 'vue'
import App from './App.vue'
import config from './aws-exports'
import './registerServiceWorker'

Amplify.configure(config)

applyPolyfills().then(() => {
  defineCustomElements(window)
})

const app = createApp(App)

app.config.isCustomElement = (tag) => tag.startsWith('amplify-')
app.mount('#app')

```

- aws-exports.js

``` javascript
const config = {
  Auth: {
    identityPoolId: 'eu-west-1:5f3fe010-6127-4XX4-XXXX-XXXXXXXXX605', 
    region: 'eu-west-1',
    userPoolId: 'eu-west-1_XXXXXz8TS',
    userPoolWebClientId: '21dXXXXXXXXXXXXh948egXXdk6',
    oauth: {
      domain: '<domain>.auth.eu-west-1.amazoncognito.com',
      scope: ['phone', 'email', 'profile', 'openid', 'aws.cognito.signin.user.admin'],
      redirectSignIn: 'https://<domain>.co.uk/',
      redirectSignOut: 'https://<domain>.co.uk/',
      responseType: 'code',
    },
  },
  federationTarget: 'COGNITO_USER_POOLS',
}

export default config
```
- My overly simplified App.vue test file:

``` javascript
<template>
  <div>
    <div v-if="authState !== 'signedin'">You are signed out.</div>
 
    <amplify-google-button client-id="946795XXXXXX-4fXX9XXXXXXXXXXXXXXXXXXXXXXXXXXX.apps.googleusercontent.com">Hello</amplify-google-button>
 
  </div>
</template>

<script>
import { onAuthUIStateChange } from '@aws-amplify/ui-components'
export default {
  name: 'AuthStateApp',
  created() {
    this.unsubscribeAuth = onAuthUIStateChange((authState, authData) => {
      this.authState = authState;
      this.user = authData;
    })
  },
  data() {
    return {
      user: undefined,
      authState: undefined,
      unsubscribeAuth: undefined
    }
  },
  beforeUnmount() {
    this.unsubscribeAuth();
  }
}
</script>
```
- My User Pool and Identity Pool configs:
<img width="978" alt="Pasted_Image_25_02_2021__02_02" src="https://user-images.githubusercontent.com/52630104/109092006-ba5efe80-770d-11eb-9e77-c39fda995ecd.png">

<img width="985" alt="Pasted_Image_25_02_2021__02_04" src="https://user-images.githubusercontent.com/52630104/109092191-01e58a80-770e-11eb-8d82-e2b3564e73eb.png">

<img width="1071" alt="Pasted_Image_25_02_2021__02_07" src="https://user-images.githubusercontent.com/52630104/109092411-5f79d700-770e-11eb-8a7f-194223be777d.png">

- My Google config:
<img width="1310" alt="Pasted_Image_25_02_2021__02_14" src="https://user-images.githubusercontent.com/52630104/109092916-59d0c100-770f-11eb-897c-a320024b53c8.png">

I would appreciate any idea on the above as I am starting to no longer see any option.

Thanks,

Stephane


---------------

---------------

# API Gateway CORS issue only using SDK

---------------

Author: @tnorlund
Upvotes: 1
Comments: 0

I've currently deployed an API Gateway that works with the browser and Postman. When I attempt to run it using the Amplify JS SDK, I get a CORS error. I've added the Lambda function, but I'm not sure how to use the SDK with this POST endpoint. What do I need to add to get this to work? 

```js
const { User, updateUserName, addTOSToUser } = require( `/opt/nodejs/index` )

/**
 * Getting the basic blog details.
 *
 * This is called to get the basics of the blog's details. This returns the
 * number of users and posts.
 */
exports.handler = async ( event, context ) => {
  if (
    !event.body
  ) return {
    statusCode: 500, 
    headers: { 'Access-Control-Allow-Origin' : '*' }, 
    body: `Must give the slug and the title in the body.`,
    isBase64Encoded: false
  } 
  try {
    const parsedBody = JSON.parse( event.body )
  } catch( error ) {
    return {
      statusCode: 500, 
      headers: {
        "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,X-Amz-Security-Token,Authorization,X-Api-Key,X-Requested-With,Accept,Access-Control-Allow-Methods,Access-Control-Allow-Origin,Access-Control-Allow-Headers",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT",
      "X-Requested-With": "*",
      "Access-Control-Allow-Credentials" : true
      }, 
      body: `Body must be JSON formatted.`,
      isBase64Encoded: false
    }
  }
  if (
    typeof parsedBody.username == `undefined` ||
    typeof parsedBody.name == `undefined` ||
    typeof parsedBody.email == `undefined` ||
    typeof parsedBody.version == `undefined`
  ) return {
    statusCode: 500, 
    headers: { 
      "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,X-Amz-Security-Token,Authorization,X-Api-Key,X-Requested-With,Accept,Access-Control-Allow-Methods,Access-Control-Allow-Origin,Access-Control-Allow-Headers",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT",
      "X-Requested-With": "*",
      "Access-Control-Allow-Credentials" : true
      
    }, 
    body: `Must give the user's number, name, email, and terms of service version in the body.`,
    isBase64Encoded: false
  }
  const { tos, error } = await addTOSToUser( 
    process.env.TABLE_NAME, 
    new User( {
      name: parsedBody.name,
      email: parsedBody.email,
      username: parsedBody.username
    } ),
    parsedBody.version
  ) 
  if ( error ) return { 
    statusCode: 500, 
    headers: { 
      "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,X-Amz-Security-Token,Authorization,X-Api-Key,X-Requested-With,Accept,Access-Control-Allow-Methods,Access-Control-Allow-Origin,Access-Control-Allow-Headers",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT",
      "X-Requested-With": "*", 
      "Access-Control-Allow-Credentials" : true
    }, 
    body: JSON.stringify( error ), 
    isBase64Encoded: false
  }
  return { 
    statusCode: 200, 
    headers: { 
      "Access-Control-Allow-Headers": "Content-Type,X-Amz-Date,X-Amz-Security-Token,Authorization,X-Api-Key,X-Requested-With,Accept,Access-Control-Allow-Methods,Access-Control-Allow-Origin,Access-Control-Allow-Headers",
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT",
      "X-Requested-With": "*", 
      "Access-Control-Allow-Credentials" : true
    }, 
    body: JSON.stringify( tos ), 
    isBase64Encoded: false
  }
};

```

---------------

---------------

# PKCE in ui-react AmplifyAuthenticator

---------------

Author: @padzikm
Upvotes: 1
Comments: 1

Hi, I'd like to know if AmplifyAuthenticator in ui-react package is using pkce extension to code flow. There is no clear answer in issues here - I don't use cognito's hosted ui and I configured cognito's app client to only allow code flow (implicit flow is not allowed). My amplify configuration is as follows:
```
Amplify.configure({
          Auth: {
            region,
            userPoolId,
            userPoolWebClientId,
            mandatorySignIn: true,
            storage: sessionStorage
          }
        })
```
and I render ui as:
```
<AmplifyAuthenticator>
   <My-content />
</AmplifyAuthenticator>
```
## Comment

---------------

Author: @padzikm

Up

---------------

---------------

# Phone number verification not sent

---------------

Author: @omer-to
Upvotes: 1
Comments: 0

Hello,

I'm using `aws-amplify` for my React Native project. I want to sign users with phone number and send SMS immediately after they sign up. I tried to do that using `eu-central-1 (Frankfurt)`, `us-east-1 (N. Virginia)`, and `eu-west-2 (London)`. Although I see that the user is created successfully, I was not able to send even one SMS at all. After searching for similar questions, though I have never sent SMS, I did request for SMS quota increase. I was not able to find the problem, and hence I'm literally describing all the steps:

## amplify add auth

Here's are the answers to the questions asked after issuing `amplify add auth`:

> Do you want to use the default authentication and security configuration? (Use arrow keys)
> ❯ Default configuration

> How do you want users to be able to sign in? (Use arrow keys)
> ❯ Phone Number

> Do you want to configure advanced settings? (Use arrow keys)
> ❯ Yes, I want to make some additional changes.

> What attributes are required for signing up?
> ❯ Family Name, Give Name, Phone Number

> Do you want to enable any of the following capabilities?
> ❯ I choose none

## AWS Cognito Console

And the process completes after that last question. Then I push the local resources and provision it in the cloud by running `amplify push`. Afterwards, I get on Cognito console, and choose the User Pool that I just created.
From **General Setting** ❯ **MFA and verifications**, I make the following changes:

> **Do you want to enable Multi-Factor Authentication (MFA)?**
> Optional

> **Which attributes do you want to verify?**
> Phone Number

and save the changes.

---

Here is the code for signing up:

```typescript
async function signUp(phoneNumber: string, password: string, firstName: string, lastName: string) {
        try {
                const response = await Auth.signUp({
                        username: phoneNumber,
                        password,
                        attributes: {
                                family_name: lastName,
                                given_name: firstName,
                                phone_number: phoneNumber
                        }
                })
        } catch (error) { }
}
```

What I expect is that after the user is created, the phone number receives the code for phone number verification. I also tried to resend it by executing `Auth.resendSignUp`, but I have never received the code.

I do not have any issue with signal strength, and tried it with other phones and AWS regions as well.

I cannot figure out why it is not working as expected, and I need suggestion.

---------------

---------------

# Amplify Subscription Observable return type for Typescript

---------------

Author: @huydiff
Upvotes: 1
Comments: 0

```typescript
    const subscription = (API.graphql({
      query: onClassroomRegister,
      variables: {
        id: classroom.id,
      },
    }) as Observable<object>).subscribe({
      next: (response => {
        console.log(response);
      }),
    });
```

I have a Typescript project and I am getting linting errors because the `response` argument in `next` is not typed. What is the correct return type for this?


---------------

---------------

# Does Auth.signUp allow me to signup without an email?

---------------

Author: @omenking
Upvotes: 1
Comments: 1

I choose to create a Cognito User Pool without a username. (I think that is actually the default in the Admin UI)

<img width="983" alt="Screen Shot 2021-02-22 at 10 31 17 PM" src="https://user-images.githubusercontent.com/7776/108799379-2a2e8700-755e-11eb-9e4c-e5d70a11d658.png">

It expects a username, I tried to omit it and it complained.

```js
Auth.signUp({
    username,
    password,
    attributes: {
        email,
        'custom:favorite_flavor': 'Cookie Dough'  // custom attribute, not standard
    }
})
```

Does the Auth.signUp not support signup without username?
## Comment

---------------

Author: @omenking

Well this explains it.

```
error signing up: {code: "InvalidParameterException", name: "InvalidParameterException", message: "Username should be an email."}
```

I think the documentation needs to be updated

---------------

---------------

# Import Amplify reports error

---------------

Author: @Kiddinglife
Upvotes: 4
Comments: 0

Puerts: Error: (0x00000206226C5490) D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-**amplify\dist\aws-amplify.js:201341: ReferenceError: self is not defined**
module.exports = self.fetch || (self.fetch = __webpack_require__(/*! unfetch */ "../../node_modules/unfetch/dist/unfetch.module.js").default || __webpack_require__(/*! unfetch */ "../../node_modules/unfetch/dist/unfetch.module.js"));
                 ^
ReferenceError: self is not defined
    at Object.../../node_modules/isomorphic-unfetch/browser.js (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:201341:18)
    at __webpack_require__ (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:30:30)
    at Module.../amazon-cognito-identity-js/es/Client.js (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:220229:76)
    at __webpack_require__ (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:30:30)
    at Module.../amazon-cognito-identity-js/es/CognitoUserPool.js (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:222917:65)
    at __webpack_require__ (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:30:30)
    at Module.../amazon-cognito-identity-js/es/index.js (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:223634:74)
    at __webpack_require__ (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:30:30)
    at Module.../auth/lib-esm/Auth.js (D:\EpicEngineProjects\puerts_unreal_demo\Content\JavaScript\node_modules\aws-amplify\dist\aws-amplify.js:231906:84)
    at

---------------

---------------

# Options for reducing bundle size (Angular, Cognito, GraphQL)?

---------------

Author: @kevin-mitchell
Upvotes: 1
Comments: 0

I am looking at a super basic Ampilfy + Angular project and the bundle size / deployed javascript is pretty huge - basically a MB. the large majority of this appears to be Amplify. I am using Cognito, GraphQL (but don't need the mqtt stuff for AppSync as I don't care about real time updates and such).... I know these are super full featured / "enterprise" level services, but it still seems like a LOT of code to ship. I'm wondering if there are any obvious optimizations around bundle size that I should be looking at?

This screenshot shows the bundle sizes in my project so far, without much really being added.

![Screen Shot 2021-02-18 at 6 03 48 PM](https://user-images.githubusercontent.com/21270844/108584207-4c24d100-72f4-11eb-972f-3b5f182891c8.png)

Thanks for any tips / best practices!

Edit: I didn't notice before but there was an issue opened for this a while ago that has side been closed: https://github.com/aws-amplify/amplify-js/issues/122

I'm going to take a look at targeting specific libraries and see if that helps much. Would still value any input here!

---------------

---------------

# Is it possible to use 'authMode' in a multi-auth Angular project

---------------

Author: @philmerrell
Upvotes: 2
Comments: 2

I'm trying to get a multi-auth, public / private scenario working using Angular. I would like the update/delete/create of my models to be allowed only by a group in my user pool named 'Admins'. I would like to grant public read access to guests and unauthenticated users. This pain point has been fairly well documented and I believe I understand my options.

I have established a Cognito User Pool as my primary means of authentication to the api. I have configured additional auth using an API key, which I have generated in the AppSync console. I understand in non-Angular environments, we can pass in an optional authMode attribute like so:

```js
const createdTodo = await API.graphql({
  query: queries.createTodo,
  variables: {input: todoDetails},
  authMode: 'API_KEY'
});
```

It is not clear to me how this `authMode` param is passed in the context of the generated `API.service.ts` (the prescribed approach for interacting with our models in the context of Angular). I'm not sure if this is a simple usage question, a feature request, or a bug. Ideally we would be able to pass in the optional `authMode` param through our `API.service.ts` methods. Something like:

```js
// Optional argument to set the authMode param.
ListTodos(filter?: ModelTodoFilterInput, limit?: number, nextToken?: string, authMode?: string): Promise<ListTodosQuery>
```

I apologize in advance if this can be accomplished currently, but I can't find an example of it.
## Comment

---------------

Author: @philmerrell

If anyone can give some guidance here, it would be much appreciated. Should I try and write a custom angular service that structures the GraphQL operations in a more vanilla way (i.e., sans generated Angular service)?

Is this a feature request for the Angular Amplify library? Would a pull request be accepted if I decided to dig in and create one?
## Comment

---------------

Author: @kevin-mitchell

Same question here.

There is a LOT (it's sort of scary as you mentioned @philmerrell !) that is magically setup for you, but in my situation I setup a GraphQL API "category" with Amplify. I was following a tutorial I think and used the "API Key" authentication to start. Which was probably a mistake, maybe. Anyway, there is some code that was generated, `API.service.ts`, and from what I can tell it is setup to use the default authMode. 

So I've found that I can do what I want to do by manually modifying or otherwise copying the `API.service.ts`, and changing

```
...
const response = (await API.graphql(
      graphqlOperation(statement, gqlAPIServiceArguments)
    )) as any;
    return <UpdateBlogPostMutation>response.data.updateBlogPost;
...
```

to


```
...
const response = (await API.graphql(
      {
        query: statement, 
        variables: gqlAPIServiceArguments,
        authMode: GRAPHQL_AUTH_MODE.AMAZON_COGNITO_USER_POOLS
      }
    )) as any;
    return <UpdateBlogPostMutation>response.data.updateBlogPost;
...
```

Basically manually specifying that I want to use the `AMAZON_COGNITO_USER_POOLS` auth method. BUT, I feel like I shouldn't have to do this manually. Or if I should have to do this manually, then it shoul be clearly spelled out somewhere (and maybe it is... there is just so much, I'm never sure when I'm looking at outdated documentation or half-baked features vs magically amazing Amplify stuff)

---------------

---------------

# Best GraphQL schema for public / private entries in a collaboration use case?

---------------

Author: @dorontal
Upvotes: 2
Comments: 5

**What is the better GraphQL schema** for efficiently and properly handling the following use case, involving public or private user "entries" in a collaborative app?

#### Background
* Users can contribute an **entry**
* Users can make their entries public or private
* Users can **list all** entries, in which case they would see:
  * All users' public entries
  * Their own private entries
* No user has access to any aspect of another user's private entry - they can't even know it exists
* Users have just read access to the other users' public entries

How do we set up an `Entry` type in a GraphQL schema for this use case?

One way may be to separate entries into two types: `PrivateEntry` and `PublicEntry`, giving them different `@auth` directives; then, for the **list all** operation, perform two GraphQL queries - one for`PrivateEntry`, another for `PublicEntry`:
```graphql
type PrivateEntry
  @auth(rules: [{ allow: owner } ])
{
  ...
}

type PublicEntry
  @auth(
    rules: [
      { allow: owner },
      { allow: public, provider: iam, operations: [read] }
    ]
  )
{
  ...
}
```
but the above schema seems like an anti-pattern, disobeying "don't use type names as data". Also, the above schema would require two queries each time, and whatever you set up for one of the two types would have to be repeated identically for the other type, leaving room for errors if you did not repeat it identically.

Perhaps instead we could use just one `Entry` type that has a `visibility` field that determines whether the entry is private or public. 

However, I don't know how to achieve this use case and still have the proper privacy protections with only one `Entry` type.


## Comment

---------------

Author: @noskovvkirill

Hi! I was wondering if you've found a solution to your problem? I'm currently using an Entry field with a boolean flag for visibility and @auth directive on the field itself, but as you mentioned in your post that doesn't seem to be the most secure solution. 
## Comment

---------------

Author: @dorontal

We've changed things! To implement private / public "Entry" model, currently taking a different approach from the above: use one model with a boolean flag for visibility, as you do, so the model is now
```graphql
type Entry
  @auth(
    rules: [
      { allow: owner },
      { allow: public, provider: iam, operations: [read] }
    ]
  )
{
  ...
  public: Boolean
  owner: String
  ...
}
```
The `ListEntries` query **resolver** checks the value `public` -- if it's `true` then the resolver will emit all entries; if the value of `public` is `false` then the resolver will emit only entries for which `owner` is the currently logged in owner.

In the Javascript code, before we call the `ListEntries` query with `public === true`, we call
```typescript
Amplify.configure({ aws_appsync_authenticationType: 'AWS_IAM' });
```
And if we are to call `ListEntries` with `public === false` then (a) we make sure the user is logged in in the Javascript code; (b) we call
```typescript
Amplify.configure({ aws_appsync_authenticationType: 'AMAZON_COGNITO_USER_POOLS' });
```
The `Amplify.configure()` calls cause the correct `@auth` directive rule (out of the two rules defined in the schema above) to be used.

----------------

This is the current "solution".  I wrote it up here not just to answer the above but also to invite others to give feedback. If you have anything to say here on whether this is a good way of doing things or if you know of any improvements -- that would be very much appreciated!
## Comment

---------------

Author: @dorontal

What you are proposing seems like a nice solution @noskovvkirill I will try it.

It also adds a third use-case to the original private / public use-cases. The original two use cases were:
* public for all users
* private for only one owner

Your proposal above also adds:
* public for some users (e.g, collaborators of the owner)

Your proposal seems like great approach - thank you very much for that!

In the meantime, however, I want to mention that the solution I've proposed above was modified. There is no longer any need to re-configure via `Amplify.configure(...)` in the code. Adding another `@auth` rule seems to have allowed for that [though I'm not 100% sure that adding the `@auth` rule is indeed what allowed me to remove the `Amplify.configure(...)` code without getting 401 errors ]. The following schema is what is implemented now and works:

```graphql
type Entry
  @auth(
    rules: [
      # allow all authenticated users ability to create tracks
      # allow owners ability to update and delete their tracks
      { allow: owner },

      # allow all authenticated users to read tracks
      { allow: private, operations: [read] },

      # allow all guest users (not authenticated) to read tracks
      { allow: public, provider: iam, operations: [read] }
    ]
  )
{
  ...
  public: Boolean
  owner: String
  ...
}
```

But this modification is still a very slight improvement over my first proposal above, which still seems more hacky than your solution, so I will try your solution (I will only implement part-1 of your solution -- the part that deals with "public for all" or "private for owner" but not the part that allows for "public for some", not the second half of your proposal).

There is another thing I don't like with my proposed solution here: With the above schema, for any owner who wants to see all entries -- which includes both their own private entries plus everybody's public entries -- the code has to make **two query calls** to `ListEntries()` -- one with `public: { eq: true }` and another with `public: { eq: false }` -- but what I am hoping is that your suggested solution will only require one query call to the `ListEntries()` query. In other words, I hope that your solution will automatically filter private / public when listing all entries, depending on ownership of each entry and therefore only one query will be needed, which would be another reason your solution is cleaner. Will try your solution and report - thank you!
## Comment

---------------

Author: @dorontal

Found this one - it looks like a good solution. It covers my use case of having public stuff available to unauthenticated users as well as authenticated ones, but I think it also covers your use case, which does not need the unauthenticated access part. I will probably try this solution and will report if I do, but here is the alleged solution if you wanted to get started: https://medium.com/@fullstackpho/aws-amplify-multi-auth-graphql-public-read-and-authenticated-create-update-delete-1bf5443b0ad1
## Comment

---------------

Author: @danielgeri

@dorontal @noskovvkirill love the conversation! I desperately needed to gain some insight on public/private strategies. I'd like to describe my situation and see if I can glean any information from you guys. My situation is the following (keep in mind I'm new to amplify/graphql):

I have a type that I'd like to toggle between private and public. If the record is private, we need the ability to add users (probably leveraging the `ownerField`. If the record is public, then both signed-on and signed-off users need to be able to access these records. To further add complexity to this, we have nested types and can also be accessed/updated independently.

Based on this need, I am leaning towards this approach https://github.com/aws-amplify/amplify-js/discussions/6544#discussioncomment-296625. I am thinking the overall solution may look something like this:

```graphql
type Entry
  @auth(
    rules: [
      # allow all authenticated users ability to create tracks
      # allow owners ability to update and delete their tracks
      { allow: owner },

      # allow all authenticated users to read tracks
      { allow: private, operations: [read] },

      # allow all guest users (not authenticated) to read tracks
      { allow: public, provider: iam, operations: [read] }
    ]
  )
{
  ...
  public: Boolean
  owner: String
  childEntries: [ChildEntry]
  ...
}

type ChildEntry   @auth(
    rules: [
      # allow all authenticated users ability to create tracks
      # allow owners ability to update and delete their tracks
      { allow: owner },

      # allow all authenticated users to read tracks
      { allow: private, operations: [read] },

      # allow all guest users (not authenticated) to read tracks
      { allow: public, provider: iam, operations: [read] }
    ]
  )
{
  ...
  public: Boolean
  owner: String
}
```
Therefore mutations would have to include updates to parent and nested types. Curious to know if you guys have additional thoughts to this.

---------------

---------------

# Reset the amplify.configure() setting after modifying graphql_headers in Amplify.configure

---------------

Author: @ronakm
Upvotes: 1
Comments: 0

We have use case where we are using two different type of AppSync queries 
1. Using Auth mode : cognito
2. Using Auth mode : AWS_IAM

As React Amplify Appsync library uses "accessToken" by default while making API request when Auth mode is (AMAZON_COGNITO_USER_POOLS).  As we wanted to pass the claims or custom attributes to backend lambda resolver, i am modifying amplify.configure as below before making actual API call:

Amplify.configure({
        API: {
          graphql_headers: async () => ({
            "Authorization": session.getIdToken().getJwtToken(),
          }),
        },
      });
const requestData = {
        body: {
          type: "test",
        },
      };
      try {
        const response = await API.graphql({
          query: testAuthQuery,
          variables: requestData,
          authMode: "AMAZON_COGNITO_USER_POOLS",
        });
        console.log(response)
      } catch (e) {
        console.log(e)
      }

Now , if i logout from application and try to make any query API with authmode "AWS_IAM" as below : 

 Amplify.configure(myAppConfig);
    try {
        const queryData = {
            test : input
            }
            console.log("Inside create account ", input);
            const data =  await API.graphql({query: testUnauthApi, variables: queryData, authMode: 'AWS_IAM'});
            console.log(data);
            return data;
        } catch (e) {
            console.log("Error");
            console.error(e);
            return e;
        }

It fails, with "user not found".  I tried to reset the Amplify.configure just before the API. but it looks like it still try to send "Authorization" header with idToken.

How i can reset my Amplify.configure(myAppConfig) after using first API(cognito one) 

Note : After signout and if i refresh the page and try to make API query with auth mode AWS_IAM, it works fine. 
        
       

---------------

---------------

# How can I verify a Developer Authenticated Federated Identity in my REST API?

---------------

Author: @joshkh
Upvotes: 3
Comments: 0

I am using Amplify to successfully sign in my Federated Users with my Custom Developer Provider.

This is done using a combination of
`GetOpenIdTokenForDeveloperIdentity` on the back-end to fetch an IdentityID and an OpenID Token
`Auth.federatedSignIn("developer", ...)` on the front-end to fetch STS credentials

So far so good. 👍

After successfully authenticating, users interact with my REST API. However, I don't understand how to provide the user's federated IdentityId to my API in such a way that it can be verified.

Back when I was using Amplify with a simple Cognito User Pool, I could call `Auth.signInUserSession()` on the client to retrieve the user's Cognito ID JWT, and then include it with their requests to my API where the tokens were verified using the User Pool's public JWKs. From there I had a trustable identity of the user, specifically their Cognito ID from the token's subject.

It seems that with the `Auth.federatedSignIn("developer", ...)` workflow, I end up with STS credentials, which just provide authorization to service level roles. And that Open ID token from `GetOpenIdTokenForDeveloperIdentity` is short lived, and I've only seen it used to fetch STS credentials, so I don't think that's the correct way to identify the user either.

Now that my Federated Users are signed in, is there an idiomatic way to identify them when they call my REST API? Specifically, I want to trust their IdentityId.

Any help or guidance is much appreciated. Thanks!

---------------

---------------

# Does Amplify DataStore selective sync based on PK perform scan or query?

---------------

Author: @htc007
Upvotes: 2
Comments: 0

According to the docs for Amplify DataStore, you can selectively sync a subset of your data by specifying a sync expression.

If I construct a sync expression based on the partition key of the primary index (not a GSI), will the base sync perform a scan operation or a query operation? This is not clear in the docs.

If the base table contains a million items, but I only need to sync 100 specified items, a scan operation will be really inefficient and costly.

I understand that it's possible to define a sync expression that returns the partition key of a GSI (instead of the primary index) and this will perform a query operation. However, this requires me to create a GSI with a duplicate set of data just for this purpose.

It would be really helpful if someone can clarify whether specifying the partition key of the primary index in the sync expression will perform a scan operation or a query operation.

---------------

---------------

# FederatedSignin Usage For Custom Provider

---------------

Author: @hakenmt
Upvotes: 1
Comments: 0

I have a Cognito Identity Pool set up with an OIDC IdP (it's a custom one, this was all done outside of Amplify, I'm not using the CLI). I also have an existing Angular app. The experience I'm trying to create is that a not logged in user browses to the site, it sees that they are not logged in (i.e. forces login), redirects them to the OIDC site, lets them login, and then brings them back to my app with their cognito credentials (which will later be used to invoke API Gateway). Feels like this is a pretty straight forward workflow, but I cannot, for the life of me, figure out how to make this work with Amplify. I don't need user signup or an actual signin page (or even a signin button), I'm not even really interested in individual user metrics. Just enforce login, redirect to IdP, get the credentials from Cognito. That's it.

```
import { Auth, Hub } from 'aws-amplify';

awsconfig = {
  Auth: {
    identityPoolId: "us-east-1:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
    region: "us-east-1",
    mandatorySignIn: true,
  }
}
Amplify.configure(awsconfig)
...
export class AppComponent implements OnInit {
 constructor(private http: HttpClient) {
      Auth.federatedSignIn({
        customProvider: "my.oidc.example.com"
      })
  }
}
```

This doesn't work, I get `AuthError - Error: Amplify has not been configured correctly.`.  What am I missing here? Do I need to have the token from my OIDC provider before calling federatedSignin? And if so, what's the point of Amplify, I could just call Cognito directly at that point if I have to plumb the app to force the user to the OIDC first.

---------------

---------------

# [Auth] Why doesn't confirming a new account set email_verified to true?

---------------

Author: @ffxsam
Upvotes: 1
Comments: 0

I would think that if a user makes an account and clicks the verification link in their email, `email_verified` should be set to true, but it's not. Why is that? We'd rather not make the user go through another step to confirm their email when they technically already have.

---------------

---------------

# Record validation on the backend (AppSync / GraphQL)

---------------

Author: @jk171505
Upvotes: 1
Comments: 0

I'm looking for a way to validate and update records in DynamoDB table inserted by `DataStore.save()`. 
Here is the exact case:

There is a DynamoDB table (Bid) where user can add a record:
```
DataStore.save(new Bid({
  amount: 3,
  userId: <some_id>
}));
```
Let's assume there was 5 inserts into this table, so the sum of the amounts is equal 15.
Now amin approves each bid, one by one:
```
const oldBid = await DataStore.query(Bid, id);
const approvedBid = await DataStore.save(
  Bid.copyOf(oldBid, b => {
    b.bitOK = true;
  }
));
```
The thing is that the sum of all bids cannot be higher than 10, so the expected behaviour on the backend during 4th bid approval by admin would be:
1. adjust the amount of this bit to 1 (3+3+3+1 = 10)
2. delete all other bids that weren't approved yet - in this case the last one (5th)
3. trigger lambda function with parameters like: recordAdjusted, recordsDeleted

As far as I know this could be done in AppSync pipeline resolvers but I'm looking for some hints on how to accomplish this. 

---------------

---------------

# How to set proper permissions to allow post-confirmation trigger lambda function to access a REST API (both created by Amplify, getting 403 errors)

---------------

Author: @dorontal
Upvotes: 1
Comments: 1

When trying to access a REST API (that the client can access) from a post confirmation trigger lambda function, the post confirmation trigger lambda function gets back a 403 error.

Curious if anybody knows how to solve this. 

Background: Noticing that Amplify did create an IAM role for the post confirmation lambda, I attached the `AmazonAPIGatewayInvokeFullAccess` policy to the IAM role of the post confirmation lambda.

But that did not help: when trying to `GET` from a REST API (also created via Amplify) I still get 403 errors despite the attached full access policy. 

If anybody has encountered this and found the secret, please share!  Thanks!
## Comment

---------------

Author: @dorontal

Please NOTE: After trying many things, I'm now convinced this is not a question but an issue so I opened an issue here (and would continue any further discussion in that issue): https://github.com/aws-amplify/amplify-cli/issues/6589

---------------

---------------

# InAppBrowser.openAuth() never gets resolved

---------------

Author: @VivekNeel
Upvotes: 2
Comments: 0

Hi,

Recently our app got rejected by apple for social logins. So i have this solution using InAppBrowser.openAuth() but the issue is that our app never gets redirected **(because the promise does not get resolved hence Linking.openUrl never gets called)** it just redirects to the redirected url in the in app browser after logging in successfully

I have the following configuration : 

```
userPoolId: awsExports.UserPoolId,
  userPoolWebClientId: awsExports.UserPoolClientId,
  storage: MemoryStorage,
  identityPoolId: awsExports.IdentityPoolId,
  region: awsExports.Region,
  authenticationFlowType: 'USER_PASSWORD_AUTH',
  aws_appsync_graphqlEndpoint: awsExports['API-Endpoint'],
  aws_appsync_region: awsExports.Region,
  aws_appsync_authenticationType: 'AWS_IAM',
  graphql_headers: graphqlHeader,
  oauth: {
    domain: awsExports.UserPoolDomain,
    scope: UserPoolClients.mobileClientScope,
    redirectSignIn: UserPoolClients.mobileClientCallbackURLs[0],
    redirectSignOut: UserPoolClients.mobileClientLogoutURLs[0],
    responseType: 'code',
    urlOpener: delegateToInAppBrowser ? urlOpener : null,
  },
```
```
async function urlOpener(url: string, redirectUrl: string) {
  try {
    if (await InAppBrowser.isAvailable()) {
      InAppBrowser.openAuth(url, redirectUrl, {
        // iOS Properties
        ephemeralWebSession: true,
        // Android Properties
        showTitle: false,
        enableUrlBarHiding: true,
        enableDefaultShare: false,
      }).then((response) => {
        console.log('.......response', response);
        if (
          response.type === 'success'
          && response.url
        ) {
          Linking.openURL(response.url);
          InAppBrowser.closeAuth();
        }
      });
    } else {
      Linking.openURL(url);
    }
  } catch (error) {
    console.log('.......error', error);
    Linking.openURL(url);
  }
}
```
Neither catch or then block gets called after providing credentials for any provider facebook, google , apple


---------------

---------------

# Does anyone know how to validate token with cognito-identity-js ?

---------------

Author: @cnikolov
Upvotes: 1
Comments: 0

I am trying to validate my tokens and the only way I could find is to  create refreshToken object, empty CognitoUser

and to call cognitoUser.refreshSession , is that the right way ?

Lets say I have localhost/secret and I want only authenticated people to hit this endpoint and if they are authenticated I would like to get some of the attributes... currently can do but only with refreshSession , any suggestions?

---------------

---------------

# Can you Upload a Custom S3 Path without User ID prepended?

---------------

Author: @Ochaun
Upvotes: 1
Comments: 1

I'm using the Client Amplify Storage API to upload to a custom folder. I'm using the `customPrefix` option to upload to **someDir**, but when I look in S3 it is **somedir/[userUUID]**. Is there a way to set custom prefix without the UUID appended? 

```js
handleSubmit = async (e) => {
    e.preventDefault();
    await Storage.put(this.state.fileName, this.fileInput.current.files[0], {
      serverSideEncryption: serverSideEncryption,
      contentType: 'image/jpeg',
      customPrefix: {
        private: 'someDir/'
      }
    })
      .then((res) => {
        alert("all done here!");
      })
      .catch((err) => {
        console.error(err);
      });

  }
```
## Comment

---------------

Author: @Ochaun

For anyone who stumbles on this, the answer is no. The prefix settings is handled at [`_prefix`](https://github.com/aws-amplify/amplify-js/blob/566b569b4256e82aa9ac3f682f33cfe08c8597e2/packages/storage/src/providers/AWSS3Provider.ts#L474) and is referenced in all methods including [put](https://github.com/aws-amplify/amplify-js/blob/566b569b4256e82aa9ac3f682f33cfe08c8597e2/packages/storage/src/providers/AWSS3Provider.ts#L226)

---------------

---------------

# Cognito Federated Identities (Identity Pool) + SAML Authentication

---------------

Author: @ab-jfortich
Upvotes: 1
Comments: 0

Hello,

A project I am working on is currently using Cognito identity pools to allow users to login to our application using Google and FB sign-in. We are now trying to integrate authentication with our app using SAML. 

In our application, the proposed flow would be:
1) User authenticates with IdP
2) User is redirected back to our application using some endpoint to receive the SAML response
3) We pass the SAML response to AWS cognito identity to get user credentials

Is this something that is possible to do with Cognito identity pool? This is our ideal approach as the SAML assertion has some additional attributes that we would need to do processing with.

Alternatively, if we would need to pass the assertion directly to AWS cognito, is it possible to redirect to a different success URL? For example, instead of navigating to the AWS console, can we navigate back to our own application with info from the assertion?

Any help/feedback is appreciated.

---------------

---------------

# DataStore unique record per Cognito User

---------------

Author: @rraczae
Upvotes: 2
Comments: 1

Hey Everyone,

My use case is to create a UserSettings table that is restricted to have only one record per Cognito user. It's easy to set the owner of a record, however I don't see a way to guarantee the required uniqueness. My initial idea was to set the Cognito user's id as the primary key but that is not possible at the moment:

https://github.com/aws-amplify/amplify-js/discussions/5976

Any thoughts?

Best,

Rob
## Comment

---------------

Author: @mynameisguy

Did you manage to find a solution?

---------------

---------------

# Does datastore support auth mode like in API graphql?

---------------

Author: @CarlJoven
Upvotes: 1
Comments: 0

Does datastore support auth mode like in API graphql?

---------------

---------------

# How to send emails from a contact form?

---------------

Author: @screendriver
Upvotes: 2
Comments: 2

I want to build a website with a contact form. But how can I send an email out of the contact form to some persons? I'm aware of [Amazon Simple Email Service](https://aws.amazon.com/ses/) (aka `Amazon SES`) and [Netlify Forms](https://www.netlify.com/products/forms/) but is there something similar in `Amplify` out of the box?
## Comment

---------------

Author: @amhinson

@screendriver There isn't any current Amplify category that does what you're describing, but that makes for a great feature request! Feel free to open an "Feature Request" issue so we can track any additional interest from the community.
## Comment

---------------

Author: @mkaschke

In my case, I used lambda, SES triggered by the Dynamodb to do this. 

---------------

---------------

# How Hide forgot password link ?

---------------

Author: @togro
Upvotes: 4
Comments: 0

How can hide "Forgot your password" hint ?

We have an application that only with usernames created by admins .

![image](https://user-images.githubusercontent.com/7252575/107077923-4d221280-67cc-11eb-9621-47d27c89c367.png)

---------------

---------------

# Vue JS Amplify authenticator - Binding to events

---------------

Author: @ari-cv
Upvotes: 1
Comments: 0

I wanted to ask how I can implement a spinner while waiting for login from the amplify authenticator.. the loading event **doesn't** seem to fire until **just before** the login details are resolved and I am not able to use the slots implementation to customize my sign-in button with events using nuxt.js as they don't override the default contents. 

---------------

---------------

# How to get the URL of an avatar when we use Amplify Storage

---------------

Author: @syang
Upvotes: 1
Comments: 1

I wanted to build a user profile feature using Amplify Storage. Basically, I wanted to have the user to upload his avatar onto the protected folder under his Identity_ID, i.e., 
 `arn:aws:s3:::my-avatar-bucket/protected/${cognito-identity.amazonaws.com:sub}`

I have setup up my S3 bucket as instructed by [Amplify Storage S3 setup](https://docs.amplify.aws/lib/storage/getting-started/q/platform/js#using-amazon-s3)

Let's say after the avatar upload operation, the avatar file is located here:
`arn:aws:s3:::my-avatar-bucket/protected/[syang's identity id here]/avatar.jpg`

How can I get the above avatar URL and persist it into my profile record (say it's a record in a DynamoDB)? Should I use Amplify's get method (see the method below) to get the URL and post it into my DynamoDB? Or is there a way for me to configure a lambda trigger on the S3 side?

```
    // get object/pre-signed url from storage
    get(key: string, options?): Promise<String|Object>
```


## Comment

---------------

Author: @yalamber

Hello, anybody found solution for this?

---------------

---------------

# Same 2LD and different 3LD for multiple Amplify apps with common backend.

---------------

Author: @jmonguilo
Upvotes: 3
Comments: 1

Hello,

We are trying to build 3 different frontends as follows:

my-domain.com
assets.my-domain.com
admin.my-domain.com

And we want to use the same backend for them. As each frontend is in a different repository, what would be the best strategy for achieve this?

We have tried the following:

1- `amplify init` for my-domain.com app (we intend to develop the backend here).
2- `amplify pull` and manually connect app on the Amplify console for assets.my-domain.com (impossible to setup domain because already in use) 
3- `amplify pull` and manually connect app on the Amplify console for admin.my-domain.com (impossible to setup domain because already in use)

Additionally, when using `amplify init` it is not possible to set a project name with dashes (e.g.: 'myproject-assets' is not valid), whereas on the console it is possible.
We should agree that having "myprojectassetssomethingelse" as project name does not look appealing. 

Thank you.
## Comment

---------------

Author: @ernestostifano

Any recommendation about this?

---------------

---------------

# S3 private bucket storage - missing key prefix

---------------

Author: @Mac-prof
Upvotes: 1
Comments: 0

**Situation**: I have pretty standard Amplify project leveraging on Angular, Cognito authentication, Dynamo DB for tables storage and S3 for images storage. I want to have one of my Dynamo DB fields to point a key to the PRIVATE bucket, that will let me generate URL for image to be presented on the web page.

**Complication**: the Storage.put function stores properly the image file in the private bucket, putting a dedicated prefix per each Cognito user (so sort of folder). I face however a problem to programmatically get the full Key of the stored image file. The put function returns only the key that contains the file name instead of prefix + file name in a given private bucket. 

**Would you please suggest what do I do wrongly? Thank you in advance.**

While storing browser selected image I put this this way:
`
 const response = await Storage.put("NewImageName", "NewImageFile", { 
    level: 'private',
    contentType: 'image/jpg', }
 .then (result => {
          console.log('result string' + result);
      }) 
      .catch(err => console.log(err));
   }
`
It is stored in a private bucket with some prefix generated by a put function specifically for given Cognito user.

When trying to retrieve the file I need to put the key... but the key I get from the put function does not contain a prefix - it only contains the actual file name (e.g. picture.jpg), so the url does not point the stored file properly. 
`
    params = {  Bucket: 'mybucketname',
      Key: key_obtained_from_put_function,
      Expires: 120*60 };
    }
    var url = this.s3.getSignedUrl('getObject', params);`

---------------

---------------

# Conditional Sync

---------------

Author: @jonathanloos
Upvotes: 1
Comments: 1

Hello everyone!

I'm a couple weeks new to Amplify and I am loving it so far. I did see this issue: #5037 but had a slightly different application I was hoping someone here might also want/ has accomplished. I'm in the mental health sector and have found that users oftentimes don't completely trust the cloud and don't always have network connection. With this, Datastore has made it super easy for offline stuff and cloud sync, but I'd like to onboard users without the cloud (everything local) and then give them the option to sync when they're ready. By the sounds of the connected issue it doesn't sound like this is an option, but has anyone attempted this or something similar?

Thanks in advance!
## Comment

---------------

Author: @sasweb

Hey! 

I have started a discussion on this just some days ago: https://github.com/aws-amplify/amplify-js/discussions/7624
My description is more technical but I think we want the same :D 

However, as you maybe noticed the AWS team doesn't care. If you look through the issues you'll notice that there are plenty issues with most trivial requests open for months and years without any comments from Amplify contributors. They just ignore it.

My current approach for React Native is now to implement a custom solution with AsyncStorage and Firebase. Let's see if this works out better.




---------------

---------------

# GraphQL Resource/Object based Authorization

---------------

Author: @danielgeri
Upvotes: 1
Comments: 0

Hello! Currently my API is structured so that there is are public and private parts to my site using GraphQL. However, in the very near future I'm looking to structure my access rules such that there is resource-based authorization (e.g. think google docs user access - for a private document, users who are explicitly added to a "shared list" have access). Is there a best practices approach of this same concept using Amplify? 

perhaps this may also provide insight/clarity to the question:https://aws.amazon.com/blogs/apn/how-to-implement-object-based-authorization-in-serverless-applications-using-amazon-cognito/?nc1=b_rp

---------------

---------------

# How to pass items in queries?

---------------

Author: @mjza
Upvotes: 1
Comments: 1

When I use AWS AppSync and play with queries I can run a query like following which by `item` I declared what columns I need. 

```
query MyQuery {
  listUserReportsByUpdatedAt(owner: "c40aabc8-9b21-4aa5-b296-12175390e28e") {
    items {
      id
      location
      longitude
      latitude
    }
  }
}
```

When I want to do the same in js (React) what do I have to do? 

I am using this snippet of code:

```js
const apiData = await API.graphql(
      graphqlOperation(listUserReportsByUpdatedAt,
        // Sort and filter long arrays
        {
          owner: "c40aabc8-9b21-4aa5-b296-12175390e28e",
          sortDirection: 'DESC',
          limit: 100,
          nextToken: this.state.nextToken 
        }
      )
    );
```

However, I don't know how to pass items here?
## Comment

---------------

Author: @mjza

I found a work around for modifying the items in a graghql query:

```js
replaceItemsInQuery(query, items) {
    const regex = /(items\s*)({(\s*[^{]*{[^}]*})*(\s*[^}]*)*})+/gm;
    let m = regex.exec(query);
     if (m !== null && m.length>0) {
         return query.replace(m[2],items);
     }
    return query;
  }
  
  async fetchUserReportsByUpdatedAt() {   
    let query = this.replaceItemsInQuery(listUserReportsByUpdatedAt, 
      `{
        id
        location
        latitude
        longitude
       }`);

    const apiData = await API.graphql(
      graphqlOperation(query,
        // Sort and filter long arrays
        {
          owner: "c40aabc8-9b21-4aa5-b296-12175390e28e",
          sortDirection: 'DESC',
          limit: 100,
          nextToken: this.state.nextToken
        }
      )
    ); 
    this.setState({reports: apiData.data.listUserReportsByUpdatedAt.items});   
  }
``` 

---------------

---------------

# How to use and transform anonymous user to Cognito User Pool

---------------

Author: @sasweb
Upvotes: 1
Comments: 0

Hi there!

I am exploring amplify now for some weeks. 
After some research and trial & error I am still not sure if my use case will work.

My setup:
- React Native
- DataStore
- Auth

My goal:
Not a todo app but very similar. Users can create items locally. No need for real time sync with other users. However, a user may sign in from different devices. If the user is registered data should be synced between devices.

The issue:
I use a freemium model without mandatory registration. Users can use the app (offline only) right away and may never sign up. This also makes totally sense because the online option is more like a premium feature. However, as soon as the user decides to sign up (Goole and Apple sign in only, no email) the account should be transformed into a Cognito Pool User and all existing data should be synced. I have already setup both - auth and api. But it's hard to make both parts work together.

My questions:
- How can users sign up/in anonymously? I have seen some comments in the issues but no docs that clearly say how to do this. Anonymously means it's a local only user. I assume that this is needed as a preparation for the potential "upgrade" to a Google or Apple account.
- How can an anonymous user be transformed to a Cognito User Pool User? Haven't found anything on this.
- How to setup auth rules? Is this an use case for Owner based Authorization with OIDC provider?

I have added kind of an activity diagram with some notes on it. Maybe this makes it clearer.

<img width="858" alt="chart" src="https://user-images.githubusercontent.com/15066762/105909392-caf55980-6027-11eb-9c06-b206c9560388.png">

Thanks!

Edit: This is how firebase does it: https://firebase.google.com/docs/auth/web/anonymous-auth?hl=en

---------------

---------------

# Aws Amplify Auth does not work in react native app

---------------

Author: @sammy532
Upvotes: 1
Comments: 3

I want to use AWS Amplify within my react native app as suggested [here][1]: I wanted to integrate the basic usage within my app. Here is the basic usage as suggested from the docs: 

    const App = () => (
      <AmplifyAuthenticator>
        <div>
          My App
         <AmplifySignOut />
       </div>
     </AmplifyAuthenticator>
     );

My app, after adding the aws auth: 

      function App() {
        return (
          <AmplifyAuthenticator>
            <NavigationContainer>
               <SomeStack />
            </NavigationContainer>
            <AmplifySignOut />
         </AmplifyAuthenticator>
       ); 
     }

Instead of showing the authentication flow it gives me the following error: `414 Authenticator - Failed to verify contact, [Invariant Violation: View config getter callback for component amplify-authenticator must be a function (received undefined). Make sure to start component names with a capital letter.]`

Before adding the aws auth, my app was working as expected, but I don't understand where the problem is.

My `packaje.json` file:


        {
          "main": "node_modules/expo/AppEntry.js",
            "scripts": {
                "start": "expo start",
                "android": "expo start --android",
                 "ios": "expo start --ios",
                 "web": "expo start --web",
                 "eject": "expo eject"
             },
            "dependencies": {
                   "@aws-amplify/ui-components": "^0.9.8",
                  "@aws-amplify/ui-react": "^0.2.33",
                 "@react-native-community/masked-view": "^0.1.10",
                 "@react-native-community/netinfo": "^5.9.7",
                 "@react-navigation/bottom-tabs": "^5.11.2",
                 "@react-navigation/native": "^5.8.10",
                 "@react-navigation/stack": "^5.12.8",
                 "@react-navigation/web": "^1.0.0-alpha.9",
                  "aws-amplify": "^3.3.13",
                  "aws-amplify-react-native": "^4.2.10",
               "expo": "~40.0.0",
              "expo-status-bar": "~1.0.3",
             "react": "16.13.1",
             "react-dom": "16.13.1",
             "react-native": "https://github.com/expo/react-native/archive/sdk-40.0.1.tar.gz",
              "react-native-gesture-handler": "^1.8.0",
             "react-native-reanimated": "^1.13.2",
             "react-native-safe-area-context": "^3.1.9",
             "react-native-screens": "^2.15.0",
            "react-native-web": "~0.13.12"
            },
           "devDependencies": {
                  "@babel/core": "~7.9.0"
            },
           "private": true
         }
 


  [1]: https://docs.amplify.aws/ui/auth/authenticator/q/framework/react#installation 
## Comment

---------------

Author: @jo-fra

Maybe try to use the `withAuthenticator` Higher Order Component if you target React Native.
As described here:
[https://docs.amplify.aws/ui/auth/authenticator/q/framework/react-native](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react-native)
## Comment

---------------

Author: @amhinson

It looks like you're trying to use the Authenticator component for React, which will not work in React Native. You'll need to utilize the Amplify UI components built specifically for React Native [here](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react-native).
## Comment

---------------

Author: @sammy532

Thank you, this was the answer I was looking for!  

---------------

---------------

# How can we translate Cognito custom validation messages during the authentication?

---------------

Author: @ignaciolarranaga
Upvotes: 2
Comments: 0

For example, I've the authentication configured for username, email or phone, but if the user introduces the phone wrongly formatted Cognito rejects it because it is not matching any of the possible formats.

A message like this:
```
2 validation errors detected: Value '+598 99 123123' at 'userName' failed to satisfy constraint: Member must satisfy regular expression pattern: [\p{L}\p{M}\p{S}\p{N}\p{P}]+; Value '+598 99 123123' at 'userAlias' failed to satisfy constraint: Member must satisfy regular expression pattern: [\p{L}\p{M}\p{S}\p{N}\p{P}]+
```

I know I can override the slot but I would prefer not having to eject that logic for such a minor thing :)

What about something like a callback for intercepting messages before display?
P.S.: A trim before sending the userName might not be bad also.

---------------

---------------

# [PubSub] Programmatically attaching IoT policy to the current authenticated user

---------------

Author: @skilenton
Upvotes: 1
Comments: 0

I can't seem to find a way to attach iot policy programmatically in js. The guide only shows how to do it via cli. I've tried lambda triggers but identityId is hidden/undefined even in post authentication. Help pls :(

---------------

---------------

# Newly created custom attributes in Cognito not available in identity.claims

---------------

Author: @CoonHouse
Upvotes: 1
Comments: 1

Hello,
For a long time, I was using a custom attribute in my Appsync resolvers detect tenants, using ` $ctx.identity.claims["custom:tenantID"]`. This is working fine. Now I added an extra custom attribute to Cognito but I cannot access it from my resolvers. I logged the "claims' object, my tenantID is there with morevalues like 'sub', 'cognito.groups', 'iss', etc. but not my new attribute. Wwen I use te cli command `aws cognito-idp admin-get-user` my new attribute is present. 
Do I need to do additioanal actions to make them available in Appsync?

Thanks,

Wilco
## Comment

---------------

Author: @CoonHouse

I Found it!
For anyone else searching for this. Its in the Userpool settings under "App clients' -> 'Show details' -> 'Set attribute read and write permissions'

---------------

---------------

# AppSync Resolvers & Amplify DataStore

---------------

Author: @sacrampton
Upvotes: 2
Comments: 0

Our current app uses GraphQL Resolvers to create / update / delete records. We are trying to move to DataStore and have a question about using custom resolvers.

In the GraphQL Resolvers we implement logic and security (given @auth limitations with respect to subscriptions and DataStore). Here is an example - in a resolver I want to have a default value for auditCompleted - so if one is not provided in the create mutation that we default to these values.

```
#if($ctx.args.input.auditCompleted)
	#set( $auditCompleted = $ctx.args.input.auditCompleted) #else
	#set( $auditCompleted = false)
#end
$util.qr($context.args.input.put("auditCompleted", $auditCompleted))
```

Also, the resolver sets a default ID if none is provide.
```
$util.qr($context.args.input.put("id", $util.defaultIfNull($ctx.args.input.id, $util.autoId())))

```

In DataStore is there some way to use the logic in the resolvers when doing the local cache operations.

---------------

---------------

# Set token expiration with Amplify and React Native

---------------

Author: @lucianomlima
Upvotes: 2
Comments: 0

https://aws.amazon.com/about-aws/whats-new/2020/08/amazon-cognito-user-pools-supports-customization-of-token-expiration/

After reading the above blog post, I'm trying to find a way to define the expire time in a React Native with amplify, but can't find anything. Is there a way to define accessToken expire time per app?

---------------

---------------

# what does it mean if `@connection` without arguments?

---------------

Author: @yaquawa
Upvotes: 1
Comments: 0

I saw this sample code on the doc:

```gql
type Project @model {
  id: ID!
  name: String
  team: Team @connection
}

type Team @model {
  id: ID!
  name: String!
}
```

it's unclear what it's going to do compare with this example code:
```gql
type Project @model {
  id: ID!
  name: String
  teamID: ID!
  team: Team @connection(fields: ["teamID"])
}

type Team @model {
  id: ID!
  name: String!
}
```

and I can't find any info on the docs.
Does anyone know what it mean if `@connection` without any arguments?

---------------

---------------

# Extra login field (role)

---------------

Author: @TAConsulting
Upvotes: 1
Comments: 0

Hi guys,

What I'm trying to do is create an admin portal where you can sign in using username, password and ROLE - as our admins might want a different level of access.

I was able to add a new role field using the formFields property in Amplify on the front-end - but the value doesn't get sent on sign-in (by Amplify anyway), I'm trying to essentially get a value I can process in the pre-tokenGeneration trigger 

Any info appreciated!

---------------

---------------

# Sources not visible after import aws-amplify when debugging React app

---------------

Author: @richgmorg
Upvotes: 1
Comments: 0

As soon as I add "import Amplify from 'aws-amplify';" to the App.js file in a simple application created with "create-react-app" I no longer see the sources and set breakpoints when attempting to debug the application in Chrome or Firefox.

Is there a way to use the Amplify libraries and still see the source and set breakpoints in the browser?


---------------

---------------

# Customise AmplifyConfirmSignUp

---------------

Author: @debugguru
Upvotes: 1
Comments: 0

Currently AmplifyConfirmSignUp only allows code verification. We are using email link verification. Is there a way to customise the AmplifyConfirmSignUp so that it shows custom text, user email and button to take user back to sign in page?

---------------

---------------

# Should I use environment variables for my Amplify config?

---------------

Author: @marco910
Upvotes: 1
Comments: 1

Hi everyone,

Since a few months I'm working on a NextJS project with AWS Cognito as Auth Provider (the backend is a existing one, that is configured manually). If I'm using my Amplify config for server-side actions all works fine but if there is a action which is carried out in the browser I'm getting an error that Amplify is not configured correctly. 

I figured out that this is caused by the environment variables used in my Amplify config. If i put the Auth-Pool-ID etc. directly into the Amplify config all works fine.

Do I have to include the Amplify secrets with environment variables in a production version to keep my app and backend secure?
## Comment

---------------

Author: @pedramp20

Yes, you should define them in the front-end and leave them empty or set dummy values for them. Then you should define environment variable in your CI/CD pipeline and replace them on build and/or publish. 

---------------

---------------

# Easiest way to handle a 30 day check...ie a subscription check

---------------

Author: @myfairshare
Upvotes: 1
Comments: 1

Hello,

    I'm just wondering if anyone could suggest an optimal way to handle a subscription feature.  So the flow would basicly be something like...

User clicks start free subscription
I update the users subscription status in dynamodb to 'started' with a datastore update function

After 30 days I check if a payment has been received, if no payment received I update the subscription to deactivated.

Is this a scenario where I should use a cron job with a serverless function, can I access the database with these functions?

Or would some kind of JS function using Time suffice.

Any tips much appreciated, thanks!
## Comment

---------------

Author: @pedramp20

You should add a claim to your user JWT token. If you are using cognito, you should either utilise groups or define an attribute and set the attribute instead of a value in your dynamo db. Then, in your custom resolver, you should check the token and authorise the user for a specific action. For the frontend side, you should check the token and customise your view, when a user authenticates or refreshes its token.

---------------

---------------

# How to detect disgraceful disconnection of an authenticated user from a specific  graphql subscription

---------------

Author: @pedramp20
Upvotes: 1
Comments: 0

Imaging that there is a graphql subscription, where authenticated users can subscribe to. In the case of graceful connection and disconnection, of course the user can update a certain state in a DB or communicate it. However, when it comes to disgraceful disconnection, only the server (in this case AppSync) can detect it (after the connection is timed out). 
How can a lambda function be triggered on an appsync disconnection?

---------------

---------------

# I can't apply custom theme for withAuthenticator in React Native

---------------

Author: @newbie737
Upvotes: 6
Comments: 0

I want to apply a custom theme on my login screen using `aws auth` services. I tried to do so using `withauthenticator`. I read all possible information online, what people suggest, yet it doesnt work for me. I tried what was suggested [here][1] as well, but the solution doesnt work for me.
Basically, I can use `aws auth` serivces calling just `export default withAuthenticator(App, true);` That worked fine for me. However, the default sign up screen requires telephone number, which I dont want. So I created a custom config: 

  

       export default signUpConfig = {
      hiddenDefaults: ['phone_number'],
      signUpFields: [
        {
          label: 'User Name',
          key: 'username',
          required: true,
          displayOrder: 1,
          type: 'username',
          custom: false
        },
        {
          label: 'Email',
          key: 'email',
          required: true,
          displayOrder: 2,
          type: 'email',
          custom: false
        },
        {
          label: 'Password',
          key: 'password',
          required: true,
          displayOrder: 3,
          type: 'password',
          custom: false
        }
      ]
    };

After that I called my component the following way: 

       export default withAuthenticator(App, {
                includeGreetings: true,
                signUpConfig: signUpConfig}
              );
That worked fine as well. I did not see the phone number field any more. 
Here is the problematic part. I wanted to create a custom style. Nothing fancy, I just want to be able to see that I am able to apply this custom style. So I created my custom theme: 

   

       import { AmplifyTheme } from "aws-amplify-react";
    
    export default authTheme = {
      ...AmplifyTheme,
      sectionHeader:{
        ...AmplifyTheme.sectionHeader,
        color:"red",
      },
      formSection: {
        ...AmplifyTheme.formSection,
        backgroundColor: "green",
      },
      sectionFooter: {
        ...AmplifyTheme.sectionFooter,
        backgroundColor: "purple"
      },
      button: {
          ...AmplifyTheme.button,
          backgroundColor: "blue"
      }
    }

I tried so many was to apply this theme, yet nothing worked and none of the colors have been changed. Some of the things which I tried and didnt work: 
   

    export default withAuthenticator(App, {
                    includeGreetings: true,
                    signUpConfig: signUpConfig,
                    theme: authTheme });

 The app loads, but the colors are the same.

`export default withAuthenticator(App, false, [], null, authTheme);` - the app doesnt load and my expo crashes;
`export default withAuthenticator(App, false, [], null, authTheme, { signUpConfig } );` - same as the above
 
I also tried to apply just the theme, without any sign up config, but it didnt work.
Any suggestions are welcome!

  [1]: https://stackoverflow.com/questions/57464208/customize-colors-of-withauthenticator-hoc-component


---------------

---------------

# Help with Amplify and Nuxt SSR

---------------

Author: @funkel1989
Upvotes: 1
Comments: 1

Recently the amplify team provided an example of a SSR site using next.js and in the article they speak of Nuxt also:
https://aws.amazon.com/blogs/mobile/ssr-support-for-aws-amplify-javascript-libraries/

Has anyone determined how to deploy a nuxt SSR site using amplify yet?

I've done this with serverless framework where site dynamic content is deployed on a lambda and I'm trying to determine if this SSR stuff can be done with Amplify or not.

Examples would be wonderful if anyone has one yet!

Thanks for any help you may provide!
## Comment

---------------

Author: @regenrek

Hi this a pretty late response but we have an app in production which uses amplify libraries for auth. 
I have created a small reproduction repository here: https://github.com/regenrek/nuxt-aws-amplify-auth

---------------

---------------

# Token refresh with React Native, Amplify, and Apollo

---------------

Author: @joebernard
Upvotes: 4
Comments: 0

The [docs](https://docs.amplify.aws/lib/auth/advanced/q/platform/js#token-refresh) mention that automatic token refresh is not supported in React Native but they are light on details as to how this is accomplished. I assume this means I need to manually refresh the token somehow.

I understand how to retrieve a new token, but not entirely sure what to do after that or when this should be called.

```javascript
try {
    const cognitoUser = await Auth.currentAuthenticatedUser();
    const currentSession = cognitoUser.signInUserSession;
    cognitoUser.refreshSession(currentSession.refreshToken, (err, session) => {
      // do something with the new session
    });
  } catch (e) {
    // whatever
  }
};
```

I'm using the `@apollo/client` package to build my client. It exposes an `onError` [link](https://www.apollographql.com/docs/link/links/error/#retrying-failed-requests). Should I be using this to refresh tokens when an auth error occurs, or is there a better approach? If I switched to the `aws-appsync` would token refresh be handled automatically? An example of how others are handling this within React Native, Amplify, and Apollo 3 would be great.

---------------

---------------

# No credentials error when using Storage.put

---------------

Author: @kieranjen
Upvotes: 1
Comments: 1

I'm putting this here because I'm not sure if it's a bug or something incorrect with my config.

I have a Cognito user pool and S3 bucket configured outside of Amplify.

I configure Amplify with the following:

```
Amplify.configure(Auth: {
        identityPoolId: IDENTITY_POOL_ID,
        region: REGION,
        userPoolId: USER_POOL_ID,
        userPoolWebClientId: APP_CLIENT_ID,
        identityPoolRegion: REGION,
        mandatorySignIn: true
    },
    Storage: {
        AWSS3: {
            bucket: UPLOAD_BUCKET,
            region: REGION,
            level: 'private'
        }
    },
    API: {
        endpoints: [
            {
                name: 'apis',
                endpoint: API_ENDPOINT,
                region: REGION
            }
        ]
    });
```
To then upload to S3 I do the following:

```
Auth.currentUserCredentials()
            .then(() => {
                Storage.put(selectedFile.name, selectedFile, {
                    contentType: selectedFile.type,
                })
                    .then(() => {
                        console.log('Uploaded');
                    })
                    .catch((err) => console.log(err));
            });
```

An error is caught when calling `Storage.put`, which prints out `No credentials`.

I have enabled debug with `window.LOG_LEVEL = 'DEBUG'`. The following is the output:

```
[DEBUG] 02:20.479 AuthClass - Getting current user credentials ConsoleLogger.js:97
[DEBUG] 02:20.480 AuthClass - Getting current session ConsoleLogger.js:97
[DEBUG] 02:20.481 AuthClass - Getting the session from this user: 
Object { username: "<username>", pool: {…}, Session: null, client: {…}, signInUserSession: {…}, authenticationFlowType: "USER_SRP_AUTH", storage: Storage, keyPrefix: "CognitoIdentityServiceProvider.<output>", userDataKey: "CognitoIdentityServiceProvider.<key>.userData", attributes: {…}, … }
ConsoleLogger.js:107
[DEBUG] 02:20.483 AuthClass - Succeed to get the user session 
Object { idToken: {…}, refreshToken: {…}, accessToken: {…}, clockDrift: 0 }
ConsoleLogger.js:107
[DEBUG] 02:20.483 AuthClass - getting session success 
Object { idToken: {…}, refreshToken: {…}, accessToken: {…}, clockDrift: 0 }
ConsoleLogger.js:107
[DEBUG] 02:20.484 Credentials - set credentials from session ConsoleLogger.js:97
[DEBUG] 02:20.655 Credentials - Load credentials successfully 
Object { identityId: "<identity>", accessKeyId: "<access key>", secretAccessKey: "<secret key>", sessionToken: "<session token>", expiration: Date Thu Jan 14 2021 13:02:20 GMT+0000 (Greenwich Mean Time) }
ConsoleLogger.js:107
[DEBUG] 02:20.655 Credentials - getting credentials ConsoleLogger.js:97
[DEBUG] 02:20.655 Credentials - picking up credentials ConsoleLogger.js:97
[DEBUG] 02:20.655 Credentials - getting new cred promise ConsoleLogger.js:97
[DEBUG] 02:20.655 Credentials - checking if credentials exists and not expired ConsoleLogger.js:97
[DEBUG] 02:20.655 Credentials - need to get a new credential or refresh the existing one ConsoleLogger.js:97
[WARN] 02:20.656 AWSS3Provider - ensure credentials error No Auth module registered in Amplify react_devtools_backend.js:2430:23
No credentials
```

I have found various issues relating to this but the solutions haven't worked. The output looks ok to me up until the `AWSS3Provider` warning.

Here are the amplify packages I have in my `package.json`:

```
"@aws-amplify/api": "^3.2.17",
"@aws-amplify/auth": "^3.4.17",
"@aws-amplify/cache": "^3.1.42",
"@aws-amplify/core": "^3.8.9",
"@aws-amplify/storage": "^3.3.17",
```

Can anyone tell me if I have configured something wrong?
## Comment

---------------

Author: @kieranjen

This was fixed by deleting `package-lock.json` and `node_modules` and then running `npm install`.

---------------

---------------

# IAM Access to amplify graphql apis

---------------

Author: @shweta-codeprism
Upvotes: 1
Comments: 0

Some of my graphql apis are being consumed by lambdas using appsync. To make it possible I have to allow iam access to the api by adding (@aws_iam) tag in the schema from the AWS Appsync console . 

The issue is, every time I update my schema, the tags get deleted ( This is reasonable because "amplify push" is actually updating the schema) and I have to reset the (@aws_iam) tags for the required apis and connections.

Is there a way to persist it ?

---------------

---------------

# Are there any new events that will be available for Interactions outside of chatCompleted?

---------------

Author: @patweb99
Upvotes: 1
Comments: 0

Currently, the only Interactions event that is available is chatCompleted. 

It would be great to have some of the following
1. chatTextSent & chatVoiceSent: Whenever a new chat message is sent to lex
2. chatTextReceived & chatVoiceReceived: Whenever a new change is received
3. chatStart: Whenever the chat has started

---------------

---------------

# Are there any to create more events such as chatCompleted for Interactions available?

---------------

Author: @patweb99
Upvotes: 1
Comments: 0

Currently, the only Interactions event that is available is chatCompleted. 

It would be great to have some of the following
1. chatTextSent & chatVoiceSent: Whenever a new chat message is sent to lex
2. chatTextReceived & chatVoiceReceived: Whenever a new change is received
3. chatStart: Whenever the chat has started

---------------

---------------

# Whats the point of using ```Auth.currentAuthenticatedUser()``` to update user attributes

---------------

Author: @Salmandabbakuti
Upvotes: 1
Comments: 0

I found below code snippet in the amplify auth library usage documentation [Here](https://docs.amplify.aws/lib/auth/manageusers/q/platform/js#managing-user-attributes)
```
let user = await Auth.currentAuthenticatedUser();

let result = await Auth.updateUserAttributes(user, {
    'email': 'me@anotherdomain.com',
    'family_name': 'Lastname'
});
console.log(result); // SUCCESS
```
I'm wondering why we're using ```Auth.currentAuthenticatedUser()``` to update user attributes? what if there's a new user ```user2``` who just logs in while we're in process of updating user ```user1``` attributes. so the ```Auth.currentAuthenticatedUser()``` will now points to the user ```user2``` who just logs in and we end up updating new user attributes(```user2```) instead of ours? (```user1```).  isn't that a big issue or am I missing anything here?

---------------

---------------

# AmplifySignIn component - setting value

---------------

Author: @0x54321
Upvotes: 1
Comments: 0

The `formFields` property on the `<AmplifySignIn>` component [seems to allow](https://github.com/aws-amplify/amplify-js/tree/main/packages/amplify-ui-components/src/components/amplify-form-field#properties) for controlling the value of the inputs, like so:

```
     <AmplifySignIn
          slot="sign-in"
          formFields={[
            {
              type: "text",
              label: "Username",
              value: usr,
              handleInputChange: (e) => setUsr(e.target.value),
            },
            {
              type: "password",
              label: "Password",
              value: pwd,
              handleInputChange: (e) => setPwd(e.target.value),
            },
          ]}
        />
```

However, this doesn't actually work. It throws `Cannot read property 'bind' of undefined`, in the function `handleFormFieldInputWithCallback`. Am I missing something?

---------------

---------------

# Angular Amplify Error Handler - GraphQL API Calls

---------------

Author: @malcomm
Upvotes: 1
Comments: 1

I am using a "global error handler" per: [ErrorHandler](https://angular.io/api/core/ErrorHandler) and it is trapping the errors for calls made the APIService. The problem: the error that is being received by this:

```
handleError(error: any): void {
}
```

Ends up being an object, which looks like this:

```
Error: Uncaught (in promise): Object: {"data": .... },"errors":[{"path":["listPractitioners","items",35,"sites"],"data":null,"errorType":"DynamoDB:ApiCallTimeoutException","errorInfo":null,"locations":[{"line":8,"column":7,"sourceName":null}],"message":"Client execution did not complete before the specified timeout configuration: 10000 millis"}]}
    at resolvePromise (https://www.foobar.com/polyfills.js:1044:23)
    at https://www.foobar.com/polyfills.js:935:11
    at rejected (https://www.foobar.com/vendor.js:373291:89)
    at ZoneDelegate.invoke (https://www.foobar.com/polyfills.js:461:160)
    at Object.onInvoke (https://www.foobar.com/vendor.js:300569:25)
    at ZoneDelegate.invoke (https://www.foobar.com/polyfills.js:461:48)
    at Zone.run (https://www.foobar.com/polyfills.js:187:37)
    at https://www.foobar.com/polyfills.js:1112:28
    at ZoneDelegate.invokeTask (https://www.foobar.com/polyfills.js:494:173)
    at Object.onInvokeTask (https://www.foobar.com/vendor.js:300557:25)
```

If I put a try/catch around the APIService call, then I get `GraphQLResult` as the error:

```
    try {
      const result = await this.apiService.ListSomething();
    } catch (error) {
      // error here is a GraphQLResult { "data": ... }, "errors": []
      this.errorService.graphqlResult = error;
      throw error;
    }
```

Without the try/catch, my global error handler gets a wrapped `GraphQLResult` object with stack trace and an error message. I'm trying to avoid having to put a try/catch all over my code and still get the `GraphQLResult`. The above try/catch is the best workaround I've found so far.

Another workaround: parse out the `GraphQLResult` from error object in the error handler ... this is less than ideal and seems backwards.

1. So in general, what's the best practice here?
2. Is there another way to still have the global error handler, but get the actual error object?

Thank you!
## Comment

---------------

Author: @malcomm

So this might have been super obvious to other folks out there but it wasn't for me. You can get at the original `GraphQLResult` by looking at the `error.promise` and `error.rejection`. So in your handleError method:

```
  isGraphQLResult(rejection: any): boolean {
    return rejection !== undefined && (rejection.data !== undefined || rejection.errors !== undefined);
  }

  handleError(error: any): void {

    if (error !== undefined && this.isGraphQLResult(error.rejection)) {
      const graphqlResult: GraphQLResult = error.rejection as GraphQLResult;
      // handle the graphqlResult
    }
  }
```

Honestly didn't know that `error.promise` and `error.rejection` were even there ... I guess I missed the memo on that one.

---------------

---------------

# Override AmplifyAuthenticator components

---------------

Author: @emilyDZC
Upvotes: 2
Comments: 0

I'm using the AmplifyAuthenticator from `@aws-amplify/ui-react`, and I'm trying to replace the ConfirmSignUp component with our own custom component. 

This worked well in react-native (using the Authenticator from `aws-amplify-react-native`) by using the 'override' feature, eg. `<CustomConfirmSignUp override='ConfirmSignUp' />`. 

However, this feature doesn't seem to exist in the react-ui AmplifyAuthenticator. 

Does anyone have any suggestions?

---------------

---------------

# Analytics: Can I export Cognito User Pool email addresses to AWS Pinpoint?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 0

Hello, I am using Amplify Analytics and I would like to send a survey to my users! 
Since I am also using Cognito, is there a way to export email addresses to Pinpoint to create a campaign?

I already tried to "add analytics and user campaigns to this user pool" on the Cognito Analytics tab with "share user profile data" but it did not work.
Thank you for your help 🙏

---------------

---------------

# Amplify custom UI - how to use Auth JWT for api calls to GraphQL, Rest, or DataStore??

---------------

Author: @bjm88
Upvotes: 1
Comments: 0

I am using Amplify frontend and backend, but with custom UI for Auth flows.  The React/JS libraries have nice Auth.signIn, .signUp, etc simple calls to make and can hook those up in my custom react UI pages.

Also the Amplify API.GraphQL, API.Rest, and Datastore.save all seem very nice.  The gap seems to be connecting both, the documentation seems to think authentication is just taken care of somewhere else or assuming you are using the "withAuthenticator" wrapper, which would be nice to use except very hard to customize fully.  Without using "withAuthenticator" higher order component or wrapper, HOW DO WE GET AN ACCESS TOKEN FROM Auth. and pass it to the API layers??????

Assuming something like this would exist:

DataStore.configureAuthHeaderPreflight = () => (await Auth.currentSession()).getIdToken().getJwtToken())


---------------

---------------

# Encoding customState for OAUTH redirect

---------------

Author: @elchicofrommo
Upvotes: 1
Comments: 0

Hello, I've got my system set up so I can transfer my auth session between one device an another using the Access Token, id Token constructing a redirect that piggy backs off the same oauth redirect that I use for social log in. The problem I have is when I updated my library I lost the ability to programmatically set the state attribute ... I guess Amplify prepends some typechecked value to the beginning of the custom state that I can't seem to replicate on my own. So when I'm listening to the hub for custom state it always comes across as junk. Can anyone tell me what I need to prepend to get this field processes in the normal manner and generate good data in the hub?

---------------

---------------

# Integrate Amplify React app in a wordpress site

---------------

Author: @myfairshare
Upvotes: 1
Comments: 0

Hello,

   Could anyone suggest if this is possible, I have a wordpress site/blog and would like to integrate my amplify app into that site, can that be done, thank you.

---------------

---------------

# How To Use Fedarated Authentication Using Custom Provider

---------------

Author: @andy2sey
Upvotes: 2
Comments: 0

Hello,

I am using AWS Amplify and I would like to federate my user login through a specific provider (not one of the currently supported).   I am struggling to find clear documentation on how to accomplish this and I hoping someone can point me in the right direction.  This is ultimately a React Native application using Expo.  I am able to retrieve an access token from my provider using Expo's AuthSession.

My Questions Are:

1. Is this the correct way to go about this with Amplify?  Should I get the token first and then pass this into Amplify's Auth?
2. Can I pass my provider's authorization URL endpoint into Amplify instead and have the Amplify handle it?
3. Is there a better way to do this?

Happy to clarify any questions, I am new to Amplify and still learning terminology.  

---------------

---------------

# Handling Caching in my Amplify app

---------------

Author: @myfairshare
Upvotes: 1
Comments: 0

Hello,

     I am currently creating an app with amplify and DataStore, caching is an area I'm not very strong in.  

I have two different types of users in the app, I have signed myself up as one of each with two different email accounts.  When I sign out and sign in I need to do a hard refresh otherwise stale data is picked up.

I have tried DataStore.clear() on signout but that doesnt help.  If anyone could point me in the right direction that would be great, thank you.

---------------

---------------

# What you can do with your client ID

---------------

Author: @funawo
Upvotes: 1
Comments: 0

I want to know what you can do with a client ID in an app that uses Amplify.
I think I can operate my own user stored in the user pool, but I am wondering if I can operate a third party user

---------------

---------------

# Are cognito client apps potentially hackable?

---------------

Author: @Xumeiquer
Upvotes: 1
Comments: 1

Hi there, I am starting with Amplify and Cognito and I having some questions about the security of my application.

My use case is (at the moment) a webapp (without server side) used only for signing up users. As this application only runs on client-side any kind of key is public, which is also mentioned in the AWS documentation and I am also agreed with that. On the other hand, Amplify `Auth` section gets configured with *region*, *identity pool region*, *user pool id*, and *user pool web client id*. Remember all public information, there is no server side and the application is fully running on client-side.

As my application is only used for signing up user I do not configure oauth2, which is also not required based on the Amplify documentation.

My concern is, how can I avoid anyone to take my public _keys_ and use them on another application or using a malicious use of them, like signing up thousands of users? Perhaps, should I user lambda for doing the sign up?

 Thank you.
## Comment

---------------

Author: @gmreburn

A lambda function can work but I suggest deploying an API Gateway and route your application's communication to API Gateway instead of AppSync. API Gateway can forward the request with the API Key configured in AppSync (keep that API key private). API Gateway supports WAFs, AWS Shield, usage plans, and custom authorizers.

---------------

---------------

# Angular-Testing: Cannot read property 'aws_appsync_region' of null

---------------

Author: @marcelkipp
Upvotes: 1
Comments: 0

We are using Ionic/Angular for our app. We want to use the angular integrated testing but facing the following error:

`TypeError: Cannot read property 'aws_appsync_region' of null`

Did somebody faced that issue before or is running angular testing with angular and amplify js and has some advise?

---------------

---------------

# Getting 403 with Amplify’s API even though I’m signed in

---------------

Author: @ammarasmro
Upvotes: 1
Comments: 0

Considering that I have included all the required portions to set a project up until running `Amplify.configure(....)` portion including
- Installing `aws-amplify` and `@aws-amplify/ui-vue`
- `const { Amplify, Auth, API } = require('aws-amplify')`
- Setting up Lambda functions - UserPool with a test user, Identity Pool with permissions for API gateway
- Setup permissions for API gateway to use the userpool as the authorizer

When I run `Auth.signIn('email@domain.com', 'password')`. It is succeeding. When I take the retrieved access token and test it in the Cognito authorizer tester, it is succeeding. When I run `API.get('apiname', '/api/path/requiring/authentication')` It is failing. Sometimes with 403 and others with 401 codes. Am I missing something? Do I need to explicitly provide auth headers?

FYI
If I remove the auth requirement in API gateway on the same paths, API.get... is working so the issue seems to be with the Auth parts

---------------

---------------

# How can I improve app loading experience with Hub.listen() and React Hooks?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 0

I am currently using a splashscreen to delay the rendering of my app while waiting for the async calls to complete.

```javascript
const App = () => {
  const [isAppReady, setAppReady] = React.useState(false);
  
  if (!isAppReady) {
    return (
      <AppLoading
        startAsync={_cacheResourcesAsync}
        onFinish={()=>setAppReady(true)}
        onError={console.warn}
    />
    )
  return (
   ...
  )
  }

 async function _cacheResourcesAsync() {
  
  const fonts = await Font.loadAsync({
    ...MaterialCommunityIcons.font,
  });

  return fonts;
}
```

***startAsync** (function) is A function that returns a Promise, and the Promise should resolve when the app is done loading required data and assets.*

It works well for loading fonts. However I was not able to use it with datastore sync.

I would ideally like for the datastore to be ready before rendering the app using **Hub.listen()**:

```javascript
async function loadDataStore() {
      try {
        await DataStore.start();
      } catch (e) {
        console.warn(e);
      } finally {
        const removeListener = Hub.listen("datastore", async (data) => {
          const { payload } = data;
          if (payload.event === "ready") {
            removeListener();
            return Promise(true)
          }
        });        
      }
    }
```

However if I use loadDataStore function in the **startAsync** parameter, it does not wait for the datastore to be ready
```javascript
return (
      <AppLoading
        startAsync={loadDataStore}
        onFinish={()=>setAppReady(true)}
        onError={console.warn}
    />
    )
```

Is there a way to return a Promise only when the DataStore is ready?

---------------

---------------

# Clientid of Cognito

---------------

Author: @funawo
Upvotes: 1
Comments: 0

Quoted from a forum article.
If you know the content of the article, please tell me

https://forums.aws.amazon.com/thread.jspa?messageID=889721
>I have a javascript application integrated with cognito, using javascript SDK. The SDK requires user pool Id and Client Id, to connect with congnito. Everything works fine, no issues.

>My concern is that, should I hide these client-id and userpool-id from javascript code, so that the users wont be able to see from the sources (in the browser). or these public information ?

---------------

---------------

# Upgrading Authenticator to AmplifyAuthenticator

---------------

Author: @mpcooke3
Upvotes: 3
Comments: 0

In react with the older <Authenticator> component I was able to prevent the initial sign-in dialog coming up immediately like this:
<Authenticator hideDefault={'true'} authState={'none'}>

And then trigger it later with:
onStateChange('signIn',{}) 

Is there an equivalent or any alternative way to trigger the SignIn component manually using AmplifyAuthenticator?


---------------

---------------

# Storage module for a multi-tenant application

---------------

Author: @Albert-Gao
Upvotes: 2
Comments: 0

There is 3 access levels listed on this page: https://docs.amplify.aws/lib/storage/configureaccess/q/platform/js

- Public: Accessible by all users of your app. Files are stored under the public/ path in your S3 bucket.
- Protected: Readable by all users, but writable only by the creating user. Files are stored under protected/{user_identity_id}/ where the user_identity_id corresponds to the unique Amazon Cognito Identity ID for that user.
- Private: Only accessible for the individual user. Files are stored under private/{user_identity_id}/ where the user_identity_id corresponds to the unique Amazon Cognito Identity ID for that user.

However, none of them are adding constraints to a group of people.

Is there an Amplify way to upload files to S3 with access control only to a group of people?


---------------

---------------

# Datastore Relational models with combo keys and Id naming convention

---------------

Author: @amirmishani
Upvotes: 1
Comments: 0

I'm new to Datastore and while designing my schema, I was looking at [relational models docs](https://docs.amplify.aws/lib/datastore/relational/q/platform/js) and came across the following:

> When using the `@key` directive with DataStore, as long as you specify a `name` you can use any value(s) in `fields`. However, if the `name` property is omitted, the first item in the `fields` array must be `"id"`. E.g., `@key(fields: ["id", "content"])`.

My schema is for a multi-tenant setup requires a hash-sort combo key with the tenantId being the hash and looks something like this:

```graphql
type Tenant @model {
   id: ID!
   # ... more fields
}

type User @model @key(fields: ["tenantId", "id"] {
   tenantId: ID!
   id: ID!
   # ... more fields
}
```

Using the above model each tenant can only list items based on matching `tenantId` hash key and therefore all the sort `id`'s become a uniqueId in the client cache.  

So my question is that is it just about the `name` of the field being `id`  or does the docs mean that the unique id must always be the hash field? I guess I'm asking whether renaming the uniqueId to `userId` and renaming the `tenantId` to `id` and changing the schema to looks like the following would work:

```graphql

type User @model @key(fields: ["id", "userId"] {
   id: ID!
   userId: ID!
   # ... more fields
}
```
Or is there something deeper involved? For example I know in Apollo if you change the uniqueId field name to something other than `"id"` can mess with your cache so you would need to specifically tell Apollo to replace `id` with `userId` using `dataIdFromObject` in your client configuration.


---------------

---------------

# Max S3 Signed URL length

---------------

Author: @giorgiocarniel
Upvotes: 2
Comments: 0

Hi everyone,

we are using a Lambda to generate a signed URL to get a file from an s3 Bucket.
I'm wondering if there is a maximum length of the generated URL.

By doing some tests I see it is around 1220 characters, but It changes from a call to another.

Does anyone know the max length of that URL?

Thanks!

---------------

---------------

# I18n - Default Vocabulary

---------------

Author: @ViepleJimJames
Upvotes: 1
Comments: 0

Hey, I am successfully initialising and using I18n in my angular project. The problem I'm having is if I am not supporting a language in my custom vocabulary, how do I have the browser default to one of the supported ones?

Thanks in advanced, I couldn't find anyone else discussing this sort of issue here.

---------------

---------------

# Is It possible to receive notifications with debug mode?

---------------

Author: @
Upvotes: 1
Comments: 0

My app gets notifications when I use Ad Hoc. But using Ad Hoc is impossible to debug. Did someone being able to receive notifications using debug mode ? Is it possible?

---------------

---------------

# AppSync List API - Database returned more than the allowed response size limit

---------------

Author: @stayingcool
Upvotes: 1
Comments: 1

**Issue:**
AppSync List API throws this error and returns a null response:

> "error": {
>             "message": "RDSHttp:{\"message\":\"Database returned more than the allowed response size limit\"}",
>             "type": "400 Bad Request"
>         },

I understand that there is a 1 MB response limit, hence the above error is thrown.

**My requirement** is to be able to **run a report** to pull all the records within a month. My resolver has a simple select statement with a where clause on the date column to filter records for that period. 
I cannot place a limit clause in the select statement as there is already a filter (where clause) to reduce the number of items returned.

**My Environment:**
"react": "^16.12.0",
Amplify CLI version:  4.25.0
"aws-amplify": "^3.3.4"
amplify-serverless using Aurora MySQL (default.aurora5.6)

**What can we do to meet the requirement?**
## Comment

---------------

Author: @stayingcool

Is there anyone who can provide some guidance? This seems to be a show stopper for me to proceed with AppSync.

---------------

---------------

# What is the best way to handle different clients versions ?

---------------

Author: @maximelebastard
Upvotes: 1
Comments: 0

Hi !

I'm adding a mobile app to my existing amplify API and web app.
As some of you may know, the issue with mobile app is updates. We can have a few days, weeks or even months where a previous version of the app will still request the API.

This is an issue when deleting a GraphQL field, renaming one or adding a new mandatory field.

Do you guys already deal with that ? Do you have some advices ?

Thanks

---------------

---------------

# Amplify authentication without Cognito

---------------

Author: @SZubarev
Upvotes: 1
Comments: 0

Hi,

Can Amplify's authentication be used with other OpenID identity providers without Cognito? We are building an app for a AWS region where Cognito is not available, can we still use Amplify authentication mechanism?

---------------

---------------

# Is there a way to do user-defined groups and secure with @auth?

---------------

Author: @fabianjj
Upvotes: 1
Comments: 0

I'm writing an application with public sign-up where users need to be able to collaborate in user-defined groups
There should be space for a lot of groups. I.E. I want to be able to scale to 10 million groups, I won't have 10 million groups, but if there's a limit of ~50 groups, then it's not really the right mechanism for my use case.

These groups will be created by and managed by the users. E.g. any user can invite any other user to any group that they themselves are a member of, and any member of a group can see and edit the group's content (except for some content that can be viewed by group members but only edited by the content's owner). If you are not a member of a given group, you can neither see not edit the content associated with that group.

In order to enforce the security of the data in this model, I was looking at using the @auth directive somehow to make sure that no object could be CRUDLed without the proper authorization. 

But from what I can tell, it looks like Cognito User Groups is the only method to enforce that, and Cognito User Groups doesn't seem to be designed for that purpose. The administration in examples seems to be more oriented towards internal corporate applications where I might have a small set of predefined user groups ("Writers", "Editors"), and a special case for the one individual owner for each object.

I don't mind going a little bit beyond the most basic implementations, I can have a look at lambda triggers, custom resolvers, the aws-api, etc., if that helps. But I don't want to go to far into this implementation if it's likely that I run into roadblocks or try to use the system in ways that will cause it to fight back, or if I have to do a lot of workarounds at every step.

Is there a way to implement user-defined user groups the way I want in order to secure access to the data? Have I missed something fundamental about how this works?
Or am I thinking about this the wrong way? Should I be separating this on some other way? Is there a different way in which I should thinking about? Or Is the Amplify back-end not really meant for this use case? 

My ideal implementation would be a simple type in the graphql schema that could contain a list of unique user identifiers, editable by any user whose identifier is part of the list, and a way to attach a reference to that object to the authrules of an object to ensure only the right users have access.

---------------

---------------

# Forget Device doesn't invalidate refresh token?

---------------

Author: @march08
Upvotes: 1
Comments: 0

Hey guys, I am using `CognitoUser.forgetSpecificDevice`, this will successfully remove the device from the `forgetSpecificDevice.listDevices` but doesn't invalidate the refresh token and still allows actions on the forgotten device. Is this expected behaviour? How should I invalidate the refresh token on the forgotten device? Thank you

---------------

---------------

# Calling AppSync from Lambda

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 0

I've been trying to call AppSync from a lambda function (both created using the aws-amplify cli), but I can't find any documentation that are both up to date and complete. For instance, I came across an article about [building a client app using aws-mobile-appsync-sdk](https://docs.aws.amazon.com/appsync/latest/devguide/building-a-client-app-node.html), but that library hasn't been touched in 5mo and seems like overkill in a nodejs environment. So, does anybody know if there is a standard or recommended way of calling AppSync from a lambda function? Any help is appreciated

---------------

---------------

# Polymorphism + GraphQL via AWS Amplify

---------------

Author: @mansdahlstrom1
Upvotes: 1
Comments: 0

Hello, I'm wondering about polymorphism + GraphQL via AWS Amplify

In it's simplest form, i would want to be able get an "Event"  and based on the enum in the event called "type" i want to only get data from another @model, see my psuedo code bellow. 

```

enum EVENT_TYPES {
  CUSTOM_EVENT_1
  CUSTOM_EVENT_2
  CUSTOM_EVENT_3
  CUSTOM_EVENT_4
}

@model
type CustomEvent1
{
  id: ID!,
  ...some more data
}
@model
type CustomEvent2
{
  id: ID!,
  ...some more data
}

union PolymorphedModel = CustomEvent1 | CustomEvent2

@model
type Event
{
  id: ID!,
  eventId: ID!,
  type: EVENT_TYPES!,

  eventData: PolymorphedModel @connection(fields: ["eventId"])
}
```

Is this possible with AWS Amplify? I havn't been able to find anything regarding polymorphism and aws amplify so far and my backup solution currently is something like this https://github.com/aws-amplify/amplify-cli/issues/5152 . But support for this is currently in a PR here https://github.com/aws-amplify/amplify-cli/pull/5153

Thanks!

---------------

---------------

# Cant get UserAttributes from a cognito user.

---------------

Author: @nschneider-sommset
Upvotes: 1
Comments: 0

In my code Im unable to get userAttributes from a user who has signed in with google.
```
  const cognitoUser = await Auth.currentAuthenticatedUser()
  await cognitoUser.getUserAttributes((data) => {
      console.log({ data })
  });
```
the data being logged is:
code: "NotAuthorizedException"
message: "Access Token does not have required scopes"
name: "NotAuthorizedException"

I have enabled read/write permissions for all attributes.
Any idea of what I could be missing?

---------------

---------------

# How do I get a list of remembered devices?

---------------

Author: @rlaphoenix
Upvotes: 2
Comments: 0

What would be the amplify alternative to `cognitoUser.listDevices(10, null, callbacks)`?

I cannot find anything related to it.

---------------

---------------

# what happens when use `@auth` without the `operations` argument?

---------------

Author: @yaquawa
Upvotes: 1
Comments: 0

I saw a lots of examples in the doc which omit the `operations`, for example:

```gql
# The simplest case
type Post @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  title: String!
}

# The long form way
type Post
  @model
  @auth(
    rules: [
      { allow: owner, ownerField: "owner", operations: [create, update, delete, read] },
    ])
{
  id: ID!
  title: String!
  owner: String
}
```
does this mean if omit the `operations` argument, the default value is going to be `[create, update, delete, read]` ? even if the `allow` was not set to `owner` for example `public`

```gql
# The simplest case
type Post @model @auth(rules: [{ allow: public }]) {
  id: ID!
  title: String!
}
```
Does the above mean:  ?
```gql
type Post
  @model
  @auth(
    rules: [
      { allow: public, ownerField: "owner", operations: [create, update, delete, read] },
    ])
{
  id: ID!
  title: String!
  owner: String
}
```

---------------

---------------

# How do I use Cognito Hosted UI with Amplify?

---------------

Author: @icecog
Upvotes: 1
Comments: 1

I feel like I'm trying to do something quite straight forward, but I'm not able to figure it out.
Someone please help me.

I'm using AWS Amplify with Svelte. I do not want to develop and maintain my own login flows and so I thought I'd just use the Hosted UI. Simple enough.

I've configured the Redirects in Cognito User Pool App Clients and I'm getting the callback with response_type=code or response_type=token.

How do I get Amplify to grab the credentials for the logged in user?

I have configured Amplify with my Cognito user pool and identity pool already, and can use Auth.SignIn(...). But I don't want to build the UI myself.

I've spent the better part of 20h on this and feel like mush.
## Comment

---------------

Author: @icecog

Well, I guess I'm just stupid.

I had never actually updated / refreshed my 'Amplify import Auth' after configuring the domain and redirect uri's of the Cognito User Pool.

As soon as I did that I got the '"oauth": {' section of my aws-export.js file filled in and then it magically worked.

Once again, I feel like the Amplify documentation fucks with you by omitting details of what it uses to create its magic.

---------------

---------------

# API security for public reads and cognito groups

---------------

Author: @amlcodes
Upvotes: 1
Comments: 0

via CLI - if I allow unauthenticated access, as well as configuring IAM as an additional auth type and then configure my schema around public reads and cognito group access - do I have to programmatically fetch data with and without using         authMode: 'AWS_IAM' in API.graphql() based on Auth.currentCredentials() ? If I were to use DataStore instead, How would would I specify using IAM authmode for public users? 

---------------

---------------

# FormData and Amplify Rest API

---------------

Author: @shweta-codeprism
Upvotes: 1
Comments: 0

How are we supposed to send formData over Amplify Rest Api ? 
` const formData = new FormData();
  const init= {
    body: formData,
    headers: {
        Accept: "application/json"
    }
  };
API.post('api', 'path', init);  // *API gateway binary type updated
`
is allowing us to send the data, but ends up receiving status 0 over xhr call
@tom-rb , I have taken your fix, but I seem to be doing something wrong :(

---------------

---------------

# Errors using in-app-browser in React Native

---------------

Author: @JPilawka
Upvotes: 1
Comments: 0

**Describe the bug**
We have a problem with in-app-browser configuration of amplify authorization in react native (0.61).
We use the same in-app-browser which is recommended in docs.amplify, react-native-inappbrowser-reborn. The plugin on it’s own works fine, both standard .open() and .openAuth() functions. Also authorization with an outside-app browser works fine.
But when we try to connect in-app browser according to documentation: "Social sign-in (OAuth)" the  browser doesn’t start, we get error: „TypeError: Cannot read property 'oauthSignIn' of undefined”
The only changes we made in code apply only to Amplify.configure() object:
Amplify.configure({
  …CONFIG,
  oauth: {
    ...CONFIG.oauth,
    urlOpener,
  },
});

We have a custom CONFIG, not generated by CLI, below you can find the CONFIG object. 
CONFIG: {
  Auth: {
    region: 'eu-central-1',
    userPoolId: 'eu-central-1_XXXXXXXXX’,
    userPoolWebClientId: ‚XXXXXXXXXXXXXXXXXX’,
    oauth: {
      domain: ‚XXXXXXXXXXXXXX.auth.eu-central-1.amazoncognito.com',
      scope: ['email', 'openid'],
      redirectSignIn: 'app-name://signIn',
      redirectSignOut: 'app-name://signOut',
      clientId: ‚XXXXXXXXXXXXXXXXXX’,
      responseType: 'code',
      urlOpener: null,
    },
  },
},

The urlOpener property was added after the error occurred but it didn’t change anything.

We also tried to use it with HOC withOAuth but IDE (WebStorm) can’t recognize any of the methods from aws-amplify-react-native, warning: „Cannot resolve symbol 'withOAuth' „.
Importing of methods is done exactly as it is in documentation: with destructuring.
Yet we get an error: „TypeError: Cannot read property 'urlOpener' of undefined”.
We tried to find the solution but none works.

**Plugins versions**
"amazon-cognito-identity-js": "^4.5.4",
"aws-amplify": "^3.3.8",
"aws-amplify-react-native": „^4.2.9",

Newest aws-amplify 3.3.11 version gives us error with aws-sdk as it cannot see ./configure in it’s node_modules folder

---------------

---------------

# Using yarn instead of npm to install function's dependencies

---------------

Author: @karol-szymanowski
Upvotes: 1
Comments: 0

In my project, we use yarn and yarn workspaces to manage all dependencies, and I noticed that every time functions are deployed or mocked, the package-lock.json file is generated. Is there a way to set yarn as the default tool or ideally disable installing dependencies step?

---------------

---------------

# Can amplify.js lib use Cognito Identity Pool (CIP) without Cognito User Pool (CUP)?

---------------

Author: @syang
Upvotes: 1
Comments: 1

I am using amplify js library to build my front-end. 

I am trying to build the authentication mechanism with 

- Facebook as social login
- Cognito Identity Pool as AWS temp credential provider

There is an aws-sdk base tutorial here https://medium.com/@trannotes/serverless-with-aws-cognito-facebook-login-integration-3a5751a89a58

But my question is can I use amplify to achieve the above architecture (i.e., I don't want to use Cognito User Pool in my stack)?
## Comment

---------------

Author: @amhinson

Identity Pool federation is possible with Amplify. There is also a Facebook example for React in the docs. Is this what you're looking for?

https://docs.amplify.aws/lib/auth/advanced/q/platform/js#identity-pool-federation

---------------

---------------

# CI / CD For Native apps

---------------

Author: @mansdahlstrom1
Upvotes: 5
Comments: 0

Hi!

We have been developing a React Native app for some time now and we are using AWS Amplify for this. So far everything is working okay and seems to be working fine, we are quickly approaching our first release and i have some concerns regarding CI & CD with AWS Amplify for React Native. Currently i'm having a hard time finding resources regarding how to automate the Deployment step for mobile.

I will explain in some more detail:

I want to use fastlane for automated app store / google play deployment for the react native app. But we are also in need of deploying the Amplify resources at the same time. There is little to nothing in the Amplify documentation that shows examples of how to integrate CI / CD for Native apps, all examples seems to be for web applications.

The issue here is that whenever we deploy a new version of the app and the Amplify environment the user must update the app from App Store/Play Store manually to be able to have a functioning app. This since my understanding is that the Amplify ENV is overwritten when i will deploy a new version on AWS amplify. This has the effect of invalidating the version of the app that is already downloaded for the user.

• How is deployment of AWS Amplify powered Native app supposed to work?
• Is it posible to use versioning of the cloudformation resources that are deployed? So that we can support older version of the app giving the users some time / headroom to update?
• How is it recommended to handle breaking changes to the Amplify API / DB in a production senario?

Is this a flaw in the design of AWS Amplify or am I missing something?

Does any here have experience with a production React Native app running on AWS Amplify?

Thank in advance
/ M 

---------------

---------------

# What if someone is hosting with my Amplify.configure settings?

---------------

Author: @allssu
Upvotes: 1
Comments: 0

Hello. I'm making stuff with amplify. I am not using the amplify CLI, and I am connecting Cognito, Appsync, and DynamoDB using CDK.
**I have a question while using Amplify.configure.** 
If someone works on a Frontend site using my Amplify.configure, will it be authenticated? If so, how can I add authorization for this? Even if you add authentication that only one user can access, **it will be a problem if someone makes the sign-up and login screens the same.**
What do you think about this problem? Even if you search for keywords like Configure, it only talks about SRP and Oauth. I want to talk about essential AuthZ. Like it's controlled by the Security Group.
I want to hear an easy explanation for me! I love you~ :)

---------------

---------------

# Module not found '../aws-exports'

---------------

Author: @masapasa
Upvotes: 2
Comments: 0

Module not found: Can't resolve '../aws-exports' in '/codebuild/output/src240068493/src/nnews/next/pages'
build:
commands:
- echo Amplify build...
- amplifyPush --simple
While deploying through the console with an ECR image

---------------

---------------

# Generate graphql documentation

---------------

Author: @iamsteveng
Upvotes: 2
Comments: 0

Hi there, I found that all the `description` fields in the schema.json are all `null`.  This makes graphql documentation generator not possible to have meaningful descriptions for all APIs. Any way to input `description` for each mutation at least?

---------------

---------------

# Problem build ui-components

---------------

Author: @skulljoi
Upvotes: 1
Comments: 0

I am trying to build: `yarn build --scope @aws-amplify/ui-components` but an error is occuring:

> @aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-chatbot/amplify-chatbot.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --width: Width of the container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-authenticator/amplify-authenticator.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --background-color: Background color of the container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-greetings/amplify-greetings.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --background-color: Background color of the container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-photo-picker/amplify-photo-picker.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --object-fit: cover;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-nav/amplify-nav.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  .nav {
@aws-amplify/ui-components:       L2:    display: flex;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-s3-text/amplify-s3-text.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --container-color: Background color of the text container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-totp-setup/amplify-totp-setup.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  .totp-setup {
@aws-amplify/ui-components:       L2:    text-align: center;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-auth-fields/amplify-auth-fields.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  .auth-fields {
@aws-amplify/ui-components:       L2:    margin-bottom: 2rem;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-form-section/amplify-form-section.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --header-color: Text color within the form header
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-section/amplify-section.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --font-family: Font family of the text within the container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-checkbox/amplify-checkbox.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --font-family: Text font family
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-icon-button/amplify-icon-button.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --button-color: Text color of the button
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-sign-in/amplify-sign-in.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --footer-font-family: Font family of the footer
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-sign-up/amplify-sign-up.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --footer-font-family: Font family of the footer
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-strike/amplify-strike.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --color: Text color of the content placed between the horizontal rules
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-tooltip/amplify-tooltip.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --font-family: Font family of the text placed within the tooltip
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-loading-spinner/amplify-loading-spinner.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --spinner-circle-fill: var(--amplify-smoke-white);
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-picker/amplify-picker.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  .picker {
@aws-amplify/ui-components:       L2:    position: relative;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-hint/amplify-hint.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --color: Color of the text
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-form-field/amplify-form-field.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --label-font-size: var(--amplify-text-md);
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-icon/amplify-icon.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --width: Width of the icon
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-label/amplify-label.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --label-color: Text color within the label
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-container/amplify-container.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    display: flex;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-link/amplify-link.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --link-color: var(--amplify-primary-color);
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-s3-album/amplify-s3-album.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --overlay-bg-color: Image overlay color on hover
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-s3-image/amplify-s3-image.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --height: Image height
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-toast/amplify-toast.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --background-color: Background color of the container
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-radio-button/amplify-radio-button.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --font-family: var(--amplify-font-family);
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-button/amplify-button.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --background-color: Background color of the button
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-phone-field/amplify-phone-field.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  .phone-field {
@aws-amplify/ui-components:       L2:    display: inline-flex;
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-select/amplify-select.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --color: Text color of the select choices
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-sign-in-button/amplify-sign-in-button.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  :host {
@aws-amplify/ui-components:       L2:    --button-color: var(--amplify-secondary-color);
@aws-amplify/ui-components: [ ERROR ]  sass error: src/components/amplify-input/amplify-input.scss:1:1
@aws-amplify/ui-components:            Can't find stylesheet to import.
@aws-amplify/ui-components:       L1:  /**
@aws-amplify/ui-components:       L2:   * @prop --color: Text color within the input
@aws-amplify/ui-components: [ WARN  ]  Bundling Warning PLUGIN_WARNING
@aws-amplify/ui-components:            The namedExports option from "@rollup/plugin-commonjs" is
@aws-amplify/ui-components:            deprecated. Named exports are now handled automatically.
@aws-amplify/ui-components: [04:00.8]  build failed in 9.57 s
@aws-amplify/ui-components: npm ERR! code ELIFECYCLE
@aws-amplify/ui-components: npm ERR! errno 1
@aws-amplify/ui-components: npm ERR! @aws-amplify/ui-components@0.9.5 stencil: `stencil build --docs-readme`
@aws-amplify/ui-components: npm ERR! Exit status 1
@aws-amplify/ui-components: npm ERR!
@aws-amplify/ui-components: npm ERR! Failed at the @aws-amplify/ui-components@0.9.5 stencil script.
@aws-amplify/ui-components: npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
@aws-amplify/ui-components: npm ERR! A complete log of this run can be found in:

anyone know how to fix it?

---------------

---------------

# How to update multiple tables data in the transaction with GraphQL React

---------------

Author: @platium111
Upvotes: 1
Comments: 0

Hi everyone,
In one-to-many (Customer has many Contracts) relation, I want to create a new record in the Customer table and many contracts for this customer. Basically, when I create the new Customer, I get customer id back, then in Contract table, I will put customer ID into createContracts mutation (for example: contractCustomerId). But if the mutation fails in createContracts, the customer should not be added. Here is my table

`type Customer @model {
  id: ID!
  firstName: String!
  contracts: [Contract] @connection(name: "CustomerContracts")
}

type Contract @model {
  id: ID!
  loanStatus: String
  note: String
  customer: Customer @connection(name: "CustomerContracts")
}
`

I think it could be Transaction to control that but don't know how to connect between `transactItems`. The below transaction is what I get in docs example here [docs](https://aws.amazon.com/blogs/mobile/appsync-caching-transactions/)
What I don't understand is if I have `PutItem` for Customer, how can I get customer id and put to the second one which is `PutItem` for Contract.
`{
        "version": "2018-05-29",
        "operation": "TransactWriteItems",
        "transactItems": [
           {
               "table": "posts",
               "operation": "PutItem",
               "key": {
                   "post_id": {
                       "S": "p1"
                   }
               },
               "attributeValues": {
                   "post_title": {
                       "S": "New title"
                   },
                   "post_description": {
                       "S": "New description"
                   }
               },
               "condition": {
                   "expression": "post_title = :post_title",
                   "expressionValues": {
                       ":post_title": {
                           "S": "Expected old title"
                       }
                   }
               }
           },
           {
               "table":"authors",
               "operation": "UpdateItem",
               "key": {
                   "author_id": {
                       "S": "a1"
                   },
               },
               "update": {
                   "expression": "SET author_name = :author_name",
                   "expressionValues": {
                       ":author_name": {
                           "S": "New name"
                       }
                   }
               },
           }
        ]
    }`

What should be the solution for it?. Thanks for your help.

---------------

---------------

# Amplify mock api switching back to in cloud end point

---------------

Author: @gruckionvit
Upvotes: 1
Comments: 0

When using `amplify mock api` this switches the end point the `aws-exports.js` file so that graphql is pointing to the local instance. What is the intended way to switch back to the cloud?

Currently I have found typing `amplify init` will do the job but this seems a little strange as I am not initializing the project.

---------------

---------------

# Connecting my amplify app to a wordpress site..

---------------

Author: @myfairshare
Upvotes: 1
Comments: 0

Hello,

   Could someone please point me in the right direction.

So I have a wordpress site build promoting a business and in the meantime I'm building my amplify full stack app using DataStore and have it deployed to a random url.

So at the moment they are essentially 2 websites.

Is it possible to maybe combine them, ie sign in to the app on the wordpress site, thanks for any tips!


---------------

---------------

# RFC: pin aws-amplify dependencies (remove ^)

---------------

Author: @ericclemmons
Upvotes: 1
Comments: 4

_This issue is a Request For Comments (RFC). It is intended to elicit community feedback regarding a proposed change to the library. Please feel free to post comments or questions here._

## Summary

Remove `^` from `dependencies` so that `aws-amplify` and its `@aws-amplify/*` packages can be installed from a specific moment-in-time:

https://github.com/aws-amplify/amplify-js/blob/2f74c6b74d38af570017139f2ba8269dc1009135/packages/aws-amplify/package.json#L36-L49

https://github.com/aws-amplify/amplify-js/blob/2f74c6b74d38af570017139f2ba8269dc1009135/packages/datastore/package.json#L50-L53

etc.

## Motivation

1. Allow pinning of `aws-amplify` in `package.json` when a regression/bug is found.
1. Faster reproduction of issues by being able to install all packages from that moment-in-time.

Suppose `aws-amplify/core` is released today with a regression.  Because `aws-amplify` specifies `@aws-amplify/core` with a `^` **customers will be broken even if they have `aws-amplify` pinned to a specific version**.

This is surprising behavior and extremely difficult to work-around (unless you have `yarn.lock` / `package-lock.json`).  One way of resolving this is with [yarn's resolutions](https://classic.yarnpkg.com/en/docs/selective-version-resolutions/), but that doesn't exist in NPM.

I would argue that `aws-amplify` acts as a single-dependency wrapper for Amplify JS, much like [`react-scripts` "bundles" dependencies with explicit versions](https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/package.json).

Today's behavior would still work when using:

```json
"dependencies": {
  "aws-amplify": "^3.1.0"
}
```

But, if `3.1.1` had a regression, a customer could simply pin their version & choose to upgrade again later:

```json
"dependencies": {
  "aws-amplify": "3.1.0"
}
```

In the case of #6811, this option wasn't available. Customers were broken until a fix was released (or an unclear work-around was found).

Yes, a lock-file mitigates this, but again those aren't guaranteed to exist. Consider a brand new project: **the customer has no ability to use a previous good release!**

But there's an additional benefit: **reproducibility**.

If a customer opens up an issue with `aws-amplify@3.1.0`, it is impossible for us to consume that package from NPM/Yarn at the time of release: `@aws-amplify/*` will always refer to the latest `^` published package.

By pinning `@aws-amplify/*` dependencies, we will be able to install _all_ of the `@aws-amplify/*` packages for quicker reproduction through NPM. To do so otherwise would require `yarn link`ing, `git bisect`, and a slow, difficult `yarn build` process.  _And this doesn't work well for React Native!_.


## Drawbacks

- I'm not sure if this is a breaking change at all:

  - Customers who install individual packages (e.g. `@aws-amplify/datastore`) will continue to do so, and will continue to use `^` at their discretion.

  - Customers who install `aws-amplify` (per our recommendation) will either have it pinned (including our sub-packages), or with `^` and receive updates (since we update sub-packages with `aws-amplify`) via lerna.

## Adoption Strategy

Should not rely on any changes in documentation or for our customers.

By default, `npm install --save aws-amplify` uses `^`:

```json
  "dependencies": {
    "aws-amplify": "^3.3.3"
  }
```

## Related Issues

Add GitHub issue numbers/URLs that informed or would be impacted by this proposal.

- #6836 
- #6811 
- https://github.com/aws-amplify/amplify-js/issues/6930#issuecomment-708153567

## References

- https://classic.yarnpkg.com/en/docs/selective-version-resolutions/
- https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/package.json
## Comment

---------------

Author: @sammartinez

Do look into other packages as well for carrots, e.g. [auth](https://github.com/aws-amplify/amplify-js/blob/main/packages/auth/package.json#L44-L45)
## Comment

---------------

Author: @wlee221

I'm for this change! Many times I had to compare changelogs and use `resolutions` to debug a specific version. This would solve subdependency version conflicts too.
## Comment

---------------

Author: @skorfmann

Just ran into a situation with https://github.com/aws-amplify/amplify-js/pull/7237 where easy version pinning would have saved me lots of headaches.
## Comment

---------------

Author: @ericclemmons

Pinning has been released via https://github.com/aws-amplify/amplify-js/pull/7040!

---------------

---------------

# 📩 Send Cognito user email to email marketing software (Mailchimp, Sendinblue...)

---------------

Author: @charleslouis
Upvotes: 1
Comments: 1

Hi 👋

I want users to subscribe to newsletter upon signup with Cognito.

How would you send the email address of Cognito users to an email marketing software such as Mailchimp or Sendinblue?

I'm thinking something like SNS + Webhooks?

But I don’t really know where to look for documentation and most integration is about Zapier and CognitoForms (not cognito).

Thank you for your help 🙏
Charlo
## Comment

---------------

Author: @sw-yx

nah no sns needed. use post confirmation trigger.

- https://docs.amplify.aws/lib/auth/advanced/q/platform/js#lambda-triggers
- https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools-working-with-aws-lambda-triggers.html

---------------

---------------

# Social Login Required Attributes Error

---------------

Author: @ulisescarreonalvarez
Upvotes: 1
Comments: 0

**Describe the bug**
We wan't to add Facebook login on our react application, we actually use only Google, we add the configuration and created the app on Facebook, we add the mapping attributes but only with Facebook we are getting this error:

![Captura de Pantalla 2020-11-19 a la(s) 19 17 11](https://user-images.githubusercontent.com/25987364/99743702-d95d4d00-2a9b-11eb-8cae-189f1e6e9a72.png)


**To Reproduce**
Steps to reproduce the behavior:

` onClick={() => Auth.federatedSignIn({ provider: "Facebook" })}
`

Accept that the app can use the Login Feature.

**Expected behavior**
As Google, we don't know why the email is marked as required if Facebook has de attribute mapped.

**Code Snippet**

 ```
Hub.listen("auth", ({ payload: { event, data } }) => {
            console.log('event', event, data);
            switch (event) {
                case "signIn":
                    let store = configureStore();
                    localStorage.setItem("user_id", data.username);
                    break;
                case 'signIn_failure':
                    console.log(event);
                    break;
                case "signOut":
                    this.setState({ user: null });
                    break;
                case "customOAuthState":
                    this.setState({ customState: data });
            }
        });
```

**Screenshots**

![Captura de Pantalla 2020-11-19 a la(s) 19 16 04](https://user-images.githubusercontent.com/25987364/99743751-f42fc180-2a9b-11eb-9754-85142e175e2f.png)

![Captura de Pantalla 2020-11-19 a la(s) 19 18 30](https://user-images.githubusercontent.com/25987364/99743801-090c5500-2a9c-11eb-9ec0-ec2274b11d78.png)

**What is Configured?**

```
const awsConfig = {
    "aws_project_region": "us-east-1",
    "aws_cognito_identity_pool_id": "us-east-1:xxxx",
    "aws_cognito_region": "us-east-1",
    "aws_user_pools_id": "us-east-1_xxxx",
    "aws_user_pools_web_client_id": "xxxx",
    "oauth": {
        "domain": "xxxx.auth.us-east-1.amazoncognito.com",
        "scope": [
            "email",
            "openid",
            "profile",
            "aws.cognito.signin.user.admin"
        ],
        "redirectSignIn": "http://localhost/callback/cognito/",
        "redirectSignOut": "http://localhost/logout/",
        "responseType": "code"
    },
    "federationTarget": "COGNITO_USER_POOLS"
};
```

---------------

---------------

# Amplify console automation process

---------------

Author: @ricardoribas
Upvotes: 1
Comments: 0

Hi folks, i would to ask a couple of questions about the CI/CD process regarding the amplify web applications. I am using at the moment to build one web application, but i would like to know more about all the steps taken to perform it. I didn't find any sort of documentation that would explain all the steps. Preferably, if you guys can recommend some github pages that deeply describe, i would appreciate. 

Additionally, there is any way to access old bundle files? In order to debug old bugs, i need to access old bundles. As we are a team that is constantly deploying new code, is hard to keep track of old files.

---------------

---------------

# Can't pass parameters to Amplify Angular generated API service subscriptions.

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 1

Hello, it seems there is no way to pass parameters to subscriptions with arguments.

For instance i have my model and subscriptions declared in my schema like this:

```
type Message
  @model(subscriptions: null)
  @key(name: "byAuthor", fields: ["authorId"], queryField: "messageByUser")
  @key(
    name: "byConvo"
    fields: ["conversationId"]
    queryField: "messageByConvo"
  ) {
  id: ID!
  authorId: ID!
  conversationId: ID!
  content: String!
  createdAt: String!
}

```
```
type Subscription {
  onCreateMessage(conversationId: ID!): Message @aws_subscribe(mutations: ["createMessage"])
}
```

On `amplify codegen` for angular the generated subscription in the API.service.ts looks like this:

```
OnCreateMessageListener: Observable<OnCreateMessageSubscription> = API.graphql(
    graphqlOperation(
      `subscription OnCreateMessage($conversationId: ID!) {
        onCreateMessage(conversationId: $conversationId) {
          __typename
          id
          authorId
         conversationId
          content
          createdAt
          updatedAt
          _version
          _deleted
          _lastChangedAt
        }
      }`
    )
  ) as Observable<OnCreateMessageSubscription>;
```

To listen to this subscription in component i have: 

PS: This only work if there was no argument specified when creating the subscription, but with argument, there is no way to pass parameters to the subscription.
```
this.apiService.OnCreateMessageListener.subscribe({
        next: (listener) => {
          console.log(listener);
        },
      })
```

PS: I tried passing the conversationId like this, but i get Error, OnCreateMessageListener is not a function.

```
this.apiService.OnCreateMessageListener(conversationId).subscribe({
        next: (listener) => {
          console.log(listener);
        },
      })
```

Pls what am i doing wrong? Thanks in anticipation.
## Comment

---------------

Author: @markeames

I have the same issue, 

Using amplify cli 4.29.3 and Angular 8.2.x

type ChangeSource @model(subscriptions: null) @auth(rules: [ { allow: groups, groupsField: "group" }]) 

{
    
id: ID!
group: String! 
source: String! 
action: Int! 
target: String! 
createdAt: String
}

type Subscription {
    onCreateChangeSource(group: String): ChangeSource @aws_subscribe(mutations: ["createChangeSource"])
}


generates 

OnCreateChangeSourceListener: Observable<
    OnCreateChangeSourceSubscription
  > = API.graphql(
    graphqlOperation(
      `subscription OnCreateChangeSource($group: String) {
        onCreateChangeSource(group: $group) {
          __typename
          id
          group
          source
          action
          target
          createdAt
          updatedAt
        }
      }`
    )
  ) as Observable<OnCreateChangeSourceSubscription>;


while the   graphql onCreateChangeSource takes a group argument, but how to pass it via the generated API.service.ts?

Is this a defect in how the Angular API service is being generated from the subscriptions.graphql?

---------------

---------------

# How to hide authenticator sign up link in Vue.js

---------------

Author: @mrichman
Upvotes: 1
Comments: 3

There is no documentation on how to hide the signup link and text. This is the "No account? Create account" prompt.
## Comment

---------------

Author: @jordanranz

Hey @mrichman, I am working on opening up a `slot` API to customize different parts of the footer for sign in and sign up. I'll like the PR here and in your feature request when it is ready
## Comment

---------------

Author: @alexvdvalk

This also applies to the Angular UI components.

`<amplify-authenticator>
<amplify-sign-in slot="sign-in">
    <div slot="secondary-footer-content"></div>  
  </amplify-sign-in>
</amplify-authenticator>`
## Comment

---------------

Author: @scottpederick

Looking at the source, you can pass 'hide-sign-up' as a boolean:

```
<amplify-authenticator :authConfig="authConfig">
    <amplify-sign-in slot="sign-in" hide-sign-up="true"></amplify-sign-in>
</amplify-authenticator>
```

---------------

---------------

# How to add extra anchor link in sign in secondary footer content along with the original content

---------------

Author: @niloy369
Upvotes: 1
Comments: 0

I'm using angular ui component. I'm wishing to customize the secondary footer content but keeping the original content also. I'm facing issue redirecting to signup page. My code is following

`<amplify-sign-in slot="sign-in" usernameAlias="email">
    <div class="" slot="secondary-footer-content">
      No account? <amplify-button slot="sign-up-link" type="anchor" data-test="sign-in-create-account-link" class="hydrated">Create account</amplify-button>
      <br>
      Or <a routerLink="/sign-up">Click Here</a> to signup as mentor
    </div>
  </amplify-sign-in>`

<img width="545" alt="Screenshot 2020-11-15 at 9 55 24 PM" src="https://user-images.githubusercontent.com/4466897/99189815-61d2a980-278d-11eb-897f-4c753411c7ee.png">

My issue is clicking on the create account link doesn't redirect to sign up page. How can I achieve that

---------------

---------------

# Guarding against malicious image/video upload workflow

---------------

Author: @myfairshare
Upvotes: 1
Comments: 1

Hello,

    I am creating a property app where users will be able to upload images and video of a property.

Today our team were discussing the edge case of a user uploading distasteful content.

Could someone please offer me some guidance on how to go about this, I'm guessing there is some kind of package / AI to scan images on the backend, like a lamda function, thank you!

## Comment

---------------

Author: @sw-yx

yup! on the clientside you can use this https://github.com/infinitered/nsfwjs

on the serverside: https://docs.amplify.aws/lib/predictions/label-image/q/platform/js#setup-the-backend

---------------

---------------

# How to assign a default value for schema ?

---------------

Author: @yaquawa
Upvotes: 3
Comments: 0

I found a lib that adds a `@default` directive to set a default value.

https://github.com/trek10inc/graphql-default-value-transformer


I don't know if this is a best practice.
Is there any official way to assign a default value for schema ?

---------------

---------------

# Secure Kinesis channels with Cognito identity pool

---------------

Author: @purbanow
Upvotes: 1
Comments: 0

Hi

I'm building video chat using Cognito + webRTC and I'm trying to figure out how to secure access to dynamically created channels so every user will be only able to access particular rooms.

Thanks a lot!

---------------

---------------

# Amplify and Redux: How to dispatch actions only when the sync is ready?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 2

I would like to know how to set up Redux to make sure it only dispatch actions when the sync is completed. Currently, I am dispatching actions after querying the DataStore. 

```javascript
// redux/actions
import { User, GroceryList, Product } from "../src/models";
import { DataStore } from 'aws-amplify'

export const loadGroceryLists = (groceryLists) => ({
  type: "LOAD_GROCERY_LIST",
  groceryLists,
});

export function handleLoadGroceryLists() {
  return (dispatch, getState) => {
		const {user} = getState()
		return fetchUserGroceryLists()
			.then((groceryLists)=> dispatch(loadGroceryLists(groceryLists)))
	}
}

async function fetchUserGroceryLists() {
  const groceryLists = await DataStore.query(GroceryList)
  return groceryLists 
}
```

However, I would like to make sure the `Datastore` is reflecting the **latest state before triggering an action**. 

I am referring to a scenario where **SelectiveSync** is required: Whenever the `syncExpression` is updated, the `DataStore` needs to be restarted to update the data received, after that the DataStore will reflect a new State.

What is happening now, is that the action gets called before the synchronization is completed, and even though the browser datastore is correctly reflecting the latest info, the state displayed on the App is different. 

Is there a way to solve this?

I thought about using `Hub.listen('datastore',...)` but I could not manage to solve my issue with it.

Thank you in advance for your help!
## Comment

---------------

Author: @tysoncung

Checkout DataStore events here:

https://docs.amplify.aws/lib/datastore/datastore-events/q/platform/js

`// Create listener
const listener = Hub.listen("datastore", async hubData => {
  const  { event, data } = hubData.payload;
  if (event === "ready") {
    // do something here once the data is synced from the cloud
  }
})

// Remove listener
listener();`
## Comment

---------------

Author: @hmisonne

Thank you @tysoncung for your answer. Here is how I implemented Redux with Amplify and SelectiveSync:

The loadPost() function will call a function to **synchronize the DataStore** with the new postID **instead of dispatching directly an action**.
Adding a listener on my React Component will then make sure the Redux actions are only dispatched when the state of synchronization is ready.


```javascript
# screens/Home
import React from "react";
import { connect, useDispatch } from "react-redux";
import {
  handleLoadPost,
  syncDatastore,
} from "../redux/actions";

const Home = () => {
  const dispatch = useDispatch();
  async function loadPost(id) {
    syncDatastore(id)
    const removeListener =
    Hub.listen("datastore", async (hubData) => {
      const { event, data } = hubData.payload;
      if ( event === "ready") {
        dispatch(handleLoadPost());
        removeListener();
      }
    });
  }
  return( ... )
}

export default connect()(Home);
```

```javascript
# redux/actions

import { DataStore, syncExpression, Hub } from 'aws-amplify'
import {  Post } from "../../models";

// Initialize Selective Sync with empty data
let postID= ''

DataStore.configure({
  syncExpressions: [
   syncExpression(Post, () => {
      return (c) => c.id('eq', postID);
    }),
  ],
});

// Redux Actions to load Posts
export const loadPost= (post) => ({
  type: "LOAD_POST",
  post,
});

export function handleLoadPost() {
  return (dispatch, getState) => {
    return fetchPost()
    .then((post)=> dispatch(loadPost(post)))
  }
}

async function  fetchPost() {
  const result = await DataStore.query(Post)
  return result
}

// update postID and restart Datastore to reevalute syncExpressions with new postID
export async function syncDatastore(id){
  postID = id
 await DataStore.stop();
 await DataStore.start();
}

```

Feel free to comment if you have a better idea on how to implement Redux with SelectiveSync! 

---------------

---------------

# How do I filter subscriptions with ids?

---------------

Author: @anand-010
Upvotes: 1
Comments: 1

My problem is more related to a real-time chat application with multiple chat rooms.
I want to filter each message and send it to users who subscribed to the same chatrooms. (not filtering on client-side)

I am a beginner to app sync. How do I do that Please help me?

Please give me relevant links, codes or steps.
## Comment

---------------

Author: @tysoncung

You can subscribe to only an object by providing an id

https://docs.amplify.aws/lib/datastore/real-time/q/platform/js

const id = '69ddcb63-7e4a-4325-b84d-8592e6dac07b';

const subscription = DataStore.observe(Post, id).subscribe(msg => {
  console.log(msg.model, msg.opType, msg.element);
});

---------------

---------------

# SelectiveSync: Is there a way to synchronize data with an array of value?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 1

I would like to get data synchronized based on their parent relationship. In my scenario, a GroceryList (parent) can have multiple Products (child). I've described my app on this ticket #7128. 

Would it be possible to retrieve all the products that belongs to specific Grocery Lists? That is to say, how can I use an array of groceryListIDs as argument in the syncExpression (see below)?

```javascript
DataStore.configure({
  syncExpressions: [
    syncExpression(Product, () => {
      return (c) => c.groceryListID('eq', [groceryListID1, groceryListID2]);
    }),
  ],
});
```
## Comment

---------------

Author: @iartemiev

Hey @hmisonne, there's not an official well-documented way of doing that currently, but I think the following should work:

```js
DataStore.configure({
  syncExpressions: [
    syncExpression(Product, () => {
      const groceryListIDs = ['groceryListID1', 'groceryListID2'];
      return (c) =>
        c.or((c) => {
          return groceryListIDs.reduce((acc, curVal) => {
            return acc.groceryListID('eq', curVal);
          }, c);
        });
    }),
  ],
});
```
This is the equivalent of chaining together a bunch of OR predicates, i.e., 
```js
(c) => c.or(c.groceryListID('eq', 'groceryListID1').groceryListID('eq', 'groceryListID2'))
```

If you want to reuse that functionality in other places, you can create a helper like:

```js
const listPredicate = (c, list, field) => {
  return c.or((c) => list.reduce((_c, operand) => _c[field]('eq', operand), c));
};

DataStore.configure({
  syncExpressions: [
    syncExpression(Product, () => {
      const groceryListIDs = ['groceryListID1', 'groceryListID2'];
      return (c) => listPredicate(c, groceryListIDs, 'groceryListID');
    }),
  ],
});
```

---------------

---------------

# Token refresh with 'another' Federated provider

---------------

Author: @darylalexjohnson
Upvotes: 1
Comments: 0

[Documentation](https://docs.amplify.aws/lib/auth/advanced/q/platform/js#token-refresh) gives sample for refreshing token with another federated provider. However, I'm seeing the "other" federated provider must still authenticate with Cognito Identity Pools https://github.com/aws-amplify/amplify-js/blob/main/packages/core/src/Credentials.ts#L352.  Is there a work around solution for refreshing the token without Identity Pools?

---------------

---------------

# Signup without password required?

---------------

Author: @yaquawa
Upvotes: 1
Comments: 0

Is it possible to have a user signup flow like this?

1. signup with a given email, and a random password
2. verification link sent to the given email
3. user click on the verification link
4. user verified(use https://docs.amplify.aws/cli/usage/lambda-triggers#email-verification-link-with-redirect)
5. redirect to my site, let the user set a new password

I was able to accomplish this flow until step 4.
on step 5, I don't know how to sign in the user automatically after the redirection.
anyone know how to do this? Thanks!

---------------

---------------

# sync a specific model fot the Datastore from a list of id

---------------

Author: @ifmael
Upvotes: 1
Comments: 1

I'm trying the selective sync feature for the Datastore and I don't know how i can sync my model from a list of items returned from a promise.

```
DataStore.configure({
DataStore.configure({
  syncExpressions: [
    syncExpression(Content, async () => {
      const listOfContents = await getListOfContents();
      // listOfContents  = "001 002  003 "
      return (c) => {
        return c.id("contains", listOfContents);
      };
    }),
  ],
});
```

The snippet above doesn't work because the `contains` operator works opposite that i thought. It checks if the  listOfContent  String is contained inside the id string.   Any suggestion?
## Comment

---------------

Author: @iartemiev

Hey @ifmael, please try the following: https://github.com/aws-amplify/amplify-js/discussions/7135#discussioncomment-125467

---------------

---------------

# unit test: How to mock Datastore and Models in Jest?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 0

I would like to add unit tests to all my calls to the Amplify DataStore using jest and I am wondering what are the best practices.

Here is an example of one function to fetch all the GroceryLists instances:
```javascript
async fetchAllGroceryLists() {
    try {
      const allGroceryLists = await DataStore.query(GroceryList);
      console.log("grocery lists retrieved successfully!");
      return allGroceryLists;
    } catch (error) {
      console.log("Error retrieving grocery lists", error);
    }
  }
```

To test this function, my idea was to create a **BackendInterface Class** that would accept a **dataStore object in the constructor**:
```javascript
export class BackendInterface {
  constructor(dataStore) {
      this._dataStore = dataStore
  }
  async fetchAllGroceryLists() {
    try {
      const allGroceryLists = await this._dataStore.query(GroceryList);
      ...
    }
  }
}
```
This way, I could initialize a BackendInterface with a mocked datastore in my **test file**:
```javascript
import { BackendInterface } from "../BackendInterface";

describe("Backend Interface with Datastore", () => {
  describe("case 1 : GroceryLists", () => {
    const dataStore = {
      query: () => [
        {
          id: "1",
          name: "test",
          groceryList: { id: "1" },
        },
        {
          id: "2",
          name: "test",
          groceryList: { id: "2" },
        },
      ],
    };
    const API = new BackendInterface(dataStore);
    test("fetchAllGroceryLists should return all items from the datastore", () => {
      return API.fetchAllGroceryLists().then((data) => {
        expect(data.length).toBe(2);
      });
    });
 });
```

Even though this approach does work for this example, it does not allow me to perform more complicated queries. Moreover, it does not solve the problem of creating and updating the models.

After researching online, I saw that some people recommended to use [mock-async-storage](https://www.npmjs.com/package/mock-async-storage) however I don't see how it could help me with my issue.

Thank you for your help!

---------------

---------------

# How to Make My Chrome Extension Login via My Website?

---------------

Author: @ChihweiLHBird
Upvotes: 1
Comments: 0

I have a web app that's written in React, and I also have a Chrome extension written in html and javascript without frameworks.

In my chrome extension, I use `amazon-cognito-identity.min.js` as the library.
In my web app, I use the amplify package with React.
 
I like to make my Chrome extension able to check the login state of the web app and to get the cognitoUser from the web app. Is there any way I can do this? Thank you!

---------------

---------------

# Response from Postman but no response from Amplify

---------------

Author: @tnorlund
Upvotes: 1
Comments: 0

I'm using the Amplify SDK to setup a REST endpoint. I set up the lambda function by editing the default lambda function created by amplify:
```js
...
// Enable CORS for all methods
app.use( function( req, res, next ) {
  res.header( `Access-Control-Allow-Origin`, `*` )
  res.header(
    `Access-Control-Allow-Headers`,
    `Origin, X-Requested-With, Content-Type, Accept`
  )
  next()
} )
...
app.get( `/blog`, function ( request, response ) {
  let params = {
    TableName: tableName,
    Key: {
      'PK': `#BLOG`,
      'SK': `#BLOG`
    }
  }
  dynamodb.get( params, ( error, result ) => {
    if ( error ) {
      response.json( { statusCode: 500, error: error.message } )
    } else {
      response.json(
        {
          statusCode: 200,
          url: request.url,
          body: result.Item
        }
      )
    }
  } )
} )
...
```
When I run the GET command through postman I get the correct response:
<img width="1392" alt="Screen Shot 2020-11-08 at 9 04 52 AM" src="https://user-images.githubusercontent.com/26452518/98482451-5c39fa00-21b6-11eb-9934-a5e93d91de3e.png">

In the JS app, I'm able to post and put perfectly, but when I get:
```js
API.get( `blogAPI`, `/blog/`, {} )
  .then( blogResponse => console.log( `response`, { blogResponse } ) )
  .catch( error => console.log( `error`, { error } ) )
```
I produce the following error:

```
Origin http://localhost:8000 is not allowed by Access-Control-Allow-Origin.
XMLHttpRequest cannot load https://<API ENDPOINT>/blog due to access control checks.
```

Any idea how I can get this to work on the frontend?

---------------

---------------

# How can I upload relatively large file to S3 with slower connection?

---------------

Author: @superphung
Upvotes: 1
Comments: 1

Hi,
I have the same problem as this issue and the answers don't work for me.
[#2166](https://github.com/aws-amplify/amplify-js/issues/2116).

What I did:

```
import { AWS } from "@aws-amplify/core/lib/";

AWS.config.s3 = { 
  httpOptions: { 
    timeout: MORE_THAN_2_MINUTES 
  } 
}; //added before the Storage.vault.put()
```

I use aws-amplify@^2.2.1 and aws-amplify-react@^2.4.4.
Do you guys have any ideas ?

Thanks you
## Comment

---------------

Author: @j2d2

@superphung - i was able to get this working by importing from "@aws-amplify/core"; (not "core/lib/")

Amplify Team (cc @ericclemmons since you made the docs commit):
i know this is old, but i am concerned about the amplify3xx-has-breaking-changes note now in the [README](https://github.com/aws-amplify/amplify-js#amplify3xx-has-breaking-changes-please-see-the-breaking-changes-below):

> Amplify@3.x.x has breaking changes. Please see the breaking changes below:
AWS.credentials and AWS.config don’t exist anymore anywhere in Amplify JS
Both options will not be available to use in version 3.

This is a required modification for my PWA - will this be addressed in the near future?

---------------

---------------

# Selective Sync: Can I manage the order of models sync ?

---------------

Author: @hmisonne
Upvotes: 1
Comments: 1

I am working on a **Shareable Grocery Shopping List app** that I developed on React Native with **AWS Amplify** and **AppSync**. Currently a user will receive the complete database which is not ideal. 

I have 4 models: User, Grocery List and Products and UserGroceryListJoin (to handle many to many relationship). The idea is that a Grocery List contains multiple Products and multiple Users can have access to multiple Grocery Lists.

```graphql
type Product @model 
@key(name: "productByGroceryList", fields: ["groceryListID"])
{
  id: ID!
  groceryListID: ID!
  name: String!
}

type GroceryList @model {
  id: ID!
  name: String!
  products: [Product] @connection(keyName: "productByGroceryList", fields: ["id"])
  users: [UserGroceryListJoin] @connection(keyName: "byUser", fields: ["id"])
}

type User @model @auth(rules: [{ allow: owner }]){
  id: ID!
  username: String
  groceryLists: [UserGroceryListJoin] @connection(keyName: "byGroceryList", fields: ["id"])
}

type UserGroceryListJoin @model(queries: null)
  @key(name: "byUser", fields: ["userID", "groceryListID"])
  @key(name: "byGroceryList", fields: ["groceryListID", "userID"]){
  id: ID!
  userID: ID!
  groceryListID: ID!
  user: User! @connection(fields: ["userID"])      
  groceryList: GroceryList! @connection(fields: ["groceryListID"])  
}
```


I thought about implementing `@auth` directive but unfortunately **it does not work with multiple owners**. The idea of my app is to be able to have multiple users interact with one list so I had to find a way around.

I thought about using **Selective Sync**, to get only the products that belongs to a specific grocery list. To implement this, I would limit one groceryList per User. Unfortunately, to get the grocery list ID, I first have to get the user identified, and then get the Grocery List ID that he is using from the UserGroceryListJoin model.

```javascript
async getGroceryListIDForSync() {
      const users = await DataStore.query(User)
      const userID = users[0].id
      const groceryListID = await fetchUserGroceryLists(userID)
      DataStore.configure({
        syncExpressions: [
          syncExpression(Product, async () => {
            return (c) => c.groceryListID('eq', groceryListID)
          })
        ]
      });
   }
```

I see that currently, the Product model is getting synchronized first, then the User model, ect... So to run this query without errors, the sync needs to be complete which defeat the purpose.

Would it be possible to set the order of the sync so that I can decide to have the User and Grocery List models synchronized first, and then perform the SelectiveSync operation on the Product model with the groceryListID?

I am open to any suggestions to simplify this process !

Thank you for your help!

## Comment

---------------

Author: @iartemiev

Hey @hmisonne, I think there is a way that you can accomplish this. 

`DataStore.configure` needs to be called _before_ DataStore starts, however, you can try something like this:

Set up a sync expression that will initially return no results for `Product`, e.g., 

```js
let groceryListID = '';

DataStore.configure({
  syncExpressions: [
    syncExpression(Product, () => {
      return (c) => c.groceryListID('eq', groceryListID);
    }),
  ],
});
```

After DataStore performs its initial sync, there should be no records in the local store for Product. 

Then you can do:

```js
async getGroceryListIDForSync() {
  const users = await DataStore.query(User)
  const userID = users[0].id
  
  // same groceryListID that's being passed to the sync expression
  groceryListID = await fetchUserGroceryLists(userID) 
  await DataStore.stop();
  await DataStore.start();
}
```

This will cause DataStore to re-evaluate that sync expression and apply the new value to the sync query. Once the sync completes, you should only have Product records stored locally that match the specified `groceryListID`.

---------------

---------------

# Datastore optional models

---------------

Author: @samputer
Upvotes: 1
Comments: 1

Hi,

I have a web app built using Amplify and Vue. I'm currently exploring migrating to the new DataStore way of doing things, as I love the concept and it will hopefully make my life a whole lot easier!

The problem is, I have quite a large number of models, some of which have hundreds of thousands of entries. I'd prefer to not sync all of these but handle them independently. I find that as soon as the sync starts, it attempts to pull down all of these, fetching needless data and timing out.

I have looked into `syncExpression`, but is there any way I can exclude a model from the sync entirely?

Thanks,
Sam
## Comment

---------------

Author: @iartemiev

Hey @samputer, there's not currently a documented way of disabling sync for a model, but we intend to add that capability soon. 

As a workaround in the meantime, you can change the `syncable` value to `false` in ./models/schema.js for the model(s) you'd like to exclude from syncing. 

You'll need to do this every time after running `amplify codegen models` since that will overwrite the value.

---------------

---------------

# How to list ALL objects but not the ones created by "owner" ?

---------------

Author: @yaquawa
Upvotes: 1
Comments: 1

For example I have the following schema
```graphql
type Post @model @auth(rules: [{ allow: owner }]) {
  id: ID!
  title: String!
}
```

This gives me only the posts that created by the currently logged in user.
```graphql
query MyQuery {
  lisPosts {
    items {
      id
      title
    }
  }
}
```

I'm going to create the admin page, which could list all the posts created by all users.
How can I do that?
## Comment

---------------

Author: @yaquawa

I found that I can accomplish it by add another rule which allow user in the admin group access it.
I'm not sure if this is the recommended way to do this. Anyone know this?

```graphql
type Post @model @auth(rules: [
    { allow: owner },
    {
        allow: groups,
        groups: ["Admins"],
        operations: [read, update, delete]
    }
]){
    id: ID!
    title: String!
}
```

---------------

---------------

# How do I make authenticated requests to Amplify GraphQL using Firebase Auth as OIDC?

---------------

Author: @corasan
Upvotes: 1
Comments: 0

I need help setting up Firebase Auth + Amplify GraphQL. I'm trying to log in using federated sign with securetoken.google.com/PROJECT-ID as the provider, and it seems to log in alright because when I call `Auth.currentAuthenticatedUser()` I get the token, and when listening to Hub "signIn" event I get the token. My problem is making authenticated requests to my GraphQL API.

```javascript
const signIn = async () => {
  try {
    // already logged in using firebase so I just need to get the token from the current user
    const tokenResult = await currentUser?.getIdTokenResult()
    await Auth.federatedSignIn('securetoken.google.com/PROJECT-ID', {
      token: tokenResult?.token,
    })
    const res = await Auth.currentAuthenticatedUser()
    console.log('token', res.token) // eyjhxxxxxxxxxx...
  } catch (error) {
    // ...
  }
}
```

```javascript
const client = new AWSAppSyncClient({
  url: AppSyncConfig.aws_appsync_graphqlEndpoint,
  region: AppSyncConfig.aws_appsync_region,
  auth: {
    type: AppSyncConfig.aws_appsync_authenticationType,
    jwtToken: () => getToken(),
  },
})

const getToken = async () => {
  const token = await Cache.getItem('@accessToken')
  return token
}
```

When calling `Auth.currentSession()` I get "No current user". Also, I do see the token in the Authorization header when I attempt to fetch data.


---------------

---------------

# Storage.list returning an incorrect list of files

---------------

Author: @stayingcool
Upvotes: 1
Comments: 7

**Issue**
Storage.list is returning an incorrect list of files.

**Expected behavior**
The list API should return files only for specific ID (Example - 125).

**To Reproduce**
Here is the screenshot of my UI showing an incorrect list of files being returned:
<img width="195" alt="Screen Shot 2020-10-06 at 8 30 53 pm" src="https://user-images.githubusercontent.com/31205483/95184437-14b8fa80-0813-11eb-978e-3c3e40eb8717.png">

The API was invoked with the ID as 125. However, the result came up with the list of files for IDs (125, 1250,  1256 ...).

**Code Snippet (Excerpt)**
```
import { Storage } from "aws-amplify";

export function getAttachments(ID) {
  const path = {
    public: "uploads/orders/tax/attachments/",
  };

  return function (dispatch) {
     return Storage.list(ID, {
        customPrefix: path,
      })   
  };
}
```

**Env**
package.json:
"aws-amplify": "^3.0.13",

Amplify CLI:
4.25.0
## Comment

---------------

Author: @ashika01

@stayingcool Sorry I dont understand you request for ID here. `Storage.list` can only take input as path. Can you brief more on this so I can help.

Also, if you are trying to get all file under `125/`, I suggest you make a call something along these lines,

`Storage.list('uploads/orders/tax/attachments/125/')`
## Comment

---------------

Author: @stayingcool

This is the excerpt code from my other project with Amplify Version ("aws-amplify": "1.2.4",) which seems to be working fine.
```
getListOfAttachments(ID: string): Promise<Attachment[]> {
        return new Promise((resolve, reject) => {
            Storage.list(ID, {
                customPrefix: this.customPrefix
            }).then(function (results) {
                results.map(item => {
                    return new Attachment(
                        item.key,
                        item.lastModified,
                        item.size
                    );
                });
                resolve(results);
            }).catch(function (results) {
                reject(results)
            });
        });
    }
```

I think this issue is with customPrefix. Not sure if the current version of Storage.list API went through change due to which the API returns all the bucket contents with a begins with clause maybe!

As per your suggestion, If I invoke the API as follows then the API returns an empty response:
```
getListOfAttachments(ID) {
    let path = `uploads/orders/tax/attachments/${ID}`
    return Storage.list(path);
  }
```
**Request in Chrome**
<img width="1377" alt="Screen Shot 2020-10-07 at 10 46 41 am" src="https://user-images.githubusercontent.com/31205483/95271921-df4ff380-088a-11eb-9343-3f352f6408e4.png">

**Response in Chrome**
<img width="902" alt="Screen Shot 2020-10-07 at 10 51 00 am" src="https://user-images.githubusercontent.com/31205483/95272100-3c4ba980-088b-11eb-829b-acbcfa4a4ff4.png">


**This is the path where the attachments are being stored:**
<img width="899" alt="Screen Shot 2020-10-07 at 10 24 42 am" src="https://user-images.githubusercontent.com/31205483/95271327-597f7880-0889-11eb-85fe-473f307b241f.png">

## Comment

---------------

Author: @ashika01

@stayingcool The older version of Amplify was using `aws-sdk-js` v2 but the latest ones use https://github.com/aws/aws-sdk-js-v3. Looking at ts file for the call, it was the path. I will try custom prefix and update here in a while. Thanks for the info, let me get back with some code snippets.
## Comment

---------------

Author: @ashika01

@stayingcool : Hey, sorry my suggestion was wrong. Apologies from my end.

Could you turn on the the Amplify debug logger by following to `App.js` 
`Amplify.Logger.LOG_LEVEL = 'DEBUG';`

And what the list file resolves to. Screenshot similar to this,

![Screen Shot 2020-10-07 at 5 15 03 PM](https://user-images.githubusercontent.com/35131273/95401030-0a553a00-08c1-11eb-9630-a9e17359b6e7.png)
## Comment

---------------

Author: @stayingcool

<img width="1250" alt="Screen Shot 2020-10-08 at 1 02 29 pm" src="https://user-images.githubusercontent.com/31205483/95406804-0c71d400-0967-11eb-99d4-68c6f2f3196b.png">
## Comment

---------------

Author: @ashika01

@stayingcool I would like you to try do that list with `125/` rather than `125` you have here. That should fix the issue for you.
## Comment

---------------

Author: @stayingcool

Yes. That forward slash towards the end added now gets the exact list of files under that path. I'm hoping that there is not going to be any other issue 😊

**Code Snippet (Excerpt)**

```
import { Storage } from "aws-amplify";

export function getAttachments(ID) {
  const path = {
    public: "uploads/orders/tax/attachments/",
  };

  return function (dispatch) {
     return Storage.list(`${ID}/`,, {
        customPrefix: path,
      })   
  };
}
```

Thank you for your time, we can close this issue.

---------------

---------------

# How to map Cognito identity ids to user pool ids?

---------------

Author: @mrichman
Upvotes: 1
Comments: 1

I'm using the Storage APIs, and I see it creating `/private/<identity_id>/foo.txt` etc. However, there's no obvious way to see which user pool user this `<identity_id>` maps to.

My Cognito auth role specifies `arn:aws:s3:::<my_bucket>/private/${cognito-identity.amazonaws.com:sub}/*` which, as I understand, is **not** the user pool sub claim, but rather the `<identity_id>`. (Do I have that wrong?)

So how do I know which users all those S3 objects under `/private/<identity_id>/` map to?
## Comment

---------------

Author: @mrichman

I have a bit of a workaround. When I sign in, I am doing this:

```javascript
Auth.currentUserInfo().then(info => {
    Storage.put('userInfo.json', JSON.stringify(info), { level: 'private', contentType: 'application/json' });
  });
```

This gives me:

```json
{
  "id": "us-east-1:c1ecd265-dead-beef-cafe-fa0cffa42ff1",
  "username": "688746f8-dead-beef-cafe-0c3de99fff98",
  "attributes": {
    "sub": "688746f8-dead-beef-cafe-0c3de99fff98",
    "email": "user@example.com"
  }
}
```

I suppose I can use this as a lookup if needed.

---------------

---------------

# How can you get the next 1000 records in the S3 bucket?

---------------

Author: @adsk-alexand
Upvotes: 1
Comments: 1

https://github.com/aws-amplify/amplify-js/blob/958f61ef2918728cc46b9b210d60e868edd87f39/packages/storage/src/providers/AWSS3Provider.ts#L395
## Comment

---------------

Author: @sammartinez

Hello @adsk-alexand, 
S3 does have a limit as to how many records can be returned in a single request. From this [documentation on the S3 SDK](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/S3.html#listObjects-property), there is a limit of 1000. 

---------------

---------------

# How to use custom on submit handler with AmplifySignUp?

---------------

Author: @roysailor
Upvotes: 1
Comments: 0

Hey, 

I am using the AmplifySignUp component from '@aws-amplify/ui-react' package. 

What I am trying to achieve here is:

1. Add a custom field "Organisation" to the submit form.
2. Write a custom handler to register the user manually and also create an organization for him in the database.

Following is the sample code:

```
import React, {useEffect, useState} from 'react';
import { AmplifyAuthenticator, AmplifySignIn, AmplifySignUp, AmplifyForgotPassword } from '@aws-amplify/ui-react';
import '../styles/App.scss';
import { AuthState, onAuthUIStateChange } from '@aws-amplify/ui-components';
import ProtectedRoutes from './ProtectedRoutes';

function App() {

  const [authState, setAuthState] = React.useState();
  const [user, setUser] = React.useState();

  const onSignup = (event) => {

    event.preventDefault();

    const { organisation, username, password, name } = event.target;

    console.log(organisation, username, password, name);

  }

  useEffect(() => {

      return onAuthUIStateChange((nextAuthState, authData) => {
          setAuthState(nextAuthState);
          setUser(authData)
      });

  }, []);

  return ( authState === AuthState.SignedIn && user ) 
  ? 
  (
    <ProtectedRoutes />
  ) 
  : 
  (
            <AmplifyAuthenticator>
                <AmplifySignIn headerText="Login" usernameAlias="email" submitButtonText="Continue" slot="sign-in" />
                <AmplifySignUp 
                  headerText="Signup for a free Listen2It account" 
                  slot="sign-up"
                  handleSubmit={onSignup} 
                  formFields={[
                    { 
                      type: "organisation",
                      label: "Organisation *",
                      placeholder: "Enter Organisation name",
                      required: true
                    },
                    { 
                      type: "username",
                      label: "Email *",
                      placeholder: "Enter your email",
                      required: true
                    },
                    { 
                      type: "password"
                    },
                    { 
                      type: "name",
                      label: "Name *",
                      placeholder: "Enter your name",
                      required: true,
                    }
                  ]}
                />
                <AmplifyForgotPassword 
                  headerText="Recover Password"  
                  slot="forgot-password"
                  usernameAlias="email"
                />
              </AmplifyAuthenticator>
  );

} 


export default App;

```

The issues which I am facing here are:

1. I am getting organisation, username, password, and name as undefined in onSignup function.
2. I have marked the fields as required, still, I am able to submit the blank form.
3. If I have to validate the form manually, then how do I display the errors?

Any clue how to achieve this? Please guide.

---------------

---------------

# Questions about security and Cognito user pools

---------------

Author: @ffxsam
Upvotes: 1
Comments: 1

Should we be keeping our Cognito user pool ID secure (maybe obfuscate it in the client)? I've realized something, that if someone obtains the user pool ID, then they can grab the keys via:

`https://cognito-idp.us-east-1.amazonaws.com/<user pool ID>/.well-known/jwks.json`

And then they'd be able to use those to decode their JWT tokens, figure out how to modify certain claims, and then forge JWT tokens and set in their browser to make false claims.

## Comment

---------------

Author: @ffxsam

Ah, of course. These are _public_ keys we can access, not private keys for signing JSON objects.

I'm relatively new to working with JWTs. 😬 

---------------

---------------

# What's the difference between `aws-amplify-vue` and `@aws-amplify/vue-ui`?

---------------

Author: @andrei-gheorghiu
Upvotes: 1
Comments: 1

It looks like they contain a lot of overlapping content. Found a few guides and tutorials featuring one or the other. They have both been updated 3 days ago and they seem to have the same contributors. 

This leads to the conclusion they are both up to date and maintained, but it would be nice to have someone more _in-the-know_ write up a little explanation on why there are two packages. 

Scope, purpose, reasoning, recommended usage. 

A nice bonus would be to know if any one of them is more TypeScript friendly.

Thank you.
## Comment

---------------

Author: @morgler

To me it seems that vue-ui is the modern way of injecting Amplify components into a vue app. Please correct me, if I'm wrong.

---------------

---------------

# Unable to verify secret hash for client

---------------

Author: @castledraw
Upvotes: 1
Comments: 0

Hi, everybody

I have the same issue reported in https://github.com/aws-amplify/amplify-js/issues/1368
I want to login my amplify app with a cognito appclient with secret key. There is required for me, because i configured an elasticsearch instances with cognito, and automatically thats created an appclient with secretkey. So i want to load a dashboard kibana in my amplify app, but i received de same error Unable to verify secret hash for client. 

I can't create another appclient without secret key, because elasticsearch use another with this.

---------------

---------------

# Getting notfication.foreground as undefined in onNotification handler for iOS

---------------

Author: @Raghvendra0601
Upvotes: 1
Comments: 0

I am handling remote push notification in foreground state for react native app. Below is code of onNotification handler

PushNotification.onNotification(async (notification) => {
    if (notification.foreground) {
      console.log('in app notification', notification);
      // RootNavigation.navigate('Notifications');
    } else {
      console.log('onNotification data', notification);
      const userRole = await getItem('userRole');
      if (userRole) {
        //Navigation to diff screens
      }
    }

When callback is made to onNotification handler then for android I am getting notification.foreground as true and flow is working as per expectation but for iOS it is undefined. Can you please let me know, How I can fix the issue?

---------------

---------------

# How to customise the CSS of the button or toast component from @aws-amplify/ui-react package

---------------

Author: @roysailor
Upvotes: 1
Comments: 1

Hey,

I am using several components from @aws-amplify/ui-react to build an Auth flow in a React application.

I am not able to figure out how to customize the CSS of components like SignIn Button or Toast message.

Any clue how to change those?
## Comment

---------------

Author: @sw-yx

amplify uses web components under the hood. apply css or css variables directly. see the docs https://docs.amplify.aws/ui/customization/customizing-css/q/framework/react

---------------

---------------

# How to setup Lambda triggers?

---------------

Author: @yaquawa
Upvotes: 1
Comments: 1

I'm reading https://docs.amplify.aws/cli/usage/lambda-triggers#set-up-lambda-triggers

But what's the command that bring me this:
```
$ Do you want to enable any of the following capabilities?
  ❯ ◯ Add Google reCaptcha Challenge
    ◯ Email Verification Link with Redirect
    ◯ Add User to Group
    ◯ Email Domain Filtering (deny list)
    ◯ Email Domain Filtering (allow list)
    ◯ Custom Auth Challenge Flow (basic scaffolding - not for production)
    ◯ Override ID Token Claims
```
By the way, I have ran `amplify add auth` already.
## Comment

---------------

Author: @sw-yx

i think you can run `amplify configure auth` and look for manual options. 

@mauerbac i think this is a docs question

---------------

---------------

# AmplifyTotpSetup errors

---------------

Author: @0x54321
Upvotes: 1
Comments: 0

Hi,
I have configured a User Group to require MFA (TOTP), and added the AmplifyTotpSetup component to my app. However, the verification flow simply does not work.

After the user sets their password, the TOTP screen appears, but without a QR code (it's just a broken image). After refreshing the page and re-entering credentials, a proper QR code is displayed, but with an error on top: "Only one request to update user Software Tokens can be processed at a time."

I've tried for hours, but just cannot get this to work. Please advise!

Thank you.

---------------

---------------

# Risk of unauthorized use of public/client-side Amplify Config Paramters by third-parties

---------------

Author: @antimonad
Upvotes: 1
Comments: 1

Ahoi all,

What are the security/privacy consequences of an unauthorited third-party using the public configuration of an amplify client in their application?

What risks does such "unauthorized config use" pose to the operation of legitimate/authorized amplify/cognito clients?

What *data* would this potentially make available to third parties, if fe. they manage to trick users to provide their creds on a fishing site f.e.?

If the scenario of unauth-config-use is a true risk, what mitigation strategies are available?

Any hints/pointers available to previous discussions regarding such topics in context of amplify/cognito-public api?

Thanks in advance
## Comment

---------------

Author: @antimonad

To clarify, the most important config visible publicly is probably the oauth config (client-id(no-secret), user-pool).
The question seeks to clarify the risks arising from unauthorized use of that config.
tia,cheers

---------------

---------------

# Refactor amazon-cognito-identity-js to use Promises instead of callbacks

---------------

Author: @htunnicliff
Upvotes: 2
Comments: 0

We are using `amazon-cognito-identity-js` pretty heavily at my organization. Right now, we are forced to write wrappers around most of the library in order to use promises instead of callbacks. 

I would be happy to submit a pull request that refactors this package to use promises. There are two obvious strategies for refactoring:

### 1. Completely replace callbacks with async/await and Promises

Pros | Cons
-----|------
⭐️ Promises! | 🚫 Breaking API changes
⭐️ Smaller codebase | 🚫 Major version change
⭐️ No more callback hell | 

### 2. Add async/await and Promises while maintaining existing callback APIs

Pros | Cons
-----|------
⭐️ Promises! | 🚫 Larger codebase
⭐️ Preserves backwards compatibility | 🚫 Conditional logic everywhere
⭐️ Minor version change | 

Is this sort of alteration a favorable improvement @ericclemmons, @sammartinez, @iartemiev? 

---------------

---------------

# Does Sign in with Apple via Cognito/Amplify support React Native apps made with Expo managed workflow?

---------------

Author: @ekailly
Upvotes: 1
Comments: 0

Hello, 

I have a project that's currently made with Expo's managed workflow and we're on SDK version 38. We use Cognito/Amplify for sign in with Facebook and Google without issue. I have attempted to follow [these docs](https://docs.amplify.aws/lib/auth/social/q/platform/js) to a tee, but I have not been successful setting up Sign in with Apple on standalone builds. 

I have a hunch that this may only be supported only in either a vanilla React Native project or an Expo project made in the bare workflow, as one comment from [an Amplify contributor](https://github.com/aws-amplify/amplify-js/issues/6547#issuecomment-674070922) in a bug report similar to this problem asked the author of the bug report if they've configured their URL scheme in `Info.plist`.  I do have the code snippet being used in the docs for a custom `urlOpener` and Expo's `WebBrowser`, but I'm still unsuccessful with that.

I can share my configuration details if necessary, but it would be really awesome to hear from any other members in this community that got Sign in with Apple to work with an Expo managed workflow project so I could learn what I'm doing wrong here!

---------------

---------------

# Amplify Auth: Custom Storage

---------------

Author: @john-redd
Upvotes: 1
Comments: 1

I'm trying to implement a custom storage solution to avoid having the Cognito JWT's stored in localStorage or on a non httpOnly cookie, but there isn't very good documentation on all the methods that need to be defined in the custom Storage class that gets passed to the Amplify configure method.

I currently have the following methods on my custom Storage class:

```js
setItem(key, value) => string
getItem(key) => string
removeItem(key) => string
clear() => object
```

After diving into the source code, it looks like [this](https://github.com/aws-amplify/amplify-js/blob/2b4f6d8c5377cee9be0446ed9f75fa8fa1ce5803/packages/auth/src/Auth.ts#L2047) is what is expected. But then later on they look for another method name [sync](https://github.com/aws-amplify/amplify-js/blob/2b4f6d8c5377cee9be0446ed9f75fa8fa1ce5803/packages/auth/src/Auth.ts#L163) and there is no good documentation about what parameters it is expected to accept, if any, and what it should return, if anything.

Any help would be much appreciated.
## Comment

---------------

Author: @Rajan-Gupta1

@john-redd Were you able to find an answer to this ? I was able to register sync() method but on debugging setItem is not getting called but getItem and sync are being called which indicates there is a bug. Can anyone confirm?

---------------

---------------

# Using same Admin Query for two different apps

---------------

Author: @daviddeslauriers
Upvotes: 1
Comments: 1

So here's my situation...I have two React apps that need to talk to the same Cognito User Pool. I've been able to accomplish this by copying the aws-exports.js file from the first app to the second app I created (not sure if this is something I should be doing or not but it is working). The issue I am having however is when I run an Admin Query on the second app (to say list users in the Cognito User Pool) I get a 403 (Forbidden) error. Has anyone ever run into this before? Googling all day has not helped me so I figured I would ask.
## Comment

---------------

Author: @undefobj

The A[dmin Queries code uses an environment variable](https://github.com/aws-amplify/amplify-cli/blob/4e5f5c62287252ff59ecda050390e9b3c2b00146/packages/amplify-category-auth/resources/adminAuth/admin-auth-cognitoActions.js#L18) for the current user pool configured for a CLI project.

If you wanted this to leverage another User Pool you could potentially alter this code or change the variable, but note that the Lambda Function which is interfacing with the other User Pool needs to be granted appropriate permissions to perform such an action.

---------------

---------------

# Is possible the dynamic configuration of the API module?.

---------------

Author: @vrebo
Upvotes: 1
Comments: 1

Hi community!.

I have a question regarding if it's possible to configure the API module at runtime via the API.configure() function?.

My use case is the following.

I have an app in react native that initially works through Cognito Pool Authorization. With this configuration a specific user profile can configure some settings in the app (between them the app authorization through API Key). From there, the app is ready to be used by unauthorized users and should use this new configuration until the API Key expires or the configuration is changed by the logged user.

Is this behavior possible?

Thanks in advance.
## Comment

---------------

Author: @vrebo

From @dabit3 in the #graphql-help Channel in Discord. 

> Yes, this is works fine and is an approach I've seen taken.
> 
> Keep in mind too that you can switch authorization modes for API calls by overriding the default auth mode: 
> 
> https://docs.amplify.aws/lib/graphqlapi/authz/q/platform/js

---------------

---------------

# Facebook user pool login through hosted ui, can you get a facebook token to retrieve a users friends?

---------------

Author: @paulsjohnson91
Upvotes: 1
Comments: 0

I've given users the ability to log into a react native app with facebook federated sign in using aws amplify hosted UI.
I'm trying to work out how to give the user the ability to see their facebook friends to add them on the app, is there a way to do this? I guess I'd need an auth token for facebook api.

---------------

---------------

# amazon-cognito-identity-js confirm that email and username (preferred username) are both unique

---------------

Author: @RoniFinTech
Upvotes: 1
Comments: 0

I tried playing with the Cognito User Pool setup properties and I can either have username unique or email uniqu but never both unique.
Is it even possible>?

---------------

---------------

# Angular UI Component routing user to Home after a successful login

---------------

Author: @Rajan-Gupta1
Upvotes: 1
Comments: 0

I have been able to integrate Angular UI Comp and auth seems to be working fine. However the problem I am having is not knowing where to put code to route the user to home component when AuthGuard is enabled and router-outlet is in-place. I need to route user to by doing this
this.router.navigate(['/home']) but do not understand where to put that.


---------------

---------------

# "Amazon" Federated Identity Sign In using Amplify

---------------

Author: @joshuafernandes1996
Upvotes: 1
Comments: 0

I am trying to Sign in using "LoginWithAmazon", See code below

  const handleAmazonLogin = (event) => {
    event.preventDefault();
    console.log(window)
    options = {};
    options.scope = 'profile';
    options.pkce = true;
    window.amazon.Login.authorize(options, function(response) {
      if (response.error) {
        console.error('oauth error ' + response.error);
        return;
      }
      window.amazon.Login.retrieveToken(response.code, function(response) {
        if (response.error) {
          console.error('oauth error ' + response.error);
          return;
        }
        const acc_token = response.access_token;
        const expires_at = response.expires_in;

        window.amazon.Login.retrieveProfile(response.access_token, function(response) {

          if (window.console && window.console.log)
            window.console.log(response);

          const user = {
            name: response.profile.Name,
            email: response.profile.PrimaryEmail
          };

          aws_amplify.Auth.federatedSignIn(
            'loginWithAmazon', {
              token: acc_token,
              expires_at
            },
            user
          );

          // location.reload();
        });
      });
    });
  }

but when I use amplify to validate access_token, it says

Uncaught (in promise) NotAuthorizedException: Invalid login token. Not a valid OpenId Connect identity token.

I have done the same for Facebook and Google, But I am struggling to understand why this is not working for amazon.

Any help would be appreciated.

---------------

---------------

# Cookies not getting stored in iOS using amazon-cognito-identity-js

---------------

Author: @Zinga9
Upvotes: 1
Comments: 0

Hi there,

We're using the amazon-cognito-identity-js for authenticating the user in our ionic - angular app.

It works really nice in web!

The only question I have is around the cookies. As expected, when i mention the CookieStorage the cookies are getting added in web and also on Android app.
import { CognitoUserPool, CognitoUser, CookieStorage } from 'amazon-cognito-identity-js';

var pool = new CognitoUserPool({
  UserPoolId: COGNITO_USER_POOL_ID,
  ClientId: COGNITO_CLIENT_ID,
  Storage: new CookieStorage({ domain: DOMAIN })
});

var user = new CognitoUser({
  Username: username,
  Pool: pool,
  Storage: new CookieStorage({ domain: DOMAIN })
});


However when i run the same on iOS app, cookies are not getting set.

Can someone guide me in getting this worked.

---------------

---------------

# NEED Help Not able to read the data from s3 bucket

---------------

Author: @sharayup12
Upvotes: 1
Comments: 0

Hi there,

I have created an android application using Amplify storage, in which amplify creates a folder in s3 bucket named pulic and by using thier functions it creates an object in the public folder(e.g xyz.txt file). but when im trying to read that folder using a esp32 wroom in board(hifi1 rev b) im not able to read the data somebody please help.

following is the log im getting
esp32>
ready
ATE0
esp32> ATE0
esp32>
OK
AT
esp32>
OK
AT+CWMODE=1
esp32>
OK
AT+CWJAP="ONEPLUS","moho1419"
AT+CIPSTART="TCP","risc-v-demo.s3.us-east-2.amazonaws.com",80,2
esp32> ERR CODE:0x010b0000
esp32>
busy p...
AT+CIPSEND=79
esp32> ERR CODE:0x010b0000
esp32>
busy p...GET /public
/data.txt HTTP/1.1
Host:risc-v-demo.s3.us-east-2.amazonaws.com

esp32> ERR CODE:0x010b0000
esp32>
busy p...
AT+CIPCLOSE
esp32> ERR CODE:0x010b0000
LEDs off
        esp32>
busy p...



---------------

---------------

# Cloudflare Workers

---------------

Author: @rohanbam
Upvotes: 1
Comments: 0

Does the aws-amplify/amplify-js work inside cloudflare workers where there is no node.js environment but a javascript v8 isolate instead?

---------------

---------------

# Import a generated GraphQL mutation inside Lambda

---------------

Author: @lexfaraday
Upvotes: 1
Comments: 0

Hello,
Following this example to call a mutation from a Lambda/NodeJS https://docs.amplify.aws/lib/graphqlapi/graphql-from-nodejs/q/platform/js#mutation the mutation specification (createTodo) is hardcoded, this is hard to maintain, the question is, how can import the generated mutation code by "amplify cli" inside a Lambda and use the API utility from AWS libraries?

An option is make a copy of the generated code inside Lambda's bundle but this is manual anyway, and for the utilities to call a GraphQL API we want to use the same code as the client, will be a great option the usage of import { API } from 'aws-amplify';

Thanks in advance!

---------------

---------------

# Need help! I cannot use my schema.graphql to create my stack.

---------------

Author: @simon-zhangmuye
Upvotes: 1
Comments: 0

Here is my schema.graphql file.
`type Post @model
@auth(rules: [
    { allow: groups, groups: ["Admin"]},
    { allow: owner},
    { allow: public, operations: [read] }
])
@key(name: "postByCreatedAt", fields:["id","createdAt"], queryField:"PostByCreatedAt")
{
  id: ID!
  title: String!
  content: String!
  username: String!
  avatar: String!
  createdAt: String
  comment: [Comment] @connection(keyName: "commentByPostId", fields: ["id"])
  postLike: [PostLike] @connection(keyName: "postLikeByPostId", fields: ["id"])
}

type Comment @model
@key(name: "commentByPostId", fields: ["postId"])
@key(name: "commentByCreatedAt", fields:["id","createdAt"], queryField:"CommentByCreatedAt")
@auth(rules: [
    { allow: groups, groups: ["Admin"]},
    { allow: owner},
    { allow: public, operations: [read] }
])
{
  id: ID!
  postId: ID!
  content: String!
  username: String!
  avatar: String!
  createdAt: String
  commentLike: [CommentLike] @connection(keyName: "commentLikeByCommentId", fields: ["id"])
  post: Post @connection(fields: ["postId"])
}


type PostLike @model
@key(name: "postLikeByPostId", fields: ["postId"])
@key(name: "postlikeByCreatedAt", fields:["id","createdAt"], queryField:"PostlikeByCreatedAt")
@auth(rules: [
    { allow: groups, groups: ["Admin"]},
    { allow: owner},
    { allow: public, operations: [read] }
])
{
  id: ID!
  postId: ID!
  username: String!
  avatar: String!
  category: Category
  createdAt: String
  post: Post @connection(fields:["postId"])
}

type CommentLike @model
@key(name: "commentLikeByCommentId", fields: ["commentId"])
@key(name: "commentlikeByCreatedAt", fields:["id","createdAt"], queryField:"CommentlikeByCreatedAt")
@auth(rules: [
    { allow: groups, groups: ["Admin"]},
    { allow: owner},
    { allow: public, operations: [read] }
])
{
  id: ID!
  commentId: ID!
  username: String!
  avatar: String!
  category: Category
  createdAt: String
  comment: Comment @connection(fields:["commentId"])
}

enum Category {
  like
  dislike
}`

When I use amplify push, the console gives me this error.
![2](https://user-images.githubusercontent.com/10706610/96067609-e5c31880-0ee5-11eb-8c5f-8f1ff058e31d.png)
![3](https://user-images.githubusercontent.com/10706610/96067624-ee1b5380-0ee5-11eb-9b9d-4f64794a7b25.png)
![4](https://user-images.githubusercontent.com/10706610/96067637-f1aeda80-0ee5-11eb-8b02-7841d4c74a64.png)
![5](https://user-images.githubusercontent.com/10706610/96067641-f4a9cb00-0ee5-11eb-905e-aad1fd28f435.png)

---------------

---------------

# What is the best practice for adding a local secondary index after creating dynamodb table?

---------------

Author: @simon-zhangmuye
Upvotes: 1
Comments: 0

I just learn AWS Amplify and want to add a new sort key in my schema.graphql.
When I use amplify push, it rises an error "you cannot add a local secondary index in your dynamodb, local secondary indexes can only be created when creating dynamodb".
What should I do in this case？

---------------

---------------

# How to update push notifications channels using amplify-cli

---------------

Author: @An0r4k
Upvotes: 1
Comments: 0

Problem: Unable to update the notifications to use FCM.

Steps to reproduce: 
1. Create a react native project
2. Add notifications using "amplify add notifications"
3. Choose the APN channel and follow the steps provided in the Amplify documentation
4. Now try to update the notifications to add FCM using "amplify update notifications"

Description:
I'm building a react native application, and for push notifications I decided to go with Amplify notifications (Pinpoint). First I added Apple Push Notifications (APN) using amplify cli "amplify add notifications" and selecting the APN channel. It worked well. Then I wanted to add another channel FCM (Firebase Cloud Messaging), I tried using "amplify update notifications" and choosing FCM, it gives an error saying "No resources to update"( See the attached screenshot)

<img width="696" alt="Screen Shot 2020-10-08 at 2 51 21 PM" src="https://user-images.githubusercontent.com/68049549/95792344-2e859200-0c98-11eb-8976-2c8b791a5fa6.png">


Since it didn't workout I tried using "amplify add notifications", it says "Notifications is migrated from Mobile Hub and channels cannot be added with amplify CLI".
<img width="645" alt="Screen Shot 2020-10-08 at 2 54 33 PM" src="https://user-images.githubusercontent.com/68049549/95792396-46f5ac80-0c98-11eb-9372-5f7bd5a7f9bf.png">

Then as a last resort I tried adding FCM using the AWS console (the website). It asked me the ApiKey which I provided. And it said FCM is enabled and seemed like everything has fallen in place. 
<img width="1140" alt="Screen Shot 2020-10-08 at 2 59 12 PM" src="https://user-images.githubusercontent.com/68049549/95792409-4ceb8d80-0c98-11eb-9940-b6dc7e42dc68.png">

Now I went back to my repo and tried to pull from the AWS cloud to update my workspace with the FCM configuration. I tried using "amplify pull". And it says "Update channel error, there was an error initializing your environment. Missing required key 'ApiKey' in params.GCMChannelRequest ". But when I tried to pull it didn't prompt me to enter ApiKey. Isn't it enough to add the ApiKey in the console. How do I provide the ApiKey from the amplify cli. I want to add the FCM channel to my notifications project. Any help will be greatly appreciated. Thank you in advance. 
<img width="1008" alt="Screen Shot 2020-10-08 at 3 01 24 PM" src="https://user-images.githubusercontent.com/68049549/95792458-64c31180-0c98-11eb-8034-026e14e1a44f.png">






---------------

---------------

# Why am I unable to create an object relationship in Lambda function?

---------------

Author: @duncangroenewald
Upvotes: 1
Comments: 0

I am trying to get a list of video objects with some properties of related objects.

Schema as shown below:

```
    type SessionType 
    @model
    {
        id: ID!
        name: String!
        activityTypes: [ActivityType] @connection(keyName: "bySessionType", fields: ["id"])
        videos: [Video] @connection(name: "SessionTypeVideo")
    }

    type Video 
    @model 
    {
        id: ID!
        bucket: String!
        key: String!
        sessionDate: String
        isReviewed: String!
        reviewedBy: ID
        reviewDate: String
        title: String
        comments: String
        sessionTypeID: ID!
        sessionType: SessionType @connection(name: "SessionTypeVideo")
        activityTypeID: ID!
        modeID: ID!
        genderID: ID!
        ageGroupID: ID!
        weightCategoryID: ID!
    }
    
    
    # create the input object for the lambda function so 
    # we can pass in the owner - is this actually required ??

    input CreateVideoInput {
    	id: ID
      owner: String
    	sessionDate: String!
      genderID: ID!
      ageGroupID: ID!
      weightCategoryID: ID!
      sessionTypeID: ID!
      videoSessionTypeId: ID!
      activityTypeID: ID!
      modeID: ID!
      isReviewed: String!
    	bucket: String!
    	key: String!
    	title: String
    }
```

AppSync annotations appear to have created the `videoSessionTypeId` property in the actual graphql schema definition when viewed in AppSync console.  Although these don't show up in the generated queries and mutations which are shown below.

 ```
   export const createVideo = /* GraphQL */ `
      mutation CreateVideo(
        $input: CreateVideoInput!
        $condition: ModelVideoConditionInput
      ) {
        createVideo(input: $input, condition: $condition) {
          id
          bucket
          key
          sessionDate
          isReviewed
          reviewedBy
          reviewDate
          title
          comments
          sessionTypeID
          sessionType {
            id
            name
            activityTypes {
              nextToken
            }
            modes {
              nextToken
            }
            createdAt
            updatedAt
            videos {
              nextToken
            }
          }
          activityTypeID
          modeID
          genderID
          ageGroupID
          weightCategoryID
          athletes {
            items {
              id
              createdAt
              updatedAt
            }
            nextToken
          }
          createdAt
          updatedAt
          owner
        }
      }
    `;
    
    export const listVideos = /* GraphQL */ `
      query ListVideos(
        $filter: ModelVideoFilterInput
        $limit: Int
        $nextToken: String
      ) {
        listVideos(filter: $filter, limit: $limit, nextToken: $nextToken) {
          items {
            id
            bucket
            key
            sessionDate
            isReviewed
            reviewedBy
            reviewDate
            title
            comments
            sessionTypeID
            sessionType {
              id
              name
              createdAt
              updatedAt
            }
            activityTypeID
            modeID
            genderID
            ageGroupID
            weightCategoryID
            athletes {
              nextToken
            }
            createdAt
            updatedAt
            owner
          }
          nextToken
        }
      }
    `;
```

Currently the sessionType {id, name} property returned by the listVideos function is always null so I guess the create method I am using is not setting the correct properties on the Video object.  If I manually create the entry using AppSync console and setting the videoSessionTypeId property it works.

The input properties are passed as metadata when uploading the file and subsequently extracted from the S3.headObject().
The input object used in the Lambda function is as follows:

 ```
   const item = {
    		id: id, 
        owner: metadata.owner,
        sessionDate: metadata.sessiondate,
        genderID: metadata.genderid,
        ageGroupID: metadata.agegroupid,
        weightCategoryID: metadata.weightcategoryid,
        sessionTypeID: metadata.sessiontypeid,
        videoSessionTypeId: metadata.sessiontypeid,               <==== 
        activityTypeID: metadata.activitytypeid,
        modeID: metadata.modeid,
        isReviewed: 'false',
        bucket: bucketName,
        key: key,
        title: metadata.videotitle
      } 
```

The lambda function that calls the mutate function is shown below:

  ```
  async function storeVideoInfo(item) {
      console.log('storeVideoItem', JSON.stringify(item))
      const createVideo = gql`
        mutation CreateVideo(
          $input: CreateVideoInput!
          $condition: ModelVideoConditionInput
        ) {
          createVideo(input: $input, condition: $condition) {
            id
            sessionDate
            genderID
            ageGroupID
            weightCategoryID
            sessionTypeID
            videoSessionTypeId
            activityTypeID
            modeID
            isReviewed
            title
            owner
            bucket
            key
          }
        }
      `;
    
      console.log('trying to createvideo with input', JSON.stringify(item))
      const result = await client.mutate({
        mutation: createVideo,
        variables: { input: item },
        fetchPolicy: 'no-cache'
      })
    
      console.log('result', JSON.stringify(result))
      return result
    }
```

However when calling the AppSync API to create the video record is fails when running validation on the input property 'videoSessionTypeId'.

Can anyone provide an explanation for how relations work and how you create a new object and the relationships such that subsequent queries return the object and properties of related objects.

BTW this is the error from the Lambda function:

```
    2020-10-13T22:28:35.438Z	d42efde3-100b-434f-b967-ce080bd43e6e	ERROR	Unhandled Promise Rejection	
    {
        "errorType": "Runtime.UnhandledPromiseRejection",
        "errorMessage": "Error: GraphQL error: Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'",
        "reason": {
            "errorType": "Error",
            "errorMessage": "GraphQL error: Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'",
            "graphQLErrors": [
                {
                    "path": null,
                    "locations": [
                        {
                            "line": 9,
                            "column": 5,
                            "sourceName": null
                        }
                    ],
                    "message": "Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'"
                }
            ],
            "networkError": null,
            "message": "GraphQL error: Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'",
            "stack": [
                "Error: GraphQL error: Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'",
                "    at new ApolloError (/var/task/node_modules/apollo-client/bundle.umd.js:85:32)",
                "    at Object.next (/var/task/node_modules/apollo-client/bundle.umd.js:890:37)",
                "    at notifySubscription (/var/task/node_modules/zen-observable/lib/Observable.js:135:18)",
                "    at onNotify (/var/task/node_modules/zen-observable/lib/Observable.js:179:3)",
                "    at SubscriptionObserver.next (/var/task/node_modules/zen-observable/lib/Observable.js:235:7)",
                "    at notifySubscription (/var/task/node_modules/zen-observable/lib/Observable.js:135:18)",
                "    at onNotify (/var/task/node_modules/zen-observable/lib/Observable.js:179:3)",
                "    at SubscriptionObserver.next (/var/task/node_modules/zen-observable/lib/Observable.js:235:7)",
                "    at notifySubscription (/var/task/node_modules/zen-observable/lib/Observable.js:135:18)",
                "    at onNotify (/var/task/node_modules/zen-observable/lib/Observable.js:179:3)"
            ]
        },
        "promise": {},
        "stack": [
            "Runtime.UnhandledPromiseRejection: Error: GraphQL error: Validation error of type FieldUndefined: Field 'videoSessionTypeId' in type 'Video' is undefined @ 'createVideo/videoSessionTypeId'",
            "    at process.on (/var/runtime/index.js:37:15)",
            "    at process.emit (events.js:198:13)",
            "    at process.EventEmitter.emit (domain.js:448:20)",
            "    at emitPromiseRejectionWarnings (internal/process/promises.js:140:18)",
            "    at process._tickCallback (internal/process/next_tick.js:69:34)"
        ]
    }
```

---------------

---------------

# How to access a Cognito UserPool data from lambda function through API Gateway

---------------

Author: @sukidhar
Upvotes: 1
Comments: 0

 What role lets me to have the access to cognito user pool data

---------------

---------------

# Remove auth attribute from required but still it's create as required

---------------

Author: @lochawala
Upvotes: 1
Comments: 3

**Describe the bug**
when i add auth in amplify and removing email from required attribute still it's create as required  

**To Reproduce**
Steps to reproduce the behavior:

amplify add auth
Do you want to use the default authentication and security configuration?
❯ Default configuration
How do you want users to be able to sign in?
❯ Email or Phone Number
Do you want to configure advanced settings?
❯ Yes, I want to make some additional changes.
What attributes are required for signing up?
❯ unselect Email
Do you want to enable any of the following capabilities?
❯ hit enter
amplify push

**Expected behavior**
create user pull as not required email attribute
## Comment

---------------

Author: @ashika01

@lochawala What is the error you are seeing? Could you provide with your amplify js code sample.

Also, I would suggest to through the manual configuration flow in CLI rather than going down default and unselecting required.
## Comment

---------------

Author: @lochawala

@ashika01 Thanks for your reply 
I have tried with custom configuration too, but still, it's created email as required attribute 
I have attached some screen shots for better understanding
 
![Screen Shot 2020-10-08 at 10 02 45 AM](https://user-images.githubusercontent.com/14148438/95415602-539f9b00-094e-11eb-8499-4b093573d761.png)


![Screen Shot 2020-10-08 at 10 07 18 AM](https://user-images.githubusercontent.com/14148438/95415538-2521c000-094e-11eb-8732-bcb85d032c2d.png)


Check in first screenshot I have unselected email, but in the 2nd screen shot you can seen email as a required attribute
## Comment

---------------

Author: @ashika01

Hi @lochawala I was able to setup with just username login by following manual configuration.

This is steps to go through in Amplify CLI for manual configuration,
![Screen Shot 2020-10-08 at 2 19 56 PM](https://user-images.githubusercontent.com/35131273/95517755-79409a80-0976-11eb-9a15-a8fcc78e8d5e.png)


This is my userpool console equivalent,
![Screen Shot 2020-10-08 at 2 53 50 PM](https://user-images.githubusercontent.com/35131273/95517799-8eb5c480-0976-11eb-82d8-168b45056547.png)


If you want your users to sign in with email and phone number it will become required attribute. That might be why you are having problems. I am moving this to discussion to get help from community.

---------------

---------------

# How to implement usage plans?

---------------

Author: @kimfucious
Upvotes: 1
Comments: 1

Hi there,

I've got an app built with Amplify that uses several functions via API Gateway.

I'd like to limit/throttle traffic on these endpoints with some granularity.

I've read up on how to setup a usage plan in the API Gateway, and it requires API requests to set an `x-api-key` in the header of the API requests.

I've tried the below, where API is an import from `aws-amplify`,but the key registers no usage, and thus enforces nothing.
```js
  const response = await API.post(
    "MY_API",
    "/PATH",
    {
      header: { "x-api-key": "MY_API_KEY" },
      body: {
        ...
      }
    }
  );
```
It's obvious that I don't know what I'm doing, so any help is appreciated.
## Comment

---------------

Author: @bwobbones

I got this working, i needed to set up the usage plan in the AWS console (though I'm pretty sure you could do this with CloudFormation if you wanted to).  Then you need to change the template to use the usage plan settings.

In the api you created, modify the `apiname-cloudformation-template.json`.  

Replace the `securityDefinitions` section with
```
"securityDefinitions": {
  "sigv4": {
    "type": "apiKey",
    "name": "Authorization",
    "in": "header",
    "x-amazon-apigateway-authtype": "awsSigv4"
  },
  "api_key": {
    "type": "apiKey",
    "name": "x-api-key",
    "in": "header"
  }
},
```

Then in both of the `x-amazon-apigateway-any-method` sections under the path add this:
```
"x-amazon-apigateway-auth": {
  "type": "NONE"
},
"security": [
  {
    "api_key": []
  }
],
```

Then `amplify push` and you should be good.  You might need to redeploy the API in the console (API->Resources->path->Actions->Deploy API), I'm not sure why that doesn't happen automatically.

---------------

---------------

# DataStore: How to query using a secondary GSI

---------------

Author: @vrebo
Upvotes: 1
Comments: 1

Hi community!.

I couldn't find in the DataStore documentation how to make queries that use Global Secondary Indexes neither as documentation nor as examples. Does anyone know if this feature exists and how to do it?.

Thanks in advance.
## Comment

---------------

Author: @vrebo

From @undefobj in the [DataStore Discord Channel](https://discord.gg/gmvQz8r)

> Delta sync automatically use GSIs. Base sync does not but you'll be able to control that in a few weeks
> Note though that with DataStore when you run a query it's always against the local store on the device, not the network.
> The local store is transparently updated for you by base/delta queries as part of sync as well as subscriptions.
> The new feature that is coming out will allow you to do "selective sync" which will transparently perform GSI queries behind the scenes during the base sync operations

---------------

---------------

# How update my local graphql operation, amplify push doesn't work.

---------------

Author: @simon-zhangmuye
Upvotes: 1
Comments: 0

Hi,

I make some changes in my schema and use amplify push to upload.
But the local graphql operations don't update.
How can I update local graphql operations after making changes in my schema?

Thank you very much.

---------------

---------------

# [Request] Storage File Explorer UI Component and JS APIs

---------------

Author: @sw-yx
Upvotes: 2
Comments: 1

**Is your feature request related to a problem? Please describe.**

the `Storage.list` API available to us today is pretty low level: given a prefix, they list all files and folders to arbitrary depth. it is up to the user to further parse folders and files for immediate depth. furthermore, some "folders" are just defined inside of filenames, so that needs to be parsed too. a lot of work to wrangle this data into something usable.

**Describe the solution you'd like**
we should make it very easy to replicate the S3 interface already offered by AWS:

![image](https://user-images.githubusercontent.com/6764957/95493876-ae2d0b80-09cf-11eb-9e9f-984e9ebb84ad.png)

I think this is a 2 part process

- offer a slightly higher level API that spits out nested filesystem data
- build a UI component that will easily display this (together with file upload progress)

**Describe alternatives you've considered**
do nothing

**additional context**

otherwise we have to do ugly stuff like this https://github.com/aws-amplify/docs/pull/2516
## Comment

---------------

Author: @ashika01

@sw-yx This is solid. This is part of our roadmap to add new UI components for s3. Moving it to0 discussions to get more thoughts for everyone.

---------------

---------------

# Aws-Amplify importing the entire aws-sdk library creating huge bundle size

---------------

Author: @drixta
Upvotes: 1
Comments: 1

**Describe the bug**

AWS-Amplify is importing aws-sdk entirely creating a massive bundle size. This issue hasn't happened before.

![Screen Shot 2020-09-25 at 4 42 38 PM](https://user-images.githubusercontent.com/2681321/94324352-58c41980-ff4e-11ea-8c7f-1d68679e0288.png)


**To Reproduce**
I'm currently using [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer) to generate this report;

My current project dependencies is as follows.
As you can see I'm not importing `aws-sdk` anywhere and aws-amplify imports aws-sdk for it's own logic, specifically in cognito.

  "dependencies": {
    "@ag-grid-community/all-modules": "^23.2.1",
    "@ag-grid-enterprise/all-modules": "^24.0.0",
    "@aws-amplify/ui-react": "^0.2.18",
    "@craco/craco": "^5.6.4",
    "@emotion/core": "^10.0.28",
    "@testing-library/jest-dom": "^4.2.4",
    "@testing-library/react": "^9.3.2",
    "@testing-library/user-event": "^7.1.2",
    "@types/facebook-js-sdk": "^3.3.0",
    "@types/jest": "^24.0.0",
    "@types/node": "^12.0.0",
    "@types/react": "^16.9.0",
    "@types/react-big-calendar": "^0.24.6",
    "@types/react-dom": "^16.9.0",
    "@types/react-router-dom": "^5.1.5",
    "ag-grid-community": "^23.2.1",
    "ag-grid-react": "^23.2.1",
    "antd": "^4.2.5",
    "aws-amplify": "^3.3.1",
    "date-fns": "^2.16.1",
    "dayjs": "^1.8.36",
    "formik": "^2.1.4",
    "formik-antd": "^2.0.1",
    "handsontable": "^7.4.2",
    "react": "16.12.0",
    "react-big-calendar": "^0.27.0",
    "react-contenteditable": "^3.3.5",
    "react-dnd": "^11.1.3",
    "react-dnd-html5-backend": "^11.1.3",
    "react-dom": "^16.13.1",
    "react-icons": "^3.10.0",
    "react-infinite-scroll-hook": "^3.0.0",
    "react-intersection-observer": "^8.28.5",
    "react-loading-skeleton": "^2.1.1",
    "react-query": "^2.21.0",
    "react-query-devtools": "^1.1.16",
    "react-router-dom": "^5.2.0",
    "react-scripts": "3.4.1",
    "react-spring": "^8.0.27",
    "react-stack-gallery": "^1.0.4",
    "react-stack-grid": "^0.7.1",
    "time-ago": "^0.2.1",
    "typescript": "~3.7.2",
    "yup": "^0.29.1"
  },

**Expected behavior**
Expecting not the entire `aws-sdk` is imported to the project as it is unreasonable to expect the users to download the entire library without using it.
## Comment

---------------

Author: @ashika01

@drixta The latest versions of Amplify lib enables tree shaking on prod builds. Please run a prod build and compare size you should not be seeing huge bundle chunks.

---------------

---------------

# Cannot find file './aws-exports' in './src'

---------------

Author: @duncangroenewald
Upvotes: 1
Comments: 1

Describe the bug
When building Frontend with AWS CI/CD we are now getting this error.

To Reproduce
Any time we commit code the CodeCommit and the front-end application is deployed we get this error during the build process

Expected behaviour
The build process should automatically create the aws-exports.js file relevant for the environment being deployed to.

Screenshots
N/A

Desktop (please complete the following information):
N/A

Smartphone (please complete the following information):
N/A

Additional context
It's not clear what other information is required. As we understand it the aws-exports.js file should be created automatically by AWS Amplify when the Frontend is built. It's unclear where there is anything we need to do to or might have don't to affect creation of the aws-exports.js file.
## Comment

---------------

Author: @ashika01

@duncangroenewald are you using setting up your backend using Amplify CLI?! 

---------------

---------------

# DynamoDB not being queried by GraphiQL

---------------

Author: @tnorlund
Upvotes: 1
Comments: 1

Hey guys!

I'm currently testing hardware. The results of each test are stored to a DynamoDB table created with Amplify. 

<img width="1017" alt="Screen Shot 2020-10-07 at 11 44 41 AM" src="https://user-images.githubusercontent.com/26452518/95373946-91d78480-0892-11eb-81a9-575e6b277ee4.png">

I'm uploading each hash using DynamoDB's cpp sdk. When I hop back onto Amplify, I can't query any of the data.

```
type Performance @model {
  id: ID!
  buffer: Int
  cpuSerial: String
  dateTime: String
  fpsReal: Float
  fpsRequested: Int
  numberFrames: Int
  runTime: Float
  timeRequested: Int
}
```

```bash
$ amplify mock api
```


<img width="1528" alt="Screen Shot 2020-10-07 at 11 46 21 AM" src="https://user-images.githubusercontent.com/26452518/95374100-c3e8e680-0892-11eb-8106-f4d4c40f4bcf.png">

If I know that the data is in the table, but not in the result of the query, how should I move forward?
## Comment

---------------

Author: @tnorlund

So I was able to query the data using AppSync.

<img width="1170" alt="Screen Shot 2020-10-07 at 12 27 50 PM" src="https://user-images.githubusercontent.com/26452518/95378290-8a1ade80-0898-11eb-9b85-ca9fefe71c66.png">

The issue I'm facing now, is that I can't query the data in my Gatsby site. I added the required config to gatsby browswer.

```js
import { PageComponents, Providers } from 'components/Global'
import React from 'react'
import Amplify from 'aws-amplify'
import config from './src/aws-exports'
Amplify.configure( config )

export const wrapRootElement = ({ element }) => {
  return <Providers>{element}</Providers>
}

export const wrapPageElement = ({ element, props }) => {
  return <PageComponents {...props}>{element}</PageComponents>
}

// https://gatsbyjs.org/docs/add-offline-support-with-a-service-worker
export const onServiceWorkerUpdateReady = () => window.location.reload()

```

But I have a component that I'd like to query the data from.

```js
import React from 'react'
import DarkToggle from '../DarkToggle'
import Nav from '../Nav'
import { HeaderDiv, Logo } from './styles'

import { API } from 'aws-amplify'
import * as queries from '../../graphql/queries'

async function asyncCall() {
  API.graphql( { query: queries.listPerformances } )
    .then( result => {
      console.log("finshed query")
      console.log(result)
    })
    .catch( error => {
      console.log("errored")
      console.log(error)
    })
}

export default function Header( { site } ) {
  const thisImage = asyncCall()
  return (
    <HeaderDiv>
      <Logo to="/" title={site.title} rel="home">
        tnor
      </Logo>
      <Nav />
      <DarkToggle />
    </HeaderDiv>
  )
}
```

When I `gatsby develop` this locally, I get the following error in console:

```
data: {}
errors: Array(1)
    0: GraphQLError
        message: "Network Error"
        extensions: undefined
        locations: undefined
        nodes: undefined
        originalError: undefined
        path: undefined
        positions: undefined
        source: undefined
        stack: "GraphQLError: Network Error↵    at GraphQLAPIClass.<anonymous> (http://localhost:8000/commons.js:9401:38)↵    at step (http://localhost:8000/commons.js:9089:23)↵    at Object.throw (http://localhost:8000/commons.js:9070:53)↵    at rejected (http://localhost:8000/commons.js:9062:65)"
        __proto__: Error
    length: 1
    __proto__: Array(0)
```

Are there any other steps I need to take to query the data?

---------------

---------------

# Storage does not make use of Auth credentials

---------------

Author: @AndreasLangberg
Upvotes: 1
Comments: 0

I'm trying to do something I would have thought should be fairly simply: Upload profile pictures from users (logged in with Cognito through Amplify.Auth) to S3. But for whatever reason, even if the user logs in correctly, Storage doesn't seem to be able to make use of the credentials, and tries to use "undefined" as its user, which is then promptly denied.

![image](https://user-images.githubusercontent.com/3735880/95200691-1a94e880-07df-11eb-82af-041c6ab804a2.png)

It also seems to slam down 4 POST commands before attempting the PUT, which returns 400

config:

```
{
  Auth: {
    identityPoolId: "eu-central-1:________-____-____-____-__________",
    region: "eu-central-1",
    identityPoolRegion: "eu-central-1",
    userPoolId: "eu-central-1_---------",
    userPoolWebClientId: "--------------------------",
  },
  Storage: {
    AWSS3: {
      bucket: "s3-bucket-name",
      region: "eu-north-1",
      level: "private",
    },
  },
}
```

Users are currently logging in using "withauthenticator" from @aws-amplify/ui-react, and I am able to check that the credentials are correct by running Auth.currentAuthenticatedUser().

The put command:

```
Storage.put(`userimages/${currentImage.name}`, currentImage, {
        contentType: currentImage.type,
      })
        .then((result) => console.log(result))
        .catch((err) => console.log(err));
```
using
"@aws-amplify/ui-react": "0.2.9",
"amazon-cognito-identity-js": "4.4.0",
"aws-amplify": "3.3.3",

Anyone have any ideas how to approach this, or at the very least a way to get better debug info? some 400s and a 403 without anything else isn't super useful

---------------

---------------

# Google and Facebook federeated identities with AWS Amplify return "Error: Cannot retrieve a new session. Please authenticate." after a few hours of inactivity.

---------------

Author: @twoandahalf2
Upvotes: 1
Comments: 0

hello , i have added federated identities to my React.js application and all worked good initially, however after a few hours the user is not able to log back in. -->  "Error: Cannot retrieve a new session. Please authenticate."

 I am using a very basic setup : 

`<div className="facebook-login">
            <Button onClick={() => {
              Auth.federatedSignIn({provider: 'Facebook'})
            } }> Login with Facebook</Button>
</div>`

`Amplify.configure({
  Auth: {
    mandatorySignIn: true,
    region: config.cognito.REGION,
    userPoolId: config.cognito.USER_POOL_ID,
    identityPoolId: config.cognito.IDENTITY_POOL_ID,
    userPoolWebClientId: config.cognito.APP_CLIENT_ID,
    oauth: {
      domain: "domain.auth.us-east-1.amazoncognito.com",
      redirectSignIn: 'http://localhost:3000/',
      redirectSignOut: 'http://localhost:3000/',
      responseType: "token"
    }
}`

To me, the issue is related to the expiration of the user token. However, i am not sure what would be the approach to fix this. I read so many posts about that issue but could not find a solution. 


---------------

---------------

# How to customize aws-amplify/ui-angulars' authenticator sign in button?

---------------

Author: @
Upvotes: 1
Comments: 0

How can I make the width of the sign in button 100% to the authenticators div?
I can hide the sign-up link using **hide-sign-up** in the amplify-sign-in tag but couldn't customize the sign in button.

I tried various access rules:

`[name=secondary-footer-content] span { 
  display: none;
}`
`slot[name=secondary-footer-content] { display: none}`


and applied both on global styles.css and app.component.css but none of them works.

Can anyone help me? Thanks

---------------

---------------

# Datastore doesn't trigger events in the  Hub after update "aws-amplify" to 3.3.2

---------------

Author: @ifmael
Upvotes: 1
Comments: 0

I'm listening for Datastore events through the Hub, but after update "aws-amplify" to the latest version, the datastore doesn't sync, Why is it happen?

If I querying for a specific models like:

```
useEffect(() => {
    const getContent = async () => {
      try {
        const contents = await DataStore.query(Content, Predicates.ALL);
      } catch (error) {
        console.log(error);
      }
    };
    getContent();
  }, []);
```

The Hub receives these events:
```
Event:  storageSubscribed
Event:  networkStatus
Event:  outboxStatus
``` 

but it doesn't sync the `Content` Model, ¿Is there another way to work with Datastore? 

---------------

---------------

# Can I set a true/false for every entry in a single column using DynamoDB AWS console?

---------------

Author: @chai86
Upvotes: 1
Comments: 0

@sammartinez  @manueliglesias 

I have a table in DynamoDB and i'd like essentially to set a boolean to true/false for ALL rows or entries in that table, for just a single column. Let's say the column is called UserActive. I know i can do this by clicking the pencil/edit icon in the console, for each individual row, but for thousands of entries, that's just not feasible. I need to be able to do this from the AWS console.

How can i set them all to true/false in one go?

---------------

---------------

# Dynamic groups with AppSync/DataStore with Cognito user pool group limit of 10,000

---------------

Author: @mogalmahesh
Upvotes: 1
Comments: 0

Hi, 
**Usecase:**
I am building an application where users can invite others to join their team and everyone in the team will have access to account resources. 
I am planning to use DataStore with a model where the owner, as well as the dynamic group, can have access to some record.

**My problem:**
my problem is, I can see there is a hard limit of 10,000 groups per user pool in AWS Cognito. I know it is a generous limit and very few applications will hit that limit. But I do not want to get bound by this in the case in future I need more than 10,000 groups.

https://docs.aws.amazon.com/cognito/latest/developerguide/limits.html

**Best case possible**
Am I wrong in thinking that when I use a dynamic group, in the backend it creates one new group in AWS Cognito? That these 10,000 groups per user pool are not related to how we create groups in AppSync/DataStore?
If those things are not related this is no issue at all.

But if we have this limit of 10,000 groups then this may put me in a spot of bother exactly when my app is getting used by many people. 

is there any way I can handle this?

Thanks in advance for your help and guidance.

---------------

---------------

# How to maintain a sound SaaS payment user model.

---------------

Author: @ripley
Upvotes: 1
Comments: 0

Dear community

I'm trying to create a SaaS notes app based on amplify and had a hard time to come up with an appropriate
authorization / authentication design.

My requirements are as below:

1. Newly signed up user could use all feature (notes CRUD) for some time.
2. User will not be able to create new notes after the trail is end but still could read/edit/delete them.
3. Separated user could only access notes of their own.

There's no problem of creating a subscription from stripe and maintain groups like trial / paid users, but I don't know how to continue from there.
1. Owner based authentication has no end time.
2. Group based authentication will allow a group of user to access each others resources, which is not acceptable.
3. I tried to attach auth rules below
    {allow: owner, operations: [update, read, delete]},
    {allow: groups, groups: ["Premium"]}
The entries created by this has no owner field and cannot be accessed by the owner.

I'm thinking of not to invoke GraphQL API from my client app but to migrate the functions to a set of Lambda based APIs, which could access both DynamoDB and the table where the subscription info are stored, where I can use a Lambda authorizer to do things like above.

Looks like this way will introduce much ado meanwhile abandons part of amplify.js 's capability.

Any suggestions?

Regards.

---------------

---------------

# Chatbot Styling after setting up project using amplify interactions

---------------

Author: @tabrza
Upvotes: 1
Comments: 1

I can't find how to style the React Chatbot widget shared by amplify js.. 
The following is provided in the instructions but there is a lack of documentation around how to use this:
```
const myTheme = {
  ...AmplifyTheme,
  sectionHeader: {
    ...AmplifyTheme.sectionHeader,
    backgroundColor: '#ff6600'
  }
};
```

with this component:
```
        <ChatBot
          title="My Bot"
          theme={myTheme}
          botName="My Bot"
          welcomeMessage="Welcome, how can I help you today?"
          clearOnComplete={true}
          conversationModeOn={false}
        />

```

Would appreciate some guidance on this
## Comment

---------------

Author: @sw-yx

just catching up on this. interesting! did you end up figuring it out?

---------------

---------------

# How to leverage @aws-amplify/ui-react for federated authentication?

---------------

Author: @Ajwah
Upvotes: 1
Comments: 1

My objective here is to use the UI-package and theme it accordingly; but it seems to me that the flow is broken on at least two levels:

1. There is an apparent disjunct between doing the custom flow vs the UI-package flow in the sense that the custom flow  will take all the relevant credentials from whatever is provided during `amplify add auth` which in turn stores it inside: `team-provider-info.js`. The UI-package flow however seems not to be able to automagically load these values and thus I have to manually provide them in the code base.
2. The manual flow will just work whereas the UI-package flow is confronted with a CORS issue somehow.

I detail both these below.

## Credentials Usage

I see an example [here](https://github.com/aws-amplify/amplify-js/tree/master/packages/amplify-ui-components#amplify-authenticator-federated) but I am confused as to why I need to input credentials manually whereas I already provided all the details when doing amplify add auth:

```ts
const federated = {
  amazonClientId: "your_amazon_client_id",
  facebookAppId: "your_facebook_app_id",
  googleClientId: "your_google_client_id",
  oauthConfig: {
    redirectSignIn: "http://localhost:1234/",
    redirectSignOut: "http://localhost:1234/",
  }
}
```

In the meanwhile, I iterated to doing this instead:

```js
import { AmplifyAuthenticator, AmplifyGoogleButton, AmplifySignOut} from '@aws-amplify/ui-react';

window.LOG_LEVEL = 'DEBUG';

function App() {
  return (
    <AmplifyAuthenticator>
      <AmplifyGoogleButton clientId="XXXXXX" slot="sign-in"></AmplifyGoogleButton>
      <AmplifySignOut />
    </AmplifyAuthenticator>
  )
}

export default App;
```

## CORS Issue

This however gives me a CORS-issue:

```
Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.en.myOGgYJo9ys.O/m=client/rt=j/sv=1/d=1/ed=1/am=wQE/rs=AGLTcCMR2Cg_3Iqxcgmos-E9G6cjWQG_Kw/cb=gapi.loaded_0. (Reason: CORS header “Access-Control-Allow-Origin” missing).
```

The callback `gapi.loaded_0` is attempted during `user.getSession` in `Auth.ts`. 
<img width="771" alt="Screen Shot 2020-09-26 at 11 05 14 AM" src="https://user-images.githubusercontent.com/11848116/94343731-2bc44500-ffe8-11ea-9758-338038c694b0.png">

The stacktrace states:
```
Uncaught (in promise) TypeError: user.getSession is not a function
    userSession Auth.ts:1323
    userSession Auth.ts:1321
    userAttributes Auth.ts:1059
    userAttributes Auth.ts:1058
    verifiedContact Auth.ts:1073
....
    <anonymous> cb=gapi.loaded_0:527
    za api:client.js:13
    ya api:client.js:16
    za api:client.js:13
    ha api:client.js:15
    A api:client.js:15
    t api:client.js:15
    R api:client.js:15
    <anonymous> cb=gapi.loaded_0:1
```

If I simply refresh the page then I am signed in though.
## Comment

---------------

Author: @sw-yx

i think @jordanranz can help you with the second part, but for the first part, the simple answer is that it is not yet implemented but is on our radar.

---------------

---------------

# Keeping an Amplify Session Fresh

---------------

Author: @fireflysemantics
Upvotes: 1
Comments: 1

These are the original instructions I looked at, but perhaps we no longer need to do this:

https://github.com/aws-amplify/amplify-js/issues/2560

```
  const cognitoUser = await Auth.currentAuthenticatedUser();
  const currentSession = await Auth.currentSession();
  cognitoUser.refreshSession(currentSession.refreshToken, (err, session) => {
    // Irrele
  });
```

If I try the above code I get the error:

> Property 'refreshToken' does not exist on type 'CognitoUserSession'.ts(2339)

Do we need to keep the session fresh or will Amplify automatically do it?

In this particular scenario I want to make sure that the session does not time out while the user is completing a credit card transaction entry.
## Comment

---------------

Author: @brsjak

I'm still having this issue, have you came up with a solution about this issue? 

---------------

---------------

# how make a sign up link and sign in link in header for ui-react hosted ui

---------------

Author: @dfang
Upvotes: 1
Comments: 2

Hi,

for @aws-amplify/ui-react, how to make a sign up btn and sign in/out btn without customized UI ?

thanks !
## Comment

---------------

Author: @isaiahgrant

➕ 1️⃣ 

We are using Cognito's hosted UI for our federated sign ins. The "SignUp" view of the hosted UI is not immediately apparent for many of our users.

How can we redirect users directly to the SignUp view rather than the SignIn view? SignIn usage is currently: `Auth.federatedSignIn` so I expected something along the lines of `Auth.federatedSignUp`, but could not find any resources accordingly.

Should this be a feature request?

Appreciate any insights here!
## Comment

---------------

Author: @dfang

@isaiahgrant  i ended up with this

```
// signup.jsx

import React from 'react';
import Amplify, { Auth } from 'aws-amplify';
import { AmplifyAuthenticator, AmplifySignIn, AmplifySignUp } from "@aws-amplify/ui-react";
import { AuthState, onAuthUIStateChange } from '@aws-amplify/ui-components';
import { useHistory } from 'react-router-dom';

export default function CustomSignUp() {

  let history = useHistory()
  React.useEffect(() => {

    // redirect to / if a authenticated user visits /register
    Auth.currentAuthenticatedUser()
      .then(data => console.log(data))
      .then(data => history.push("/"))

    return onAuthUIStateChange((nextAuthState, authData) => {
      // setAuthState(nextAuthState);
      // setUser(authData)
      if (nextAuthState.SignedIn) {
        history.push("/")
      }
    });
  }, []);

  return (
    <AmplifyAuthenticator initialAuthState={AuthState.SignUp}>
      <AmplifySignUp />
    </AmplifyAuthenticator>
  );
}
```

---------------

---------------

# Single Sign On with Xero.

---------------

Author: @clethrill
Upvotes: 1
Comments: 0

I'm trying to use Single Sign On with Xero, Cognito and Amplify, I've got to the point of getting access tokens for the Xero auth but I don't know how to tell my react app to use these credentials to sign my user in.

My flow is currently:

1. Hit sign in with Xero button in react app
2. Get taken to the cognito hosted UI which redirects me to Xero login
3. I login in Xero which redirects me back to the cognito hosted ui which redirects me back to my react app with a ?code=1234abc...
4. I exchange that code using a post request to get my access tokens

```
const req = await Axios.post(
	'https://{domain}.auth.ap-southeast-1.amazoncognito.com/oauth2/token', 
	`grant_type=authorization_code&client_id=${clientID}&code=${code}&redirect_uri=${redirectUri}`, 
	{
		headers: {
			'Content-Type': 'application/x-www-form-urlencoded'
		}
	}
)
```

5. ???

What do I do with these tokens to login using the Auth class? Auth.federatedSignIn and Auth.signIn both don't look like they take the right parameters. Am I doing a step wrong should I be doing something differently?

---------------

---------------

# Does @auth directive on graphQL type impact performance?

---------------

Author: @Nxtra
Upvotes: 1
Comments: 0

Adding `@auth` to a graphQL type will add an `owner` attribute in DynamoDB.
This attribute is not part of the primary key.

That makes me wondering about the impact on performance. How does the resolver check whether this `owner` is correct.
And does that implementation heavily impact peformance?

---------------

---------------

# Improve speed for the datastore

---------------

Author: @ifmael
Upvotes: 1
Comments: 0

I'm developing an app with the entry point is a login page. I'm using the datastore.
If a user sing-in correctly in the app,  the datastore start (`await DataStore.start();`) to sync all the content, but I've thousand of items in differents model so the datastore is `ready`  after 10 seconds. This is a long time showing a spinner waiting for datastore. 

Is there any way to do this sync faster? or any way to ask for the specific content?

---------------

---------------

# Can't hide the Forgot Password

---------------

Author: @nguyenkien1402
Upvotes: 1
Comments: 0

Hi guys,

How do I hide the Forgot Password in SignIn.
I have referred to all the issues related to hiding the SignIn and Forgot Password in #1478
#1624 and #1632. 

I am able to hide SignIn but not ForgotPassword 
`
<AmplifyAuthenticator >
        <AmplifySignIn slot="sign-in" hideSignUp hideForgotPassword />
        <AmplifySignOut/>
        <Router>
            ......
          </Router>
      </AmplifyAuthenticator>
`

I am using ui-react: "^0.2.21"

---------------

---------------

# Auth.currentAuthenticatedUser() is adding ?catagory=0 to url

---------------

Author: @MattM31
Upvotes: 1
Comments: 0

I've built my web app and I have a page where it has a table of requests and when you click on a request it changes the state which then changes the content dispalyed on the page to the request details (url dosent change). But to load that data it calls an API, and I kept getting 401 errors if the token had expired so I think I need to call Auth.currentAuthenticatedUser at the start of the api call to get/refesh the tokens. But when I call Auth.currentAuthenticatedUser it completes successfully but its adding ?category=0 to the url, which is triggering react router to navigate back to the table view again. Is there a way to prevent Auth.currentAuthenticatedUser from changing the url or do I need to re-write my application to make the request details page have its own url and route so when the url changes the page dosent redirect back?

---------------

---------------

# GraphQL Create operations on models through JS library don't respect Cognito group permissions

---------------

Author: @danhaab
Upvotes: 1
Comments: 0

I've got a model type that I only want users of specific groups to be able to create, but any logged in user seems to be able to create the object. Other operation permissions seem to be respected (e.g. read).

This only happens in my app, graphQL explorer returns unauthorized as I would expect for not Administrator and Publisher group users.

Here's the auth directive:

type Content @model 
#@key(name: "byPublisher", fields: ["publisherId", "title", "author"])
@auth (
    rules: [
      { allow: groups, groups: ["Administrators"] }
      { allow: groups, groups: ["Publishers"], operations: [create, read ] }
      { allow: groups, groups: ["Readers", "Subscribers"], operations: [read] }
      { allow: owner, operations: [update, delete] }
    ]
) {
  ...
}

What am I doing wrong here?

---------------

---------------

# REST API and STS

---------------

Author: @edfenergy-stevebowerman
Upvotes: 1
Comments: 1

Hi,

I'm my use case, my React app authenticates with Cognito User Pool+Identity pool, then needs to assume a role before making a call to API Gateway. Ie (by design) the role assumed via authentication only allows that user to assume a list of other roles. 

Using Auth.currentUserCredentials() I can get the temporary creds provided by Cognito identity pool - lets refer to these as "cogntio creds". I can also successfully use AWS.STS to assume a role (with the "cognito creds") and obtain the "assumed role creds". However, when I call API.get(), it fails with a 403 error. On inspection, its because the creds used for the signing are the "cognito creds" rather than "assumed role creds".
I've tried using AWS.config to explicitly set/override the credentials (cognito ones).
Running ampliy 2.3.0

Many thanks

Steve
## Comment

---------------

Author: @MC313

@edfenergy-stevebowerman hey sorry I don't have an answer for this but I think I'm experiencing the same issue. Have you found a solution for this or is there an issue created that I can track?

---------------

---------------

# Dynamic URL for redirect_uri using customState

---------------

Author: @emilycarr36
Upvotes: 1
Comments: 0

Hi all,

Hopefully you can help me. I've encountered a use case that I don't seem to be able to get the results I would like. I'm using a SAML identity provider and currently calling Auth.federatedSignIn({provider, customerState}) which logs me in and the state sting is appended with what I put in the customState arguement. 

What I want to achieve is if someone navigates to a page say https://xxxxxx/post/45 I want them to be taken there, instead of https://xxxxxxx.

Is using custom state going to help me to achieve this. The AWS Console for Cognito specifies that the call back urls have to be static, however the number mentioned above would be an id, so dynamic.

Any ideas of what I can do would be great please :)

---------------

---------------

# Why do I receive access denied error from Storage.put request in Amplify?

---------------

Author: @patelatharva
Upvotes: 1
Comments: 0

I have followed the steps of adding storage, have added create/update and read permission to relevant group via cli. I have assigned relevant role to the user via Cognito UI. Is there anything remaining to be done to let this user put objects in S3 bucket?


---------------

---------------

# Is it possible to have `SameSite = lax` for cookies when using SSR (Server Side Rendering)

---------------

Author: @jdmwood
Upvotes: 4
Comments: 0

Hi there,

We're using the SSR approach described here: https://docs.amplify.aws/lib/ssr/q/platform/js

Mostly works really nicely!

The only question I have is around the cookies. As expected, when I set `ssr: true` in the config, amplify sets a couple of cookies which are sent with all requests.

The issue is that these are set to `SameSite = strict` which means that when I follow a link from a third party (e.g. clicking a link in gmail), these cookies are filtered out by the browser:

![Screenshot 2020-09-18 at 09 28 32](https://user-images.githubusercontent.com/7125593/93575359-73682280-f991-11ea-8cbb-dc4c9ec784ee.png)

Is there a way to make the SSR system use `lax` instead which would be more appropriate for our needs?

I guess I can just configure the `Auth.cookies` section in configuration, but that means I would switch to cookie storage generally, and it seems when I do that, Amplify ends up setting a lot more cookies than with just setting `ssr: true`.

Thanks!

---------------

---------------

# How to Use amplify app for Alexa account Linking Flows

---------------

Author: @parth4992
Upvotes: 1
Comments: 0

I want to facilitate alexa account linking through my amplify app. I want the user to sign in to the amplify web app, change alexa settings (pincode) and then notify alexa skill about link successful.

Problems - 
Alexa account linking needs authorization code from cognito /oauth2/authorize (Don't know how to get outside of hosted UI)
alexa skill and Amplify app have different app clients.

My current Approach - 
if the URL has query params redirect to the Hosted UI then wait for code and change redirect uri to my app. 
My app gets the code and immediately tries to /oauth2/token which fails because different app clients
Once I get this code, I try to manually get tokens from the Cognito but then I run into 405 Method not allowed


I am not sure if anyone has implemented this or not. or if there is another way to do it. 

---------------

---------------

# How to prevent a specific user from changing the password and email.

---------------

Author: @MuhaddiMu
Upvotes: 1
Comments: 0

In my Application, I am using Amplify Auth module for user authentication. 

I have created another user `demo@app.com` and block all post requests for the user since it's going to be demo purpose account. 

Chaning Password, deletion of account, changing email is all handled via frontend. All the POST, PATCH, PUT, DELETE APIs are already blocked for the user but here is a security risk. 

I want revoke these permissions from this specific user.

Any help would be highly appreciated.

---------------

---------------

# amplify init failed with MissingRequiredParameter error

---------------

Author: @aldrindoinwork
Upvotes: 1
Comments: 0

Hello guys! I'm trying to install amplify in my React Native project but I cannot proceed with the amplify init.

Below is the error that I am receiving:

`MissingRequiredParameter: Missing required key 'name' in params
    at ParamValidator.fail (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/param_validator.js:50:37)
    at ParamValidator.validateStructure (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/param_validator.js:61:14)
    at ParamValidator.validateMember (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/param_validator.js:88:21)
    at ParamValidator.validate (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/param_validator.js:34:10)
    at Request.VALIDATE_PARAMETERS (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/event_listeners.js:132:42)
    at Request.callListeners (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/sequential_executor.js:106:20)
    at callNextListener (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/sequential_executor.js:96:12)
    at /Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/event_listeners.js:86:9
    at finish (/Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/config.js:386:7)
    at /Users/aldrincastro/.nvm/versions/node/v12.18.1/lib/node_modules/@aws-amplify/cli/node_modules/aws-sdk/lib/config.js:404:9 {
  code: 'MissingRequiredParameter',
  time: 2020-09-17T08:36:58.623Z
}`

**Versions**

**React Native**
0.62.2

**@aws-amplify/cli**
4.29.2

**aws-amplify-react-native**
4.2.6

**aws-amplify**
3.3.1

---------------

---------------

# Amplify - React sdk throw error when verifying TOTP code w\ google authenticator

---------------

Author: @jpmoreau2
Upvotes: 1
Comments: 1

**Describe the bug**
I am using amplify react sdk to create a login oauth path.  Because I read in a past post that the Cognito hosted UI could not be used to setup TOTP (dating from 2017 and I was not able to find anything updated about this), I decided to go with react for this setup.
Users are created by administrators exclusively (no sign-up page) through the aws console. When the user login for the first time, he needs to reset his password and then received a SMS-MFA code. Once this is done, he is logged in.  In the app, there is a setup page for the user to change his prefered MFA.

I get a QR code but when I verify the numbers using google authenticator, Cognito respond with :
![Screen Shot 2020-09-16 at 1 05 54 PM](https://user-images.githubusercontent.com/71400546/93369432-5dd1ec00-f81d-11ea-9d69-ace58393cba4.png)

Here is the UI
![Screen Shot 2020-09-16 at 1 04 41 PM](https://user-images.githubusercontent.com/71400546/93369524-7fcb6e80-f81d-11ea-800a-676976784f5c.png)

Here is the javascript code for that page:
```javascript
import React from 'react'
import { withRouter, Link } from 'react-router-dom'
import { Auth } from 'aws-amplify'
import QRCode from 'qrcode.react'

export default class Totp extends React.Component {
  state = {
    username: '',
    user: {},
    qrCode: '',
    challengeAnswer: ''
  }
  componentDidMount() {
    Auth.currentAuthenticatedUser().then(user => this.setState({ user }))
    Auth.currentUserInfo()
      .then(data => {
        this.setState({
          username: data.username
        })
      })
      .catch(err => console.log('error: ', err))
  }
  addTTOP = () => {
    Auth.setupTOTP(this.state.user).then((code) => {

      console.log("user : ", this);
      console.log("state: ", this.state)
      console.log("state user : ", this.state.user);
      const authCode = "otpauth://totp/customApp:"+ this.state.user.username + "?secret=" + code + "&issuer=Amazon%20Cognito";
      console.log("AuthCode: ", authCode);
      this.setState({ qrCode: authCode })
    });
  }
  setPreferredMFA = (authType) => {
    console.log("verifyTotpToken: ", this.state.user, " and this : ", this.state.challengeAnswer);
    Auth.verifyTotpToken(this.state.user, this.state.challengeAnswer).then(() => {
      console.log("setPreferredMFA ",this.state.user,"and this again ", authType)
      Auth.setPreferredMFA(this.state.user, authType)
        .then(data => console.log('data from verify...: ', data))
        .catch(err => console.log('error: ', err))
    });
  }
  render() {
    return (
      <div>
        <h1>Welcome {this.state.username}</h1>
        <Link to='/route1' label='route1'>Route 1</Link><br /><br /><br />
        <button onClick={this.addTTOP} style={{ border: '1px solid #ddd', width: 125 }}>
          <p>Add TOTP</p>
        </button>
        {
          (this.state.qrCode !== '') && (
            <div>
              <br />
              <QRCode value={this.state.qrCode} />
            </div>
          )
        }
        <br /><br /><br />
        <input
          placeholder='TOTP Code'
          onChange={e => this.setState({ challengeAnswer: e.target.value })}
          style={{ border: '1px solid #ddd', height: 35 }}
          />
        <input
          placeholder='TOTP Code state'
          onChange={e => this.setState((state) =>
            console.log("setState : ", state)          )}
          style={{ border: '1px solid #ddd', height: 35 }}
          />
          <br /><br /><br />
        <button onClick={() => this.setPreferredMFA('TOTP')} style={{ border: '1px solid #ddd', width: 125 }}>
          <p>Prefer TOTP</p>
        </button>
        <br /><br />
        <button onClick={() => this.setPreferredMFA('SMS')} style={{ border: '1px solid #ddd', width: 125 }}>
          <p>Prefer SMS</p>
        </button>
        <br /><br /><br />

      </div>
    )
  }
}

```
## Comment

---------------

Author: @jpmoreau2

Oh well. After a week and a half, just figured the device did not have the right time stamp.  
I'm ashamed

---------------

---------------

# specify attributes for GIS

---------------

Author: @lochawala
Upvotes: 1
Comments: 0

Hello All 

How can i provide attributes in schema definition for GSI? 

Like in GIS3 i want only  PK SK & GSI3

Below is my schema 
```
type UsersAndOrgs 
@model @auth(rules: [{allow: owner}])
@key(fields: [ "PK", "SK" ])
@key(name: "GSI1", fields: [ "GSI1" ], queryField: "GSI1")
@key(name: "GSI2", fields: [ "GSI2"], queryField: "GSI2") 
@key(name: "GSI3", fields: [ "GSI3"], queryField: "GSI3") 
{
    id: ID!
    PK: String!
    SK: String!
    GSI1: String
    GSI2: String
    GSI3: String
    fullProfile:String
    PKProfile:String
    firstName:String
    lastName:String
    status:String
    licExp:String
    statusHist:String
    subsLevel:String
    role:String
}
```

---------------

---------------

# ParseError: 'import' and 'export' may appear only with 'sourceType: module'

---------------

Author: @jeff1evesque
Upvotes: 1
Comments: 0

I'm attempting to utilize the amplify documentation:

- https://docs.amplify.aws/lib/auth/start/q/platform/js#configure-your-application

So, I have the following `package.json`:

```json
{
  "name": "reactjs",
  "version": "1.0.0",
  "description": "packages needed for source files.",
  "main": "index.js",
  "scripts": {
    "prebuild:dos2unix": "find . -type f -print0 | xargs -0 dos2unix",
    "build:browserify": "browserify -t [ babelify --presets [ @babel/preset-env @babel/preset-react ] ] content.jsx > content.js",
    "watch:jsx": "onchange '**/*.jsx' '**/*.js' -- npm run build:browserify",
    "test": "NODE_ENV=test jest --config jest.config.js",
    "report:coveralls": "cat lcov.info | ./node_modules/coveralls/bin/coveralls.js"
  },
  "author": "Jeffrey Levesque",
  "license": "BSD",
  "repository": "github:jeff1evesque/xxxxxxxxxxxxxx",
  "dependencies": {
    "dos2unix-cli": "^1.0.1",
    "babelify": "^10.0.0",
    "browserify": "^16.5.2",
    "onchange": "^3.3.0",
    "babel-jest": "^23.6.0",
    "core-js": "^2.5.4",
    "whatwg-fetch": "^2.0.2",
    "promise-polyfill": "^7.0.0",
    "query-string": "^5.0.1",
    "react": "^16.2.0",
    "react-dom": "^16.2.0",
    "react-router-dom": "^4.2.2",
    "react-redux": "^5.0.6",
    "react-bootstrap": "^0.32.0",
    "react-router-bootstrap": "^0.24.4",
    "redux": "^3.7.2",
    "rearm": "^0.8.2",
    "d3": "^4.12.2",
    "prop-types": "15.6.0",
    "react-json-view": "1.16.0",
    "jest-cli": "^23.6.0",
    "enzyme": "^3.6.0",
    "enzyme-adapter-react-16": "1.5.0",
    "global": "^4.3.2",
    "coveralls": "^3.0.2",
    "aws-amplify": "^3.2.0",
    "@aws-amplify/ui-react": "^0.2.19",
    "@babel/preset-env": "^7.11.5",
    "@babel/core": "^7.11.6",
    "@babel/preset-react": "^7.10.4"
  }
}
```

Which unfortunately generates the following error:

```bash
[Container] 2020/09/16 02:45:42 Running command npm run build:browserify
--
955 |  
956 | > reactjs@1.0.0 build:browserify /codebuild/output/src375884655/src/jsx
957 | > browserify -t [ babelify --presets [ @babel/preset-env @babel/preset-react ] ] content.jsx > content.js
958 |  
959 |  
960 | /codebuild/output/src375884655/src/jsx/aws-exports:1
961 | import Amplify, { Auth } from 'aws-amplify';
962 | ^
963 | ParseError: 'import' and 'export' may appear only with 'sourceType: module'
964 | npm ERR! code ELIFECYCLE
965 | npm ERR! errno 1
966 | npm ERR! reactjs@1.0.0 build:browserify: `browserify -t [ babelify --presets [ @babel/preset-env @babel/preset-react ] ] content.jsx > content.js`
967 | npm ERR! Exit status 1
968 | npm ERR!
969 | npm ERR! Failed at the reactjs@1.0.0 build:browserify script.
970 | npm ERR! This is probably not a problem with npm. There is likely additional logging output above.
971 |  
972 | npm ERR! A complete log of this run can be found in:
973 | npm ERR!     /root/.npm/_logs/2020-09-16T02_45_42_801Z-debug.log
974 |  
975 | [Container] 2020/09/16 02:45:42 Command did not exit successfully npm run build:browserify exit status 1
976 | [Container] 2020/09/16 02:45:42 Phase complete: BUILD State: FAILED
977 | [Container] 2020/09/16 02:45:42 Phase context status code: COMMAND_EXECUTION_ERROR Message: Error while executing command: npm run build:browserify. Reason: exit status 1
```

---------------

---------------

# Android app closes when sending notification with PinPoint - React Native

---------------

Author: @xterikatx
Upvotes: 1
Comments: 0

### - I've been having this problem for weeks, and I still couldn't solve it, I have a document on the google drive that contains all the images of settings made in my application. [MORE DETAILS](https://docs.google.com/document/d/1S9_RCwxvZYVJ-lAI8ZEVHL6ApGN2lQcRrtBE9cTz5jo/edit)

I thought the problem was because I was trying to send notifications by emulator, but the same problem occurs on a real device.

**in app>build.gradle**

`apply plugin: "com.android.application"
apply plugin: 'com.google.gms.google-services'
apply plugin: 'io.fabric'

import com.android.build.OutputFile
[...]
dependencies {
    implementation project(':@react-native-community_netinfo')
    implementation project(':@react-native-community_google-signin')

    implementation 'com.android.support:appcompat-v7:28.0.0'
    implementation 'androidx.swiperefreshlayout:swiperefreshlayout:1.1.0-alpha02'
    implementation 'com.google.android.gms:play-services-auth:17.0.0'
    implementation 'com.google.firebase:firebase-analytics:17.2.1'
    implementation "androidx.annotation:annotation:1.1.0"
    implementation "com.google.firebase:firebase-auth:17.0.0"
    implementation 'com.android.support:support-annotations:28.0.0'
    implementation "com.google.firebase:firebase-core:16.0.9"
    implementation 'com.android.support:multidex:1.0.3'

    implementation "com.google.firebase:firebase-messaging:20.2.4"
    implementation 'com.crashlytics.sdk.android:crashlytics:2.10.1'
  
    implementation 'com.google.firebase:firebase-auth:17.0.0'
    def multidex_version = "2.0.1"
    implementation "androidx.multidex:multidex:2.0.1"

    implementation fileTree(dir: "libs", include: ["*.jar"])

    implementation project(':react-native-vector-icons')

    implementation 'com.facebook.android:facebook-android-sdk:[5,6)'

    if (enableHermes) {
        def hermesPath = "../../node_modules/hermes-engine/android/";
        debugImplementation files(hermesPath + "hermes-debug.aar")
        releaseImplementation files(hermesPath + "hermes-release.aar")
    } else {
        implementation jscFlavor
}
}
[...]`


**in the androidmanifest.xml**

`<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="**hidden**">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
 <!-- < Only if you're using GCM or localNotificationSchedule() > -->
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    <permission
        android:name="com.nevii.permission.C2D_MESSAGE"
        android:protectionLevel="signature" />
    <uses-permission android:name="{{app.id.HIDDEN}}.permission.C2D_MESSAGE" />
    <!-- < Only if you're using GCM or localNotificationSchedule() > -->
      <uses-permission android:name="android.permission.VIBRATE" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>
 

    <application
        android:name=".MainApplication"
        android:allowBackup="false"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:theme="@style/AppTheme"
        android:usesCleartextTraffic="true">
        <meta-data
            android:name="com.facebook.sdk.ApplicationId"
            android:value="@string/facebook_app_id" />
        <activity
            android:name="com.facebook.FacebookActivity"
            android:configChanges="keyboard|keyboardHidden|screenLayout|screenSize|orientation"
            android:label="@string/app_name" />

        <activity
            android:name="com.facebook.CustomTabActivity"
            android:exported="true">
            <intent-filter><action android:name="android.intent.action.VIEW" />

                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />

                <data android:scheme="@string/fb_login_protocol_scheme" />
            </intent-filter>
        </activity>
        <activity
            android:name=".MainActivity"
            android:configChanges="keyboard|keyboardHidden|orientation|screenSize"
            android:label="@string/app_name"
            android:windowSoftInputMode="adjustResize">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
        <activity android:name="com.facebook.react.devsupport.DevSettingsActivity" />

            <!-- < Only if you're using GCM or localNotificationSchedule() > -->
        <receiver
            android:name="com.google.android.gms.gcm.GcmReceiver"
            android:exported="true"
            android:permission="com.google.android.c2dm.permission.SEND" >
            <intent-filter>
                <action android:name="com.google.android.c2dm.intent.RECEIVE" />
                <category android:name="com.nevii.gcm" />
            </intent-filter>
        </receiver> 
         <service
             android:name="com.amazonaws.amplify.pushnotification.RNPushNotificationMessagingService">
             <intent-filter>
                 <action android:name="com.google.firebase.MESSAGING_EVENT"/>
             </intent-filter>
         </service>
         <!-- [END firebase_service] -->
         <!-- [START firebase_iid_service] -->
         <service
             android:name="com.amazonaws.amplify.pushnotification.RNPushNotificationDeviceIDService">
             <intent-filter>
                 <action android:name="com.google.firebase.INSTANCE_ID_EVENT"/>
             </intent-filter>
         </service>
         <receiver
             android:name="com.amazonaws.amplify.pushnotification.modules.RNPushNotificationBroadcastReceiver"
             android:exported="false" >
             <intent-filter>
                 <action android:name="com.amazonaws.amplify.pushnotification.NOTIFICATION_OPENED"/>
             </intent-filter>
         </receiver>
     <!-- [END Push notification config -->
    </application>
</manifest>`


**in root>app.js**

`NativeModules.RNPushNotification.getToken(token_push => {
      console.log('token push in getToken', token_push);
      this.setState({tokenPush: token_push});

    });
    await PushNotification.onRegister(() => {
      console.log('call ~onregister');
      PushNotification.updateEndpoint(token_push);
    });
    PushNotification.onNotification(notification => {
      if (notification.foreground) {
        console.log('onNotification foreground', notification);
      } else {
        console.log('onNotification background or closed', notification);
      }
      // extract the data passed in the push notification
      const data = JSON.parse(notification.data['pinpoint.jsonBody']);
      console.log('onNotification data', data);
      // iOS only
      // notification.finish(PushNotificationIOS.FetchResult.NoData);
    });

    // get the notification data when notification is opened
    PushNotification.onNotificationOpened(notification => {
      console.log('onNotificationOpened', notification);
      // extract the data passed in the push notification
      const data = JSON.parse(notification['pinpoint.jsonBody']);
      console.log('onNotificationOpened data', data);
    });`


**Can someone help me? pleaseee**

---------------

---------------

# Export GRAPHQL_AUTH_MODE from aws-amplify

---------------

Author: @ericclemmons
Upvotes: 1
Comments: 1

**Is your feature request related to a problem? Please describe.**

I'm always frustrated when I have `import { API, Auth } from 'aws-amplify'` but need to specify `authMode` for my `API.graphql` call, but don't remember if it's `IAM` or `AWS_IAM`.  Instead, I want to use `GRAPHQL_AUTH_MODE`, but that requires a separate import to `@aws-amplify/api` or `@aws-amplify/api-graphql`.

**Describe the solution you'd like**

`@aws-amplify/api` should:

- `export { GraphQLAPI } from "@aws-amplify/api-graphql"`
- `export { GRAPHQL_AUTH_MODE } from "@aws-amplify/api-graphql"`
- `export { RestAPI } from "@aws-amplify/api-graphql"`

`aws-amplify` should re-export those from `@aws-amplify/api`.

This will also allow improved tree-shaking for only `RestAPI` users who could find/replace usages of `import { API }` with `import { RestAPI }` and get bundle-size savings with only 4 keystrokes!

**Describe alternatives you've considered**

`import { GRAPHQL_AUTH_MODE } from "@aws-amplify/api-graphql"`.

This feels like I'm reaching into the `aws-amplify` implementation details to pull out this reference.  

**Additional context**

Supported APIs & interfaces should hang off of `aws-amplify`.
## Comment

---------------

Author: @manueliglesias

We have a chance to export with a better name, `GRAPHQL_AUTH_MODE` can be a little missleading since it is AppSync specific

---------------

---------------

# photo picker amplify storage 403 error

---------------

Author: @ShehryarKh
Upvotes: 1
Comments: 0

Hi, I need some help.

So I have added auth via `amplify add auth` & storage `amplify add storage`

in code im doing 
```
<div class="my-8">
     <amplify-s3-image-picker
          button-text="yes"
          header-title="Campaign Photo"
          track="true"
          :path="imgpath"
     ></amplify-s3-image-picker>
</div>
<div>
   <amplify-s3-image level="public" track="true" :img-key="{{imgpath}}" />
</div>
```
I have a Hub listener that listens to events and checks for a successful upload.
I use UUID to generate a key and I place user images  in s3 like `users/COGNITOID/images/UUID`
I store the path to the image in graphql db schema

That is how im storing images for a user. They are all in public folder in s3. However, I continue to get a 403 forbidden error.
` <amplify-s3-image level="public" track="true" :img-key="{{imgpath}}" />` Returns that error:

to test im not doing anything wrong I added a `ball.png` right in the public folder in s3. I still got the same error.

```
https://...s3.amazonaws.com/public/ball.png?X-Amz-Algorithm=AWS4-HMA
```

Why do I get this 403 if the setup was done though amplify and guest users have read access?
Is there a better way to store images than just storing the path?

---------------

---------------

# Amplify/Cognito quickly forgetting devices

---------------

Author: @elaidlaw
Upvotes: 1
Comments: 0

We're using aws-amplify-react-native with Cognito to manage user authentication for our iOS app. On the Cognito user pool, we have the following settings configured:

Do you want to enable Multi-Factor Authentication (MFA)?: opt-in (our frontend automatically opts users in)
Do you want to remember your user's devices?: Always
Do you want to use a remembered device to suppress the second factor during multi-factor authentication (MFA)?: Yes

Given these settings, after signing in and submitting the MFA code, the device should be remembered and subsequent logins should not require the second factor to authenticate. This is the case after each login for some amount time in the minutes to hours range, but after that, MFA is again required.

Something curious to me is that in the remembered devices in the Cognito user pool, it seems to be remembering the same device many times. The image below shows this being the case. This is my account, which I have only used on my phone. The IP changes based on what WiFi I'm on, but even several "devices" with the same IP are shown. Why is this the case?

![Screen Shot 2020-09-10 at 4 13 41 PM](https://user-images.githubusercontent.com/10340382/92798237-c124cf80-f380-11ea-888a-51be912cc3a6.png)

Any ideas why Amplify and Cognito aren't remembering devices properly? Also of note is the fact that this worked until a few months ago.

---------------

---------------

# Is there an API library for AWS Personalize Runtime

---------------

Author: @minimalistinnovator
Upvotes: 1
Comments: 1

I have created recommenders and campaigns in AWS Personalize. However, all the examples are using Python and could not find any examples to plug into AWS Amplify/react project.

I was able to call the Personalize API directly but that required Authentication token. If this is the only option, how can I authenticate through Cognito pools and pass the credentials to the API?
## Comment

---------------

Author: @minimalistinnovator

Solved this in a round about way:
React->API->Lambda->Personalize. Here is the lambda:
```
import boto3

def handler(event, context):
    personalizeRt = boto3.client('personalize-runtime')

    if 'queryStringParameters' in event and 'itemId' in event['queryStringParameters']:
        queryStringParameters = event['queryStringParameters']
        itemId = queryStringParameters['itemId']
        response = personalizeRt.get_recommendations(
            campaignArn='xxxxxxxx',
            itemId=itemId)
        return {
            'recommendations': response['itemList']
        }
    else:
        return {
            'message': 'ItemId should be passed in the queryStringParameters'
        }
```

---------------

---------------

# How to develop in one region and have production in different region ?

---------------

Author: @bishonbopanna
Upvotes: 2
Comments: 0

Use case scenario : 

- Development for react amplify project is carried out in us-east-1 - USA EAST
- Deployment is for Australia, so project will be deployed in ap-southeast-2 Sydney Australia

Question - Is this possible using amplify ? I do understand the concept of envs in Amplify where in you could have dev, qe and prod. However all seem to be in the same region.

Amplify can read from the a repo and deploy directly to production env for each new commit. Is this possible by maintaining the repo is just one region where development and testing is carried out and deployed for production in a completely different region like in the above use case ?



---------------

---------------

# Several warning with I add subscriptions. (validation errors)

---------------

Author: @ifmael
Upvotes: 1
Comments: 0

I've added some subscription in my app.  The models for these subscriptions is:

```

type Content
  @model
  @aws_iam
  @aws_cognito_user_pools
  @auth(rules: [
    { allow: owner, ownerField: "owner", operations: [delete, update] }
  ])
  @key(name: "byContent", fields: ["userID"])
  @key(name: "byUrl", fields: ["contentUrl"])
  {
    id: ID!
    createdOn: AWSTimestamp!
    title: String!
    owner: ID!
    subtitle: String
    description: String!
    image: S3object
    contentUrl: String
    userID: ID!
    type: String
    imageUrl: String
    skills: [ContentSkill] @connection(keyName: "byContentSkill", fields: ["id"])
  }

type Notification
  @model(queries: null)
  @aws_iam
  @aws_cognito_user_pools
  @auth(rules: [
    { allow: owner , ownerField: "ownerID", operations:[ delete, update]}
  ])
  @key(name:"toUserID", fields:["toUserID"]){
    id: ID!
    createdOn: AWSTimestamp!
    title: String!
    type: Int!
    url: String!
    ownerID: ID!
    toUserID: ID!
    fromUserID: ID!
    fromUser: User @connection(fields:["fromUserID"])
  }
```

I'm using React so I subscribe to it in the useEffect hooks:
```
useEffect(() => {
  const listContent = async () => {
    // Does something
  };


  listContent();
  const subscription = DataStore.observe(Content).subscribe(() => listContent())
  
  return () => subscription.unsubscribe();
  }, []);


  
  useEffect(() => {
    const getNewNotification = async (newNotification) => {
      //  does soemething
    };
    
    const subscription = DataStore.observe(
      Notification
    ).subscribe((newNotification) => getNewNotification(newNotification));

    return () => subscription.unsubscribe();
  }, [userNotifications, user]);
```

I generated the models with `amplify codegen models` and pushed the changes.

The subscription works but i got there warning in the console

```
ConsoleLogger.ts:91 [WARN] 38:44.946 DataStore - Connection failed: {"errors":[{"message":"Validation error of type UnknownArgument: Unknown field argument owner @ 'onUpdateContent'"}]}
ConsoleLogger._log @ ConsoleLogger.ts:91
ConsoleLogger.ts:91 [WARN] 38:44.947 DataStore - Connection failed: {"errors":[{"message":"Validation error of type UnknownArgument: Unknown field argument owner @ 'onDeleteContent'"}]}
ConsoleLogger._log @ ConsoleLogger.ts:91
ConsoleLogger.ts:91 [WARN] 38:44.949 DataStore - Connection failed: {"errors":[{"message":"Validation error of type UnknownArgument: Unknown field argument ownerID @ 'onDeleteNotification'"}]}
ConsoleLogger._log @ ConsoleLogger.ts:91
ConsoleLogger.ts:91 [WARN] 38:44.972 DataStore - Connection failed: {"errors":[{"message":"Validation error of type UnknownArgument: Unknown field argument 
``` 

is there something wrong in the code?

---------------

---------------

# Branch Restrictions In Team Environment

---------------

Author: @lr001dev
Upvotes: 1
Comments: 0

So, I'm wondering how one would enforce certain permissions on branches built by Amplify? I'd like to control who can push to our develop branch... currently, after successfully setting up my team on our resources using this tutorial https://docs.amplify.aws/cli/usage/iam-roles-mfa, anyone with access can push or change any branch currently deployed. Does amplify have any feature to help restrict some behavior?

---------------

---------------

# How to tell which environment an Elastic Search domain belongs to?

---------------

Author: @dylan-westbury
Upvotes: 1
Comments: 0

Is there a way to find out which environment an Elastic Search domain belongs to? 

I can't find anything noticeable anywhere, I tried searching the Elastic Domain Name id (e.g. amplify-elasti-xxxxxxxxx - the xxxxxxx) in amplify directory also, but no luck.

Cheers

---------------

---------------

# GDPR support/ideas with GraphQL

---------------

Author: @PeteDuncanson
Upvotes: 1
Comments: 0

I've been busy playing around with a prototype app I'm making and all has been going well. But then it occurred to me that fun though this is to follow the tutorials I need it to take into account privacy and the beast that is GDPR.

Couple of queries really that are open for input from anyone:

* Is it possible to encrypt the data in the DynamoDB used under the hood of the GraphQL api in Amplify? If so they this ticks a big box in the GDPR hit list, if not we can work around it but I couldn't find anything about amplify and encryption of sensitive data in the underlying DB.
* I want to keep sensitive data in separate tables and log when someone requests to access it (so if you want to contact a customer by phone you would have click a button to say "show the number" and we would log this access request so we can see who has seen what). Wondering how best to do that in GraphQL. Not looked at subscriptions yet but wondered if that was the way to go. Any ideas or pointers?

Cheers

Pete

---------------

---------------

# Aws Amplify Using Multiple Cognito User Pools in One GraphQL Api

---------------

Author: @cnbrkkaya
Upvotes: 1
Comments: 0

I have two different front end (react) projects. One of them for blog readers and one of them for editors.For both application i want to use same DynamoDB tables(and use graphql api). But i want to different user pools for each project. How can i implement this?

I was reading this article - https://medium.com/@fullstackpho/aws-amplify-multi-auth-graphql-public-read-and-authenticated-create-update-delete-1bf5443b0ad1

I know aws appsync support multiple authorization types like cognito, api key ... But does it support two cognito type?

Thanks,

---------------

---------------

# How to add an extra value in the Sign In request using Cognito

---------------

Author: @marianolc
Upvotes: 1
Comments: 0

Hi! I trying to develop a multi-tenant app. 

What I'm trying to achieve now is to give the user the option to write the workspace/section/group he is going to work before the sign-in. 

Something similar to slack when you have to indicate first the "workspace" and then your credentials. Or the same AWS where you can log in with accountId + email when using IAM.

This value will be used in the pre token generation lambda to assign the correct groups. So I would need to know how to read that value there.

Thanks!

---------------

---------------

# Hide Skip link in VerifyContact in aws-amplify-react

---------------

Author: @psaks
Upvotes: 2
Comments: 0

Hi all,

Does anyone know how to hide the "Skip" link in VerifyContact - does it even make sense to have it there? 

Would you ever want a user to be signed in if the contact (e.g., email) is not verified? 


---------------

---------------

# Appsync: how to fail create mutation if the key already exists

---------------

Author: @elchicofrommo
Upvotes: 1
Comments: 0

I know I saw this somewhere but I can't find it again. I have a model with a pk/sk. Calling createXXX with the same pk/sk overrides the original (particularly with createdAt/updatedAt) but I'd like it to fail or noop. I thought I could use the conditional input that is generated, but condition type never includes the pk/sk. Is the only solution really to write a custom resolver with the condition checks? Seems like this would be a common use case so I'd be surprised if that were the case.

---------------

---------------

# Using Amplify inside Jest

---------------

Author: @elchicofrommo
Upvotes: 1
Comments: 1

I'm writing some integration tests with amplify that I can run  after standing up an environment that validate expected APIs, Auth  and some Appsync endpoints. Problem is, when I use my same export to Amplify.configure as I use for the running the app I get empty objects for currentCredentials (I have unauth ident pools set up) and calling signUp or sign in fails. I have to assume it's because I'm running in Jest. I've tried to  use jest.requireActual but that doesn't work either. Any thoughts?
## Comment

---------------

Author: @elchicofrommo

I ended up opening a ticket, ive seen a few others comment that this was a problem for them as well. 

---------------

---------------

# Use UI components for federated signin flows

---------------

Author: @Ajwah
Upvotes: 1
Comments: 0

I have setup `amplify add auth` for Google Oauth. I am able to get it working with `Auth.federatedSigning` components but such components are bereft of any styling. As such, I want to leverage `<AmplifyAuthenticator />` instead. However, when I do:
```
import App from './App'
import Amplify from 'aws-amplify'
import config from './aws-exports'
Amplify.configure(config)

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById('root')
);
```
and for App.js:
```
import { AmplifyAuthenticator } from '@aws-amplify/ui-react';
function App() {
  return (
    <AmplifyAuthenticator />
  )
}
```

then it is not rendering for me the Google Sign in button:
![Screen Shot 2020-08-29 at 8 11 35 PM](https://user-images.githubusercontent.com/11848116/91648300-d8d08f80-ea33-11ea-8255-caac25f33dd6.png)
Of course, clicking on `Sign In With AWS` button does render the desired `Continue with Google Account`:
![Screen Shot 2020-08-29 at 8 12 29 PM](https://user-images.githubusercontent.com/11848116/91648310-f9004e80-ea33-11ea-8632-6c54a75b1639.png)
and when pressing it all works fine. However, instead; I would like that social account signin to be present on the main component. After some searching, it appears that `<AmplifyAuthenticator>` accepts the property: `federated` and generally is to be used like this:
```
const federated = {
  googleClientId: "*****",
  oauthConfig: {
    redirectSignIn: "http://localhost:3000/",
    redirectSignOut: "http://localhost:3000/",
  }
}

function App() {
  return (
    <AmplifyAuthenticator federated={federated} />
  )
}
```
This does render the desired button:
![Screen Shot 2020-08-29 at 8 16 03 PM](https://user-images.githubusercontent.com/11848116/91648359-77f58700-ea34-11ea-98aa-58d06cd21542.png)

But when I click that button then I get the error:
```
{error: "idpiframe_initialization_failed", details: "Not a valid origin for the client: http://localhos…itelist this origin for your project's client ID."}
details: "Not a valid origin for the client: http://localhost:3000 has not been whitelisted for client ID *****. Please go to https://console.developers.google.com/ and whitelist this origin for your project's client ID."
error: "idpiframe_initialization_failed"
__proto__: Object
```

The questions I have at this point are:
1. Why do I need to pass through a `federated` property repeating all the information I already provided during the `amplify add auth` flow? `team-provider-info.json` and `aws-exports.json` contain all that information so when doing `Amplify.configure(config)` in `index.js`, why does the component `<AmplifyAuthenticator />` not suffice to recognize that a dedicated button for Google Signin is to be rendered as well?
2. I tried to pinpoint exactly which `http://localhost:3000/` is causing the above error. I did a project wide search and I updated it do a different value in:
A) federated property:
```
const federated = {
  googleClientId: "*****",
  oauthConfig: {
    redirectSignIn: "http://localhost:3002/",
    redirectSignOut: "http://localhost:3002/",
  }
}
```
B) `amplify update auth` as follows:
```
lease note that certain attributes may not be overwritten if you choose to use defaults settings.
Using service: Cognito, provided by: awscloudformation
 What do you want to do? Add/Edit signin and signout redirect URIs
 Which redirect signin URIs do you want to edit? http://localhost:3000/
? Update http://localhost:3000/ http://localhost:3002/
 Do you want to add redirect signin URIs? No
? Do you want to add another redirect signin URI No
 Which redirect signout URIs do you want to edit? http://localhost:3000/
? Update http://localhost:3000/ http://localhost:3002/
 Do you want to add redirect signout URIs? No
Successfully updated resource oautha9745125 locally
```
Then I did a `amplify push`

But in both cases A and B; the error message is always complaining about: `http://localhost:3000/`. This leads me to believe that `http://localhost:3000/` is some default value set when there is no proper configuration on my side. So where does this value come from and why is this not working?

Lastly, I have not setup anything related to `AWS Signin` for OAuth purposes. So far I have only played with Google Oauth. Why is it that the button shows up and how to remove it?

---------------

---------------

# React: Cannot find module './amplify-authenticator.cjs.entry.js'

---------------

Author: @martysweet
Upvotes: 1
Comments: 0

Hi,

I'm trying to upgrade to the new `@aws-amplify/ui-react` module but I am getting some runtime errors when I try and render the `AmplifyAuthenticator` component.

**Code (initialized from App)**
```js
import React, {Component} from 'react'
import { AmplifyAuthenticator, AmplifySignOut } from '@aws-amplify/ui-react';

export class Account extends Component {

    render() {
        return (
                <AmplifyAuthenticator>
                    <div>
                        My App
                        <AmplifySignOut />
                    </div>
                </AmplifyAuthenticator>
        )
    }

}

export default Account;
```

**Errors**
```
react_devtools_backend.js:2273 Error: Cannot find module './amplify-authenticator.cjs.entry.js'
    at o (Analytics.js:7)
    at Analytics.js:7
    at index-dbc7c762.js:1627
    at async initializeComponent (index-dbc7c762.js:1340)

Error: Cannot find module './amplify-nav_2.cjs.entry.js'
    at o (Analytics.js:7)
    at Analytics.js:7
    at index-dbc7c762.js:1627
    at async initializeComponent (index-dbc7c762.js:1340)
```

The Analytics.js file mentioned here is `@aws-amplify/analytics/lib/Analytics.js`, which is a dependency of the `aws-amplify` package.

My package.json file contains the following aws-amplify packages (latest versions). node_modules has been deleted and reinstalled.
```
"@aws-amplify/api": "^3.1.23",
"@aws-amplify/ui-react": "^0.2.15",
"aws-amplify": "^3.0.24",
```

I'm thinking this is potentially a bundling issue? Though am not sure how to debug this issue further.
I have the following browserify entry in my gulpfile.js.
```js
let bundler = browserify(
		{
			entries      : PKG.main,
			extensions   : [ '.js', '.jsx', '.tsx', '.ts' ],
			// required for sourcemaps (must be false otherwise).
			debug        : process.env.NODE_ENV === 'development',
			// required for watchify.
			cache        : {},
			// required for watchify.
			packageCache : {},
			fullPaths    : true,
			ignoreMissing: true,
		})
		.transform('babelify', { extensions   : [ '.js', '.jsx', '.tsx', '.ts' ] })
```

Any help would be greatly appreciated!

Thanks,
Marty

---------------

---------------

# Command Line Query using AMAZON_COGNITO_USER_POOLS Authorization

---------------

Author: @sacrampton
Upvotes: 1
Comments: 0

I am using Cognito User Pools on my GraphQL API and I want to run queries from the command line.

This web site gives the CURL command for an api-key authorization
https://docs.aws.amazon.com/appsync/latest/devguide/security.html
```
curl -XPOST -H "Content-Type:application/graphql" -H "x-api-key:ABC123" -d '{ "query": "query { movies { id } }" }' https://YOURAPPSYNCENDPOINT/graphql
```

How can I use a Cognito identity to authorize a query instead of an api-key from a CURL command?

---------------

---------------

# How to use setupTOTP?

---------------

Author: @hirocsingh
Upvotes: 1
Comments: 0

I ran into this error while trying to get secret code.

`Auth.ts: 843 Uncaught (in promise) TypeError: user.associateSoftwareToken is not a function`

My Code:

```
async function getCode(user) {
  let code = await Auth.setupTOTP(user);
  return code;
}

useEffect(() => {
  if(location.search) {
    let username = new URLSearchParams(location.search).get("user");
    let issuer = new URLSearchParams(location.search).get("issuer");
    let code = getCode(username);
  }
```

---------------

---------------

# facebook login button image

---------------

Author: @dvliman
Upvotes: 1
Comments: 0

I am working on a react-native app. The code looks like this:
```
  // in the view
  return (
    <View style={styles.container}>
      <Button title="Facebook" onPress={() => loginFacebook() }/>
      <Button title="Google" onPress={() => loginGoogle() }/>
    </View>
  );

  // function definitions
  const loginFacebook = () => Auth.federatedSignIn({ provider: 'Facebook' });
  const loginGoogle   = () => Auth.federatedSignIn({ provider: 'Google' });

```

Calling `Auth.federatedSignIn({ provider: 'Facebook' });` will still point to hosted UI's URL (or rather the lambda function) and I believe it immediately redirect to Facebook's endpoint

So far so good

Then I realize Facebook doesn't share the login button as an image anymore. 
https://developers.facebook.com/docs/facebook-login/web/login-button#faq - We either need to use the SDK or we can follow the iframe, find some ways to get the image: https://www.facebook.com/v8.0/plugins/login_button.php?app_id=113869198637480&auto_logout_link=false&button_type=continue_with&channel=https%3A%2F%2Fstaticxx.facebook.com%2Fx%2Fconnect%2Fxd_arbiter%2F%3Fversion%3D46%23cb%3Df2f5eac1c082cec%26domain%3Ddevelopers.facebook.com%26origin%3Dhttps%253A%252F%252Fdevelopers.facebook.com%252Ff381de9c9c39acc%26relation%3Dparent.parent&container_width=734&locale=en_US&login_text=&sdk=joey&size=large&use_continue_as=false

I am not exactly sure if Facebook will have a problem with this. I doubt it. I am sure the image in the hosted UI works the same way
> Can I use the Login button with server-side registration code?
You can, however you will still need to use the JavaScript SDK partially. Once the login process started by clicking on the button is done, the SDK will have access to an authResponse object using FB.getLoginStatus(). You can use this function to pass the response object to your server-side code to complete any registration that exists there.

So I was wondering if there is a plan to include the login image in the UI component?

---------------

---------------

# Overriding the .section class within the Vue Authenticator component

---------------

Author: @anastasialanz
Upvotes: 1
Comments: 2

I'm looking to remove the `box-shadow` on the `.section` class within the `<amplify-sign-in>` shadow root. Is there a way to override this or style the container for the login form?

<img width="1072" alt="Screen Shot 2020-06-10 at 8 32 58 AM" src="https://user-images.githubusercontent.com/3081483/84268025-096bf180-aaf5-11ea-8399-f95c3aa7d2ef.png">
## Comment

---------------

Author: @sammartinez

@jordanranz @ashika01  Do we have this ability in our UI Components today to adjust this? 
## Comment

---------------

Author: @sammartinez

@anastasialanz I went ahead and created a feature request on your behalf as we currently don't have this support within our UI Components Library. Please find the feature request [here](https://github.com/aws-amplify/amplify-js/issues/6076)

---------------

---------------

# How to generate base types for TypeScript with codegen?

---------------

Author: @xuan9230
Upvotes: 1
Comments: 0

I'm building a React + aws AppSync graphql web app with amplify. Have been enjoying this fantastic tool, but couldn't get the `codegen` to work as I expected - it doesn't generate base types for TypeScript frontend.

Say I feed this `schema.graphql` file to `amplify codegen`:

```
type Event @model {
  id: ID!
  name: String
  effects: [EventEffects]
}

type EventEffect {
  name: String
  delta: Int
}
```

with this `config.yml`:

```
projects:
  myapi:
    schemaPath: amplify/backend/api/myapi/build/schema.graphql
    includes:
      - src/graphql/**/*.ts
    excludes:
      - ./amplify/**
    extensions:
      amplify:
        codeGenTarget: typescript
        generatedFileName: src/API.ts
        docsFilePath: src/graphql
extensions:
  amplify:
    version: 3
```

Then codegen gives me `API.ts` and `queries.ts`, `mutations.ts`, `subscriptions.ts` and `schema.json`. The problem is, there are no base types generated.

I can get interface for Event with:
```
export interface Event
  extends Omit<Exclude<GetEventQuery["getEvent"], null>, "__typename"> {}
```

But there's no way to get interface for `EventEffect`, since I didn't add `@modal` directive.

To narrow down my questions:

1. Is it by design that amplify doesn't generate base types?

2. How to get base type for `EventEffect`?

3. What is the `schema.json` generated used for?

Thanks for any help!

---------------

---------------

# How to obtain AWS temporary credentials when using HOC like withAuthenticator

---------------

Author: @joshis2020
Upvotes: 1
Comments: 0

I have seen that Amplify automatically calls the Auth.currentCredentials() and refreshes the token for us when making calls to AWS services that amplify supports. But for services like R53, we need to call the Auth.currentCredentials() manually and make the respective aws api calls. My question is, if the credentials expire after 1 hr then how do we detect this and handle this situation?

---------------

---------------

# How to Verify SMS Code in Cognito

---------------

Author: @RameshRM
Upvotes: 1
Comments: 0

I am able to send `sms mfa code` on `User Login`, I want to understand how to confirm the User after the User Enters the `MFA Code` , I dont see `cognito identity js` docs related to this. 


---------------

---------------

# Error: Unknown argument "operations" on directive "@auth".

---------------

Author: @CarlosBalladares
Upvotes: 1
Comments: 0

Not sure what I'm doing wrong. Has anyone got this message?

```
type Form @model @auth(rules: [{ allow: all }], operations: [create]) {
```

---------------

---------------

# Invalid S3 bucket name (Bucket name shouldn't contain '/') when using `Storage` via AWS Amplify

---------------

Author: @asumaran
Upvotes: 1
Comments: 1

I'm migrating my app from `"aws-amplify": "1.1.29"` to `"aws-amplify": "^3.0.23"` and I got the following error.

I couldn't find anything related to this warning so I was wondering what should I do regarding this. Should I change the bucket name? Thoughts?

Worth mentioning that with the old aws-amplify version there's no warning and file upload works normal. With the new version file upload also works but the following warning is logged.

```
react_devtools_backend.js:2273 [WARN] 57:46.301 AWSS3Provider - error uploading InvalidBucketName: Bucket name shouldn't contain '/', received 'project-name-ui-storage/cognito/project-ui'
    at http://localhost:3000/static/js/0.chunk.js:294098:19
    at step (http://localhost:3000/static/js/0.chunk.js:535975:17)
    at Object.next (http://localhost:3000/static/js/0.chunk.js:535906:14)
    at http://localhost:3000/static/js/0.chunk.js:535879:67
    at new Promise (<anonymous>)
    at Module.__awaiter (http://localhost:3000/static/js/0.chunk.js:535858:10)
    at http://localhost:3000/static/js/0.chunk.js:294092:22
    at S3Client.Client.send (http://localhost:3000/static/js/0.chunk.js:297053:14)
    at AWSS3ProviderManagedUpload.<anonymous> (http://localhost:3000/static/js/0.chunk.js:124416:18)
    at step (http://localhost:3000/static/js/0.chunk.js:124321:17)
    at Object.next (http://localhost:3000/static/js/0.chunk.js:124252:14)
    at fulfilled (http://localhost:3000/static/js/0.chunk.js:124206:24)
overrideMethod @ react_devtools_backend.js:2273
ConsoleLogger._log @ ConsoleLogger.ts:99
ConsoleLogger.warn @ ConsoleLogger.ts:132
(anonymous) @ AWSS3Provider.ts:328
step @ index.ts:57
(anonymous) @ index.ts:57
rejected @ index.ts:57
Promise.then (async)
step @ index.ts:57
fulfilled @ index.ts:57
Promise.then (async)
step @ index.ts:57
(anonymous) @ index.ts:57
push../node_modules/@aws-amplify/storage/lib-esm/providers/AWSS3Provider.js.__awaiter @ index.ts:57
AWSS3Provider.put @ AWSS3Provider.ts:226
(anonymous) @ Storage.ts:199
step @ Storage.ts:1
(anonymous) @ Storage.ts:1
(anonymous) @ Storage.ts:1
push../node_modules/@aws-amplify/storage/lib-esm/Storage.js.__awaiter @ Storage.ts:1
Storage.put @ Storage.ts:190
uploadFile @ ProductsPageContainer.ts:401
ProductsPage.uploadFile @ ProductsPage.tsx:609
FileUploader.submitFile @ FilePicker.tsx:82
callCallback @ react-dom.development.js:188
invokeGuardedCallbackDev @ react-dom.development.js:237
invokeGuardedCallback @ react-dom.development.js:292
invokeGuardedCallbackAndCatchFirstError @ react-dom.development.js:306
executeDispatch @ react-dom.development.js:389
executeDispatchesInOrder @ react-dom.development.js:414
executeDispatchesAndRelease @ react-dom.development.js:3278
executeDispatchesAndReleaseTopLevel @ react-dom.development.js:3287
forEachAccumulated @ react-dom.development.js:3259
runEventsInBatch @ react-dom.development.js:3304
runExtractedPluginEventsInBatch @ react-dom.development.js:3514
handleTopLevel @ react-dom.development.js:3558
batchedEventUpdates$1 @ react-dom.development.js:21871
batchedEventUpdates @ react-dom.development.js:795
dispatchEventForLegacyPluginEventSystem @ react-dom.development.js:3568
attemptToDispatchEvent @ react-dom.development.js:4267
dispatchEvent @ react-dom.development.js:4189
unstable_runWithPriority @ scheduler.development.js:653
runWithPriority$1 @ react-dom.development.js:11039
discreteUpdates$1 @ react-dom.development.js:21887
discreteUpdates @ react-dom.development.js:806
dispatchDiscreteEvent @ react-dom.development.js:4168
Show 14 more frames from Library code
```
## Comment

---------------

Author: @asumaran

Turns out File upload didn't work at all using `"aws-amplify": "^3.0.23"`. Had to revert to `"aws-amplify": "1.1.29"` to make it work. I couldn't find any reason for this strange behavior.

---------------

---------------

# AWS Amplify + Redux Saga

---------------

Author: @jefelewis
Upvotes: 1
Comments: 0

Was anyone able to get an auth channel/subscription to keep track of the `currentAuthenticatedUser`? Below is how I am trying to do it, but my AWS auth channel is not working. I'm coming from Firebase, so below is an example of a working saga to keep track of the user.

**Firebase Saga (Working):**
```javascript
// Redux Saga: Firebase Auth Channel
export function* firebaseAuthChannelSaga() {
  try {
    // Auth Channel (Events Emit On Login And Logout)
    const authChannel = yield call(reduxSagaFirebase.auth.channel);

    while (true) {
      const { user } = yield take(authChannel);

      // Check If User Exists
      if (user) {
        // Firebase ID Token
        const firebaseIdToken = yield user.getIdTokenResult();

        // Redux: Login Success
        yield put(loginSuccess(user));
      }
      else {
        // Redux: Logout Success
        yield put(logoutSuccess());

        // authChannel.close();
      }
    }
  }
  catch (error) {
    console.log(error);
  }
};
```




**AWS Saga (Not Working):**
```javascript
// Redux Saga: AWS Auth Channel
export function* awsAuthChannelSaga() {
  try {
    console.log('AUTH CHANNEL');

    // Auth Channel (Events Emit On Login And Logout)
    const currentUser = yield call([Auth, 'currentAuthenticatedUser']);

    while (true) {
      const { attributes } = yield take(currentUser);

      // Check If User Exists
      if (attributes) {
        console.log('AUTH CHANNEL LOGGED IN');

        // Redux: Login Success
        yield put(loginSuccess(attributes));
      }
      else {
        console.log('AUTH CHANNEL LOGGED OUT');

        // Redux: Logout Success
        yield put(logoutSuccess());
      }
    }
  }
  catch (error) {
    console.log(error);
  }
};
```

**Index:**
```javascript
// Root Saga
export default function* rootSaga() {
  // AWS Auth Channel
  yield fork(awsAuthChannelSaga);

  yield all([
    // Sagas: Auth
    fork(watchLoginSaga),
    fork(watchLogoutSaga),
    fork(watchResetPasswordSaga),
    fork(watchSendVerificationCodeSaga),
  ]);
};
```

---------------

---------------

# Can I delete many items using Amplify Graphql API?

---------------

Author: @LucasAndrad
Upvotes: 1
Comments: 0

I would like to now how to delete many items using Amplify AppSync Graphql API

Example: in a N to N relation between Posts and Users, amplify graphql schema will have that table PostUser, with connections for Posts and Users, so if I remove a Post, I would like to remove all the relations between that Post and the Users, in this case all PostUser items with `postID = Post.id`.

I know that dynamoDB has the [batchWrite](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_BatchWriteItem.html) method that we can use, but create a lambda, that check if there are 25 or more items, create all calls etc etc seems too much for this feature, so is there an easier way to do it? If not, can we have a feature request for this?

---------------

---------------

# why All fields provided to an @connection must be non-null scalar or enum fields

---------------

Author: @dfang
Upvotes: 1
Comments: 0

eg. for this model

```
type Task @model 
  @key(name: "tasksByStatus", fields: ["status"], queryField: "tasksByStatus") {  
  id: ID!
  title: String
  status: TaskStatus!
  assignerID: ID
  assigneeID: ID
  assigner: User @connection(fields: ["assignerID"])
  assignee: User @connection(fields: ["assigneeID"])
}
```

i got this error:

`All fields provided to an @connection must be non-null scalar or enum fields`

---------------

---------------

# Use RNPushNotificationMessagingService with other services that utilize Firebase Cloud Messaging

---------------

Author: @The0racle
Upvotes: 1
Comments: 0

Docs require `AndroidManifest.xml` to include:

```
        <service
            android:name="com.amazonaws.amplify.pushnotification.RNPushNotificationMessagingService"
            android:enabled="true"
            android:exported="true">
            <intent-filter>
                <action android:name="com.google.firebase.MESSAGING_EVENT" />
            </intent-filter>
        </service>
```
However, there are other services that also use FCM such as Intercom. In that case, we subclass `RNFirebaseMessagingService` and checking whether it is an Intercom notification or not. 

```
public class MainMessagingService extends RNFirebaseMessagingService {
    private static final String TAG = "MainMessagingService";
    private final IntercomPushClient intercomPushClient = new IntercomPushClient();

    @Override
    public void onMessageReceived(RemoteMessage remoteMessage) {
        Map message = remoteMessage.getData();
        if (intercomPushClient.isIntercomPush(message)) {
            Log.d(TAG, "Intercom message received");
            intercomPushClient.handlePush(getApplication(), message);
        } else {
            super.onMessageReceived(remoteMessage);
        }
    }
}
```
How can we do something similar with amplify (`amplifyPushService.isAmplifyPush`)?

---------------

---------------

# Does the Cognito Identity SDK verify JWT tokens?

---------------

Author: @rpivo
Upvotes: 1
Comments: 2

I've been working with this SDK for the past couple of weeks and liking it so far. I've been reading up on JWT tokens and I know I should be verifying them. Does this SDK automatically verify them? If not, would I have to get the tokens into Lambda to be verified? How would I go about doing that?
## Comment

---------------

Author: @elorzafe

@rpivo The tokens are not validated on the client, the library can ask for tokens and refresh those in case they are expired however the tokens should be always verified on the backend for Authorization purposes.

What is your use case to validate the token on the client?
## Comment

---------------

Author: @IsaacTrevino

Related [issue #5477](https://github.com/aws-amplify/amplify-js/issues/5477#issuecomment-675518220)

---------------

---------------

# Build failed when I implemented pushed a commit in which I just connected to the backend

---------------

Author: @pranav1812
Upvotes: 1
Comments: 1

Hi, I am new to AWS. I was playing around with a handson tutorial on how to host react app with aws amplify.
First I hosted a static hello world app (the one that is built by Create React App). Then I configured amplify console and initialized the app. then added basic authentication. It worked well on local machine but when I pushed the latest commits to github, it showed an error that build failed to complete successfully. I'm unable to figure out anything from the console message.

I tried pushing aws exports.js file and other amplify files

P.S. my process of reaching here was not that straight:

1st I deployed the app with aws educate account which had access limitations, so I deployed the same app in my aws account in mumbai region but at the time of configuring, I configures N. Verginia region by mistake. It got configured but lead to another error while initializing (can not find project). Finally I configured again(this time in mumbai region) and it got initialized and worked in local machine..... what happened next you know
![Screenshot from 2020-08-18 23-23-53](https://user-images.githubusercontent.com/55294644/90547986-ea9b7280-e1a9-11ea-8b0c-bab3ff6e27d5.png)
![Screenshot from 2020-08-18 23-27-20](https://user-images.githubusercontent.com/55294644/90548384-7b724e00-e1aa-11ea-9a21-f0b9ac327fda.png)
![Screenshot from 2020-08-18 23-27-32](https://user-images.githubusercontent.com/55294644/90548385-7d3c1180-e1aa-11ea-9eeb-30b325743c38.png)
![Screenshot from 2020-08-18 23-27-40](https://user-images.githubusercontent.com/55294644/90548393-7e6d3e80-e1aa-11ea-9cf4-b5ea60e07f6c.png)
## Comment

---------------

Author: @pranav1812

[https://aws.amazon.com/getting-started/hands-on/build-react-app-amplify-graphql/module-two/](url)
I was following this tutorial

---------------

---------------

# Track user online status with websockets

---------------

Author: @avlonder
Upvotes: 1
Comments: 1

Hi everyone,

Is it possible to change values in a dynamoDB table if the server notices that a websocket (subscription) is disconnected?
This would allow me to track the user's online status in real-time. 
## Comment

---------------

Author: @crolly

Hi, unfortunately I cannot help, however have a similar use case. Did you happen to stumble upon a solution?

---------------

---------------

# Unable to translate text with Predictions - AccessDeniedException

---------------

Author: @giorgiocarniel
Upvotes: 1
Comments: 0

[Amplify 4.22.0]

I'm trying to translate a text inside my Amplify application but when I call `Predictions.convert` I get:

> `AccessDeniedException: CognitoIdentityCredentials is not authorized to perform: translate:TranslateText`

Does anybody know what can cause this error, or any workaround?

I've done:
>amplify add predictions

with the following parameters:

>? Please select from one of the categories below Convert
>? What is the source language? Italian
>? What is the target language? English
>? Who should have access? Auth users only

My code:
```
import Predictions, { AmazonAIPredictionsProvider } from '@aws-amplify/predictions';

export function TranslateItem(name) {
    Predictions.addPluggable(new AmazonAIPredictionsProvider());

    Predictions.convert({
      translateText: {
        source: {
          text: "Prova",
          language : "it" 
        },
        targetLanguage: "en"
      }
    })
    .then(result => {
    	console.log("result", result);
    })
    .catch(error => {
    	console.log("error", error);
    });
}
```

Error:
![AccessDeniedException](https://user-images.githubusercontent.com/69838480/90488091-a8d3e300-e13b-11ea-988b-e40a0ba27328.png)

translateText-template.json:

```
{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Convert resource(s) stack creation using Amplify CLI",
    "Parameters": {
        "authRoleName": {
            "Type": "String"
        },
        "unauthRoleName": {
            "Type": "String"
        },
        "convertPolicyName": {
            "Type": "String"
        },
        "convertType": {
            "Type": "String"
        },
        "access": {
            "Type": "String"
        },
        "resourceName": {
            "Type": "String"
        },
        "sourceLang": {
            "Type": "String"
        },
        "targetLang": {
            "Type": "String"
        },
        "env": {
            "Type": "String"
        }
    },
    "Conditions": {
        "AuthGuestRoleAccess": {
            "Fn::Equals": [
                {
                    "Ref": "access"
                },
                "authAndGuest"
            ]
        }
    },
    "Outputs": {
        "region": {
            "Value": {
                "Fn::FindInMap": [
                    "RegionMapping",
                    {
                        "Ref": "AWS::Region"
                    },
                    {
                        "Ref": "convertType"
                    }
                ]
            }
        },
        "sourceLang": {
            "Value": {
                "Ref": "sourceLang"
            }
        },
        "targetLang": {
            "Value": {
                "Ref": "targetLang"
            }
        }
    },
    "Resources": {
        "TranslatePolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": {
                    "Ref": "convertPolicyName"
                },
                "Roles": {
                    "Fn::If": [
                        "AuthGuestRoleAccess",
                        [
                            {
                                "Ref": "authRoleName"
                            },
                            {
                                "Ref": "unauthRoleName"
                            }
                        ],
                        [
                            {
                                "Ref": "authRoleName"
                            }
                        ]
                    ]
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "translate:TranslateText"
                            ],
                            "Resource": "*"
                        }
                    ]
                }
            }
        }
    },
    "Mappings": {
        "RegionMapping": {
            "us-east-1": {
                "translateText": "us-east-1"
            },
            "us-east-2": {
                "translateText": "us-east-1"
            },
            "us-west-2": {
                "translateText": "us-west-2"
            },
            "eu-west-1": {
                "translateText": "eu-west-1"
            },
            "eu-west-2": {
                "translateText": "eu-west-1"
            },
            "eu-central-1": {
                "translateText": "eu-central-1"
            },
            "ap-northeast-1": {
                "translateText": "ap-northeast-1"
            },
            "ap-northeast-2": {
                "translateText": "ap-northeast-2"
            },
            "ap-southeast-1": {
                "translateText": "ap-southeast-1"
            },
            "ap-southeast-2": {
                "translateText": "ap-southeast-1"
            },
            "ap-south-1": {
                "translateText": "ap-south-1"
            }
        }
    }
}
```

---------------

---------------

# Uncaught SyntaxError: The requested module './js/aws-amplify/aws-amplify.js' does not provide an export named 'default'

---------------

Author: @hashitha
Upvotes: 1
Comments: 0

I am trying to use Auth module in the browser directly `<script type="module" src="index.js"></script>`
but I am getting the following error.

`Uncaught SyntaxError: The requested module './js/aws-amplify/aws-amplify.js' does not provide an export named 'default'`

I have attached a sample code
[sample.zip](https://github.com/aws-amplify/amplify-js/files/5078424/sample.zip)

I can get amplify working if I use webpack but I want to keep it simple and develop without webpack.

---------------

---------------

# Angular amplify latest UI component-style

---------------

Author: @Ivelraj1997
Upvotes: 1
Comments: 1

How can i add custom css to amplify component in angular latest? because  no proper documentation there.

How can i hide creat account link in footer section?

thanks advance.
## Comment

---------------

Author: @karlitos

I am actually searching for a solution as well. We recently switched from **Angular 7** and **aws-amplify-angular (legacy)** to **Angular 10** and **@aws-amplify/ui-angular (latest)**

Previously I was able to pierce the encapsulation with **::ng-deep**, this des not work anymore

I was now desperately trying to:
* get rid of the`box-shadow: rgba(0, 0, 0, 0.15) 1px 1px 4px 0px;` on `amplify-section -> section`
* increase the height of the `input` fields and increase the `border-radius`
* place the `primary-footer-content` above the `secondary-footer-content` (Button  over the signup hint text)

No luck so far 😠 😭 

---------------

---------------

# Reopening of closed, but not fixed issues?

---------------

Author: @gbwashleybrown
Upvotes: 1
Comments: 0

There are no doubt bugs in the issues section that have been prematurely closed despite the fact it clearly hasn't been addressed.

So am I right to assume we open a new thread, thats identical to the one that's been closed (despite comment after comment that its still a problem) ? Adding comments to a closed thread don't seem to get it any attention. So what do we do?

I'm talking about #1857 to be specific. 

---------------

---------------

# Custom Theme ignored?

---------------

Author: @cklingspor
Upvotes: 1
Comments: 2

I'm trying to customize the signOut button but I'm most certainly using it wrong
According to [this](https://docs.amplify.aws/lib/auth/customui/q/platform/js#customize-withauthenticator-hoc) part of the official documentation, it should be possible to pass a piece of code to the withAuthenticator component.

I'm passing the following piece of code to the component
```
const MyTheme = {
    Button: { 'fontWeight': '10' },
}

export default withAuthenticator(
  WebApp, false, [], null, MyTheme
);
```

Ultimately, what I'm trying to do is changing, how the AmplifySignOut-component looks like. I'm pretty sure I'm missing something obvious but I can't make it work right now. 
Could someone maybe help out?

Best Regards!


## Comment

---------------

Author: @hitchiceburg

I have been playing with custom UI a lot and it is very confusing. 
You can use css for some things. https://docs.amplify.aws/ui/customization/theming/q/framework/react

Theming has not worked for me. I wish there was a definite description of functionality. 
## Comment

---------------

Author: @kjones

I'm also having trouble with customization. I can't get `<AmplifyGreetings />` to honor CSS settings. I simply want to change the background. Here is my CSS:
```jsx
<AmplifyGreetings>
  <div slot="logo">Amplify Todos</div>
  <div slot="nav">
    <span>{user?.username ?? ''}</span>
    <AmplifySignOut />
  </div>
</AmplifyGreetings>
```
This doesn't work:
```css
amplify-greetings {
  background-color: grey;
}
```
This doesn't work:
```css
.greetings {
  background-color: grey;
}
```
The only thing that works is overriding `--amplify-white` on the `amplify-greetings` element. This works:
```css
amplify-greetings {
  --amplify-white: grey;
}
```
I guess I can live with that but wait... I also can't set the `border-width`. No matter what I do it is always 1px.

aws-amplify: 3.0.23
@aws-amplify/ui-react: 0.2.14
@aws-amplify/ui-components: 0.6.1

---------------

---------------

# DataStore observer does not trigger in other application instances logged in as different user

---------------

Author: @ifmael
Upvotes: 1
Comments: 0

I am not sure if Datastore complies with this feature.
I'm developing a notification system for different users that can share content between them.  So when the user A shares content with the user B,  I want to the user b receives a notification with the content. 
I'm using Datastore.observer to do create the notification system. Initially, the system didn't working even when a user shared content with himself, but  I found this topic I've checked this topic https://github.com/aws-amplify/amplify-js/issues/5687 , and I could fix it this case of use.
The problem is it is not working with different users, and the users that receive the notification need to refresh the page.

I've tried to overwrite the owner field with the cognito user id for the user that will receive the notifications but when i add it this fields, the Datastore.save  doesn't save the notifications.

The notification model:
```
type Notification
  @model(queries: null)
  @aws_iam
  @aws_cognito_user_pools
  @auth(rules: [
    { allow: owner, operations: [create, read, delete, update] }
    { allow: public, provider: iam , operations: [read] }
    { allow: groups, groups: ["everyone"], operations: [read] }
  ])
  @key(name:"toUserID", fields:["toUserID"]){
    id: ID!
    fromUserID: ID!
    toUserID: ID!
    createdOn: AWSTimestamp!
    type: Int!
    title: String!
    url: String!
    owner: String
  }
```


```
      const notification = new Notification({
        fromUserID: user.id,
        toUserID: id,
        createdOn: parseInt(moment(new Date()).format('x')),
        type:1,
        title:titleContent,
        url: window.location.href,
        owner: owner
      });
      
      const x = await DataStore.save(notification);
```

---------------

---------------

# How do I assume role properly so I can clone repository during amplify build

---------------

Author: @linfiesto
Upvotes: 1
Comments: 0

When cloning repository during the build process of amplify it says

2020-08-12T02:37:14.776Z [ERROR]: !!! Unable to assume specified IAM Role. Please ensure the selected IAM Role has sufficient permissions and the Trust Relationship is configured correctly.
2020-08-12T02:37:14.907Z [INFO]: # Starting environment caching...
2020-08-12T02:37:14.908Z [INFO]: # Environment caching completed
Terminating logging...

I never had problem with this in my other client's AWS account. I did the standard AWS amplify-backend-console role found here. [](https://docs.aws.amazon.com/amplify/latest/userguide/how-to-service-role-amplify-console.html) And I made sure my IAM user has AdministratorAccess.

![image](https://user-images.githubusercontent.com/4402009/90082829-637e7280-dd43-11ea-9757-8ee073315cd2.png)

---------------

---------------

# Software Engineering Survey on GitHub Discussions.

---------------

Author: @raux
Upvotes: 1
Comments: 0

Do you find GitHub discussions useful as a communication channel? Maybe not? 
Hello Developers! I am Raula Gaikovina Kula, a Software Engineering researcher
https://raux.github.io/

Together with a team of researchers, we are interested in your thoughts about
using the GitHub Discussions Beta. We noticed that your project is currently using.

We have developed a simple 3 question survey that could take up to 5 mins to complete.
https://forms.gle/peBxiio8u99QvKMk6

Thank you in advance for your time and apologize if this is not a proper use of this channel.

@raux
Raula, PhD on behalf of Hideaki, Sebastian, Nicole and Christoph

---------------

---------------

# How to add custom cloudformation configs that don't get overridden by the CLI

---------------

Author: @hbj
Upvotes: 1
Comments: 0

Hi,

I have a REST API created with the CLI and I need to add a custom config to it's cloudformation template, more specifically the "BinaryMediaTypes" property. According to the documentation (https://docs.amplify.aws/cli/usage/customcf) this should be done in the corresponding "api-cloudformation-template.json" file, but my changes are getting overridden if I update the API from the CLI, e.g. with `amplify api update`. Is there a way to add custom configs that don't get overridden?

Thanks.

---------------

---------------

# Getting UnrecognizedClientException while calling appSync API

---------------

Author: @shubh9795
Upvotes: 2
Comments: 0

I am working on a application which contains a react web app & a react-native mobile app. I have configured amplify in the react app from scratch and used the same backend in the web app as well.

I have also configured multi-auth for APIs which uses cognito userpool as primary authentication and IAM as secondary.

In web app I have enforced to login and hence only authenticated users are accessing the data and things are working fine but in react native app, I want users to access some amount of data without them being logged in. For that I am using IAM as authMode while calling API.

const categoriesData = await API.graphql({
          query: listCategorys,
          authMode: "AWS_IAM",
        });

Although I am getting UnrecognizedClientException while making any API calls with this method in react native app.

---------------

---------------

# Help regarding AWS SNS Service

---------------

Author: @3atharvkurdukar
Upvotes: 1
Comments: 1

I am using AWS Amplify to manage my React application as well as the serverless Express API for the backend. The customer has requested to send SMS to a list of users at specified time everyday. However, the user info is not stored in AWS Cognito for some reasons.
I have added and API endpoint to get the list of mobile numbers based on some conditions and I want to add a lambda function that calls the API at specified time.
However, I don't know how to call the API from the lambda function. Google Search is not helpful as well. Please let me know which way I am supposed to use.
## Comment

---------------

Author: @3atharvkurdukar

Is it possible and recommended to use 'amplify-js' for the backend?

---------------

---------------

# DataStore - Support for client-side CRUD Permissions?

---------------

Author: @danrivett
Upvotes: 1
Comments: 0

We already use DataStore for data that is owned by the owner and modified on the client side in a React Native app, we now want to flow data updates from the backend for other data models that are designed to be read only by the client - e.g. data that's more of a notification-type of data.

An example of this sort of notification would be like a saved search in craiglist, and when there's a new posting that matches the saved search, then the user gets notified.

We're using Elasticsearch and its Percolator functionality to determine who should get notified, however the question is - how should they get notified.

We initially thought about defining a vanilla GraphQL mutation that the backend can call with the notification, and the front-end can subscribe to, and this could work well.

The downside we see though is that now the client needs to use the DataStore API for entity type data, and a separate GraphQL client for notification-based data. It's doable, but I'm wondering if we can simplify things for the client and use DataStore for all of it, and if it's a good idea.

The way I see it working if we used DataStore would be that we'd have a new model type for the notification and we'd use the `@auth` directive to limit the notifications synced to the client to be just theirs. However one issue I'm seeing is there's nothing to stop the client accidentally, or ignorantly, mutating the synced notifications locally, since I don't believe there's any way of having client-side access control to instruct that certain data types are read only for example?

Of course we can just tell the app to not be silly, but I'm wondering if this is showing whether using DataStore for this use case is even a good idea?

If we went with the vanilla GraphQL client approach it would introduce complexity of a second way of accessing and subscribing to AppSync data, which doesn't seem great. Plus we'd also need to keep hold of that data locally (perhaps in Redux) for as long as that data is valid. And so it starts to look like it would become way more work than just observing a data model type in DataStore.

Any thoughts here are most welcome.

---------------

---------------

# pubsub

---------------

Author: @dingdongping
Upvotes: 1
Comments: 0

 I only need to use PubSub in my react-native application. Can I just create a cognito account? All accounts in my system share the same cognito account to use PubSub service.
Or is there any better suggestion for my program to use PubSub instead of creating a cognito account for each account

---------------

---------------

# Can I use Amplify JS lib to sign-up and sign-in with Google, but directly integrate Identity Pool (not User Pool)?

---------------

Author: @syang
Upvotes: 1
Comments: 0

A lot of Amplify Auth tutorials give the way to integrate Cognito User Pool with Google Oauth2 as IdP like this.
![image](https://user-images.githubusercontent.com/188004/89716953-4eca6500-d966-11ea-88e0-c8d31840ae3d.png)

BUT, **the above is not** what I am looking for. What I am looking is integrate Google as IdP directly with Cognito Identity Pool like this 
<img width="953" alt="CognitoDiagram" src="https://user-images.githubusercontent.com/188004/89716963-73bed800-d966-11ea-887a-b95de76b0fab.png">


Is there a way for me to use Amplify JS library to achieve this? If so, can I have a reference point?

---------------

---------------

# How to hook custom user pool programmatically?

---------------

Author: @sakhmedbayev
Upvotes: 1
Comments: 2

We are building a SaaS using AWS Amplify and AWS AppSync. For each new tenant/customer, we create a new Cognito User Pool using cloudformation. We know that it is possible to hook those user pools manually using AppSync's console, however, is it possible to do the same programmatically?
## Comment

---------------

Author: @sw-yx

[redacted; misunderstood the qtn]
## Comment

---------------

Author: @RossWilliams

https://github.com/aws-amplify/amplify-js/issues/6518#issuecomment-670647826 ?

---------------

---------------

# Get 'id' from a row entry in DynamoDB/AppSync?

---------------

Author: @chai86
Upvotes: 1
Comments: 2

I want to do something seemingly so simple, but i am a bit lost as to how to do it: I have a table with user information already in it. Here's the Schema:


    type Users @model {
      id: ID!
      userName: String
      firstname: String
      weblink: String
      email: String
      mobileNum: String
     .
     .
     .
    }
    
    
    //**Here's my current Query.js**
    export const getUsers = `query GetUsers($id: ID!) {
      getUsers(id: $id) {
        id
        userName
        firstname
        weblink
        email
        .
        .
        .
      }
    }
    `;

This table is populated in DynamoDB when i check my AWS console. What i need is to be able to get the id from the table using the userName (not vice versa). The id is generated when i createUser() and it's used throughout my app to get all my user's information. However when a user signs in on a new phone, this id isn't available anymore. So when they sign in via Cognito, i do know the userName and all i need to do is retrieve this id. Because there's only one unique **userName**, it should only return one **id**

How can this be done easily?
## Comment

---------------

Author: @mauerbac

hi @chai86 - this seems more like a general GQL question. Will move into our discussion section! 
## Comment

---------------

Author: @ericclemmons

@chai86 Ah, I've ran into this issue myself!  What I did was use `@key` to provide another index for to query by:

> https://aws-amplify.github.io/docs/cli-toolchain/graphql#how-to-use-key

/cc @yuth from the Amplify CLI team

---------------

---------------

# React authenticator without sign up and password reset

---------------

Author: @ksabr
Upvotes: 1
Comments: 2

Hi all,

I'd like to make a react authentication form without the sign up and password reset options (as the users can only be manually created and modified by an admin). How is this done? There's a vast amount of information out there on customizing the authenticator but I didn't come across a simple solution to this - presumably common - use case.

Thanks in advance.
## Comment

---------------

Author: @

AmplifySignIn has an exposed field `hideSignUp` but no equivalent for forgotpassword. The code below works for me though:

```
    <AmplifyAuthenticator>
      <div slot="sign-in" style={{ textAlign: 'center' }}>
        <AmplifySignIn
          hideSignUp="true"
          headerText="Sign In"
          formFields={[{ type: "email" }, { type: "password", hint:null }]}
        />
      </div>
      <App />
    </AmplifyAuthenticator>
```
## Comment

---------------

Author: @ksabr

An update: I updated to Firefox 68.11.0 and it looks fine. Thanks again!

---------------

---------------

# passing props to function wrapped in withAuthenticator

---------------

Author: @awshanks
Upvotes: 1
Comments: 1

Hi.  I might be missing something but it doesn't seem possible to have a function wrapped in withAuthenticator and also allow props to be passed down.

e.g.  I have an app with router:

```
import Name from "./components/name";

const App = () => {
    const [appTenant, setAppTenant] = useState(null);

    return (
        <Router>
            <Header tenant={appTenant} setTenant={setAppTenant}/>
            <Switch>
                <Route path="/name" exact component={withProps(Farm, {setTenant: setAppTenant,tenant: appTenant})} />
            </Switch>
        </Router>
    );
}

export default App;
```

The Name component is just a function: 


```
export const Name = ({
                  tenant,
                  setTenant,
              }) => {

    console.log('function',setTenant)
    console.log('function', tenant)

    return <Container fluid="md">some text</Container>

};

export default withAuthenticator(Name)
```

This will show the Authenticator login screen, allow login and then render the view, but the console statements are null.

If I import the Name component with `{Name}` after a successful login everything works as expected but then authenticator no longer works.

What I want to have, is have auth routes and public routes but keep the Header outside and use useState to show / hide different links that would be available to users.
## Comment

---------------

Author: @awshanks

I have seen many different ways to do auth with Amplify, mostly involving custom auth flows and I really wanted to steer away from this whilst still being able to have both public and private routes.

I have come up with a solution using nested routes with react-router that achieves this aim.

The main **App** has the top level routing and the **ProtectedApp** component houses the nested routing for the App to be authenticated.  This overcomes the problem above as components within the ProtectedApp that is wrapped by withAuthenticator(), can freely pass props as required.


### App.js
```
const App = () => {
    return (
        <Router>
            <Switch>
                <Route path="/" exact render={() => <Home/>}/>
                <Route path="/farm" render={() => <ProtectedApp/>}/>
                <Route path="/admin" render={() => <AdminHome/>}/>
            </Switch>
        </Router>
    );
}

export default App;
```

### ProtectedApp.js

```
import Amplify from "aws-amplify";
import awsExports from "./aws-exports";
Amplify.configure(awsExports);

const ProtectedApp = () => {
    const [appTenant, setAppTenant] = useState(null);

    return (
        <div>
            <ProtectedHeader tenant={appTenant} setTenant={setAppTenant}/>
            <Switch>
                <Route path="/farm" exact render={() => <Farm tenant={appTenant} setTenant={setAppTenant}/>}/>
                <Route path="/farm/create" exact render={() => <FarmSetup/>}/>
            </Switch>
        </div>
    );
}

export default withAuthenticator(ProtectedApp);
```

---------------

---------------

# It seems that my conflictHandler is called after my Datastore.Save()'s Promise is fulfilled?

---------------

Author: @Jeff17Robbins
Upvotes: 1
Comments: 0

I am trying to use Optimistic Concurrency with my GraphQL API.  Everything seems properly setup.  DynamoDb shows updating `_version` numbers.  If I run one instance of my app, all is well.  

But if I bring up the same record in two instances of my app (instances retrieved via `await DataStore.query(entity, params.id);`), update the record from one instance (via `Datastore.Save(...using copyOf in here...)`) which succeeds, then attempt to update the now out-of-date record in the other app instance, the second `Datastore.Save()` succeeds (no error is thrown) and **then** the `conflictHandler` I registered via `Datastore.configure()` gets called.

Is there some way to get Datastore to hold-off fulfilling until the `.Save()` succeeds or fails?  I realize that this might be contrary to an "offline first" approach, but I have subsequent operations which are a waste of time once it turns out that the `.Save()` will never succeed.

---------------

---------------

# Notes from 8/6/20 Amplify Office Hours via Discord

---------------

Author: @mauerbac
Upvotes: 1
Comments: 8

Starting a thread to take notes from our office hours
## Comment

---------------

Author: @RossWilliams

I'm interested in hearing about how to decide on whether to use Pinpoint for Push Notifications. What would make you not want to use Pinpoint.
## Comment

---------------

Author: @josh-tncarry

Name: Josh Carroll (Twitter: @jwcarroll)
Discord: jwcarroll

topic(s): AppSync Resolvers, Pinpoint

Questions:

- I may not 100% understand the mechanics, but is there a potential issue with how owner filtering works on resolvers? If I am reading it correctly, it filters after the records have been returned from DynamoDB, which seems like you could run into potential issues or limits or performance issues if there isn't already a secondary index including that column.
- Since direct lambda resolvers have been introduced, are there any plans to generate Lambda resolvers using Node or another runtime instead of VTL templates? If not, what is the current best way to integrate more RPC style calls into my API?
- I have a decent amount of experience with Pinpoint, but the integration with web based apps seems to be broken. I have things configured, and even have Cognito set to push things to pinpoint, but none of that seems to be working. Am I just missing something, or is the integration between Amplify and Pinpoint not fully baked?

JS AppSync Issues/Question:

- In one of my current apps, it seems that the connections to AppSync seem to timeout at some point. Is there an idomatic way to extend this timeout (keepalive) or set something up to simply reconnect after a timeout event?
## Comment

---------------

Author: @BrianHHough

Name: Brian Hough (Twitter: @BrianHHough)
Discord: InterstellarXD

topic(s): Auth, Style

Questions:
- How do you create a custom login screen? I can edit the colors via my SCSS file, but how do I add a logo? 
- It's importing the blue primary color into some of my div elements, but how do I edit the colors if it's pulling AWS Amplify colors?
## Comment

---------------

Author: @Ricardo1980

Name: Ricardo

Discord: Ricardo#4748.

Topic: Amplify, cloud formation, aurora serverless

Question 1:
When using AppSync with Aurora Serverless, how can I pass secretStoreArn and clusterIdArn to my lambda function?  (I am trying modifying my cloud formation templates but no luck)

Question 2:
How can I update my aurora serverless from version 1.17 to version 2?
## Comment

---------------

Author: @supercodes1223

We are currently doing a lot of custom logic in vtl with #if statements and etc. I would like to know in general is it advisable to rely so much on vtl for business logic? Is there such a thing as too much vtl customizing. 

Also, would love for someone to explain vtl and how it works under the hood.
## Comment

---------------

Author: @ayushjainrksh

Name: Ayush Jain [@ayushjn_](https://twitter.com/ayushjn_)
Discord: Ayush Jain

I migrated a node.js backend from EC2 to AWS Amplify. The React frontend was hosted on S3. The problem was that the frontend did not have any SSL, and thus, was served over `http` but the backend was served over `https` by Amplify and blocked all the request from the frontend. Can Amplify be configured to serve over `http` or is there a workaround to this?
## Comment

---------------

Author: @albac

Name: Alfredo
Discord: albac
Topic: React UI Oauth, hosted ui
I recently completed my first react backend and frontend app. Initially I use withAuthenticator with aws cognito and everything work as expected. Now I am adding Saml Authentication, I did this through the aws cognito console adding a federated provided. Using the aws console this works well when using the hosted UI option, but the app still using the user and password screen too. I am unable to find documentation to enable this on the react side, I do see there are examples for google, facebook, but not for any other third party. Do you have any information on how to do this? I am using OneLogin as identity provider.
## Comment

---------------

Author: @mauerbac

Thanks everyone for joining! Let us know if you have improvement suggestions in the #discord-discussion channel. 

---------------

---------------

# clarify amplify support in angular

---------------

Author: @wraila
Upvotes: 1
Comments: 1

I cannot find any documentation of which versions of aws-amplify and its related packages, e.g. aws-amplify-angular, aws-amplify/ui*, work with which versions of angular. Very frustrating. 

@ericclemmons has mentioned in some other threads documentation at 
> Please also note that the AWS Amplify Angular components do not yet support Ivy.
> – https://aws-amplify.github.io/docs/js/angular#angular-6-support

but that link redirects to a tutorial with no mention of ivy or other angular version info. [It does mention edits for polyfills.ts, but that hasn't changed since angular 6.]

I'm trying to upgrade from angular 8. 

Which versions of which amplify packages can be used with angular 9?
Which versions of which amplify packages can be used with angular 10?

## Comment

---------------

Author: @sammartinez

Apologizes for the late response here. For our support of Angular, we currently support up to Angular 9 with our newer [Amplify UI Components](https://docs.amplify.aws/ui/q/framework/angular) implementations. We are exploring support for Angular 10 but dont have a timeline as its a new release from Angular.

---------------

---------------

# Mobile Application login via AD

---------------

Author: @sandeep621
Upvotes: 1
Comments: 1

Hi Team,

We are developing hybrid application using ionic framework. Signing in via AD we get successful login in web browser as the user auth object is retrieved from local storage & the user is authorised.

But for mobile application we are using InappBrowser provided by ionic. After signing in via AD credentials we are getting the response code back for successful authentication. However while authorisation function “Auth.currentAuthenticatedUser” is returning “Not authenticated” since we are not able to capture user auth object from InAppbrowser. 

 Is there any listener to check the auth event & get the user object instead of local storage.

Or if there is any other way to handle login from Mobile apps please let us know.
## Comment

---------------

Author: @sammartinez

We do have the ability to listen to Auth Events via our [Hub Events Utility](https://docs.amplify.aws/lib/utilities/hub/q/platform/js#listening-for-messages). Please let us know if you have anymore questions in regards to this.

---------------

---------------

# How can I add a checkbox to AmplifySignUp?

---------------

Author: @carlhaynes
Upvotes: 1
Comments: 2

I have the new auth ui working so I can sign up, login etc but for my signup I need to have a checkbox checked before registering (It is an alcohol related site that needs confirmation on age)

I see there is an AmplifyCheckbox component, but I can not figure out how to add it to the config for sign up, 

My Signup is very straightforward:

```
          <AmplifySignUp
            headerText="Please Sign up for Vinotrove"
            slot="sign-up"
            formFields={[
              {
                type: 'preferred_username',
                label: 'Username',
                placeholder: 'Username',
                required: true,
              },
              {
                type: 'username',
                label: 'Email',
                placeholder: 'user@email.com',
                required: true,
              },
              {
                type: 'password',
                label: 'Password',
                placeholder: 'Password',
                required: true,
              },
            ]}
          />

```

The [docs](https://github.com/aws-amplify/amplify-js/tree/master/packages/amplify-ui-components/src/components/amplify-form-field#properties) say that it can be any html input type but putting "checkbox" as the type does not work (shows a text field)

<img width="1011" alt="Screen Shot 2020-05-24 at 9 37 58 PM" src="https://user-images.githubusercontent.com/1378540/82778700-f07df380-9e06-11ea-8206-0e90cdd677c3.png">

How do I do this, it must be a common ask since most apps need you to agree to the terms before signing up.

Is there an alternate way to do this without re-writing the forms and not using the new ? I'm hoping to let amplify to the auth work for me.

## Comment

---------------

Author: @nkint

Hi!
I need this feature too.
Include a Term of service/Privacy checkbox is mandatory in most of user flow today.

I'm concerned where documentation is clear `Can be any HTML input type` but "checkbox" is not a valid value, or is ignored.

I've tried to dig into the code but I'm not really understand where is the problem. Maybe someone can spot the problem?

Here is the path I'm following to check where the code can be changed to let `amplify-input` accept also "checkbox":

- https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-sign-up/amplify-sign-up.tsx#L313
- https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-auth-fields/amplify-auth-fields.tsx#L40
- https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-auth-fields/component-field-mapping.tsx#L65
- https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-form-field/amplify-form-field.tsx#L49
- https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-input/amplify-input.tsx#L49

I think that the field `type` is missing here: 

https://github.com/aws-amplify/amplify-js/blob/main/packages/amplify-ui-components/src/components/amplify-auth-fields/component-field-mapping.tsx#L65

Can anyone help me to spot if this is the right place?

```
<amplify-form-field
      type={ff.type}
      label={ff.label}
      placeholder={ff.placeholder}
      required={ff.required}
      handleInputChange={ff.handleInputChange}
      value={ff.value}
      inputProps={ff.inputProps}
      disabled={ff.disabled}
    />
```

this can be enough?
## Comment

---------------

Author: @nkint

I have tried to fix with this PR: https://github.com/aws-amplify/amplify-js/pull/6502

---------------

---------------

# How do I remove the drop shadow from the authentication react component?

---------------

Author: @hirenumradia
Upvotes: 1
Comments: 1

I have been trying to remove the drop shadow of the authentication react component, but cant get it to select the right element.

https://docs.amplify.aws/ui/customization/theming/q/framework/react#for-colors

This is the element with a drop shadow. I have limited experience working with web components. How do I style this? Any help would be appreciated.

`
<section class="section" role="application"><slot></slot></section>
`
Thanks,
Hiren
## Comment

---------------

Author: @sw-yx

unfortunately you can't burst through the web component shadow dom to do custom styling like that. i recommend forking/copying out the code into your own codebase and modifying it for yourself.

cc @jordanranz for comment

---------------

---------------

# Overridden groups are lost on token refresh

---------------

Author: @jdwil
Upvotes: 1
Comments: 1

I have a Pre-Token Generation lambda trigger that adds groups to user's id/access tokens based on a custom database. After an hour, amplify will refresh my access token, but the groups ("cognito:groups") overridden in the lambda trigger are gone. Does anyone know why the tokens, after a refresh, are not identical to the originals?
## Comment

---------------

Author: @jdwil

This wasn't an amplify thing. My lambda callback wasn't executing for the "TokenGeneration_RefreshTokens" triggerSource.

---------------

---------------

# Can someone post a code snippet on how to do a Federated Login with amazon-cognito-identity-js ?

---------------

Author: @batmanwannabe
Upvotes: 1
Comments: 0

We have a old app that uses amazon-cognito-identity-js for authentication, I need to add SSO login to it, I don't want to update to Amplify just for this. Is there any way amazon-cognito-identity-js can achieve this? 

I searched online but could not find anything,

---------------

---------------

# Request: Support or Documentation for using pubsub with Cognito groups

---------------

Author: @atyshka
Upvotes: 1
Comments: 2

**Is your feature request related to a problem? Please describe.**
When integrating sensitive IoT data into my web app, I don't want any user of the app to be able to access it, I would like to restrict access using cognito groups. How can I achieve this? I have current tried adding an all-wildcard policy on the group, but this isn't working. Attempting to subscribe leads to an error code 8: socket closed error. I know something is incorrect with the IAM policies, but I'm unsure.

**Describe the solution you'd like**
Support for user groups as a form of permissions for IoT. If this already is possible, then documentation on how to achieve this.

Here is my user-pool-group-precedence.json that adds the inline policy:
```
[
  {
    "groupName": "TrustedUsers",
    "precedence": 1,
    "customPolicies": [
      {
        "PolicyName": "admin-group-policy",
        "PolicyDocument": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "statement1",
              "Effect": "Allow",
              "Action": ["iot:*"],
              "Resource": ["*"]
            }
          ]
        }
      }
    ]
  },
  {
    "groupName": "UntrustedUsers",
    "precedence": 2
  }
]
```
Other than that, I haven't made the single-user changes in the pubsub tutorial, as I want to configure on a group basis rather then per user.
## Comment

---------------

Author: @ashika01

@atyshka Have you tried looking into [AppSync service](https://docs.aws.amazon.com/appsync/latest/devguide/welcome.html)? They handle a lot the use cases you are trying to solve. You can use [amplify to interact with the appsync service.](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js)

## Comment

---------------

Author: @atyshka

I ended up solving the issue. It wasn't initially clear that IAM policies and IoT policies are completely separate things. The eventual user permissions are the intersection of the IAM policy and the IoT policy. It's buried in the IoT docs but that's pretty important info. So in my case, I am giving every user, trusted or untrusted, a full access IoT policy upon sign up. However, only users in the IAM group receive the IAM policy with IoT permissions, and as such they are the only ones who can access the IoT data.

---------------

---------------

# CognitoUserPool - Client.js - missing http status error code

---------------

Author: @trylas
Upvotes: 1
Comments: 0

I would like to ask why error codes are missing and methods like signUp respond errors as per below. Instead of 400 code 'InvalidParameterException'.
```
{ 
  code: 'InvalidParameterException',
  name: 'InvalidParameterException',
  message: '1 validation error detected: Value null at \'confirmationCode\' failed to satisfy constraint: Member must not be null' 
}
```

InvalidParameterException
This exception is thrown when the Amazon Cognito service encounters an invalid parameter.
HTTP Status Code: 400

Link to file
https://github.com/aws-amplify/amplify-js/blob/3642e6af455ee1848c1cc743a7a503e96baefa41/packages/amazon-cognito-identity-js/src/Client.js#L55

---------------

---------------

# How do I use AWS Pinpoint to send text messages?

---------------

Author: @3atharvkurdukar
Upvotes: 1
Comments: 0

I have added SMS service using AWS Amplify CLI with command `amplify add notification`. But, I am unable to find any documentation regarding how to implement it. Please help. I want to manually send SMS to a list of mobile numbers, which are not stored in Cognito User Pool.

---------------

---------------

# Same user (same email) logging into Cognito Identity Pool with both Facebook and Google social providers

---------------

Author: @justingrant
Upvotes: 1
Comments: 0

My web app offers both Facebook and Google login providers using a Cognito Identity Pool. (I'm not using Cognito User Pools.) My login flow looks like this: 
1) User clicks a login button in my app
2) I show a dialog with "Login with Facebook" and "Login with Google" buttons
3) When the user clicks a login button, my app calls into the Facebook or Google SDK to show a login UI
4) If the user successfully logs into their social provider, my app uses code like below to log into Cognito: 
```typescript
async function cognitoLogin(provider: 'google' | 'facebook', name: string, email: string, token: string, expiresAt: number) {
  const federatedUser: FederatedUser = { name, email };
  const federatedResponse: FederatedResponse = { token, expires_at: expiresAt };
  try {
    await Auth.federatedSignIn(provider, federatedResponse, federatedUser);
    console.log('Cognito federated login success');
  } catch (e) {
    console.log(`Cognito federated login error: ${(e as Error).message}`);
    throw e;
  }
}
```
5) If Cognito login succeeds, my app calls a `getOrCreateUser` Lambda function that looks up that user in a backend database using the Cognito Identity ID as a key and returns the user profile back to the client. If the user doesn't exist in my database, then the Lambda will create a new user in the database, storing its Cognito Identity ID as well as email, name, and other profile info returned from the social provider.

Until recently my app only supported Facebook login, but now that it also supports Google login, I'm running into the case where a user originally signs up using one social provider (e.g. Google) but later decides to log in with another provider (e.g. Facebook). My database will prevent a duplicate account from being created with the same email as another account. So today this use case simply fails with an error, e.g. "_You've previously logged in using Facebook, so please use Facebook to log in again._" 

Instead, I'd like to enable users to log in with either social provider. For this use case, do developers typically store multiple Cognito Identity IDs per user (one per social provider) in the back-end database, instead of just storing one identity per user?  Or is there some way to tell Cognito to match the email address so that only one Cognito Identity ID will be created per email address?  I assume not, but wanted to know before changing my DB schema.

---------------

---------------

# Federated Signin w/Axios but feed access_tokens into amplify lib?

---------------

Author: @filburt-turle
Upvotes: 1
Comments: 0

Hi,

I currently use a third-party auth provider w/cognito. I have my provider working w/cognito and I'm able to do the gran_code workflow to obtain access_tokens, etc...

At the moment I'm unable to use the Auth for Amplify because of:

https://github.com/aws-amplify/amplify-js/issues/6438#issuecomment-665279255

I'm wondering if there's a way that if I do my exchange outside of the Amplify lib to get my JWT-tokens, is there a way to inject that data into Amplify lib, so that appsync queries using the lib, would be seamless as I've already got the auth tokens needed?


Any help would be appreciated.
Thanks

---------------

---------------

# How to register a guest Identity Id to a User Pool User.

---------------

Author: @andsee
Upvotes: 1
Comments: 0

Our app starts users as guests for a low friction start. They may play for as long as they wish against the IdentityId from the Federated Identity Pool and data is saved and uploaded to S3 against their IdentityId.

After deciding they like the app they decide to register by linking their save to an email or (Google / Facebook / Apple etc)

So this creates a UserPool user for them, but in doing so the amplify library assigns them a new IdentityId from the federated identity pool.

How do I switch the UserPool user to use the original IdentityId so that the user can access their previous data?

I’ve tried storing the existing IdentityId before calling SignIn (during a registration of new user flow) and then linking it to the user as follows however the UserPool user remains linked to the new IdentityId.

```

    async linkUser(identityId:string)
    {
        let session = await Auth.currentSession();
        console.log('linkUser session', session);
        let config = Auth.configure(undefined);
        let credentials = undefined;
        const region = config.identityPoolRegion || config.region;
        const userPoolId = config.userPoolId;
        const provider = 'cognito-idp.' + region + '.amazonaws.com/' + userPoolId;
        const token = session.getIdToken().getJwtToken();
        const logins = {};
        logins[provider] = token;
        // TODO Append with any existing logins
        const cognitoClient = new CognitoIdentityClient({
            region,
            customUserAgent: getAmplifyUserAgent(),
        });
        const cognitoIdentityParams: FromCognitoIdentityParameters = {
            identityId: identityId,
            logins,
            client: cognitoClient,
        };
        console.log('linkUser useExistingIdentity setup', cognitoIdentityParams);

        credentials = fromCognitoIdentity(cognitoIdentityParams)();
        console.log('linkUser resulting credentials', credentials);
    }

    async doRegister({password, email}: {password: string, email: string}) {
        let originalUserId = this.userIdentity;
        const data = {username: this.userIdentity, password};
        const Register = await Auth.signUp({ ...data, attributes: {email} });
        const SignIn = await Auth.signIn(data);
        console.log('[Auth] Sign in: ', SignIn);
        this.linkUser(originalUserId);
        const SendCode = await Auth.verifyCurrentUserAttribute('email');
        return { Register, SignIn, SendCode };
    }
```

---------------

---------------

# no-ssr in Nuxt.js with amplify-authenticator

---------------

Author: @malmil
Upvotes: 1
Comments: 0

Hi,

I've recently switched from SPA to Universal (Server Rendered (Universal SSR)) in Nuxt and this caused some problems with aws-amplify-vue.
Everything worked fine before this, but because I now have to wait for the client I need to have conditional imports.

I have a component that is going to show amplify-authenticator:

```
<template>
   <v-container grid-list-md>
      <no-ssr placeholder="Loading...">
         <!-- not signed in -->
         <v-flex v-if="!signedIn" sx12>
            <amplify-authenticator v-bind:authConfig="authConfig" />
         </v-flex>
      </no-ssr>
   </v-container>
</template>
<script>
export default {
   data() {
    return {
      authConfig: {
        signInConfig: {
          header: 'Login as admin',
          isSignUpDisplayed: false
        }
      }
   },
   computed: {
      signedIn() {
         return this.$store.state.user.signedIn
      }
   },
   beforeMount() {
     if (process.client) {
       const { AmplifyEventBus: eventBus } = require('aws-amplify-vue')
       eventBus.$on("authState", info => {
         if (info === 'signedIn') {
           this.$store.dispatch('user/setUser', true)
         }
       })
     }
  }
}
</script>
```

The problem with this is that if I write; `import { AmplifyEventBus } from 'aws-amplify-vue'` I will get document is not defined. And having the solution I wrote over gives me `TypeError: Cannot read property 'Logger' of undefined`

**Additonal info:**

plugin in nuxt.config.js
```
plugins: [
    {
        src: '~plugins/aws.js',
        mode: 'client'
    }
  ],
```

plugins/aws.js
```
import Vue from 'vue'
import Amplify, * as AmplifyModules from 'aws-amplify'
import AWSAppSyncClient from 'aws-appsync'
import awsconfig from '../src/aws-exports'

const AmplifyPlugin =  process.client ? import('aws-amplify-vue'.AmplifyPlugin) : null

if (process.client && AmplifyPlugin) {
  Amplify.configure(awsconfig)
  Vue.use(AmplifyPlugin, AmplifyModules)

  const client = new AWSAppSyncClient({
    url: awsconfig.aws_appsync_graphqlEndpoint,
    region: awsconfig.aws_appsync_region,
    auth: {
      type: awsconfig.aws_appsync_authenticationType,  //AWS_IAM
      credentials: () => AmplifyModules.Auth.currentCredentials(),
    }
  })
}
```


Anyone that knows how to fix this?



---------------

---------------

# S3.Storage and Cognito Group Policies

---------------

Author: @GetJoot
Upvotes: 1
Comments: 0

Related to issues discussed in another thread, I want to explain a situation in our web app that is causing a 403 when using Amplify to upload a file to S3 for an authenticated user that belongs to a Cognito group that has a policy attached to it granting all access to the specific S3 bucket and folders.

I have designed a Serverless app using the guidelines defined at [serverleses-stack.com](http://serverless-stack.com). This guide does not use the Amplify CLI for creating/generating/configuring the serverless architecture, but a similar architecture is manually defined/deployed and used. The client app is built using React and the Amplify libraries are installed and included using npm. Amplify Auth, Storage, and API are all configured using Amplify.configure() as detailed on this page [configure AWS](https://serverless-stack.com/chapters/configure-aws-amplify.html).

We use Cognito User Pools, User Groups, and Identity Pools to manage all of our app's users. When a new user signs up for our service using the web app, the new user is created in Cognito with the default policy we have defined for authenticated users. New users then have the option of creating a new 'Account' or joining an existing Account. Within our platform, Accounts represent an organization or group and are designed as a workspace for one or more users that need to share a set of resources such as images and other things associated with that account. When an account is created, a corresponding Cognito Group is created with the same name, a new Policy is defined and attached to the group allowing for access to certain S3 folders that will contain files accessible only by members of the group, and the Cognito user is then added to the Cognito group. Of course, any Cognitio user can belong to more than a single account (and therefore more than a single Cognito group).

When an authenticated user is logged in, they have no issues using Storage.vault.put() to add files to their own private folder in S3. However, when we attempt to use Storage.put() to add files to the specific group/account folder defined in the access policy in the Cognito group they belong to, then receive a 403 Access Denied.

I have checked to make sure the PUT storage request is generated properly and observed the request/response to make sure we are attempting to properly access the right S3 bucket and path (all good). So I am left scratching my head as to why the Cognito Group policy doesn't appear to be in effect for the given Cognito user who belongs to that Cognito group when attempting to access the specific resource in S3 allocated for that group when using Amplify.

Any suggestions?

Thank you.

---------------

---------------

# Change a field on a @model from one to many

---------------

Author: @emmafass
Upvotes: 1
Comments: 1

I have a table already set up in prod that is:

```
type Person
  @model
  @auth(rules: [
    {allow: owner, provider: userPools, operations: [read, create, update, delete]}
  ]) {
  id: ID!
  firstname: String!
  lastname: String!
  loginemail: String!
  role: Role!
}

enum Role {
  student
  teacher
}
```

I am adding more roles to my application. For example I want to add a `tutor` role. Some teachers will need to have both a `tutor` and a `teacher` role.

I need to update my schema to look like:
```
type Person
  @model
  @auth(rules: [
    {allow: owner, provider: userPools, operations: [read, create, update, delete]}
  ]) {
  id: ID!
  firstname: String!
  lastname: String!
  loginemail: String!
  role: [Role]
}

enum Role {
  student
  teacher
  tutor
}
```

I just tried updating my schema in a dev environment. This makes all current users have a `null` role. I cannot accidentally make a push like this in prod. 

How do I change this part of my schema without overwriting the current data I have?
## Comment

---------------

Author: @r0zar

You may want to take a look at https://github.com/aws-amplify/amplify-cli/issues/1407, it's related to your question about migrating data with amplify.

---------------

---------------

# Specify current environment in customer resolver

---------------

Author: @Somtozech
Upvotes: 1
Comments: 1

I am writing for a custom resolver for my Mutations. The custom resolver does a batch write for my POST schema.  The customer resolver requires me to specify the table name for dynamo DB. 
The issue is that am using a multi-environment setup that has a dev and master. The current environment gets appended to the name of the table eg for dev the table name becomes Post-dev while for the master it becomes Post-master.
So whenever I switch to the master I have to change the table name to reference that of the master environment. And also have to do the same for dev.

Is there any way I can make the table name dynamic to reference the correct table name for the current environment without having to edit the custom resolver?
## Comment

---------------

Author: @Somtozech

Sample code
## DEV ENVIRONMENT 
```
#set($postsdata = [])
#foreach($item in ${ctx.args.posts})
    $util.qr($postsdata.add($util.dynamodb.toMapValues($item)))
#end

{
    "version" : "2018-05-29",
    "operation" : "BatchPutItem",
    "tables" : {
        "Posts-dev": $utils.toJson($postsdata)
    }
}
```

## MASTER ENVIRONMENT
```
#set($postsdata = [])
#foreach($item in ${ctx.args.posts})
    $util.qr($postsdata.add($util.dynamodb.toMapValues($item)))
#end

{
    "version" : "2018-05-29",
    "operation" : "BatchPutItem",
    "tables" : {
        "Posts-master": $utils.toJson($postsdata)
    }
}
```

---------------

---------------

# Is Identity Pool Required when using Cognito HostedUI to front single page app (serverless)

---------------

Author: @iceback
Upvotes: 1
Comments: 0

I'm having a hard time getting from id/access/refresh tokens supplied by cognito to authenticating for serverless app.  Cannot construct Auth.CognitoUserSession(), Auth.currentAuthenticatedUser() blows up.  I seem to be finding only examples which use Identity Pools

---------------

---------------

# No scroll on AmplifySignUp - AmplifySignIn

---------------

Author: @4rocky4
Upvotes: 1
Comments: 0

Hello,
How can I activate a scroll on AmplifySignUp or AmplifySignIn ?
I wrapped my application with AmplifyAuthenticator but when I reduce the page (or display it on my mobile), there is no scroll so it's not possible to access to the bottom of the component.

![NoScroll](https://user-images.githubusercontent.com/34491737/87933474-99ef0780-ca8d-11ea-9269-176c0ac2c28e.jpg)

Thanks for your help.

---------------

---------------

# graphql has changes but no changes detected when amplify push command run.

---------------

Author: @ajitgoel
Upvotes: 1
Comments: 0

I have made changes to my application's schema.graphql file and when i run the amplify push command, the system says "no changes detected". What could I be missing?

---------------

---------------

# Auth related questions

---------------

Author: @gtb104
Upvotes: 1
Comments: 0

I'm rolling my own login UI so that we can do a little extra, and also get the styling to look exactly like UX would like. I've come across two issues so far that have me stumped

1) I see that you can use `Auth.setPreferredMFA()` to set the desired MFA, but what can I use to get the list of available MFA for the user pool? The `Auth.getMFAOptions()` function is deprecated. What else do I use, or where else can I get it?

2) If I've set a password recipe on my Cognito user pool, how can I get that recipe so that I can use it when a user has forgotten their password, or is setting their initial password? I see there's a `/user/describePasswordRules` endpoint, but you need to be logged in to use that. Is there an `Auth` function that I'm not seeing?

---------------

---------------

# Correct way to re-init project

---------------

Author: @ajitgoel
Upvotes: 1
Comments: 1

I have a working application that I am unable to publish as the profile that I used to create the application is no longer valid(I had checked the secret key into github by mistake). In this scenario what is the correct way to reinitialize the application so I can publish it to AWS? i have also deleted the application artifacts in the cloud, when I was trying to fix the issue. 
## Comment

---------------

Author: @ajitgoel

I was able to get this working by getting the latest source code from git, running npm install, amplify init=>creating a new environment, amplify publish.

---------------

---------------

# How to calculate userContextData for Dart implementation

---------------

Author: @danielblignaut
Upvotes: 1
Comments: 0

Hi, 

I'm currently working on a Dart implementation of Cognito and then AWS Amplify however I notice that there's no documentation around the UserContextData.EncodedData calculation and appears to be closed source.

Is this for security through obscurity reasons and I should never expect assistance on this? Or is there someone who can help me out here to help the rest of the community!

Best,
Daniel

---------------

---------------

# Verifying phone number (username) after updating attribute

---------------

Author: @andrewdavidcostello
Upvotes: 1
Comments: 1

Title could be a bit misleading so apologies. The phone_number field is being used as the username and it needs to be allowed to be updated from an account page. A manual process is being used to manage the auth state.

The flow is like this:

1. Call `Auth.updateUserAttributes(user, { phone_number })`
2. Phone number is updated and user is updated in state (username does not update but the attributes do) which is fine
3. The `phone_number` field is now no longer verified
4. A form loads so the user can verify the phone number
5. The user decides not to verify the phone number and proceeds to logout
6. Now when they enter their phone_number they are sent a login confirmation code which is correct. However now the user no longer has a verified phone number. At this point they are currently being sent yet another code via text and asked to verify again, even though they have been allowed to login...

So there are a couple of questions here:

1. Should a user that is required to have a verified phone number be allowed to login with an unverified one after update?
2. If they are shouldn't it automatically become verified after logging in? (As the only alternative to a bad UX is to leave it unverified?)

Hope that makes sense and appreciate any thoughts and pointers.
## Comment

---------------

Author: @andrewdavidcostello

Based on finding some comments elsewhere it seems like this requires a Pre Authentication Lambda setting up to deal with this scenario and the normal login one updating to ensure unverified numbers are not allowed.

---------------

---------------

# How to save array values in DataStore.save

---------------

Author: @dyson-yamashita
Upvotes: 1
Comments: 1

Dear AWS Amplify team,

I am currently trying to save using Amplify DataStore with Vue.js.

- @aws-amplify/datastore: 2.2.4
- @aws-amplify/core: 3.4.0

I try to update item has editors field(this is array field) by below code:

```
save: async function (data) {
  const item = data.item
   await DataStore.save(Item.copyOf(this.item, (updated) => {
     updated.value = item.value
}))
```
The editors field is not updated, but editor field values are increased after saving.

[Before]
<img width="664" alt="スクリーンショット 2020-07-05 9 58 39" src="https://user-images.githubusercontent.com/4074527/86523346-2c948180-bea6-11ea-9d1b-457cd97b4773.png">

[After]
<img width="672" alt="スクリーンショット 2020-07-05 9 58 59" src="https://user-images.githubusercontent.com/4074527/86523349-2ef6db80-bea6-11ea-83f2-6eb80abd73f1.png">

Could you tell me how to save avoid increasing values of not updated field?

Regards,
Dyson
## Comment

---------------

Author: @dyson-yamashita

This problem was resolved in below versions
- @aws-amplify/datastore: 2.2.6
- @aws-amplify/core: 3.4.2

Thank you!

---------------

---------------

# unauth Storage.get

---------------

Author: @kldeb
Upvotes: 1
Comments: 0

I have two front end applications using the same amplify backend. I'm using storage to manage images. 

one front end can put and the other can only read. So i create the image public like so: 

```js
      const imageResult = await Storage.put(imageName, blob, {
        contentType: 'image/png',
        level: 'public',
      });
```


Then in the other app I'm trying to use Storage.get but it complains that there is no current user. I tried adding auth and getting a current unauth user but that's not working either. Does anyone have an example of how to do this?   

---------------

---------------

# ACID Transactions with AppSync

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 0

I have encountered a race condition in my app and I'm wondering if anyone in the community has come up with a way to solve similar issues. In my app I have events for which users can sign up. Each event has a capacity, or a maximum number of people who can sign up for it. A race condition occurs when multiple users sign up at the same time because they may encroach the capacity. In other words, I need an all-or-nothing transaction. I stumbled upon some documentation regarding [transactions with dynamodb](https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/transaction-example.html#transaction-example-Additional), but I'm wondering if anyone has tried this in the community. So, how have y'all dealt with race conditions in your apps, and if you've implemented transactions, how did you do it?

I can share more details on my schema if need be

---------------

---------------

# onCreate subscriptions won't fire

---------------

Author: @mnatanbrito
Upvotes: 1
Comments: 0

Hi, folks!
I've been struggling with this for some time now, so I could use some help.

I can't get onCreate subscription for type `HealthPlan` working in my react-native app.

Based on [Nader's example](https://github.com/dabit3/conference-app-in-a-box/blob/master/src/Discussion.js), 

__subscriptions.js__
```
export const onCreateHealthPlan = /* GraphQL */ `
  subscription OnCreateHealthPlan($owner: String!) {
    onCreateHealthPlan(owner: $owner) {
      id
      name
      type
      owner
    }
  }
`;
```

__Main.js__

```
import { API, graphqlOperation } from 'aws-amplify';
import { onCreateHealthPlan } from './subscriptions.js';

const sub = "cognitoSubField";   // AMAZON_COGNITO_USER_POOLS auth

API.graphql(
          graphqlOperation(onCreateHealthPlan, {
            owner: sub,
          }),
        ).subscribe({
          next: response => {
            console.log('next data received', response);
          },
          error: err => {
            console.log('subscription error', err.message);
          },
          complete: () => {
            console.log('finished');
          },
})
```

__Subscription.onCreateHealthPlan.req.vtl__
```
{
    "version": "2018-05-29",
    "payload": {}
}
````

__Subscription.onCreateHealthPlan.res.vtl__
```
## [Start] Determine request authentication mode **
#if( $util.isNullOrEmpty($authMode) && !$util.isNull($ctx.identity) && !$util.isNull($ctx.identity.sub) && !$util.isNull($ctx.identity.issuer) && !$util.isNull($ctx.identity.username) && !$util.isNull($ctx.identity.claims) && !$util.isNull($ctx.identity.sourceIp) && !$util.isNull($ctx.identity.defaultAuthStrategy) )
  #set( $authMode = "userPools" )
#end
## [End] Determine request authentication mode **
## [Start] Check authMode and execute owner/group checks **
#if( $authMode == "userPools" )
  ## No Static Group Authorization Rules **


  ## [Start] Owner Authorization Checks **
  #set( $isOwnerAuthorized = false )
  ## Authorization rule: { allow: owner, ownerField: "owner", identityClaim: "cognito:username" } **
  #set( $allowedOwners0 = $util.defaultIfNull($ctx.args.owner, null) )
  #set( $identityValue = $util.defaultIfNull($ctx.identity.claims.get("username"),
                        $util.defaultIfNull($ctx.identity.claims.get("cognito:username"), "___xamznone____")) )
  #if( $util.isList($allowedOwners0) )
    #foreach( $allowedOwner in $allowedOwners0 )
      #if( $allowedOwner == $identityValue )
        #set( $isOwnerAuthorized = true )
      #end
    #end
  #end
  #if( $util.isString($allowedOwners0) )
    #if( $allowedOwners0 == $identityValue )
      #set( $isOwnerAuthorized = true )
    #end
  #end
  ## [End] Owner Authorization Checks **


  ## [Start] Throw if unauthorized **
  #if( !($isStaticGroupAuthorized == true || $isOwnerAuthorized == true) )
    $util.unauthorized()
  #end
  ## [End] Throw if unauthorized **
#end
## [End] Check authMode and execute owner/group checks **

$util.toJson(null)
````

Every time the code runs, I get:

`subscription error`

logged to the console.

Analyzing the console output, I found the following info:

```
LOG  [DEBUG] 39:51.456 AWSAppSyncRealTimeProvider - subscription message from AWS AppSyncRealTime: {"type":"connection_ack","payload":{"connectionTimeoutMs":300000}}
LOG  [DEBUG] 39:51.457 AWSAppSyncRealTimeProvider - Notifying connection successful
LOG  [DEBUG] 39:51.459 AWSAppSyncRealTimeProvider - subscription message from AWS AppSync RealTime: {"type":"ka"}
LOG  [DEBUG] 39:51.459 AWSAppSyncRealTimeProvider {"id": "", "observer": null, "query": "", "variables": {}}
LOG  [DEBUG] 39:51.620 AWSAppSyncRealTimeProvider - subscription message from AWS AppSync RealTime: {"id":"9f72da89-0d1d-4aa8-8457-78bb1832478b","type":"error","payload":{"errors":[{"errorType":"MappingTemplate","message":"Value for field '$[operation]' not found."}]}}
LOG  [DEBUG] 39:51.620 AWSAppSyncRealTimeProvider {"id": "guid", "observer": {"_subscription": {"_cleanup": [Function anonymous], "_observer": [Object], "_queue": undefined, "_state": "ready"}}, "query": "subscription OnCreateHealthPlan($owner: String!) {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    onCreateHealthPlan(owner: $owner) {
        id
        name
        type
        owner                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     }", "variables": {"owner": "cognitoSubField"}}
LOG  [DEBUG] 39:51.622 AWSAppSyncRealTimeProvider - Error while unsubscribing Error: Subscription never connected
LOG  [DEBUG] 39:52.624 AWSAppSyncRealTimeProvider - closing WebSocket...
```

It seems that this is the real error:
`Value for field '$[operation]' not found`

Any ideas of why this is happening? 😰 

---------------

---------------

# Access multiple @model resources in lambda trigger

---------------

Author: @ionutmiftode
Upvotes: 1
Comments: 1

Hello,

![Selection_024](https://user-images.githubusercontent.com/6890762/86971276-8c767b00-c179-11ea-87b6-76f8909b60ef.png)

I have a lambda that gets trigger when a graphql `@model` gets modified.
What I want to do is to connect on other `@model`'s (dynamoDB tables) to have all the data that I need in the lambda trigger.

How I can do that? do I have to use a graphql client to make a api call to API_VEHICOOL_GRAPHQLAPIIDOUTPUT?

Any response will be very appreciated!
## Comment

---------------

Author: @ionutmiftode

it seems it was a basic `dynamoDB.query()` to API_VEHICOOL_COOLERTABLE_NAME

---------------

---------------

# Cognito and IAM 401 or not called.

---------------

Author: @Rafcin
Upvotes: 1
Comments: 2

The issue is I have created a schema that utilizes cognito groups and IAM. I wanted to use IAM for general read access and cognito to allow specific users to perform action such as creating posts etc.
 
My current model uses the following auth.
```
@auth(
  rules: 
    [
      { allow: owner }
      { allow: public, provider: iam, operations: [read] }
      { allow: private }
      { allow: groups, groups: ["User"], operations: [read] }
      { allow: groups, groups: ["RestaurantUser"] }
      { allow: groups, groups: ["Admin"] }
    ]
)
```

The problem I run into is, I can't user Cognito and IAM. If try to set the authmode by doing 
``` Auth.currentAuthenticatedUser ? "COGNITO..." : "IAM..."```

Even if it uses IAM it won't use IAM when its unauthenticated. Normally when using IAM it doesn't allow the authed user to makes calls, however the unauthed can. And the same is if you use cognito then authed users work and unauthed don't.

The one thing I noticed was if the user isn't in one of the 3 groups then the calls seem to work fine. I originally had read, write etc and the same issue persisted "Permission Denied" 
## Comment

---------------

Author: @Rafcin

It seems this issue is actually the result of guest credentials not generating for guest users. I looked at a few of my project and they all log credentials for guest users except for this project even though I have the unauthorized credentials active in cognito.
## Comment

---------------

Author: @mauerbac

HI @Rafcin - I'm going to move this to our discussion form as it seems you need help with the graphQL schema and are not reporting a bug. 

---------------

---------------

# User can access the app after disabled the user by admin in cognito (using aws-amplify-react-native)

---------------

Author: @nihp
Upvotes: 1
Comments: 1

I have disabled a user in cognito. But the user is already in the app. Here he not received any error and also it will allow him to use the app.

How can I make the user to out of the app immediately after the disable action in cognito?

## Comment

---------------

Author: @mauerbac

Hi @nihp - this sounds more like a question rather than a bug report. Can you provide more information? What is the error? 

---------------

---------------

# Social Provider Bypassing hosted UI with federatedsignin

---------------

Author: @ruodingt
Upvotes: 1
Comments: 0

# Use Case
We are using appsync with auth method CognitoUserPool.

Previously our our team has been using normal `Auth.signIn()`.

With Auth.signIn, the amplify SDK could automatically pickup the user pool user info and identity pool credential.

We don't want to use hosted UI since it will destroy our existing UI/UX flow.

# We tried
We were expecting that `Auth.federatedSignin()` would have very similar behaviour such that the SDK could automatically pickup the user pool user info and identity pool credential.

We tried two approaches:

1. Using Facebook SDK and federatedSignIn 
```
 this.amplify.auth().federatedSignIn('Facebook', facebookResponse, federatedUser)
```
Outcome: No User created in the User Pool, but got currentuserinfo and currentuserCredentials
(No user in user pool but got identities in identity)

 2. Facebook SDK and federatedSignIn with provider 
```
 this.amplify.auth().federatedSignIn({provider: 'Facebook'}, facebookResponse, federatedUser)
```
 Outcome: new user was created in the user pool, but no access to currentuserinfo and currentuserCredentials.

I see that there are 3 different implementations in the [doc](https://aws-amplify.github.io/amplify-js/api/classes/authclass.html#currentuserpooluser)

But I didn't expect that they lead to different behaviours. In fact, we are expecting that `auth().federatedSignIn` could behave like `Auth.signIn()`, in which there will be a user exist in a user pool and the Amplify SDK could pick up those user pool user info and identity pool credential



---------------

---------------

# How to use DataStore before and after authentication?

---------------

Author: @maciulskis
Upvotes: 2
Comments: 0

Hello. I'm trying implement an offline-first react native application using DataStore. Say we have auth setup through Cognito user pool and this basic schema:
```
type Record @model @auth(rules: [{allow: owner}]) {
  id: ID!
	number: Int!
	owner: String
}
```
Is it possible to implement a workflow, where a user could use the app without signing up or logging in, completely offline, performing CRUD operations, where data is persisted in DataStore? Later on, if he decides to sign up or log in, local and remote data should sync. Main issues I'm having right now are:
1. If the user is not authenticated, created records are persisted in DataStore, but after authenticating, local data does not sync with remote. Application has to be completely restarted for sync to work.
2. Creating a record while logged in, then logging out (or when the access token expires) and creating a record again causes an infinite loop in Amplify's lib, the APIClass.graphql function is being called over and over again with a mutation operation to create the record, thus freezing the UI.
3. Performing a DataStore operation while user is not authenticated results in an unhandled promise rejections originating from Amplify Auth module.

Here's a repo with the setup to reproduce described behaviour https://github.com/maciulskis/rn-datastore-example

Amplify CLI version 4.21.3

---------------

---------------

# total count of appsync serverless using aurora

---------------

Author: @stayingcool
Upvotes: 1
Comments: 0

Hello All,

How can we get the total count of a type using appsync serverless (using aurora)? This is something I see in [Hasura called as Aggregate of results ](https://hasura.io/docs/1.0/graphql/manual/queries/pagination.html#fetch-limited-results-along-with-data-aggregated-over-all-results-e-g-total-count-in-the-same-query)?

---------------

---------------

# Amplify Deploy Stuck - React App With Yarn

---------------

Author: @Zebara58
Upvotes: 1
Comments: 1

I'm using yarn to setup the dependencies. I got the react amplify website to launch properly on local and I got the amplify authorization to work properly on localhost. I'm currently using the free tier. I am just trying to test deploying the app with Amplify now. I have the following code in the build settings in Amplify:
`version: 1`
`backend:`
 ` phases:`
`    build:`
`      commands:`
`        - cd yarn-created-react-app-directory-name-here`
`        # amplifyPush to create the aws-exports.js file`
`        - amplifyPush --simple`
`frontend:`
`  phases:`
`    # IMPORTANT - Please verify your build commands`
`    preBuild:`
`      commands:`
`        - yarn install`
`    build:`
`      commands:`
`        - yarn run build`
`  artifacts:`
`    # IMPORTANT - Please verify your build output directory`
`    baseDirectory: ./`
`    files:`
`      - '**/*'`
`  cache:`
`    paths: []`


The build keeps gets stuck in the Deploy phase after about 40k "Uploading" / "Skipping" messages.
## Comment

---------------

Author: @sammartinez

@Zebara58 This issue seems related to [Amplify Console](https://github.com/aws-amplify/amplify-console) I would highly recommend to reach out to them. cc @brene for visibility  

---------------

---------------

# DynamoDB.scan Problem

---------------

Author: @kimuhjin
Upvotes: 1
Comments: 1

I Tried this code:

app.get('/<YOUR_PATH>', function (req, res) {
var params = {
TableName: tableName,
Select: 'ALL_ATTRIBUTES',
};
dynamodb.scan(params, (err, data) => {
if (err) {
res.json({ error: 'Could not load items: ' + err.message });
}
res.json({
data: data.Items.map(item => {
return item;
})
});
});
});

but data returned not in ordered.
is there have any solution to solve this problem?
## Comment

---------------

Author: @adrian-hc

It sounds like you should try the "query" api instead of "scan". See [this](https://stackoverflow.com/a/21815354)

---------------

---------------

# Single-Sign-On (SSO) via amplify auth

---------------

Author: @davidgengenbach
Upvotes: 1
Comments: 0

Goal:
1) Login user on custom UI via Amplify Auth (with MFA)
2) After successful login which sets the `IdToken`, `AccessToken`, ... => I want to redirect to another application(**different domain**)  where the user should also be authenticated 

Step 1 is no problem - works fine. I get the `Access Token`, can change any attribute and everything is fine - **within this application**.

Step 2 is a problem. I am not sure whether the `AccessToken` and `IdToken` are safe to be passed to another application.
I think this flow is called `Implicit grant` and not encouraged?

Hints or help would be greatly appreciated!


Related: https://aws.amazon.com/blogs/mobile/understanding-amazon-cognito-user-pool-oauth-2-0-grants/

---------------

---------------

# Design help to create a Multi Tenant Table using the Primary Key + Sort Key in DataStore

---------------

Author: @marianolc
Upvotes: 1
Comments: 0

For example, using a Table that containts all the orders created for that User, something like this:

```
type Order @model @auth(rules: [{allow:owner}])
{
  id: ID!
  owner: String
  total: Float
  qty: Float
  subtotal: Float
  tax: Float
  status: String
  createdAt: String!
  canceledAt: String
  completedAt: String
  customerId: ID
  customerName: String
  customerAddress: String
}
```

So, If i wanted to change it to use the multi tenant design and Using PK+ST to be better optimized should I change it for something like this?

```
type Order @model @auth(rules: [{allow:owner}]) @key(fields: ["owner", "id"])
{
  id: ID!
  owner: String
  total: Float
  qty: Float
  subtotal: Float
  tax: Float
  status: String
  createdAt: String!
  canceledAt: String
  completedAt: String
  customerId: ID
  customerName: String
}
```

**Should the Owner by the Partition Key ? and the Id/number the Sort key?**

Thanks!

---------------

---------------

# [Cloudfront with Amplify Storage] How to build an album application by serving photos through CloudFront?

---------------

Author: @syang
Upvotes: 8
Comments: 0

I am building an application using Amplify Storage, so that a signed-in user can upload his photos to S3 (in his own `protected` subfolder) and any users can view his photos.

I think this session in the Amplify Storage document shows the solution https://docs.amplify.aws/lib/storage/getting-started/q/platform/js#using-amazon-s3, but the photo viewing logic shown in the doc is about directly accessing S3, which is probably not performant.

I wonder if I can have my application read the photos through CloudFront instead of through S3 directly. Here are two concrete questions I have:

- Is it possible to use Amplify Storage Js lib to access the CloudFront endpoint as mentioned above?

- If not possible, is it possible to upload the S3 object using Amplify Storage JS lib and use AWS-SDK to access Cloudfront? (I guess it's theoretically possible, but I guess there must be a lot of hassle for me to find the right URL of the photos that I wanted to read, plug the hassle of setting up CloudFront/S3 connection through Cloudformation)

Looks like my problem is quite similar with a discussion in Amplify-Cli repo https://github.com/aws-amplify/amplify-cli/issues/1910 and I am not sure if we can do better (simpler) than what @ehtulhaq suggested.

Thank for sharing your thoughts.

---------------

---------------

# Getting Access Keys for third-party OIDC provider

---------------

Author: @mbarinov
Upvotes: 1
Comments: 0

Hi lads, the second day I can not understand how to obtain an access key for OIDC provider (twitch). Auth is working great, CognitoUser entity is available on the client-side. Maybe anybody faced such a problem before. Peace ✌️

---------------

---------------

# Why typescript codegen doesn't generates the graphql types ?

---------------

Author: @maximelebastard
Upvotes: 1
Comments: 0

Hello, in Typescript is there any reason why the graphql types are not generated in API.ts ? That would be super useful to detect regressions.

For example, let's say I have this schema.graphql
```graphql
type Todo @model {
  id: ID!
  name: String!
  description: String
}
```

I'd love to get that type generated into my API.ts
```typescript
type Todo = {
  id: string,
  name: string,
  description?: string|null
}
```

---------------

---------------

# How to add a description to a UserGroup using amplify auth update

---------------

Author: @brandonvilla21
Upvotes: 1
Comments: 0

I'm creating my user groups from `amplify auth update` command. But now I want to add the description property for each group in order to be displayed in the AWS Cognito Dashboard:

<img width="978" alt="image" src="https://user-images.githubusercontent.com/20288447/86321373-7bb88900-bbfe-11ea-9fb5-9f66b0d624a8.png">

The problem is, when I add the description in the `template.json` and then I do `amplify push` this gets removed automatically:
<img width="778" alt="image" src="https://user-images.githubusercontent.com/20288447/86321451-9f7bcf00-bbfe-11ea-9423-5b929a3f85e3.png">

How can I add and persist the description property then?

---------------

---------------

# How to take cognito user session from amazon-cognito-identity-js and have it be managed by Amplify?

---------------

Author: @sreimer15
Upvotes: 1
Comments: 0

Hi, 

I have created a separate app that handles authentication hosted on a web server, essentially a url where a user can authenticate through amplify. I have a web app that uses that seperate app for authentication and is redirected back to the web app with a set of cognito tokens, that set of cognito tokens is then used to create a session on the backend and is used as needed.

I am now creating a react-native app, and want to use a similar flow (authentication through separate app, a redirect back into my native app), I can instantiate a session through amazon-cognito-identity-js, but I want to somehow pass that session into Amplify in order to have the amplify package manage the life cycle of the session.

There are many features within amplify that I want to use for the react native app, like aws pinpoint, but I do not want to reimplement my auth flow logic within my native app. Is there a way to take the id/access/refreshToken I am receiving through my redirect_url and to instantiate a session in aws amplify with it?


Thank you for any help you can be!

---------------

---------------

# Creating an already existent record with @key(fields: ["someID"]) does not raise error. Is it expected?

---------------

Author: @PedroBern
Upvotes: 1
Comments: 0

Is it expected to not raising an error when creating a duplicate record when the hash key field is not id? Note that the second attempt to create the `Todo2` did not create a new record, but also did not return an error. See the following code.

I have the following schema:

```graphql
type Todo1 @model {
  id: ID!
  name: String
}

type Todo2 @model @key(fields: ["someID"]){
  someID: ID!
  name: String
}
```

Running:

```graphql
# First run
mutation createTodo1 {
  createTodo1(input: {id: "my-id", name: "name"}) {
    id
  }
}

# OK

# Second run
mutation createTodo1 {
  createTodo1(input: {id: "my-id", name: "name"}) {
    id
  }
}

# "errorType": "DynamoDB:ConditionalCheckFailedException"
```
 But, running:

```graphql
# First run
mutation createTodo2 {
  createTodo2(input: {id: "my-id", name: "name"}) {
    id
  }
}

# OK

# Second run
mutation createTodo2 {
  createTodo2(input: {id: "my-id", name: "name"}) {
    id
  }
}

# OK again! Is it expected?
```

---------------

---------------

# update lambda function on backend not updating frontend

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

hi
am using storage in a Vue app. i created a lambda trigger (triggered when upload file to S3) and then updated the lambda function in the backend. if i upload file, it works. 

problem is that the changes i made to the function are not updated in the frontend (function's index.js file). (i ran amplify pull --appId d73ox8pnts8im --envName dev) but it indicates | Function | S3Trigger2d214614 | No Change | awscloudformation |

now if i update the local function index.js and run amplify push, it overwrites the changes made to the function in the backend!

does this mean that i may only make changes to the functions local index.js file?

what about user, role, bucket policies? are the changes i make on the backend valid? will they be overwritten next time i run amplify push?

appreciate any clarity on this 
thanks

---------------

---------------

# Amplify Auth with Cognito in Multiple Env's

---------------

Author: @siddharthsharma94
Upvotes: 1
Comments: 0

Hey! So I was wondering what would be the recommended approach to building an AWS Amplify React project with Auth in multiple environments.

Let's say I want to have a Dev and Prod Env which is based on the Git env. Let's also say I want to be able to deploy feature branches. I have a Federated Oauth integration with Google and Fb and the redirect URL is my main URL. How would I build my app to allow multiple env auth? I'm not sure how to approach this since I want people on my team to be able to test out stuff in the Dev and Feature branch Env's.

---------------

---------------

# How to manage DataStore Sync when the is no support for IndexedDB?

---------------

Author: @naripok
Upvotes: 1
Comments: 0

Is there a way to bypass local storage and translate DataStore saves directly into GraphQL mutations whenever there is no support  for IndexedDB, like in Tor browser (or firefox private mode)?
Do I need to do the support detection and implement alternative calls on graphQL by hand?

---------------

---------------

# Is this possible to DataStore.query not @model type?

---------------

Author: @sakhmedbayev
Upvotes: 1
Comments: 0

I have a graphql schema as follow:

```
type Chapter { # notice not @model type
  id: ID!
  bookCode: String!
  chapterNumber: String!
  content: AWSJSON!
}

type Query {
  getChapter(
    projectId: ID!
    bookCode: String!
    chapterNumber: String!
  ): Chapter
}
```

Is this possible to query `Chapter` using `DataStore.query`?

```
 const chapterNet = await DataStore.query(Chapter, (c) =>
        c.bookCode("eq", `${bookCode} `).chapterNumber("eq", chapterNumber)
      );
```

---------------

---------------

# AUTH - Switch between groups

---------------

Author: @yudao
Upvotes: 1
Comments: 0

Hi,

I'm using different groups which each one get his own IAM policy (attached to a specific IAM role).

I need to implements a"switch" between the groups associated to the user. He could switch between his ADMIN role to an EDITOR role, etc.

How can I switch between his groups without asking to re-authenticate him?

I'm using only one Cognito User Pool and the standard authorizer.

Thx for your help.

Yu.

---------------

---------------

# API.get is not working and returns  "<apiname> does not exist"

---------------

Author: @Dylan-Carriere
Upvotes: 1
Comments: 0

Hello, I am having an issue about my API.get function.
It always retrun <apiname> does not exist while the api name is specified in may aws-exports.js file.
I do not know where the issue came from, here is my code to invoke the API : 

```
const apiName = "testtrigger";
    const path = "/test"; 
    const myInit = {
        headers: {}, 
        response: true, 
    };
    API
      .get(apiName, path, myInit)
      .then(response => {
        console.log(response);
      })
      .catch(error => {
        console.log(error);
    });
```

And the content of my aws-exports.js file for the api endpoint is : 

`
"aws_cloud_logic_custom": [
        {
            "name": "testtrigger",
            "endpoint": "<apiUrl>",
            "region": "eu-west-1"
        }
    ],
`

This is the error that I get `API testtrigger does not exist`

I hope you guys can help me !

---------------

---------------

# Post signup hook for Cognito

---------------

Author: @MatteoInfi
Upvotes: 1
Comments: 0

Is there an hook for PostSignup? I need to get the userId, but in the pre-signup is not possible.

Thanks

---------------

---------------

# aws-congito forgot password verification SerializationException error

---------------

Author: @ayaankhan98
Upvotes: 0
Comments: 0

i was implementing the forgot password feature using angular9 and aws-amplify. After successful sending of verification code on user's email i have a route where the user enters this verification code along with the username and new password, in this route i am using 
```Auth.forgotPasswordSubmit(username, code, newPassword)``` 
if i define the verification code field as input type of number in the componet.html file i get this error
```
forgot-password-verification.component.ts:29 
{code: "SerializationException", name: "SerializationException", message: "class com.amazon.coral.value.json.numbers.TruncatingBigNumber can not be converted to an String"}
```
but if i change the verification field code as input type of text everything works fine, i am thinking that if we are getting the numeric verification code always from cognito then why can't i use numbers instead of text input

---------------

---------------

# Created after Premium Support call: Jest test will not signIn after a signOut

---------------

Author: @JohnAtFenestra
Upvotes: 1
Comments: 0

I am writing a set of end-to-end Jest tests to develop our authentication code. I have been fighting basic signIn for two days. Here is the latest problem scenario.

1. Create a user
2. SignIn
3. Respond to NEW_PASSWORD_REQUIRED challenge
4. SignOut
5. SignIn using new credentials

Blows up on step 5

My code

```javascript
  it('should create a new user', async () => {
    const newUser = {
      username: 'lisasimpson',
      temporaryPassword: ******,
      newPassword: ******,
      name: 'Lisa Simpson',
      email: 'john.elrick@gmail.com',
      messageAction: 'SUPPRESS',
    }

    try {
      const createdUser = await cognitoService.createUser(newUser)
      expect(createdUser.User.Username).toEqual(newUser.username)
      expect(createdUser.User.UserStatus).toEqual('FORCE_CHANGE_PASSWORD')
      let user
      user = await Auth.signIn(newUser.username, newUser.temporaryPassword)
      expect(user.challengeName).toEqual('NEW_PASSWORD_REQUIRED')
      console.log('starting complete')
      if (user.challengeName === 'NEW_PASSWORD_REQUIRED') {
        await Auth.completeNewPassword(user, newUser.temporaryPassword, {})
        await Auth.changePassword(
          user,
          newUser.temporaryPassword,
          newUser.newPassword
        )
      }
      console.log('complete done')
      await Auth.signOut()
      user = null

      console.log('Re Signin')
      user = await Auth.signIn(newUser.username, newUser.newPassword) // BLOWS UP HERE!!!
      console.log(user)

      const session = await Auth.currentSession()
      console.log(session.getIdToken().getJwtToken())
      await cognitoService.deleteUser(newUser.username)
    } catch (error) {
      console.log('ERROR')
      console.log(error)
      console.log(error.stack)
      fail(error)
    }
  })

```

```bash
john@john-onlogic:~/Documents/fenestra/naep/2021/DigitalFolders/cognito-sandbox$ jest
  console.log
    starting complete

      at Object.<anonymous> (test/hello.spec.js:55:15)

  console.log
    complete done

      at Object.<anonymous> (test/hello.spec.js:64:15)

  console.log
    Re Signin

      at Object.<anonymous> (test/hello.spec.js:68:15)

 FAIL  test/hello.spec.js (5.573 s)
  hello world
    ✓ should detect existing user (254 ms)
    ✓ should detect user does not exist (173 ms)
    ✕ should create a new user (3312 ms)

  ● hello world › should create a new user

    NotAuthorizedException: Incorrect username or password.

      36 |   })
      37 | 
    > 38 |   it('should create a new user', async () => {
         |   ^
      39 |     const newUser = {
      40 |       username: 'lisasimpson',
      41 |       temporaryPassword: 'Naep$2020',

      at new Spec (../../../../../../.nvm/versions/node/v12.16.3/lib/node_modules/jest-cli/node_modules/jest-jasmine2/build/jasmine/Spec.js:116:22)
      at Suite.<anonymous> (test/hello.spec.js:38:3)
      at Object.<anonymous> (test/hello.spec.js:25:1)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 2 passed, 3 total
Snapshots:   0 total
Time:        6.081 s
Ran all test suites.
  console.log
    ERROR

      at Object.<anonymous> (test/hello.spec.js:76:15)

  console.log
    {
      code: 'NotAuthorizedException',
      name: 'NotAuthorizedException',
      message: 'Incorrect username or password.'
    }

      at Object.<anonymous> (test/hello.spec.js:77:15)

  console.log
    undefined

      at Object.<anonymous> (test/hello.spec.js:78:15)

```

I have confirmed using HostedUI that the user can log in with the new password. I have spent over an hour with Premium Support trying to troubleshoot the problem. Any suggestions as to what I may be missing?

---------------

---------------

# How to globally sign out a user on "forgot password"

---------------

Author: @leosoaivan
Upvotes: 3
Comments: 0

I have a use case where I would like to globally sign-out a user from all devices/clients if a user changes their password through the "forgot password" flow. Presumably, this wouldn't be an issue if a user were to "change password", as I could assume a user is already authenticated and thus call `Auth.signOut({ global: true })`.

It doesn't appear that the [ForgotPassword](https://github.com/aws-amplify/amplify-js/blob/main/packages/aws-amplify-react/src/Auth/ForgotPassword.tsx) component from aws-amplify-react does this. Opening a browser and logging in, and opening another browser and confirming a new password doesn't invalidate the session in the first browser.

I've tried hooking into the Cognito UserConfirmation trigger and calling `adminUserGlobalSignOut` based on the trigger source. CloudWatch logs indicate that `adminUserGlobalSignOut` is resolving successfully, but there is no difference client-side. `Auth.currentSession()` and `Auth.currentAuthenticatedUser()` both return without errors.

Interestingly, I see that network calls to https://cognito-idp.us-east-1.amazonaws.com/ are returning with a 400 status and `{"__type":"NotAuthorizedException","message":"Access Token has been revoked"}`, but I am unsure how I would hook into that.

I am wondering if anyone else has come across this issue, or have a work-around.

---------------

---------------

# Headless CLI -- Auth question Do you want to configure Lambda Triggers for Cognito

---------------

Author: @abdsahin
Upvotes: 1
Comments: 0

Hi All,

Lately whenever I do an "amplify init", the CLI is asking the following question

```bash
? Do you want to configure Lambda Triggers for Cognito? (Y/n)
```

Is there anyway to say No default to this question? I looked at the [headless CLI page](https://docs.amplify.aws/cli/usage/headless) and [examples](https://github.com/aws-amplify/amplify-cli/blob/master/packages/amplify-cli/sample-headless-scripts/headless_init_env.sh) but couldn't find an example for Cognito configuration.

Thanks

---------------

---------------

# How to create HEAD request URL from URL returned by `Storage.get`?

---------------

Author: @mtakac
Upvotes: 1
Comments: 1

I'd like to check if the resource I uploaded to S3 using `Storage.put` was changed before downloading it. I am trying to use the HEAD request before actually downloading the resource to see if there's a new version since it was last downloaded.

I have the URL of the resource, returned by `Storage.get` call, but I cannot figure out how to modify this URL in a way so that it can be used for HEAD request. If I just try to use the url returned from `Storage.get` for HEAD request, I get 403 as a response.
## Comment

---------------

Author: @sw-yx

may need to presign URLs to get past the auth checks: https://github.com/aws-amplify/amplify-js/blob/main/packages/storage/src/providers/AWSS3Provider.ts#L189-L192

but at a higher level this ("I'd like to check if the resource I uploaded to S3 using Storage.put was changed before downloading it.") could be a feature request. does `Storage.list` not give you the info you need?

---------------

---------------

# Do Amplify generated GraphQL statements work in all cases?

---------------

Author: @kimfucious
Upvotes: 1
Comments: 0

I've been trying to figure out why certain GraphQL mutations aren't working in an app I've got involved in.

Toward that I've created a test project based on  these docs [here](https://docs.amplify.aws/cli/graphql-transformer/dataaccess), using Amplify CLI to add the API.

I've copied the schema (cut and paste), and I've had Amplify CLI build the statements on `amplify push`
```console
? Do you want to update code for your updated GraphQL API Yes
? Do you want to generate GraphQL statements (queries, mutations and subscription) based on your schema types?
This will overwrite your current graphql queries, mutations and subscriptions Yes
```
Using the Warehouse / Employee relationship as an example, if I try to create a Employee (with a warehouseID) with the Amplify generated mutation, an error is thrown in the console:
```console
One or more parameter values were invalid: Type mismatch for Index Key data Expected: S Actual: M IndexName: byWarehouse ...
```
However, if I create separate mutation (different from the generated one), as per the documentation mentioned prior, it works as expected. 

**So my question is**:  Are the generated statements supposed to work in all cases, including the [schema setup in the example](https://gist.github.com/dabit3/e0af16db09b6e206292d1c5cfc0d0a07), or do you sometimes need to create your own statements to get things to work?

If the answer is the latter, it would make sense why the generated statement is not working in this case; but if the answer is the former, I can't for the life of me figure out what to pass as the input to the generated `createEmployee` mutation.

Thanks in advance for any advice here.

---------------

---------------

# event.requestContext.identity.cognitoAuthenticationProvider Format

---------------

Author: @rudijs
Upvotes: 1
Comments: 0

Hi,

I've noticed the string format of `event.requestContext.identity.cognitoAuthenticationProvider`has had two shapes in my AWS serverless lambda 

I'm not sure why that is, can anyone advise?

This is the format I saw and used initially  (sensitive data is obscured):

 `cognito-idp.ap-southeast-1.amazonaws.com/ap-southeast-1_xxxx,cognito-idp.ap-southeast-1.amazonaws.com/ap-southeast-1_aaaa:CognitoSignIn:qqqq-1111-2222-3333-rrrr`

This is what I've seen recently, it's switches back and forth

`cognito-idp.ap-southeast-1.amazonaws.com/ap-southeast-1_xxxx,cognito-idp.ap-southeast-1.amazonaws.com/ap-southeast-1_aaaa:CognitoSignIn:qqqq-1111-2222-3333-rrrr,cognito-identity-aws-account-id:123456789`

Sometimes the string ends with the `cognito-identity-aws-account-id` and sometimes not.

I'm not sure how or why the client javascript sometimes sends `cognito-identity-aws-account-id` and sometimes does not.

My application code extracts the data from the string, I'm expecting it to be consistent or at least understand why the format may differ.

Any tips much appreciated.

Thanks.
  

---------------

---------------

# List files using Auth.list() on objects uploaded via Lambda via AWS.S3

---------------

Author: @kimfucious
Upvotes: 1
Comments: 1

Hi there,

Here's what I'm trying to do and confusing myself in the process.

I have and app that uses a lambda to generate a PDF file and upload it in an S3 bucket.

The bucket is one that I've created using `amplify storage add`.

Because I'm in a lambda, I'm using `AWS.S3`, not Amplify.

It's a somewhat involved process, but the upload part of the lambda looks like this:
```js
const uploadPdfToS3 = (buffer) => {
  return new Promise((resolve, reject) => {
    const uploadParams = {
      ACL: "private",
      Body: buffer,
      Bucket: bucket,
      ContentType: "application/pdf",
      Key: `private/${req.body.id}/forms/${req.body.formId}_form.pdf`
      // `req.body.id` is the cognitoUser username/sub of the user making this request 
    };
    s3.upload(uploadParams, (error, response) => {
      if (error) {
        reject(error);
      }
      resolve(response.key);
    });
  });
};
```
The gist of the above is that I'm **trying** to save the file to a place where an authenticated Cognito user (auth is already setup and working via amplify auth), and only that user, can access it via Amplify in the app using, `Storage`.

To clarify: `req.body.id` is the `username` of the cognitoUser.

Users are created this site allowing emails as usernames, thus creating a (guid) as the username that matches `cognitoUser.attributes.sub`.

Ideally, I'd like to perform a `Storage.list("forms/", {level: "private"})` and get a list of all objects in that folder, but I can't seem to do that.

To be specific, I don't want the content of the `forms` folder, just the `keys`, so that I can know what forms are actually there or not.

What I **can** do is perform individual gets, using `Storage.get("forms/someform.pdf")`.  This will return an URL, with which I can use to retrieve an individual form.

The problem with that approach is that I don't know what forms will be in the `forms` folder at any given time for each user.

I could write a function to get all possible forms (i.e. multiple get requests) that could be in the forms folder and then work from there (filtering blanks and such), but it seems inelegant.

So I post my question here, in hopes that some great mind might have a solution.

Thanks in advance for any constructive advice.

## Comment

---------------

Author: @kimfucious

I figured a few things out here, which I'll share in case someone comes along looking for this in the future.

1.   Amplify `Storage.put()` uses the `identityId`, when saving files to S3.  This is **not** the same as `cognitoUser.attributes.sub`. 
2. You can get this, on the client-side, with `const {id} = await Auth.currentUserInfo();`.
3.  You can then use this as a request parameter in the lambda function to put files (via AWS.S3) in the same path that Amplify uses on the client side.
4. To get a listing of the users private files, from the client, you can run:
 ```js
const forms = await Storage.list("", { level: "private" });
```  
This will return an array with the keys (plus additional info) of all the user's private files.

The confusing bit for me here was the `""`, as I was trying everything but that.  `"/"` doesn't work here.

---------------

---------------

# How to create product id that is serial with datastore? like 0001, 0002

---------------

Author: @apoorvmote
Upvotes: 1
Comments: 1

The actual product (or insert any type here) id will be `UUID` but I also want to create additional ID that must be auto generated and must be serial. 

It's for react web app with datastore. 

Does it have to be dynamodb streams with lambda function? Or is there any simpler solution?
## Comment

---------------

Author: @sw-yx

just catching up on this. did you end up figuring it out?

---------------

---------------

# Why does aws-amplify-angular include aws-amplify as a dev dependency?

---------------

Author: @dan-didjatv
Upvotes: 1
Comments: 2

Any reason why this requires me to install the entire amplify stack in my dev environment when aws-amplify-angular doesn't require it production mode. This adds IDE overhead as it tries help me by indexing and caching modules I don't use for search and auto-complete and means I'm adding an unnecessary difference to how the app runs locally when I can easily debug it vs. when built for deployment. Neither issue is earth-shattering but given amplify has been designed to be modular, it seems like could easily be handled in a better way (and it's already listed as a peer dependency with a different version?)

Example error f I don't install the full stack of amplify libraries I don't use:
```
ERROR in The target entry-point "aws-amplify-angular" has missing dependencies:
 - @aws-amplify/storage
 - @aws-amplify/api
 - @aws-amplify/pubsub
 - @aws-amplify/interactions
 - @aws-amplify/xr
```
From `amplify-js/packages/aws-amplify-angular/package.json`:
```
  "devDependencies": {
    ...
    "aws-amplify": "^3.0.17",
    ...
  },
  "dependencies": {
    "@aws-amplify/ui": "^2.0.2",
    "rxjs-compat": "^6.2.1"
  },
  "peerDependencies": {
    "aws-amplify": "^2.0.0"
  }
```
## Comment

---------------

Author: @sw-yx

hey Dan - you might be using the [legacy](https://docs.amplify.aws/ui-legacy/q/framework/angular) version - what happens if you install the latest version instead? https://docs.amplify.aws/ui/q/framework/angular

```bash
yarn add aws-amplify @aws-amplify/ui-angular
```
## Comment

---------------

Author: @dan-didjatv

It looks like I don't really need either module? Reading the docs again it seems `aws-amplify-angular` is only if you want to reference Amplify APIs through a pre-built Angular service provider. That would be nice if the services were split up to match the modules (eg. AmplifyAuthService vs just the catch-all AmplifyService) but I added my own provider config and was able to remove this package completely.

For reference if others are interested, this what I did for the Auth and Hub classes:

```ts
// amplify.ts
import {Auth} from '@aws-amplify/auth';
import {Hub} from '@aws-amplify/core';

export const AMPLIFY_AUTH = new InjectionToken<string>('amplify-auth');
export const AMPLIFY_HUB = new InjectionToken<string>('amplify-hub');

export const AMPLIFY_PROVIDERS = [
  { provide: AMPLIFY_AUTH, useValue: Auth },
  { provide: AMPLIFY_HUB, useValue: Hub }
]

// some.module.ts
import { AMPLIFY_PROVIDERS } from './amplify';

@NgModule({
  declarations: [],
  imports: [
    CommonModule
  ],
  providers: AMPLIFY_PROVIDERS
})
export class SomeModule { }

// some.service.ts
@Injectable()
class SomeService {
  constructor(@Inject(AMPLIFY_AUTH) private amplifyAuth: AuthClass) {}
}
```

---------------

---------------

# Allow GraphQL operation only for use in an AWS Lambda function

---------------

Author: @mruzekw
Upvotes: 1
Comments: 2

Hi there,

Is there a way to set the `@auth` config so that only an AWS Lambda can execute a certain operation? I know there's `allow: private` but I'm not sure if that fully covers it.

Thanks.
## Comment

---------------

Author: @sw-yx

just catching up on this. did you end up figuring it out?
## Comment

---------------

Author: @mruzekw

Hi @sw-yx, yes! I have an answer.

This will make sure only those with the proper IAM role can access this / perform these operations. Although I haven't been able to get this to work, you're suppose to able to attach the authRole (created by amplify) to Cognito groups to allow access through IAM.

Either way, no Cognito user should be able to do these operations without the IAM role. Effectively giving you a way to scope GraphQL operations to just lambdas (which get their authoriation from other IAM policies).

```
@auth([
  # Allow authenticated Cognito users to read this model
  { allow: private, operations: [read]}
  # Only allow IAM authenticated resources to create, update, and delete this model
  { allow: private, provider: iam, operations: [create, update, delete] }
])
```

Hope that helps!

---------------

---------------

# AWS cognito social login throwing NotAuthorizedException:does not have identity providers configured React Native

---------------

Author: @rahulje9
Upvotes: 1
Comments: 1

Hi,
 I'm using user pool. I have completed signup with email now trying to implement social login.
I'm using `Auth.federatedSignIn({ provider: 'Google' })` for google and 
`Auth.federatedSignIn({ provider: 'Facebook' });`.
Here is my config for OAuth

```
oauth: {
            domain: '__domain__',
            clientID: '__client id __',
            scope: ['email', 'profile', 'openid'],
            redirectSignIn: 'myapp://oauth/',
            redirectSignOut: 'myapp://signout/',
            responseType: 'code'
          }
```

I have added google, Facebook id and secret in aws.

But in the hub listener, I'm getting the following error.
```
signIn_failure [NotAuthorizedException: Identity pool - * poolid * does not 
have identity providers configured.]
```

However, This worked at least once since in the user registered I have seen the Google and Facebook user details.
I'm pretty much stuck at this point, any help would be appreciated.
## Comment

---------------

Author: @sw-yx

just catching up on this. did you end up figuring it out? you said you are using user pool but the error message says identity pool

---------------

---------------

# Add @auth to existing model with data

---------------

Author: @MontoyaAndres
Upvotes: 1
Comments: 1

I have this model that was created without using @auth before and with the field `userId` created. Also, this model has data...

![EVr0UeHXYAEVmIj](https://user-images.githubusercontent.com/15065852/79531719-cc293d00-8038-11ea-8070-e80644842d1d.png)

So, I added the @auth to this model in this way and I got this error when I run `amplify mock`:

![EVr0UeKWoAAbb36](https://user-images.githubusercontent.com/15065852/79531817-04308000-8039-11ea-92d4-4a89e77f3acb.png)

How can I resolve it :)? Thanks!
## Comment

---------------

Author: @sw-yx

just catching up on this. interesting! did you end up figuring it out? can you provide a small repro so we can test it?

---------------

---------------

# TypeError: _awsAmplify.default.configure is not a function with Jest

---------------

Author: @mikemeyer30
Upvotes: 1
Comments: 1

I am currently trying to write tests for a component that uses amplify authentication.
I created a mock for Amplify and it works for tests for my other components, but any tests written for components that are wrapped in <AuthContext.Consumer> fail with this error: 

<img width="672" alt="Screen Shot 2020-04-16 at 7 12 30 PM" src="https://user-images.githubusercontent.com/35384442/79515285-3977a680-8016-11ea-842f-2099e99e88a4.png">
; 

Here is what my mock looks like:
<img width="389" alt="Screen Shot 2020-04-16 at 7 24 04 PM" src="https://user-images.githubusercontent.com/35384442/79515903-d7b83c00-8017-11ea-900b-d7286efae80d.png">


Amplify.configure is called in the root component of the app (App.js) , it's only when I try to test components wrapped in AuthContext.consumer that I get the error referring to amplify.configure.

I've been looking for answers, and I've read that it's because I'm using Amplify in Node, but I wasn't sure if that was the case or there was something else I'm doing incorrectly? 
## Comment

---------------

Author: @sw-yx

yeah youre using amplify in Node. can you show how you `require` it? thats going to be the problem.

---------------

---------------

# Can Amplify refresh refreshToken?

---------------

Author: @rooleek
Upvotes: 1
Comments: 2

Hi guys,

I cannot find in reference of Cognito how to renew refreshToken except of singing in again.
Can Amplify refresh refreshToken so user would not be forced to enter his credentials one more time? 

Thanks
## Comment

---------------

Author: @mg98

Hello, why would you refresh a refresh token? You refresh your access token with your refresh token and that should already give you a new refresh token. When you idled for too long so your access token expired (like after an hour), it is legitimate that you need to sign in again with your credentials.
## Comment

---------------

Author: @sw-yx

@mauerbac i think that was the answer

---------------

---------------

# Client Subscriptions with DataStore for objects with children

---------------

Author: @Neuroforge
Upvotes: 2
Comments: 1

Hello,

I am seeking help with a use case.

We have a parent object and a child object in the schema.
```

type SchemaOne @model @auth(rules: [{ allow: owner }]) {
   id: ID!
   child: SchemaTwo @connection(name: "SchemaConnection") //Nullable
}

type SchemaTwo @model @auth(rules: [{ allow: owner }]) {
   id: ID!
   parent: SchemaOne @connection(name: "SchemaConnection") //Not nullable.
}
```

We want to subscribe to the creation/update of SchemaOne.

```
DataStore.observe<LoadedFileDetailsSchema>(LoadedFileDetailsSchema).subscribe(schema =>{
  // Do some stuff that needs to reference schema.child (Which is of type Schema2)
})
```

Is there a way to save these at the same time with Datastore?
If not, how do we ensure SchemaTwo is created before on create SchemaOne subscription fires?

```
const s1 = await DataStore.save<SchemaOne>(
    new SchemaOne({
    })
  );

const s2 = await DataStore.save<SchemaTwo>(
    new SchemaTwo({
parent:s1
    })
  );
```
## Comment

---------------

Author: @sw-yx

just catching up on this. interesting! did you end up figuring it out? the await solution looks good.

---------------

---------------

# Graphql Subscription with a Service worker 

---------------

Author: @magjack
Upvotes: 1
Comments: 1

I was wondering on the possibility of being about to use a graphql subscription where all events are subscribed to by a service worker, which can then generate a notification. (https://aws-amplify.github.io/docs/js/service-workers). Is it possible to link the two ? 
## Comment

---------------

Author: @sw-yx

you can use Hub to send messages to your SWs https://docs.amplify.aws/lib/utilities/hub/q/platform/js

---------------

---------------

# Sending (metrics) records to pinpoint in multi-tenant architecture.

---------------

Author: @ravyg
Upvotes: 1
Comments: 1

We have a react based portal using amplify.js, which host multiple apps owned by various teams. We are looking for a solution to provide them with a way where they can see their own metrics. The idea is to use amplify analytics to send records to different AWS accounts pinpoints based on the app teams.     
## Comment

---------------

Author: @sw-yx

just catching up on this. interesting! did you end up figuring it out?

---------------

---------------

# Signup method not executed

---------------

Author: @abdulelah1
Upvotes: 1
Comments: 1

This is my code here 



```
var AmazonCognitoIdentity = require('amazon-cognito-identity-js');
var CognitoUserPool = AmazonCognitoIdentity.CognitoUserPool;
global.fetch = require('node-fetch');
var poolData = {
    UserPoolId: 'I already put the user pool id here', // Your user pool id here
    ClientId: 'I already put the client id here', // Your client id here
};

var userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);

var attributeList = [];


exports.handler = async (event) => { 
    const email = event.email;
    const password = event.pass;
    const fullName = event.fName;
    const phone = event.phone;

    const emailData = {
        Name: 'email',
        Value: email
    };

    const nameData = {
        Name: 'name',
        Value: fullName
    };

    const phoneData = {
        Name: 'phone_number',
        Value: phone
    }
    
    const emailAttribute = new AmazonCognitoIdentity.CognitoUserAttribute(emailData);
    const nameAttribuute = new AmazonCognitoIdentity.CognitoUserAttribute(nameData);
    const phoneAttribute = new AmazonCognitoIdentity.CognitoUserAttribute(phoneData);
    
    attributeList.push(emailAttribute);
    attributeList.push(nameAttribuute);
    attributeList.push(phoneAttribute);
    
    console.log("We are out");
    
    userPool.signUp(email, password, attributeList, null, function(err, result) {
	if (err) {
		return console.error(err.message || JSON.stringify(err));
	}
	var cognitoUser = result.user;
	console.log('user name is ' + cognitoUser.getUsername());
});
    console.log("Not Working");
}

```

And the output like this
// INFO      We are out
// INFO      Not Working


Which means that the signup not working and never executed for some reason
This code will run in aws lambda function, and I already check the request body and it is working. 

## Comment

---------------

Author: @sw-yx

this needs more detail i'm afraid. if the code runs in an aws lambda, it is working as designed. where are you running it that it is failing?

---------------

---------------

# Can GraphQL and REST API use the same custom domain?

---------------

Author: @iaarnio
Upvotes: 2
Comments: 0

I have a project that uses AWS Amplify with GraphQL API. For hosting I have added custom domain for the project. All this is working fine.

Now I have need to receive REST API call (from external system) in my application.

Adding new REST API works using Amplify but the REST endpoint is only accessible by the default AWS generated domain. Not by my custom domain. Trying to add custom domain via API Gateway setup fails too.

Is there any way to support both GraphQL and REST APIs in the same custom domain?

---------------

---------------

# DataStore for large data storage (DynamoDb)

---------------

Author: @lenarmazitov
Upvotes: 1
Comments: 0

Hello guys, I have a question.
How DataStore works with remote storage with huge amount of data?
As I know it uses DeltaSync to sync data and uses Scan operation on base table if there was no sync yet.
Assume we write messenger application and have millions of users, is it reasonable to use DataStore?

---------------

---------------

# API.graphql(graphqlOperation(mutations.deleteTodo, id)) doesn't remove the todo from dynamoDB table

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 1

Hello each time i run API.graphql(graphqlOperation(mutations.deleteTodo, id)), the data is not actually deleted it just set the _deleted field to true with ttl field, and whenever i do API.graphql(graphqlOperation(queries.listTodo)), it returns all todos including deleted ones. is there anyway i can delete the data completly from the DynamoDB table? or am i missing something??? Thanks. 🙏🙏
## Comment

---------------

Author: @mkaschke

mhhh, strange ... it is not the default behavior. I would recommend to remove the DB (amplify remove API) and create a new one(amplify add API). I take 5 minutes to do that. 

---------------

---------------

# Get all the data from amazon cognito

---------------

Author: @ifmael
Upvotes: 1
Comments: 1


I've created a schema 
```javascript
type S3Object {
  bucket: String!
  region: String!
  key: String!
}

type Content @model @auth(rules: [{allow: owner}])
@searchable {
  id: ID!
  title: String!
  subtitle: String
  description: String!
  url: String
  image: S3Object!
}
```
Also, I've created a form to add data to the server. This works for every authenticated user that I've tried. 

Now, I would like to list all the content created for all user in the main page after a user login on the website. how can I do that?  
I'm working with javascript and react and amazon cognito for authentication


```javascript
  async componentDidMount(){
    const contents = await API.graphql(graphqlOperation(listContents))
    console.log(contents);
  }
```

This snipped get the list of content create for the specific login user not for all.
## Comment

---------------

Author: @mkaschke

@ifmael: try this, it works for me but I have to admit that I didn't fully understand it and 
could find any good source that explains the auth topic within the schema. 

````
@auth(rules: [
  {allow: owner, operations: [create, delete]}
])

@model(subscriptions: {
  onCreate: ["onCreateReservation"]
  onDelete: ["onDeleteReservation"]
  onUpdate: ["onUpdateReservation"]
  level: public })
````

---------------

---------------

# Access other user's attributes (Cognito)

---------------

Author: @mkaschke
Upvotes: 1
Comments: 0

Hello everyone,

I am building an application with a buyer and a seller (simplified).

Currently, I am facing the issue that I try to access the other user's attributes from the Cognito user pool.

So the idea is: when the buyer would like to buy something (click on the buy button), I am storing a reference (e.g. cognitoID, IDToken, or something else?) to that user. With this reference, I would like to display the first name, last name, ... (user attributes) from the buyer in the seller's inbox.

The application stack is React(web) and AWS Amplify with a Dynamodb.

A very simple solution would be to store all attributes from the buyer when he/she is clicking the buy button but there must be a better solution.

Many thanks in advance

PS. It seems pretty easy but I couldn't find a proper solution.

---------------

---------------

# Subscription errors for multi-tenant-like setup

---------------

Author: @BarbaraPruz
Upvotes: 2
Comments: 0

Quick version of question: Should I be able to set up subscriptions with
`{allow: owner, ownerField: "listGroup", identityClaim:"custom:groupname"}`

If so, I need some help debugging the authorization error I get when trying to set up a subscription. Thanks!

Background: 
- Amplify with React using cognito user pools, graphql and dynamodb
- Our users belong to customer groups. For each customer, data is private but all their users have RW access. So each user belongs to a cognito group corresponding to the customer.
- when users are logged in, they need to see data updates being made by others in their group.

We tried multiple approaches - we could get the right data privacy access but never the subscriptions.  Current approach:
- set up cognito user pool custom attribute that contains the group name
- in schema.graphql 
`{allow: owner, ownerField: "listGroup", identityClaim:"custom:groupname"}`
- subscription info from resulting schema:
```
type Subscription {
    onCreatePatient(listGroup: String!): Patient
        @aws_subscribe(mutations: ["createPatient"])
    onUpdatePatient(listGroup: String!): Patient
        @aws_subscribe(mutations: ["updatePatient"])
    onDeletePatient(listGroup: String!): Patient
        @aws_subscribe(mutations: ["deletePatient"])
}
```
In appsync console, confirmed queries and mutations are working as expected. But no luck setting up subscription. Here is command
`subscription {
  onCreatePatient(listGroup:"TestToothFairy")
  { id firstName }
}`
And error
```
"errors": [
        {
            "message": "Connection failed: {\"errors\":[{\"errorType\":\"Unauthorized\",\"message\":\"Not Authorized to access onCreatePatient on type Subscription\"}]}"
        }
    ]
```
Any clues on how to debug or fix? And definitely open to other approaches to meet our requirements.
Thanks

---------------

---------------

# Login and refresh using tokens

---------------

Author: @mithunkalan
Upvotes: 1
Comments: 0

I have a large user base with really basic smart phones. Think Galaxy S1 with browser stock android 2.3.3 ginger bread.
ReactJS doesnt render for them. So i'm trying SSR to cut down the JS in the page. Next.js and Gatsby doesnt render either. Razzle is way too complicated and somewhat still in prototype. 

So Im doing SSR using nodejs and express. 
I am able to login using amplify libs on the server  (Auth.signIn()).
On the client side, the user will go from page to page an before the HTML is sent, I do API queries and S3 gets. But if you reload the page, you're a 'new' user and need to login again.

My question:
If the user returns to the site, I have Auth.currentSession() tokens stored on their phones browser's localstorage. How can I log them back in using those tokens?

I've looked at Auth class, no way to login via token or refresh the token. 
I've looked at the Credentials.set & that will only work if im doing federation.

---------------

---------------

# Is there a way to get more specific errors when graphql @auth directive fails?

---------------

Author: @mogarick
Upvotes: 1
Comments: 0

I’m using the following  versions for a React Native app (The amplify related libs omitted for brevity): 
* “@aws-amplify/api”: “^3.1.9”
* “aws-amplify”: “^3.0.10”

##  Brief scenario
Given I have users `prueba01` and `prueba02`, and one group named `prueba01_account_viewers`, where  `prueba01` is a member of: 
* If I create a **recordA1**  as `prueba02` and I include `prueba01_account_viewers ` in the record’s `viewers` list, and then update the same **recordA1** with the same `prueba02` it works as intended, in accordance with the directive rule `{ allow: owner, ownerField: “recordOwner” }`.
* If I sign in with  `prueba01`  I can view the `recordA1` without a problem because `prueba01` is in its `viewers` group. So it works as intended by the directive `{ allow: groups, groupsField: "viewers", groupClaim: "groupsEnrolledIn",   operations: [read] }`
* If I try to update **recordA1** using `prueba01` I get an error, as expected, because `prueba01` is not the `recordOwner` and the `viewers` group only has a `read` permission on the **recordA1** record. The thing is the error is kind of generic. This error is thrown for many different reasons as I could find by googling it, so it’s not specific for `@auth` directive rules failing.

I want to correctly manage the `@auth` scenario to correctly notify the user that the cause is `prueba01` doesn’t have enough privileges/authorization to perform the update.

So I’d like to know if there’s a way to identify when an `@auth` directive error has ocurred.

## Test Scenario Info
Here is verbose info for an update scenario.

I defined the next type in my amplify graphql schema (Complementary types not shown for brevity):

``` graphql
type Animal
  @model
  @key(
    name: "byAccount"
    fields: ["ownerAccount"]
    queryField: "listAnimalsByOwnerAccount"
  )
  @auth(
    rules: [
      # Allow read queries using IAM credentials.
      { allow: private, provider: iam, operations: [read] }
      { allow: owner, ownerField: "recordOwner" }
      {
        allow: groups
        groupsField: "admins"
        groupClaim: "groupsEnrolledIn"
        operations: [read, update, delete]
      }
      {
        allow: groups
        groupsField: "editors"
        groupClaim: "groupsEnrolledIn"
        operations: [read, update]
      }
      {
        allow: groups
        groupsField: "viewers"
        groupClaim: "groupsEnrolledIn"
        operations: [read]
      }
    ]
  ) {
  id: ID!
  name: String
  # Electronic Identification Number
  eid: String
  registry: AnimalRegistry @connection
  species: AnimalSpeciesEnum
  breed: AnimalBreed @connection
  sexType: SexTypeEnum
  traits: String
  birthdate: String
  relatedPersons: [AnimalRelatedPerson!]
    @connection(keyName: "byAnimal", fields: ["id"])
  # User that owns the record.
  recordOwner: String
  # Account that owns the record
  ownerAccount: String!
  # groups access
  admins: [String]
  editors: [String]
  viewers: [String]
}
```

Here is the graphql query that amplify sends, as logged in CloudWatch

``` graphql
mutation UpdateAnimal($input: UpdateAnimalInput!, $condition: ModelAnimalConditionInput) {
  updateAnimal(input: $input, condition: $condition) {
    id
    name
    eid
    registry {
      id
      registrar {
        id
        name
        type
      }
    }
    species
    breed {
      id
      animalID
      language
      name
      groupNumber
      groupName
      recordOwner
    }
    sexType
    traits
    birthdate
    recordOwner
    ownerAccount
    admins
    editors
    viewers
    relatedPersons {
      items {
        id
        animalID
        personID
        relationRole
        recordOwner
      }
      nextToken
    }
  }
}
, Operation: null, Variables: 
{
    "input": {
        "recordOwner": "prueba02",
        "ownerAccount": "Gf76LAgGzyKe",
        "editors": [],
        "viewers": [
            "Gf76LAgGzyKe:VrOLstDpj0yt"
        ],
        "id": "47fc83c2-0048-494b-b16c-f1a672a44a9e",
        "name": "Camilo",
        "eid": "6784949",
        "species": "dog",
        "sexType": "male",
        "traits": "Probando prueba",
        "animalBreedId": "22c1d4b3-fed1-4312-bbac-d0cee043da68"
    }
}
```

Here is the template file for the mutation above (`Mutation.updateAnimal.req.vtl` ):
``` velocity
## [Start] Determine request authentication mode **
#if( $util.isNullOrEmpty($authMode) && !$util.isNull($ctx.identity) && !$util.isNull($ctx.identity.sub) && !$util.isNull($ctx.identity.issuer) && !$util.isNull($ctx.identity.username) && !$util.isNull($ctx.identity.claims) && !$util.isNull($ctx.identity.sourceIp) && !$util.isNull($ctx.identity.defaultAuthStrategy) )
  #set( $authMode = "userPools" )
#end
## [End] Determine request authentication mode **
## [Start] Check authMode and execute owner/group checks **
#if( $authMode == "userPools" )
  ## No Static Group Authorization Rules **


  #if( ! $isStaticGroupAuthorized )
    ## [Start] Dynamic group authorization checks **
    #set( $groupAuthExpressions = [] )
    #set( $groupAuthExpressionValues = {} )
    #set( $groupAuthExpressionNames = {} )
    ## Authorization rule: { allow: groups, groupsField: "admins", groupClaim: "groupsEnrolledIn"} **
    #set( $userGroups = $util.defaultIfNull($ctx.identity.claims.get("groupsEnrolledIn"), []) )
    #if( $util.isString($userGroups) )
      #if( $util.isList($util.parseJson($userGroups)) )
        #set( $userGroups = $util.parseJson($userGroups) )
      #else
        #set( $userGroups = [$userGroups] )
      #end
    #end
    #foreach( $userGroup in $userGroups )
      $util.qr($groupAuthExpressions.add("contains(#groupsAttribute0, :group0$foreach.count)"))
      $util.qr($groupAuthExpressionValues.put(":group0$foreach.count", { "S": $userGroup }))
    #end
    #if( $userGroups.size() > 0 )
      $util.qr($groupAuthExpressionNames.put("#groupsAttribute0", "admins"))
    #end
    ## Authorization rule: { allow: groups, groupsField: "editors", groupClaim: "groupsEnrolledIn"} **
    #set( $userGroups = $util.defaultIfNull($ctx.identity.claims.get("groupsEnrolledIn"), []) )
    #if( $util.isString($userGroups) )
      #if( $util.isList($util.parseJson($userGroups)) )
        #set( $userGroups = $util.parseJson($userGroups) )
      #else
        #set( $userGroups = [$userGroups] )
      #end
    #end
    #foreach( $userGroup in $userGroups )
      $util.qr($groupAuthExpressions.add("contains(#groupsAttribute1, :group1$foreach.count)"))
      $util.qr($groupAuthExpressionValues.put(":group1$foreach.count", { "S": $userGroup }))
    #end
    #if( $userGroups.size() > 0 )
      $util.qr($groupAuthExpressionNames.put("#groupsAttribute1", "editors"))
    #end
    ## [End] Dynamic group authorization checks **


    ## [Start] Owner Authorization Checks **
    #set( $ownerAuthExpressions = [] )
    #set( $ownerAuthExpressionValues = {} )
    #set( $ownerAuthExpressionNames = {} )
    ## Authorization rule: { allow: owner, ownerField: "recordOwner", identityClaim: "cognito:username" } **
    $util.qr($ownerAuthExpressions.add("#owner0 = :identity0"))
    $util.qr($ownerAuthExpressionNames.put("#owner0", "recordOwner"))
    $util.qr($ownerAuthExpressionValues.put(":identity0", $util.dynamodb.toDynamoDB($util.defaultIfNull($ctx.identity.claims.get("username"), $util.defaultIfNull($ctx.identity.claims.get("cognito:username"), "___xamznone____")))))
    ## [End] Owner Authorization Checks **


    ## [Start] Collect Auth Condition **
    #set( $authCondition = $util.defaultIfNull($authCondition, {
  "expression": "",
  "expressionNames": {},
  "expressionValues": {}
}) )
    #set( $totalAuthExpression = "" )
    ## Add dynamic group auth conditions if they exist **
    #if( $groupAuthExpressions )
      #foreach( $authExpr in $groupAuthExpressions )
        #set( $totalAuthExpression = "$totalAuthExpression $authExpr" )
        #if( $foreach.hasNext )
          #set( $totalAuthExpression = "$totalAuthExpression OR" )
        #end
      #end
    #end
    #if( $groupAuthExpressionNames )
      $util.qr($authCondition.expressionNames.putAll($groupAuthExpressionNames))
    #end
    #if( $groupAuthExpressionValues )
      $util.qr($authCondition.expressionValues.putAll($groupAuthExpressionValues))
    #end
    ## Add owner auth conditions if they exist **
    #if( $totalAuthExpression != "" && $ownerAuthExpressions && $ownerAuthExpressions.size() > 0 )
      #set( $totalAuthExpression = "$totalAuthExpression OR" )
    #end
    #if( $ownerAuthExpressions )
      #foreach( $authExpr in $ownerAuthExpressions )
        #set( $totalAuthExpression = "$totalAuthExpression $authExpr" )
        #if( $foreach.hasNext )
          #set( $totalAuthExpression = "$totalAuthExpression OR" )
        #end
      #end
    #end
    #if( $ownerAuthExpressionNames )
      $util.qr($authCondition.expressionNames.putAll($ownerAuthExpressionNames))
    #end
    #if( $ownerAuthExpressionValues )
      $util.qr($authCondition.expressionValues.putAll($ownerAuthExpressionValues))
    #end
    ## Set final expression if it has changed. **
    #if( $totalAuthExpression != "" )
      #if( $util.isNullOrEmpty($authCondition.expression) )
        #set( $authCondition.expression = "($totalAuthExpression)" )
      #else
        #set( $authCondition.expression = "$authCondition.expression AND ($totalAuthExpression)" )
      #end
    #end
    ## [End] Collect Auth Condition **
  #end


  ## [Start] Throw if unauthorized **
  #if( !($isStaticGroupAuthorized == true || ($totalAuthExpression != "")) )
    $util.unauthorized()
  #end
  ## [End] Throw if unauthorized **
#end
## [End] Check authMode and execute owner/group checks **



#if( $authCondition && $authCondition.expression != "" )
  #set( $condition = $authCondition )
  #if( $modelObjectKey )
    #foreach( $entry in $modelObjectKey.entrySet() )
      $util.qr($condition.put("expression", "$condition.expression AND attribute_exists(#keyCondition$velocityCount)"))
      $util.qr($condition.expressionNames.put("#keyCondition$velocityCount", "$entry.key"))
    #end
  #else
    $util.qr($condition.put("expression", "$condition.expression AND attribute_exists(#id)"))
    $util.qr($condition.expressionNames.put("#id", "id"))
  #end
#else
  #if( $modelObjectKey )
    #set( $condition = {
  "expression": "",
  "expressionNames": {},
  "expressionValues": {}
} )
    #foreach( $entry in $modelObjectKey.entrySet() )
      #if( $velocityCount == 1 )
        $util.qr($condition.put("expression", "attribute_exists(#keyCondition$velocityCount)"))
      #else
        $util.qr($condition.put("expression", "$condition.expression AND attribute_exists(#keyCondition$velocityCount)"))
      #end
      $util.qr($condition.expressionNames.put("#keyCondition$velocityCount", "$entry.key"))
    #end
  #else
    #set( $condition = {
  "expression": "attribute_exists(#id)",
  "expressionNames": {
      "#id": "id"
  },
  "expressionValues": {}
} )
  #end
#end
## Automatically set the updatedAt timestamp. **
$util.qr($context.args.input.put("updatedAt", $util.defaultIfNull($ctx.args.input.updatedAt, $util.time.nowISO8601())))
$util.qr($context.args.input.put("__typename", "Animal"))
## Update condition if type is @versioned **
#if( $versionedCondition )
  $util.qr($condition.put("expression", "($condition.expression) AND $versionedCondition.expression"))
  $util.qr($condition.expressionNames.putAll($versionedCondition.expressionNames))
  $util.qr($condition.expressionValues.putAll($versionedCondition.expressionValues))
#end
#if( $context.args.condition )
  #set( $conditionFilterExpressions = $util.parseJson($util.transform.toDynamoDBConditionExpression($context.args.condition)) )
  $util.qr($condition.put("expression", "($condition.expression) AND $conditionFilterExpressions.expression"))
  $util.qr($condition.expressionNames.putAll($conditionFilterExpressions.expressionNames))
  $util.qr($condition.expressionValues.putAll($conditionFilterExpressions.expressionValues))
#end
#if( $condition.expressionValues && $condition.expressionValues.size() == 0 )
  #set( $condition = {
  "expression": $condition.expression,
  "expressionNames": $condition.expressionNames
} )
#end
#set( $expNames = {} )
#set( $expValues = {} )
#set( $expSet = {} )
#set( $expAdd = {} )
#set( $expRemove = [] )
#if( $modelObjectKey )
  #set( $keyFields = [] )
  #foreach( $entry in $modelObjectKey.entrySet() )
    $util.qr($keyFields.add("$entry.key"))
  #end
#else
  #set( $keyFields = ["id"] )
#end
#foreach( $entry in $util.map.copyAndRemoveAllKeys($context.args.input, $keyFields).entrySet() )
  #if( !$util.isNull($dynamodbNameOverrideMap) && $dynamodbNameOverrideMap.containsKey("$entry.key") )
    #set( $entryKeyAttributeName = $dynamodbNameOverrideMap.get("$entry.key") )
  #else
    #set( $entryKeyAttributeName = $entry.key )
  #end
  #if( $util.isNull($entry.value) )
    #set( $discard = $expRemove.add("#$entryKeyAttributeName") )
    $util.qr($expNames.put("#$entryKeyAttributeName", "$entry.key"))
  #else
    $util.qr($expSet.put("#$entryKeyAttributeName", ":$entryKeyAttributeName"))
    $util.qr($expNames.put("#$entryKeyAttributeName", "$entry.key"))
    $util.qr($expValues.put(":$entryKeyAttributeName", $util.dynamodb.toDynamoDB($entry.value)))
  #end
#end
#set( $expression = "" )
#if( !$expSet.isEmpty() )
  #set( $expression = "SET" )
  #foreach( $entry in $expSet.entrySet() )
    #set( $expression = "$expression $entry.key = $entry.value" )
    #if( $foreach.hasNext() )
      #set( $expression = "$expression," )
    #end
  #end
#end
#if( !$expAdd.isEmpty() )
  #set( $expression = "$expression ADD" )
  #foreach( $entry in $expAdd.entrySet() )
    #set( $expression = "$expression $entry.key $entry.value" )
    #if( $foreach.hasNext() )
      #set( $expression = "$expression," )
    #end
  #end
#end
#if( !$expRemove.isEmpty() )
  #set( $expression = "$expression REMOVE" )
  #foreach( $entry in $expRemove )
    #set( $expression = "$expression $entry" )
    #if( $foreach.hasNext() )
      #set( $expression = "$expression," )
    #end
  #end
#end
#set( $update = {} )
$util.qr($update.put("expression", "$expression"))
#if( !$expNames.isEmpty() )
  $util.qr($update.put("expressionNames", $expNames))
#end
#if( !$expValues.isEmpty() )
  $util.qr($update.put("expressionValues", $expValues))
#end
{
  "version": "2017-02-28",
  "operation": "UpdateItem",
  "key": #if( $modelObjectKey ) $util.toJson($modelObjectKey) #else {
  "id": {
      "S": $util.toJson($context.args.input.id)
  }
} #end,
  "update": $util.toJson($update),
  "condition": $util.toJson($condition)
}
```

Here is the requestMapping after the `Mutation.updateAnimal.req.vtl` has been processed, as logged in CloudWatch:

``` json
{
  "version": "2017-02-28",
  "operation": "UpdateItem",
  "key": { "id": { "S": "47fc83c2-0048-494b-b16c-f1a672a44a9e" } },
  "update": {
    "expression": "SET #eid = :eid, #traits = :traits, #recordOwner = :recordOwner, #__typename = :__typename, #sexType = :sexType, #ownerAccount = :ownerAccount, #animalBreedId = :animalBreedId, #viewers = :viewers, #species = :species, #name = :name, #editors = :editors, #updatedAt = :updatedAt REMOVE #birthdate, #animalRegistryId, #admins",
    "expressionNames": {
      "#eid": "eid",
      "#traits": "traits",
      "#birthdate": "birthdate",
      "#recordOwner": "recordOwner",
      "#__typename": "__typename",
      "#animalRegistryId": "animalRegistryId",
      "#sexType": "sexType",
      "#ownerAccount": "ownerAccount",
      "#animalBreedId": "animalBreedId",
      "#viewers": "viewers",
      "#species": "species",
      "#name": "name",
      "#admins": "admins",
      "#editors": "editors",
      "#updatedAt": "updatedAt"
    },
    "expressionValues": {
      ":eid": { "S": "6784949" },
      ":traits": { "S": "Probando prueba" },
      ":recordOwner": { "S": "prueba02" },
      ":__typename": { "S": "Animal" },
      ":sexType": { "S": "male" },
      ":ownerAccount": { "S": "Gf76LAgGzyKe" },
      ":animalBreedId": { "S": "22c1d4b3-fed1-4312-bbac-d0cee043da68" },
      ":viewers": { "L": [{ "S": "Gf76LAgGzyKe:VrOLstDpj0yt" }] },
      ":species": { "S": "dog" },
      ":name": { "S": "Camilo" },
      ":editors": { "L": [] },
      ":updatedAt": { "S": "2020-06-11T16:23:35.502Z" }
    }
  },
  "condition": {
    "expression": "( contains(#groupsAttribute0, :group01) OR contains(#groupsAttribute0, :group02) OR contains(#groupsAttribute0, :group03) OR contains(#groupsAttribute0, :group04) OR contains(#groupsAttribute1, :group11) OR contains(#groupsAttribute1, :group12) OR contains(#groupsAttribute1, :group13) OR contains(#groupsAttribute1, :group14) OR #owner0 = :identity0) AND attribute_exists(#id)",
    "expressionNames": {
      "#groupsAttribute0": "admins",
      "#groupsAttribute1": "editors",
      "#owner0": "recordOwner",
      "#id": "id"
    },
    "expressionValues": {
      ":group01": { "S": "Gf76LAgGzyKe:VrOLstDpj0yt" },
      ":group02": { "S": "Gf76LAgGzyKe:3S-Oi1shMBui" },
      ":group03": { "S": "eMFUomHuGj8M:9PhlEdv7jmtX" },
      ":group04": { "S": "eMFUomHuGj8M:ufHqaTNG0nbo" },
      ":group11": { "S": "Gf76LAgGzyKe:VrOLstDpj0yt" },
      ":group12": { "S": "Gf76LAgGzyKe:3S-Oi1shMBui" },
      ":group13": { "S": "eMFUomHuGj8M:9PhlEdv7jmtX" },
      ":group14": { "S": "eMFUomHuGj8M:ufHqaTNG0nbo" },
      ":identity0": { "S": "prueba01" }
    }
  }
}
```

Here is the ResponseMapping, as logged in CloudWatch:

``` json
{
    "logType": "ResponseMapping",
    "path": [
        "updateAnimal"
    ],
    "fieldName": "updateAnimal",
    "resolverArn": "arn:aws:appsync:us-west-2:520818527109:apis/hecc7cqrvfdapcjcxsdb766niu/types/Mutation/fields/updateAnimal",
    "requestId": "1c05150c-a94a-4ae1-9679-14a5d7f2e3e2",
    "context": {
        "arguments": {
            "input": {
                "id": "47fc83c2-0048-494b-b16c-f1a672a44a9e",
                "name": "Camilo",
                "eid": "6784949",
                "species": "dog",
                "sexType": "male",
                "traits": "Probando prueba",
                "recordOwner": "prueba02",
                "ownerAccount": "Gf76LAgGzyKe",
                "editors": [],
                "viewers": [
                    "Gf76LAgGzyKe:VrOLstDpj0yt"
                ],
                "animalBreedId": "22c1d4b3-fed1-4312-bbac-d0cee043da68",
                "updatedAt": "2020-06-11T16:23:35.502Z",
                "__typename": "Animal"
            }
        },
        "result": {
            "eid": "6784949",
            "traits": "Probando",
            "recordOwner": "prueba02",
            "__typename": "Animal",
            "sexType": "male",
            "ownerAccount": "Gf76LAgGzyKe",
            "animalBreedId": "22c1d4b3-fed1-4312-bbac-d0cee043da68",
            "createdAt": "2020-06-08T22:01:30.547Z",
            "viewers": [
                "Gf76LAgGzyKe:VrOLstDpj0yt"
            ],
            "species": "dog",
            "name": "Camilo",
            "id": "47fc83c2-0048-494b-b16c-f1a672a44a9e",
            "editors": [],
            "updatedAt": "2020-06-11T02:36:42.332Z"
        },
        "stash": {},
        "error": {
            "message": "The conditional request failed (Service: AmazonDynamoDBv2; Status Code: 400; Error Code: ConditionalCheckFailedException; Request ID: 7QQHUP5PCMLVDKAV39K4IGQI3VVV4KQNSO5AEMVJF66Q9ASUAAJG)",
            "type": "DynamoDB:ConditionalCheckFailedException"
        },
        "outErrors": []
    },
    "fieldInError": false,
    "errors": [],
    "parentType": "Mutation",
    "graphQLAPIId": "hecc7cqrvfdapcjcxsdb766niu",
    "transformedTemplate": "{eid=6784949, traits=Probando, recordOwner=prueba02, __typename=Animal, sexType=male, ownerAccount=Gf76LAgGzyKe, animalBreedId=22c1d4b3-fed1-4312-bbac-d0cee043da68, createdAt=2020-06-08T22:01:30.547Z, viewers=[Gf76LAgGzyKe:VrOLstDpj0yt], species=dog, name=Camilo, id=47fc83c2-0048-494b-b16c-f1a672a44a9e, editors=[], updatedAt=2020-06-11T02:36:42.332Z}"
}
```

And here is the graphql response received on the app:

```json
{
  "data": {
    "updateAnimal": null
  },
  "errors": [
    {
      "path": [
        "updateAnimal"
      ],
      "data": {
        "id": "47fc83c2-0048-494b-b16c-f1a672a44a9e",
        "name": "Camilo",
        "eid": "6784949",
        "registry": null,
        "species": "dog",
        "breed": null,
        "sexType": "male",
        "traits": "Probando",
        "birthdate": null,
        "recordOwner": "prueba02",
        "ownerAccount": "Gf76LAgGzyKe",
        "admins": null,
        "editors": [],
        "viewers": [
          "Gf76LAgGzyKe:VrOLstDpj0yt"
        ],
        "relatedPersons": null
      },
      "errorType": "DynamoDB:ConditionalCheckFailedException",
      "errorInfo": null,
      "locations": [
        {
          "line": 2,
          "column": 3,
          "sourceName": null
        }
      ],
      "message": "The conditional request failed (Service: AmazonDynamoDBv2; Status Code: 400; Error Code: ConditionalCheckFailedException; Request ID: 7QQHUP5PCMLVDKAV39K4IGQI3VVV4KQNSO5AEMVJF66Q9ASUAAJG)"
    }
  ]
}

```
As you can see there is no clear way to isolate the error as a, `@auth` directive related to lack of `update` permissions for the current user.

Is there some way I can achieve this?

Thank you in advance.

---------------

---------------

# How to use AmplifyTheme for react native?

---------------

Author: @Blkc
Upvotes: 1
Comments: 1

According to [doc](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react-native#using-withauthenticator-hoc), to change the colors I would need to use AmplifyTheme

In my code I have:

```
import { withAuthenticator, AmplifyTheme } from 'aws-amplify-react-native';

...

const theme = {
  ...AmplifyTheme,
  button: {
    ...AmplifyTheme.button,
    backgroundColor: '#1ab'
  },
  navBar: {
    ...AmplifyTheme.navBar,
    backgroundColor: "#ffc0cb"
  }
}

export default withAuthenticator(ProfileScreen, {
  usernameAttributes: 'email',
  signUpConfig: {
    hiddenDefaults: ['phone_number']
  },
 theme
})
```

^ didn't work. So after some research, with the below approach I was able to change the color of the sign in button (albeit ugly and somehow the button loses all other styles)

```
const theme = {
  ...AmplifyTheme,
  button: {
    ...AmplifyTheme.button,
    backgroundColor: '#1ab'
  }
}
export default withAuthenticator(ProfileScreen, false, [], null, theme)
```
![image](https://user-images.githubusercontent.com/7827466/84399992-7ce23180-abcf-11ea-886b-b31eadc2534d.png)

But the signup button's color is still orange?

![image](https://user-images.githubusercontent.com/7827466/84400051-908d9800-abcf-11ea-8462-dc1678550884.png)





## Comment

---------------

Author: @amhinson

@Blkc It looks like the button is disabled, which has a different style object for the button [based on the code](https://github.com/aws-amplify/amplify-js/blob/master/packages/aws-amplify-react-native/src/AmplifyTheme.ts#L114).

So you can override this disabled button color as well by:

```js
const theme = {
  ...AmplifyTheme,
  button: {
    ...AmplifyTheme.button,
    backgroundColor: '#1ab'
  },
  buttonDisabled: {
    ...AmplifyTheme. buttonDisabled,
    backgroundColor: '#1ab'
  }
}
```

With that said, this is something we are looking to improve in the future.

---------------

---------------

# Datastore / AppSync Authentication without using Amplify Auth

---------------

Author: @kheriox-technologies
Upvotes: 2
Comments: 0

We have an application which uses our custom auth service. It uses Cognito & Azure. We are not using Amplify Auth for some customisation reasons. We do get authenticated and get the tokens from Cognito.

We need to use these tokens with Datastore / AppSync. We want to use the token we generated with Datastore / AppSync.

We use `aws-exports` file generated by Amplify with `aws_appsync_authenticationType` set to `AMAZON_COGNITO_USER_POOLS`. Below is our exports file
```
{
    "aws_project_region": "ap-southeast-2",
    "aws_appsync_graphqlEndpoint": "https://xxxxxxxxxx.appsync-api.ap-southeast-2.amazonaws.com/graphql",
    "aws_appsync_region": "ap-southeast-2",
    "aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS"
}
```
Configuring Amplify using `Amplify.configure(aws-exports);`
We do `Datastore.save()` to save the items to offline database. 
How do I pass in my jwtToken to Amplify config to be used by `Datastore.save()` ?

---------------

---------------

# Why was aws-sdk v3 included while it's still in BETA? Is Amplify JS v3 considered production-stable?

---------------

Author: @masbaehr
Upvotes: 1
Comments: 1

As it clearly states here: https://github.com/aws/aws-sdk-js-v3 it is in beta
Should we really use v3 in production or is v2 amplify still recommended?

## Comment

---------------

Author: @sammartinez

Hello, for Amplify use cases using AWS SDK v3, they are supported for production use. We recommend to use v3 of Amplify as it is intended to be used in production.

---------------

---------------

# Confirm username on email verification redirect

---------------

Author: @mk0y
Upvotes: 1
Comments: 1

Hi, I already asked this question on SO: https://stackoverflow.com/questions/61599944/aws-amplify-confirm-signup-with-email-verification

So basically my `Auth.signUp` works, and Amplify is configured so that email is used as username. After I get email with confirmation link, I get redirected to URL which is defined in:
1. team-provider-info.json, under "categories" -> "function" -> "myproject0292ecd8CustomMessage" -> REDIRECTURL 
2. nested-cloudformation-stack.yml, under "Resources" -> functionmyproject0292ecd8CustomMessage -> Properties -> Parameters -> REDIRECTURL

Link from email redirects me to REDIRECTURL/my-redirect-path?username=653663f9-e36b-432d-9dac-08c8338a4444
I'd like to know what this number is: **`653663f9-e36b-432d-9dac-08c8338a4444`**
Looked everywhere but can't find any documentation on this. Should be important and easy to find as it's crucial for verifying users after signup process. Any ideas?

## Comment

---------------

Author: @babyjesusQ

I need help on getting my Facebook back in active please

---------------

---------------

# Datastore hydration not observable

---------------

Author: @kerzmaximilian
Upvotes: 1
Comments: 1

Dear AWS Amplify team, 

I am currently running into an issue during sign-in of an existing user for a react application. 

Scenario:
1. Using Auth a user is created on Cognito.
2. After signup, the user is able to sign in and a profile is created via DataStore GraphQL Api in DynamoTables
3. On sign out, `DataStore.clear()` is used to remove local data
4. On subsequent sign-in and new session, a `DataStore.query(...)` will result in an empty array. Refreshing results in the array holding the anticipated Model. 

I assume this is has something to do with the hydration process. Is there a way to observe this, in order to avoid the need for refresh?

Best,
Max
## Comment

---------------

Author: @isv485

Hello, Max!

I have similar issue with RN Application. In my context AWS Cloud keeps some shared information that is expected to be loaded as soon as existing user installs application and logs in with Cognito service. On first load, DataStore returns an empty array of my public data, but if application reloaded, data correctly updated with Cloud info. Logging user our and cleaning up DataStore, reproduces issue again. 
Dear AWS Amplify/DataStore team, is there a way to observe store rehydration or force DataStore sync? By the way, using API.graphql query provides response from the cloud correctly.

Max, were you able to find some workaround for this issue with DataStore? 

Thanks,
Serge 

---------------

---------------

# Triggering 'signUp' Event with Social Federation

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 1

** Which Category is your question related to? **
Auth

** What AWS Services are you utilizing? **
Cognito User Pools

** Provide additional details e.g. code snippets **
Is there any way to trigger the 'signUp' event on the auth Hub listener? I am using the social federation sign up (i.e. Auth.federatedSignin()) with User Pools and I need some way to create a user in a dynamodb table upon sign up, but federatedSignin() only triggers the 'signIn' event. If not, is there any way I can add a custom field to a to the CognitoUser created by federatedSignin()? If I can't trigger the signUp event, I'd like to add a field on the cognito user that would allow me to determine if I need to create a dynamodb user.
## Comment

---------------

Author: @ashika01

@karrettgelley Moving issue to discussions to get help from the community. Your question is a little confusing. If you are using `Auth.federatedSignIn`, you are going to get a `signIn` event while listening.

---------------

---------------

# Expose added public method in AWS lambda project as api

---------------

Author: @ajitgoel
Upvotes: 1
Comments: 0

Hello all, 
I have an existing AWS API gateway(payments api, payments path) which points to a .Net lambda function.
If I edit the .Net lambda function's class to add another public method, how do I expose it with a new path in the existing api, through aws amplify? 
Similarly if I add another class(charges?) and a public method(ListAllCharges) to the .Net lambda function project, how do I expose it with a new path in the existing api, through aws amplify? 
I have fiddled with `amplify update api `and `amplify add function` commands but they do not seem to satisfy my needs.

---------------

---------------

# AWS amplify i18n internationalization

---------------

Author: @Muttaki-Khan
Upvotes: 1
Comments: 0

I am using amplify i18n library for internationalization
 import { I18n } from '@aws-amplify/core';
 I18n.setLanguage('ch'); 
const dict = { 'bh': { 'Hello there!': "Apa khabar di sana!" },
 'ch': { 'Hello there!': "你好！" } };
I18n.putVocabularies(dict);
I18n.get('Hello there!');

my html heading is
<h3>Hello there!</h3>
so i want this Hello there! in chinese while loading my website i wrote this code
But how can i tell my html to show chinese???
how to call this I18n function

---------------

---------------

# How can I create users as an Admin and the user receives an email to sign with temp password and username?

---------------

Author: @mdunbavan
Upvotes: 1
Comments: 0

Hi, I am working on a Vue JS app with Amplify.

I have an application that uses the Cognito SAAS sign up/out/in slightly differently.

We have an admin area where certain admin users need to be able to create users and the users get emails with a temp password to sign in and then carry on with editing their profile details such as photo, username, password etc.

The current issue is in Amplify/Cognito you need to have a verified email and that is only done once they have got through a certain flow in the process.

Is there a way we can do that within Amplify, if not what workarounds have people done to get around this?

Thanks,
Mark

---------------

---------------

# Anyone else experience VPN troubles + trying to hit endpoints?

---------------

Author: @weisisheng
Upvotes: 1
Comments: 0

Not sure where to post this but suggested here.  After updating the amplify-sdk, cli, and amplify-js (I think) a few days ago, I am no longer able to reach some endpoints (us-west-2 and ap-southeast-1) nor the aws docs site.  Having used a VPN for years since in mainland China and AWS universe (serverless for 12 months or so while learning the framework), I have never seen this problem.  Googling doesn't help.  If I switch to google outline or lantern, I can reach them even though I have to fiddle with extra proxy settings at the command line.  Thanks in advance.

---------------

---------------

# Call an API protected by AWS IAM using Amplify

---------------

Author: @randalb1991
Upvotes: 1
Comments: 1

Hi guys, 

I'am creating an App where my users can sign in using an Idendity Pool connected to a Cognito Pool User. I've applied a rule where the generation token depends on the Cognito group where the user is:

![image](https://user-images.githubusercontent.com/10707967/83549924-56a0ff80-a506-11ea-9259-6e7a78783642.png)

As you can see, I have the admin and moderator groups&roles, where admin is allowed to do everything on my app, including S3 and invoke any API Gateway resource even if it is protected by AWS IAM, and moderator has all forbidden(just for troubleshooting proposal)

But once logged on My App using **Auth.signIn**, both roles get CognitoUser(with its idToken, refresh Token...) and using **Auth.currentCredentials()** it gets access_key, secret_key and session_token. I noticed that tokens are generated according the propers roles since my request agains S3 work as expected(allowed for admin and denied for moderators), but I'm having problem Invoking API Gateway using **API.get('xx','yy)** from 'aws-amplify'. I get an 403 unauthorized.

As far as I understand Amplify signed your request with the tokens obtained, but I've noticed that is not true, and you have to sign your request using:

```
            let access_info= {
                access_key: credentials.accessKeyId,
                secret_key: credentials.secretAccessKey,
                session_token: credentials.sessionToken
                }

            let request = {
                method:'GET',
                url: awsConfing.API.endpoints[0].endpoint+'/xxxx/yyy'
            }
           Signer.signUrl(request, access_info)
```

Does someone know how delegate the signing procedure in AWS Amplify? it is possible? Would I have to request new credentials every hours or it is managed by Amplify?  Could I invoke API Gateway Resources using ID token?


Im trying to avoid using API Gateway Authorizers, since it can't different among users groups.
## Comment

---------------

Author: @randalb1991

Problem solved adding the region in the config file:

```
const  awsconfig = {
    // OPTIONAL - if your API requires authentication 
    Auth: {
        // REQUIRED - Amazon Cognito Identity Pool ID
        identityPoolId: 'eu-west-1:xxxx',
        // REQUIRED - Amazon Cognito Region
        region: 'eu-west-1', 
        // OPTIONAL - Amazon Cognito User Pool ID
        userPoolId: 'eu-west-xxxxx', 
        // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
        userPoolWebClientId: 'xxxxx',
    },
    API: {
        endpoints: [
            {
                name: "txxxx",
                endpoint: "https://xxxxx.execute-api.eu-west-1.amazonaws.com",
                **region**: 'eu-west-1'
            }
        ]
    },
    Storage: {
        AWSS3: {
            bucket: 'xxx-bucket', //REQUIRED -  Amazon S3 bucket
            region: 'eu-west-1', //OPTIONAL -  Amazon service region
        }
    }
}
```

According AWS Amplify documentation region is a not mandatory parameter in aws-export.js when you add an existing API Gateway, but truly it is...  

---------------

---------------

# Using SAML for authentication

---------------

Author: @mrgoos
Upvotes: 1
Comments: 2

Hi,
It seems like there isn't a clear doc in the new amplify website about how to use SAML (auth0 specifically) as identity provider.
It's clear about Facebook, Google and Amazon but what about SAML in general?

I have setup whatever's needed on auth0 website and in Cognito but I'm having a hard time to find how to configure it through the cli or even manually.

I have an angular 9 app but even a full general JS example could be good, hopefully an updated one.

Thanks.
## Comment

---------------

Author: @pmclachlan

To initiate login, you need to call Auth.federatedSignIn, like:

          const options: FederatedSignInOptionsCustom = {
            customProvider: 'cognitoProvider'
          }
          let v = await Auth.federatedSignIn(options);


You also don't want it opening that pop-up all the time, so when initializing your app you need to start by asking if you're already signed in:

   const cognitoUser: CognitoUser = await Auth.currentAuthenticatedUser();

(this will throw an exception if not & return the user if so).

Also, on immediate redirect after a successful login, it is sometimes the case that .currentAuthenticatedUser() doesn't work but it's about to, like, really soon.  So you also need a 

    Hub.listen('auth', (data) => {
      switch (data.payload.event) {
        case 'signIn':
          const cognitoUser:CognitoUser = data.payload.data;
          // console.log('Hub: now the user is signed in: ' + data.payload.message);
          setTimeout(()=> {
              this.processCognitoUser(cognitoUser);
            }, 50 //  we need to let the rest of the hub listeners process their events on login or our calls to them might not work
          );
          break;
   }

type of thing.

That said, I didn't use auth0 directly, I was just using cognito & connecting it to Azure or Google or whatever SAML provider.
## Comment

---------------

Author: @pmclachlan

I just use cognito by itself -- I'm less sure about auth0, sorry.  I would guess you'd need to go to the cognito console for your userpool and add a provider there for auth0 -- that provider will then have a name you can plug into the amplify code.  I think (in my poking) there is a bunch of docs about hooking auth0 up to cognito, so I bet you can find something.  Possibly what you're missing is that, as far as I know, one *has* to go through cognito for auth with amplify.  At some level this can be understood because the other AWS resources you're using need to authenticated access somehow, and cognito is how you provide that linkage.

---------------

---------------

# CacheUtils: getByteLength, is byte calculation correct?

---------------

Author: @grundmanise
Upvotes: 1
Comments: 0

I was studying how the Cache module works, more specifically how it calculates byte size.

And the calculation raised some concerns:
```
export function getByteLength(str: string): number {
	let ret: number = 0;
	ret = str.length;

	for (let i = str.length; i >= 0; i -= 1) {
		const charCode: number = str.charCodeAt(i);
		if (charCode > 0x7f && charCode <= 0x7ff) {
			ret += 1;
		} else if (charCode > 0x7ff && charCode <= 0xffff) {
			ret += 2;
		}
		// trail surrogate
		if (charCode >= 0xdc00 && charCode <= 0xdfff) {
			i -= 1;
		}
	}

	return ret;
}
```
Code copied for the reference [from here](https://github.com/aws-amplify/amplify-js/blob/master/packages/cache/src/Utils/CacheUtils.ts#L35
)

**Concern 1.**
ECMAScript spec [defines String type as](https://www.ecma-international.org/ecma-262/10.0/index.html#sec-ecmascript-language-types-string-type):
> The String type is the set of all ordered sequences of zero or more 16-bit unsigned integer values...

So each element occupies 2 bytes. That means the calculation is wrong as the math is: `string.length * 2`;

**Concern 2.**
If I am missing something from the spec (please note), and engine could actually allocate less bytes per code point the calculation is still incorrect as:
`if (charCode > 0x7f && charCode <= 0x7ff) { ret +=1 }` is wrong, `> 0x7f` takes 2 bytes:
```
new Blob([String.fromCharCode(0x80)]).size === 2
```


Am I missing something?

---------------

---------------

# DataStore TTL

---------------

Author: @lenarmazitov
Upvotes: 2
Comments: 0

Hello guys.
I have a question.
Does DataStore keeps all synced data in local storage forever?
What if add TTL parameter when querying data for every model instance?
And clear expired data from local storage along with sync process?

---------------

---------------

# What's the difference between aws-amplify-react and @aws-amplify/ui-react ?

---------------

Author: @LucasAndrad
Upvotes: 1
Comments: 1

What's the difference between`aws-amplify-react` and `@aws-amplify/ui-react` ?

I saw my docs and places saying to use `aws-amplify-react` but here on the docs to get start I saw this package [@aws-amplify/ui-react](https://docs.amplify.aws/start/getting-started/setup/q/integration/react#install-amplify-libraries) to use the module `withAuthentication` (which `aws-amplify-react` also has)

What's the difference between them? When should I use `aws-amplify-react` and when should I use `@aws-amplify/ui-react` ?
## Comment

---------------

Author: @LucasAndrad

Someone already replied here;
https://stackoverflow.com/questions/62142118/whats-the-difference-between-aws-amplify-react-and-aws-amplify-ui-react/62142309#62142309

---------------

---------------

# Unable to resolve "./httpHandlerOptions" from "node_modules\@aws-amplify\storage\lib-esm\providers\AWSS3Provider.js"

---------------

Author: @rajeshchoudhari147
Upvotes: 1
Comments: 2

I'm creating a react native expo application with AWS. I got this error once I added storage to the amplify using amplify add storage.  
## Comment

---------------

Author: @DrWorkhard

Got the same error
## Comment

---------------

Author: @mauerbac

hi @rmit-s3705430-rajesh-choudhari - this is better suited as an Issue rather than a Discussion. I created on here -> https://github.com/aws-amplify/amplify-js/issues/5964 . Would you want to add any other details? 

---------------

---------------

# Sign in with Apple Sheet shows null as the app name

---------------

Author: @VTSingle
Upvotes: 1
Comments: 0

Hi everyone. 
When I try to use **Auth.federatedSignIn({provider: 'SignInWithApple'})** I am getting success, but I'm lose app name in modal window. 
Could you help me, how I can to get app name ? 

<img width="174" alt="Screenshot at Jun 01 12-45-17" src="https://user-images.githubusercontent.com/26880406/83397125-c380a080-a405-11ea-865b-99f99c94b685.png">



---------------

---------------

# S3Image component does not display other users images

---------------

Author: @ranjeev75
Upvotes: 1
Comments: 2

I'm using these libraries to store and display images for other users:

` "aws-amplify": "2.2.2",
        "aws-amplify-react-native": "^4.0.4",`

```
import { S3Image } from 'aws-amplify-react-native';
import { Storage } from 'aws-amplify';

Storage.list('images/', { level: 'protected', identityId: 'abcd' }).then(// store response[]);

images.map(({ key }) => {
    return (
        <S3Image style={{ height: 100, width: 100}} level='protected' imgKey={key} identityId='abcd' 
    />);
})
```

But this results in an error as below:

```
<Error>
<Code>NoSuchKey</Code>
<Message>The specified key does not exist.</Message>
<Key>
protected/efg/images/7ac121b2-ff9b-42e4-ace8-e3f7f6f0d8cb.jpg
</Key>
<RequestId>8F0BD626697304D7</RequestId>
<HostId>
xxxx
</HostId>
</Error>
```

Where it has ignored the user `identityId` and has replaced it with the `identityId` of the current user. So it should be `protected/abcd/images/7ac121b2-ff9b-42e4-ace8-e3f7f6f0d8cb.jpg`

I've followed the [docs](https://docs.amplify.aws/ui/storage/s3-image/q/framework/react-native), so not sure why this occurs?
## Comment

---------------

Author: @ranjeev75

The docs state to get another users objects to use the `identityId`prop but I cannot see any reference to this in the [S3Image code](https://github.com/aws-amplify/amplify-js/blob/master/packages/aws-amplify-react-native/src/Storage/S3Image.tsx) :(
## Comment

---------------

Author: @ashika01

@ranjeev75 - do you actually see an image `protected/abcd/images/7ac121b2-ff9b-42e4-ace8-e3f7f6f0d8cb.jpg` in the s3 bucket?

---------------

---------------

# Default TOTP Customization throwing error "Cannot read property 'length' of null"

---------------

Author: @DavidTawil
Upvotes: 1
Comments: 0

I'm trying to fully customize the look of the Amplify Authenticator pages to look like my company's theme.
So far I've managed to customize the SignIn, ConfirmSignIn, ForgotPassword & RequireNewPassword.
I've done it by overriding the defaults, hiding them and using the slot prop.
So far so good.
Now I also need to use MFA so I'm trying to customize the TOTPSetup (& TOTPSetupComp, don't really know if that's necassery) in the same way that worked for the other components,
but I can't get the QRcode to be rendered at all.
I keep getting the following error **TypeError: Cannot read property 'length' of null**.

here's my `CustomTOTPSetupComp.js ` 


```
import React from "react";
import { TOTPSetupComp } from "aws-amplify-react";
import { withStyles } from '@material-ui/core/styles';
import Card from '@material-ui/core/Card';
import CardActions from '@material-ui/core/CardActions';
import Button from '@material-ui/core/Button';
import { Grid, TextField, Typography } from '@material-ui/core';
import QRCode from 'qrcode.react';
import { totpQrcode } from '@aws-amplify/ui';


class CustomTOTPSetupComp extends TOTPSetupComp {
  constructor(props) {
    super(props);
  }

  componentDidMount = function () {
    console.log('Componentdidmount');
    this.setup();
    });
    
};
  
  render() {

    var code = this.state.code;
    const { classes } = this.props;

      return (  
        <Grid container
        spacing={0}
        display="flex"        
        justify="center"
        alignItems="center"
        style={{ minHeight: '100vh' }}>
                <Card className={classes.root} >                           
                    <CardActions >
                    <Grid container spacing={2} justify='center' direction="column">
                      <Grid item >
                          <Typography variant="body1" className={classes.header} fullWidth>
                              Scan QR to get a verification code                              
                          </Typography>
                      </Grid>
                      <Grid item className={totpQrcode}>
                          <QRCode value={this.state.code}/>                         
                      </Grid>
                      <Grid item >
                          <TextField 
                          fullWidth 
                          id="totpCode" 
                          key="totpCode" 
                          name="totpCode"  
                          label="Code" 
                          variant="outlined" 
                          type="password" 
                          onChange={this.handleInputChange} 
                          required/>
                      </Grid>                     
                      <Grid item >
                        <Button 
                          className={classes.confirmBtn} 
                          variant="contained" 
                          color="primary" 
                          type="submit" 
                          fullWidth 
                          onClick={(event) => super.verifyTotpToken(event)}>
                            Confirm
                        </Button>
                      </Grid>
                    </Grid>
                    </CardActions>              
                  </Card>
              </Grid>
      );
  }
}

export default withStyles(useStyles)(CustomTOTPSetupComp);
```


and this is my `CustomTOTPSetup.js `

```
class CustomTOTPSetup extends TOTPSetup {
  constructor(props) {
    super(props);
    this._validAuthStates = ["TOTPSetup"];
  }
  showComponent() {
      return <CustomTOTPSetupComp />
  }
}

export default CustomTOTPSetup;

```

Thanks in advance!

---------------

---------------

# Amplify point to wrong API

---------------

Author: @pjohar
Upvotes: 1
Comments: 2

We created an app using Amplify with React Native. 
For adding API, we chose to add it from AppSync console - because we wanted to provision GraphQL queries for an existing DynamoDB table. https://docs.aws.amazon.com/appsync/latest/devguide/import-dynamodb.html

I deleted an old API from the AppSync console, and added a new API with some changes. But the Amplify CLI is still trying to connect to old API, and gets an error when not able to fetch the API, because it does not exist.


In my local amplify-meta.json file, the api points to new API. 
But the #current-cloud-backend/amplify-meta.json file still points to the old API.


I tried amplify remove api, and then amplify push. But still the 'amplify status' says shows the api category. 
## Comment

---------------

Author: @pjohar

Here is the error message:

Uncaught (in promise) NotFoundException: GraphQL API ubl7fopas5e6pbihl4rkmr3yx4 not found.
    at Object.o [as extractError] (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:41:185728)
    at constructor.a (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:55:144551)
    at constructor.callListeners (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:55:147691)
    at constructor.emit (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:55:147402)
    at constructor.emitEvent (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1391868)
    at constructor.e (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1387510)
    at n.runTo (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1440206)
    at https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1440411
    at constructor.<anonymous> (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1387720)
    at constructor.<anonymous> (https://d21i4kmlk61npv.cloudfront.net/8649469f7ec011c3e948562abac13b89ef1db83a/main.js:81:1391923)
## Comment

---------------

Author: @ashika01

Hi, could you open an issue with amplify-cli team? https://github.com/aws-amplify/amplify-cli.

Side Note: you could use `amplify pull` to pull in changes from backend. https://docs.amplify.aws/cli/start#amplify-pull

---------------

---------------

# can you provide a valid hoc component example working for react native amplify 4.1.2

---------------

Author: @ARChatco
Upvotes: 1
Comments: 1

tried many of theme and not working prperly the theme modification
## Comment

---------------

Author: @amhinson

This is something we are looking to improve in the future. However, does the [example from the documentation](https://docs.amplify.aws/ui/auth/authenticator/q/framework/react-native#using-withauthenticator-hoc) work for you?

---------------

---------------

# External Credentials with Amplify

---------------

Author: @bbernays
Upvotes: 1
Comments: 0

In 3.x.x Amplify removed support for `AWS.credentials` and `AWS.config`. In the [README.md](https://github.com/aws-amplify/amplify-js#amplify3xx-has-breaking-changes-please-see-the-breaking-changes-below) it says that a plan for handling this will be introduced post GA. 

Is there any timeline for this feature?

We are being forced to use Amplify 2.x.x in a new project as we have an external key management  tool.

---------------

---------------

# Calling federatedSignIn leads to signin page with 401 and "Login option is not available. Please try another one"

---------------

Author: @jfharden
Upvotes: 1
Comments: 4

I've been setting up a react app to auth using the cognito hosted ui with a custom domain against a simple user pool (no other auth providers, just the user pool).

When I call federatedSignIn the browser gets redirected to:

`https://<hosted_ui_domain>/oauth2/authorize?....`

which in turn redirects to 

`https://<hosted_ui_domain>/login?...`

but the login page is already a 401 error and displays the error message "Login option is not available. Please try another one"

![Screenshot from 2020-05-24 13-05-33](https://user-images.githubusercontent.com/2170030/82753673-49c23480-9dbf-11ea-9045-d9981ad7b893.png)

I'm not expecting there to be any authentication at this point, it's the sign in window after all.

Logging in at this prompt works exactly as expected and redirects back to my app where the JWT tokens work for authing against api_gateway cognito protected endpoints.

I had this all working with a domain which wasn't a custom domain for the hosted ui and was redirecting to 10.100.0.4. It's only since i switched to a custom domain this is happening

I'm hoping someone can help me understand what misconfiguration I have to make it land on the login page with that error.


In my react app I have (I've trimmed this to just the relevant sections):

```
import React from 'react';
import Amplify, { Auth, Hub } from 'aws-amplify';
import awsconfig from './awsconfig.json';
import awsauth from './awsauth.json';

Amplify.configure(awsconfig);
Auth.configure({ oauth: awsauth });

class AuthPanel extends React.Component {
  state = {
    user: null
  };

  render() {
    return (
      <div>
        <p>
          Not Logged in <button onClick={this.login.bind(this)}>Login</button>
        </p>
      </div>
    );
  }

  login(e) {
    Auth.federatedSignIn();
  }

  componentDidMount() {
    Hub.listen("auth", ({ payload: { event, data } }) => {
      switch (event) {
        case "signIn":
          this.setState({ user: data });
          break;
        case "signOut":
          this.setState({ user: null });
          break;
        default:
          this.log(`Event ${event} received from hub auth, unknown event`);
      }
    });

    Auth.currentAuthenticatedUser()
      .then(user => this.setState({ user }))
      .catch(() => this.log("Not signed in"));
  }

  log(message) {
    console.log(`AuthPanel: ${message}`);
  }
}

export default AuthPanel;
```

awsconfig.json:
```
{
  "Auth": {
    "region": "eu-west-2",
    "userPoolId": "<pool_id>",
    "userPoolWebClientId": "<client_id>",
    "mandatorySignIn": false,
    "cookieStorage": {
      "domain": "<app_domain>",
      "path": "/",
      "expires": 365,
      "secure": true
    },
    "authenticationFlowType": "USER_PASSWORD_AUTH"
  }
}
```

awsauth.json:
```
{
  "domain": "<hosted_ui_domain>",
  "scope": [
    "profile",
    "openid"
  ],
  "redirectSignIn": "https://<app_domain>/index.html",
  "redirectSignOut": "https://<app_domain>/index.html",
  "responseType": "token"
}
```

My cognito user pool is configured as follows:

Attributes: Username login with "Also allow sign in with verified email address"
Case insensitive
No required standard attributes

Devices: User opt-in remember devices (I've tried with this off as well)

App client:
Enable username password based authentication (ALLOW_USER_PASSWORD_AUTH
Enable refresh token based authentication (ALLOW_REFRESH_TOKEN_AUTH)
(All other auth flows disable, but I've tried with ALLOW_USER_SRP_AUTH on as well)

App client settings:
Enabled Identity providers: Cognito user pool
Allowed oauth flows:
Authorization code grant, implicit grant
Allowed oauth scopes:
openid, profile

Any help or suggestions would be greatly appreciated

## Comment

---------------

Author: @odannyboy000

This looks like a potential issue with Cognito, as I'm seeing this problem on all of my user pools right now. I haven't updated the aws amplify auth packages either.

@jfharden Have you filed a support ticket with AWS?
## Comment

---------------

Author: @bklebe

Same problem but using an existing user pool (i.e. not generated with Amplify CLI), and debugging against localhost currently: 

```javascript
Amplify.configure({
  Auth: {
    region: '<region>',
    userPoolId: '<user-pool-id>'
    userPoolWebClientId: '<user-pool-web-client-id>'
    oauth: {
      domain: '<hosted-ui-domain>',
      scope: [<scopes>],
      redirectSignIn: '<localhost>',
      redirectSignOut: '<localhost>',
      responseType: 'token'
    }
  }
});
```
Logs in and redirects back just fine but not sure why it's adding the errorMessage parameter when it redirects from `/oauth2/authorize` to `/login`. The request generated by the library when `Auth.federatedSignIn()` is called is 
```
GET https://<domain-prefix>.auth.<region>.amazoncognito.com/oauth2/authorize
?redirect_uri=<localhost>
&response_type=token
&client_id=<client-id>
&identity_provider=COGNITO
&scopes=<scopes>
&state=<state>
```
and response:
```
302 https://<domain-prefix>.auth.<region>.amazoncognito.com/login
?redirect_uri=<localhost>
&response_type=token
&client_id=<client-id>
&identity_provider=COGNITO
&scopes=<scopes>
&state=<state>
&errorMessage=Login+option+is+not+available.+Please+try+another+one
```
## Comment

---------------

Author: @odannyboy000

I created an AWS support ticket. There was an issue on the Cognito UI side that has been fixed by the team. Their response:

> There was a mismatch on Cognito's backend. This issue affects anyone who uses Amplify SDK and federatedSignin, because SDK is adding identity_provider=COGNITO automatically.

> Cognito service team just pushed a code change and this issue has been fixed. I have tested it and can confirm that I'm no longer seeing this error now.
## Comment

---------------

Author: @jfharden

@odannyboy000 Thank you for doing that.

Good to know it's been fixed

---------------

---------------

# How can I get a URL that never expire in AWS Amplify Storage.get API function?

---------------

Author: @yvescoinpass
Upvotes: 1
Comments: 0

I am implementing a blogging platform which user has to upload images for each content. I am wondering if I can during the upload I can get the permanent URL of the image as a response from AWS Amplify Storage.get function?

I want to know if this is a good idea?

```
Storage.get('img-sample.png', { expires: 9999999 })
    .then(result => console.log(result))
    .catch(err => console.log(err));
```

I wanted the URL because I will be saving it on the database. I don't want to call the Storage.get API function every time the post content is rendered because what if there are multiple images inside a post content. That will make the application less reliable I think.

---------------

---------------

# exist option to cancel all request?

---------------

Author: @berzavlu
Upvotes: 1
Comments: 0

hello, in the new feature to cancel request https://github.com/aws-amplify/amplify-js/pull/5753
i have a question/feature, exist te posibility to cancel all request in the network?
i know now uses axios.cancel but axios have the option to assign same cancel token to all request and then use axios.cancel but here we can use something like API.cancelAll()?

---------------

---------------

# using amplif CLI - how to abort, cancel, exit or go back

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

when using the CLI for example, to add or update AUTH a number of options are displayed in the terminal to which we need to respond, mostly with Y or N or enter, etc.

if i enter N instead of Y and press enter and then realise my mistake, how can i cancel, redo, return, etc to correct my mistake without having to continue through the list?

thanks

---------------

---------------

# api.del() - how to use? how to identify item to delete?

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

using amplify REST api, how to delete item?

documentation states:
`const apiName = 'MyApiName';
    const path = '/path';
    const myInit = { // OPTIONAL
        headers: {} // OPTIONAL
    }
    return await API.del(apiName, path, myInit);`

but how do i identify the item that i want to delete?

for example, with GET i use 
   `   let path = "/items/object/" + 123456789;`
to get the identified item (partition key = phone = 123456789) but this does not work with the code above

thanks

---------------

---------------

# GraphQL error: Communication error while executing a request to Elasticsearch.

---------------

Author: @dogsonacid
Upvotes: 1
Comments: 1

any idea what the issue is here?
## Comment

---------------

Author: @dogsonacid

it's intermittent , sometimes query works sometimes it fails. AWS issues?

---------------

---------------

# ui-vue validation-errors usage

---------------

Author: @kjetilge
Upvotes: 1
Comments: 1

So i tried this in a slot:
```
<amplify-authenticator
:validation-errors="map"
>
</amplify-sign-up>
```
and in methods:
```
methods: {
     map(message) {
      console.log('mess', message)
     if (/Username.*empty/i.test(message)) {
        return 'My error message'
      }
      return message
    }
}
```

This is not working. I expected the message to be changed.
I can't find any documentation for how to get this to work.
## Comment

---------------

Author: @kjetilge

The code above is wrong: It's like this:
```
<amplify-authenticator>
<amplify-sign-up
      :validation-errors="map"
>
</amplify-sign-up>
</amplify-authenticator>
```

---------------

---------------

# Enforce phone number uniqueness

---------------

Author: @ataravati
Upvotes: 1
Comments: 0

I'm using AWS Amplify with email as username and I use phone number for MFA. But, I also need to make sure that phone number is always unique. Each user should sign up with a unique phone number. How can I enforce that?

---------------

---------------

# Is it a must to setup 'Datastore.observe' for all tables?

---------------

Author: @nubpro
Upvotes: 1
Comments: 0

Question 1:
As per title, do I have to setup a subscription to observe every single tables that we're using?
If we didn't, will the client be in sync?

-----------------------------------
Question 2:
Currently, I'm facing an issue where I'm querying Table B, but the promise doesn't resolve until Table A has completed its sync. But please do note that I did not subscribe to Table B.

Here's my use case:
We load all orders with `DataStore.query`. When a user press on the order, we will load order details which is resided on another table. We do this by querying the Order Details table. But the promises to the Order Details table takes a long time to resolve (1-5mins). During this time, we observed that the Order table is syncing with the backend. As I mention before, we did not setup an subscription to the Order Details table, would that be a problem?

---------------

---------------

# External service data sync questions

---------------

Author: @mdoesburg
Upvotes: 2
Comments: 0

I am working on a React Native app using DataStore. Whenever the data gets updated in the cloud, an external service needs to be notified of the updated data.

**Question 1:**
What is the best way for the external service to be notified of data changes, or how can the service subscribe to said changes?

What I've thought of so far:
- DyamoDB streams

**Question 2:**
In addition to the external service being notified or somehow subscribing to data changes, it also needs to be able to update the data. What is the best way for an external service to update the data?

What I've thought of so far:
- Through a Lambda which runs a mutation

I guess I am really just wondering what the best way is to achieve the above things.

---------------

---------------

# Full tabular sorting, Spring 2020 edition

---------------

Author: @ffxsam
Upvotes: 1
Comments: 0

I've raised this topic quite a while ago, but a lot has changed with Amplify (and now there's DataStore!), so I wanted to revisit this. I've been using AppSync with Aurora Serverless (Postgres), which admittedly feels a bit like shoe-horning something to work properly. AppSync definitely seems to be built with DynamoDB as a 1st class citizen.

This is my use case:

A user on my site will log in, and be able to see a paginated table view of their data, which might look something like this:

| Name | Duration | Size | Uploaded | 
|------|----------|------|----------|
| Main Theme | 2:38 | 38.7MB | 3/23/2020 8:38pm |
| End Title | 1:13 | 17.2MB | 3/23/2020 8:59pm |

**Page 1 of 30** &lt; &gt;

Users need to be able to sort any column, in either ascending or descending order, as well as paginate through this data. Furthermore, if they search this data by keyword, that result set could also be sorted and paginated.

Is this possible yet, using Amplify? Literally this is the only reason I chose Postgres—believe me, I would rather be using DynamoDB, but as is the case with any product, user experience dictates the data architecture, not vice-versa.

I'd appreciate any advice!

---------------

---------------

# Migration from AmplifyEventBus to *AuthState*

---------------

Author: @fboudra
Upvotes: 1
Comments: 1

Using **Vue** framework, the migration doc is limited:
https://docs.amplify.aws/ui/auth/authenticator/q/framework/vue#migration

AmplifyEventBus isn't covered and doesn't exist anymore with @aws-amplify/ui-vue package.
I found references to initialAuthState, handleAuthStateChange and Hub but without examples for using them with **Vue**.

For example, how to listen to Auth state and react to events change?
## Comment

---------------

Author: @fboudra

Found https://github.com/aws-amplify/amplify-js/issues/2540

I came to the conclusion AmplifyEventBus is deprecated in favor of using Hub.
With the new @aws-amplify/ui-vue components, the migration section of the documentation is lacking guidance and even Hub documentation is toward React. It will be nice to have an example using Hub and Vuex for Vue framework users.

---------------

---------------

# Authenticate user using SAML from electron app.

---------------

Author: @samavedulark
Upvotes: 1
Comments: 0

Hi,

i was able to access our application form web using SAML, with authentication is redirected to IDP and redircturi back to our application. where is in electron app, we were unable to login.

IDP shall be same.
What shall be the redirect uri?
Do i need to change anything in coginto user pool.

Thanks
Rav



---------------

---------------

# How to enable mfa for a new user while Auth.signUp with userpool setting as optional

---------------

Author: @nihp
Upvotes: 1
Comments: 0

I need to enable MFA for a user while Auth.signUp(). Here some users can able to get code while  registering and some are not able to register because they failed to receive code. 

**I have set MFA setting as optional**.  

Here i have checked in user pool, for that user the MFA is not enabled. How can I know this in UI or how can I enable MFA for these users while signup using aws-amplify-react-native.

Can anyone is there to clarify this? If I set this as optional does it send MFA for some users and not for all users?

---------------

---------------

# How can I enable SMA MFA while signUp in aws-amplify-react-native (Some users not receiving the confirmation code)

---------------

Author: @nihp
Upvotes: 1
Comments: 0

How can I enable SMS MFA for the user who is registering for the first time.

Here some users can receive the code and some users not able to receive the code. 

How can I trigger this if the MFA is not enabled while Auth.signUp in aws-amplify-react-native.

---------------

---------------

# Clarification: How can I know if the user received code while doing Auth.signUp in aws-amplify-react-native

---------------

Author: @nihp
Upvotes: 1
Comments: 0

How can I know if the user received code while doing Auth.signUp in aws-amplify-react-native.

I need to track the user received code or not while registration as a new user. Does aws-amplify-react-native has any methods to track or show any message for the user in UI?

Note: I have registered as a new user i received code, but another one user tried to register but that one not received the confirmation code.

Also his MFA is not enabled.

I need to know how the MFA will be enabled and why that user not received code?

How can I track this in a method to convey this to users?

Any inputs on this will be appreciated


---------------

---------------

# I18n constructor not fully instantiating object?

---------------

Author: @bmilesp
Upvotes: 1
Comments: 1

Hello, I'm trying to instantiate the I18n object but it doesn't seem to recognize the I18n functions when I do so:

```
import { I18n }  from '@aws-amplify/core';
Vue.use(I18n)

const i18n = new I18n({
  language: "en"
})
```

then later in a function called during the mounted lifecycle callback:
```
i18n.get('Sign In')
```
Throws this error:

```
i18n.js?9225:91 Uncaught (in promise) TypeError: i18n.get is not a function
```

if i console.log(i18n) I can see the get() function in the constructor object:
https://snipboard.io/bWoJvj.jpg

But it's not fully "constructed" it seems (for lack of a better term).

Not sure why this is not working. If I use the Vue official vue-i18n package then i can instantiate the object in this way and use all of it's functions just fine, so I'm a bit at a loss as to why this isn't working for the Amplify I18n?

Any help would be greatly appreciated!

-bp

## Comment

---------------

Author: @ericclemmons

`I18n` operates as a singleton, so you don't need to worry about instantiating it:
> https://github.com/aws-amplify/amplify-js/blob/e8b63af76498ff88c0c2be43024487adaef6fe42/packages/core/src/I18n/index.ts

You're likely wanting to use `I18n.get('Sign In')`:
> https://docs.amplify.aws/lib/utilities/i18n/q/platform/js

---------------

---------------

# UnauthorizedException with Cognito user pool

---------------

Author: @tombrouwer
Upvotes: 1
Comments: 0

I am trying to do my first GraphQL request to a custom mutation. But I get a 401 UnauthorizedException, i tried a lot, searched a lot, but didn't solve it yet. Is there a way to get more info about the failed request (why is my token not valid?).

## Set Up:
I have a repository with **backend** info. Like functions, Auth en a GraphQL API.

- The default auth mode is `AWS_IAM`, additional is `AMAZON_COGNITO_USER_POOLS`.
- I created a custom mutation in the top of my schema.graphql file.
```
type Mutation {
  setUp(
      businessName: String!
      businessAddress: String!
      creditCardLinkNumber: String!
      ): String
      @function(name: "setUpAccount-${env}")
      @auth(rules: [{ allow: groups, groups: ["no_user"] }])
}
```
The resolver and builded schema generated by the CLI looks fine. See below.

I have a repo with my **frontend** application (this will be multiple soon). Only Amplify hosting is used.
- I use the aws-export.js from my backend repo in to setup Amplify in Vue. 
- I changed `"aws_appsync_authenticationType": "AWS_IAM"` to `"aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS"`. This results in sending the `Authorization` header in the request. I checked the token, it sends the group "no_user" in the groups claim:
```
"cognito:groups": [
    "no_user"
],
```
**The header:**
```
authorization: eyJ..................long token without prefix bearer
```

**It is not Authorized, but I do not know why.**

Amplify tells me (output in js from API.graphql method):
```
{ "data": {}, "errors": [ { "message": "Request failed with status code 401" } ] }
```

Response of request tells me:
```
{
  "errors" : [ {
    "errorType" : "UnauthorizedException",
    "message" : "Valid authorization header not provided."
  } ]
}
```

#### Generated resolver
```
## [Start] Static Group Authorization Checks **
#set($setUp_isStaticGroupAuthorized = $util.defaultIfNull(
            $setUp_isStaticGroupAuthorized, false))
## Authorization rule: { allow: groups, groups: ["no_user"], groupClaim: "cognito:groups" } **
#set( $userGroups = $util.defaultIfNull($ctx.identity.claims.get("cognito:groups"), []) )
#set( $allowedGroups = ["no_user"] )
#foreach( $userGroup in $userGroups )
  #if( $allowedGroups.contains($userGroup) )
    #set( $setUp_isStaticGroupAuthorized = true )
    #break
  #end
#end
## [End] Static Group Authorization Checks **


## [Start] Throw if unauthorized **
#if( $setUp_isStaticGroupAuthorized == false )
  $util.unauthorized()
#end
## [End] Throw if unauthorized **

## [Start] Stash resolver specific context.. **
$util.qr($ctx.stash.put("typeName", "Mutation"))
$util.qr($ctx.stash.put("fieldName", "setUp"))
{}
## [End] Stash resolver specific context.. **
```

#### Generated schema for this mutation
```
type Mutation {
  setUp(businessName: String!, businessAddress: String!, creditCardLinkNumber: String!): String @aws_cognito_user_pools
.... more mutaions
```




---------------

---------------

# AuthError - not been configured correctly logged when Auth module is not imported

---------------

Author: @veproza
Upvotes: 1
Comments: 17

**Describe the bug**
When Auth module is not imported anywhere in project, an AuthError is logged into console, confusing newcomers
_(note that I encountered it on React Experimental brach, but I don't expect it to be a factor)_

**To Reproduce**
Create a tiny demo where `Auth` is not used, e.g.

```javascript
import React from "react";
import Amplify from "@aws-amplify/core";
import {AmplifyAuthenticator} from "@aws-amplify/ui-react";
import awsconfig from './aws-exports';

Amplify.configure(awsconfig);

const Authenticated = (props) => {
    return (
        <AmplifyAuthenticator usernameAlias="email">
            {props.children}
        </AmplifyAuthenticator>
    );
};
export default Authenticated; // or render
```

**Expected behavior**
Console does not contain any error logs

**Code Snippet**
See above for not-working code. All it takes to get rid of the issue is to import `Auth` anywhere in the code while making sure it does not get tree-shaked for never using it, eg:
```javascript
import React, {FunctionComponent} from "react";
import Amplify from "@aws-amplify/core";
import {Auth} from 'aws-amplify';
import {AmplifyAuthenticator} from "@aws-amplify/ui-react";
import awsconfig from './aws-exports';

Amplify.configure(awsconfig);


const Authenticated: FunctionComponent = (props) => {
    Auth.currentAuthenticatedUser(); // noop because of bug in Amplify requiring Auth is imported.
                                     // otherwise a AuthError - Amplify has not been configured correctly will be thrown
    return (
        <AmplifyAuthenticator usernameAlias="email">
            {props.children}
        </AmplifyAuthenticator>
    );
};
export default Authenticated;
```
**Screenshots**
![image](https://user-images.githubusercontent.com/1926602/80993155-e33e9c00-8e3a-11ea-8f1f-9fc134316f04.png)

**What is Configured?**
AWS Exports
   ```
const awsmobile = {
    "aws_project_region": "eu-central-1",
    "aws_appsync_graphqlEndpoint": "https://xxx.appsync-api.eu-central-1.amazonaws.com/graphql",
    "aws_appsync_region": "eu-central-1",
    "aws_appsync_authenticationType": "AMAZON_COGNITO_USER_POOLS",
    "aws_cognito_identity_pool_id": "eu-central-1:xxx",
    "aws_cognito_region": "eu-central-1",
    "aws_user_pools_id": "eu-central-xxx",
    "aws_user_pools_web_client_id": "xxx",
    "oauth": {}
};
```
  
<details>
  <summary><strong>Environment</strong></summary>

<!-- Please run the following command inside your project and copy/paste the output into the codeblock: -->

```
  System:
    OS: Linux 4.4 Ubuntu 18.04.1 LTS (Bionic Beaver)
    CPU: (4) x64 Intel(R) Core(TM) i5-6600K CPU @ 3.50GHz
    Memory: 1.88 GB / 15.96 GB
    Container: Yes
    Shell: 4.4.19 - /bin/bash
  Binaries:
    Node: 11.13.0 - ~/.nvm/versions/node/v11.13.0/bin/node
    npm: 6.7.0 - ~/.nvm/versions/node/v11.13.0/bin/npm
  npmPackages:
    @aws-amplify/api: ^3.1.9 => 3.1.9
    @aws-amplify/datastore: ^2.0.10 => 2.0.10
    @aws-amplify/pubsub: ^3.0.10 => 3.0.10
    @aws-amplify/ui-react: ^0.2.5 => 0.2.5
    @reach/router: ^1.3.3 => 1.3.3
    @testing-library/jest-dom: ^4.2.4 => 4.2.4
    @testing-library/react: ^9.5.0 => 9.5.0
    @testing-library/user-event: ^7.2.1 => 7.2.1
    @types/jest: ^24.9.1 => 24.9.1
    @types/node: ^12.12.37 => 12.12.37
    @types/reach__router: ^1.3.5 => 1.3.5
    @types/react: ^16.9.34 => 16.9.34
    @types/react-dom: ^16.9.7 => 16.9.7
    aws-amplify: ^3.0.10 => 3.0.10
    ini: ^1.3.5 => 1.3.5
    inquirer: ^6.5.1 => 6.5.2
    node-sass: ^4.14.0 => 4.14.0
    react: 0.0.0-experimental-e5d06e34b => 0.0.0-experimental-e5d06e34b
    react-bem-helper: ^1.4.1 => 1.4.1
    react-dom: 0.0.0-experimental-e5d06e34b => 0.0.0-experimental-e5d06e34b
    react-scripts: 3.4.1 => 3.4.1
    source-map-explorer: ^2.4.2 => 2.4.2
    typescript: ^3.7.5 => 3.7.5
```

</details>
## Comment

---------------

Author: @jordanranz

Hey @veproza, `AmplifyAuthenticator` uses the Amplify Auth category under the hood. To configure the Auth category properly you must either configure Amplify using the module in `aws-amplify`:
```
import Amplify from "aws-amplify";
import {AmplifyAuthenticator} from "@aws-amplify/ui-react";
import awsconfig from './aws-exports';

Amplify.configure(awsconfig);
```
or
```
import Auth from "@aws-amplify/auth";
import {AmplifyAuthenticator} from "@aws-amplify/ui-react";
import awsconfig from './aws-exports';

Auth.configure(awsconfig);
```

Can you point me to the documentation you are following that guides you to the broken configuration?
## Comment

---------------

Author: @Johnniexson

I'm still stuck with this error, tried everything but not working.
## Comment

---------------

Author: @veproza

Hi @jordanranz , I'm aware of the config, my *To reproduce* code does contain the `Amplify.configure` call.

The code itself is not from guides, it's from after I got relatively comfortable and started restructuring the app into smaller pieces. The component mentioned is supposed to be a wrapper "guarding" the inner application only for logged in users and displaying login screen for all other. But I wrote this component before needing any `Auth` methods, and the app started logging the error because of that. After adding `Auth`, the error disappeared, but I think the app should be working even without `Auth` specifically imported.
## Comment

---------------

Author: @Johnniexson

Configuring Amplify like this, i get the AuthError:

```
import Amplify from "aws-amplify";
import awsconfig from "./aws-exports";

Amplify.configure(awsconfig);
```

But importing like this, i dont get the error.

```
import Amplify from "@aws-amplify/core";
import awsconfig from "./aws-exports";

Amplify.configure(awsconfig);
```

Any reason for this please and does it make any difference?
## Comment

---------------

Author: @veproza

Oh I see! I imported Amplify from `@aws-amplify/core`, but I should be using `aws-amplify`! Now it works even without importing `Auth`.

This happened due to combination of IDE's automatic import and lack of correct import specification in the DataStore docs (https://docs.amplify.aws/lib/datastore/sync/q/platform/js#connect-your-app). Since I started working with Amplify using only DataStore, I couldn't find where to source `Amplify` from correctly, so I let the IDE figure it out - and it worked, for the most part, up until now.

So I'd propose adding a line `import Amplify from "aws-amplify";` to the last code example at https://docs.amplify.aws/lib/datastore/sync/q/platform/js#existing-backend, that should help some newcomers with fancy IDEs :-)
## Comment

---------------

Author: @Johnniexson

> Oh I see! I imported Amplify from `@aws-amplify/core`, but I should be using `aws-amplify`! Now it works even without importing `Auth`.
> 
> This happened due to combination of IDE's automatic import and lack of correct import specification in the DataStore docs (https://docs.amplify.aws/lib/datastore/sync/q/platform/js#connect-your-app). Since I started working with Amplify using only DataStore, I couldn't find where to source `Amplify` from correctly, so I let the IDE figure it out - and it worked, for the most part, up until now.
> 
> So I'd propose adding a line `import Amplify from "aws-amplify";` to the last code example at https://docs.amplify.aws/lib/datastore/sync/q/platform/js#existing-backend, that should help some newcomers with fancy IDEs :-)

@veproza but i still get the error while importing from from aws-amplify like 
`import Amplify from "aws-amplify";`
## Comment

---------------

Author: @veproza

@Johnniexson It's weird that what fixed it for me broke it for you and vice versa. Is there any minimal code example you could share? Can't it be some timing issue, that you're calling `.configure` after some other call in another module already tried to use some `Auth` method? Easiest way to check would be `console.log` something at the `Amplify.configure` line and seeing if the AuthError happens before or after that log...
## Comment

---------------

Author: @Johnniexson

> @Johnniexson It's weird that what fixed it for me broke it for you and vice versa. Is there any minimal code example you could share? Can't it be some timing issue, that you're calling `.configure` after some other call in another module already tried to use some `Auth` method? Easiest way to check would be `console.log` something at the `Amplify.configure` line and seeing if the AuthError happens before or after that log...

@veproza  I Just tried the console log thing, the `Amplify.configure()` runs before any other thing in the app. I'm using angular on ionic.
## Comment

---------------

Author: @veproza

@Johnniexson Sorry, that's the only thing that occurred to me. I don't know Angular or Ionic, so I won't be able to help you.
## Comment

---------------

Author: @Johnniexson

@veproza  no probs, thanks for your time. But how any idea on diff btw configuring using Amplify from "@aws-amplify/core" and from "aws-amplify"??
## Comment

---------------

Author: @Amplifiyer

@Johnniexson, the only difference is that importing Amplify from `aws-amplify` by default imports the Auth module and `Amplify.configure()` then successfully configure it. However importing from `@aws-amplify/core` does not do any of that.  See ref below

https://github.com/aws-amplify/amplify-js/blob/50bb84995a7b15d969f0b0ce10e6b254ec95c94b/packages/aws-amplify/src/index.ts#L18-L23

I'm looking for a fix that should make importing from `@aws-amplify/core` work as well as long as Auth is imported somewhere in your app (either through the UI-component packages such as `ui-react` or direct import in any of your other files)
## Comment

---------------

Author: @Johnniexson

> @Johnniexson, the only difference is that importing Amplify from `aws-amplify` by default imports the Auth module and `Amplify.configure()` then successfully configure it. However importing from `@aws-amplify/core` does not do any of that. See ref below
> 
> https://github.com/aws-amplify/amplify-js/blob/50bb84995a7b15d969f0b0ce10e6b254ec95c94b/packages/aws-amplify/src/index.ts#L18-L23
> 
> I'm looking for a fix that should make importing from `@aws-amplify/core` work as well as long as Auth is imported somewhere in your app (either through the UI-component packages such as `ui-react` or direct import in any of your other files)

It works fine while importing from "@aws-amplify/core" without any error, but importing from "aws-amplify" throws the AuthError. My only problem is that i'm unsure if importing and configuring using "@aws-amplify/core" might break something else as i use other aws services such as api and storage in the app.
## Comment

---------------

Author: @jordanranz

I am going to move this thread to a discussion.
## Comment

---------------

Author: @jordanranz

@Johnniexson can you describe your file structure a bit. In which file are you executing the following configuration?:
```
import Amplify from "aws-amplify";
import awsconfig from "./aws-exports";

Amplify.configure(awsconfig);
```

Are you using the `amplify-authenticator` components? If so which npm package are you using?
## Comment

---------------

Author: @Johnniexson

This throws AuthError:

```
import Amplify from "aws-amplify";
import awsconfig from "./aws-exports";

Amplify.configure(awsconfig);
```

But this dosen't:

```
import Amplify from "@aws-amplify/core";
import awsconfig from "./aws-exports";

Amplify.configure(awsconfig);
```

Here is my app.module.ts file:

```
import { AmplifyAngularModule, AmplifyService } from 'aws-amplify-angular';

@NgModule({
  ...
  imports: [
    ...
    AmplifyAngularModule
  ],
  ...
  providers: [
    ...
    AmplifyService
  ]
  ...
});
```

With the AmplifyService from the amplify-angular module, i can access Api, Auth, Storage, etc from my components.
## Comment

---------------

Author: @Johnniexson

@sammartinez the change you made was to the docs, how does it fix the issue cus i still get the AuthError even after importing exactly the way twas done in the docs.
## Comment

---------------

Author: @jonmifsud

Seems we're getting the same error on our end. I'm setup with a working project. Tried to get a colleague to setup amplify with the same project; she had to use `import Amplify from "@aws-amplify/core";` to get it working.

---------------

---------------

# API queries returns limited data items

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 1

Hello guys, i have this model: 

```
type Todo
 @model
 @key(
    name: "byUser"
    fields: ["userId"]
    queryField: "todosByUser"
  ) {
  id: ID!
  userId: ID!
  content: String!
}

type User @model {
  id: ID!
  name: String!
  todos: [Todo] @connection(keyName: "byUser", fields: ["id"])
}
```

The issue i have is that anytime i query any user data, with: 
`const userData = await API.graphql(graphqlOperation(queries.getUser, {id: userId}));`

 `userData.todos.items` only return maximum of 10items even though i have more than 10 items in the todo table created by the specified user.

Any reason for this? Thanks in anticipation.
## Comment

---------------

Author: @undefobj

Default limit is 10 items. You can pass in a higher limit and paginate through by using the nextToken argument.

---------------

---------------

# Amplify codegen for Angular does not generate importable mutations, queries and subscriptions

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 0

Hello guys, how come on `amplify codegen` for angular projects the generated statements in the generated graphql folder are mutations.graphql, queries.graphql, schema.json, subscriptions.graphql.

Looking into these files the statements are not exported while using Angular as preferred language as when asked `? Choose the code generation language target: angular(or your preferred language target)` so there is no way to import them in my component in other to use then like this as stated by the docs [here:](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js#enable-queries-mutations-and-subscriptions)

import * as mutations from './graphql/mutations';
import * as subscriptions from './graphql/subscriptions';

async create() {
  const todo = { name: "My first todo", description: "Hello world!" };

   /* create a todo */
  await API.graphql(graphqlOperation(mutations.createTodo, {input: todo}));
}

OR

const subscription = API.graphql(graphqlOperation(subscriptions.OnCreateTodo, variables));

---------------

---------------

# Changing defaultCountryCode

---------------

Author: @asparamancer
Upvotes: 1
Comments: 0

How can I change defaultCountryCode in AmplifySignUp?

I can do: 
```
<AmplifySignUp
        slot="sign-up"
        usernameAlias="email"
        formFields={[
          {
            type: "name",
            label: "Your full name",
            placeholder: "First Last",
            required: true,
          }, ... 
``` 
for other formFields items but can't see how to do it for defaultCountryCode

---------------

---------------

# Unable to get the Global Secondary Index query to work

---------------

Author: @shahid285
Upvotes: 1
Comments: 1

Hi All, I am new to AWS ans also AWSAPPSync. I am trying to fetch records from DynamoDB using GSI, post seeing multiple post here suggesting GSI as the way to achieve consistency in results.
I did create a GSI index for my table, and then proceed to write the query in request mapping template. post writing the query, i am getting 'MappingTemplate' Error as below
![image](https://user-images.githubusercontent.com/64884440/82039274-60330680-96c2-11ea-91e4-627c80d15891.png)
I am sharing my table here, and also the GSI been created for reference, along with the request and response template from the resolver.
![image](https://user-images.githubusercontent.com/64884440/82039468-a5efcf00-96c2-11ea-864f-5e5316131b3e.png)
![image](https://user-images.githubusercontent.com/64884440/82042163-0f71dc80-96c7-11ea-98e3-c997a9904c10.png)
![image](https://user-images.githubusercontent.com/64884440/82042207-231d4300-96c7-11ea-9bb5-2356d4474766.png)

![image](https://user-images.githubusercontent.com/64884440/82039817-2e6e6f80-96c3-11ea-90a1-bcd261f5ad45.png)

I have been trying to run this for over a week now, and i have failed. I request anyone's help here to understand what am i doing wrong, and what needs to be done.
Thanks in Advance!
Shahid Nawaz


## Comment

---------------

Author: @shahid285

After putting an exhausting effort i found the reason and also got the thing working finally.
The problem was i removed the hash next to brand in expression attribute
Also found out that primary Key cannot be used in Filter and neither sort key
The following is the request mapping template and the results
![image](https://user-images.githubusercontent.com/64884440/82051487-929b2e80-96d7-11ea-96ae-16b5dbb90422.png)
![image](https://user-images.githubusercontent.com/64884440/82051533-ae063980-96d7-11ea-9018-e39265a9e125.png)

This thread can be closed 

Thanks 
Shahid Nawaz



---------------

---------------

# Amplify Analytics with Pinpoint security issue in single page app

---------------

Author: @sonphnt
Upvotes: 2
Comments: 0

Hi,

I have configured successfully Amplify Analytics and AWS Pinpoint in my VueJs app for UnauthorizedAccess. The question is what happens if someone steals my "identityPoolId" and "appId" of Pinpoint values from the browsers. And they use those settings in their app for any purposes to make my analytics completely imprecise.

I can not find any settings in PinPoint with "Allow domain" only for my site to avoid other domains using it.



---------------

---------------

# Ability to hide the toast or customize it

---------------

Author: @emmi
Upvotes: 1
Comments: 0

Related to @amplify-js/ui-components amplify-toast

Hi, is there a way to hide the toast message bar that's shown on top of the page when ever error message arrive? I would like to display the error messages closer to the form and also have the messages translated to Finnish instead of English. Also the ability to customise the css would be amazing. 

Is there any ways to do this with the current version or should I look into making my own PR about this? 

---------------

---------------

# How to make DataStore to work with Gatsby.js

---------------

Author: @sakhmedbayev
Upvotes: 1
Comments: 0

Has anyone successfully made DataStore work with Gatsby.js? What does it take? Do you have an example?

---------------

---------------

# Number of Cognito calls triggered by Auth.signIn()

---------------

Author: @TimNZ
Upvotes: 1
Comments: 1

EIGHT - 8 - Cognito API calls triggered by Auth.signIn(username,password) on fresh load of app, with Device tracking enabled.

2 calls are for Device tracking.

Is 6 calls (when device tracking disabled) normal?

Only 4 if Auth.signIn() called when already signed in.

After Auth.signOut(), Auth.signIn() results in 6/8 calls again.

```
      Auth.configure(
      {
          mandatorySignIn: false,
          region: amplifyConfig.auth.REGION,
          userPoolId: amplifyConfig.auth.USER_POOL_ID,
          identityPoolId: amplifyConfig.auth.IDENTITY_POOL_ID,
          userPoolWebClientId: amplifyConfig.auth.APP_CLIENT_ID
      })

```

```
    userSignIn({email,password})
    {
      return Auth.signIn(email,password)
    }

```

![image](https://user-images.githubusercontent.com/1051701/81659520-e61a3c00-948d-11ea-8f34-4371b3a6928e.png)

# 1)
![image](https://user-images.githubusercontent.com/1051701/81658255-b3bc0f00-948c-11ea-9f7e-37328e236841.png)

# 2)
![image](https://user-images.githubusercontent.com/1051701/81658294-bd457700-948c-11ea-84ae-457694e4f78f.png)

# 3)
![image](https://user-images.githubusercontent.com/1051701/81658361-cdf5ed00-948c-11ea-8be9-9fe150259b7a.png)

# 4)
![image](https://user-images.githubusercontent.com/1051701/81658430-df3ef980-948c-11ea-8c66-dcd98b3492f4.png)

# 5)
![image](https://user-images.githubusercontent.com/1051701/81658459-e6660780-948c-11ea-9e8c-a26b8ef05a8a.png)

# 6)
![image](https://user-images.githubusercontent.com/1051701/81658552-fc73c800-948c-11ea-9747-ffe9e06ecc2a.png)

# 7)
![image](https://user-images.githubusercontent.com/1051701/81658581-04cc0300-948d-11ea-82ff-fd91b11a5178.png)

# 8)
![image](https://user-images.githubusercontent.com/1051701/81658644-11505b80-948d-11ea-8a00-06b03c4a1cd1.png)

## Comment

---------------

Author: @elorzafe

@TimNZ thanks for pointing this out, I merged a PR that avoid refresh token and I can look the ones you mention too. 

---------------

---------------

# Problem SignIn with Apple at the User Pool level

---------------

Author: @amerida63
Upvotes: 1
Comments: 1

Anything new with the login functionality with apple at the User Pool level, I'm trying to implement it with Swift, (Mobile only). I have configured the entire environment but it does not work.

I really don't know if I have to update the awsconfiguration.json (but every time I generate it, it doesn't update it for me) I don't know what apple keys should I put it, if anyone can help me it would be great.

I am trying to use the same approach that I use for google and facebook, but the

getIdentityId()

function always fails.

I will leave here the code of what I am trying to do, see if my info is incorrect and can help me.

```
` 
// identityProvider ="SignInWithApple"  I have also tried  "appleid.apple.com"
// accesToken = "appleIDCredential.identityToken" I use the one that returns the login with apple

AWSMobileClient.default().federatedSignIn(providerName: identityProvider, token: accesToken) { (userState, error)  in
            
            guard error == nil, let userState = userState else {
                completion(false)
                return
            }
            switch userState {
            case .signedOut, .signedOutFederatedTokensInvalid, .signedOutUserPoolsTokenInvalid, .guest, .unknown:
                completion(false)
                return
            // Now we are signed in we need to check whether this is really a new user or not
            case .signedIn:
                completion(true)
          //This function always returns me correctly, and indicates that the session is started.
            }
        }

//But when call this function. 
 let identityTask: AWSTask = AWSMobileClient.default().getIdentityId()

 override public func getIdentityId() -> AWSTask<NSString> {
        guard self.internalCredentialsProvider != nil else {
            return AWSTask(error: AWSMobileClientError.cognitoIdentityPoolNotConfigured(message: "Cannot get identityId since cognito credentials configuration is not available."))
        }
        let identityFetchTaskCompletionSource: AWSTaskCompletionSource<NSString> = AWSTaskCompletionSource()
        self.internalCredentialsProvider?.getIdentityId().continueWith(block: { (task) -> Any? in
            if let error = task.error {
                if error._domain == AWSCognitoCredentialsProviderHelperErrorDomain
                    && error._code == AWSCognitoCredentialsProviderHelperErrorType.identityIsNil.rawValue {

 All the time it enters here, so it does not return a valid result.

                    identityFetchTaskCompletionSource.set(error: AWSMobileClientError.identityIdUnavailable(message: "Fetching identity id on another thread failed. Please retry by calling `getIdentityId()` method."))
                } else {
                    identityFetchTaskCompletionSource.set(error: error)
                }
            } else if let result = task.result {
                identityFetchTaskCompletionSource.set(result: result)
            }
            return nil
        })
        
        return identityFetchTaskCompletionSource.task
    }
`
```
## Comment

---------------

Author: @mauerbac

Is this your issue? https://github.com/aws-amplify/amplify-js/issues/5723

---------------

---------------

# Lambda templates

---------------

Author: @Danielduel
Upvotes: 1
Comments: 1

Have you some thoughts about providing typescript and/or deno lambdas straight from cli?
Like adding additional step to `amplify function add` (and updating it)
Would it be welcomed feature?

... edgecase: when user is updating lambda and language was changed - just move lambas `src/` into `old_{previous_language}_src_{timestamp}/` and create new src folder from template.
## Comment

---------------

Author: @Danielduel

I am moving this discussion into amplify-cli repo.

---------------

---------------

# [DataStore] Why is query the way it is?

---------------

Author: @nubpro
Upvotes: 1
Comments: 1

I'm kinda of flustered using Datastore at this point, there's certain stuff that I don't understand especially the syntax **query**.

Here is the use case:
1. Login with amplify.
2. Query a model after logged in.
3. Returns data.
4. Logout.
5. Clear datastore after logged out.
6. Returns to login page.
7. Proceed to login again.
8. Query the same model.
9. Returns [] (an empty array).

I'm expecting it to return data, just like in step 3.
But instead, it doesn't and I had to subscribe to the same model in order to get the expected data.

The question is, why does query behaves like this? Am I missing something here?
## Comment

---------------

Author: @manueliglesias

Hi @nubpro 

I think the issue here is that you might be querying the DataStore before it syncs with the backend and that's why you receive an empty array back.

You can try observing your model, e.g.

```typescript
const items = [];

const subscription = DataStore.observe(Note, c => c.content("contains", "a")).subscribe(({element, opType}) => {
  if(opType === OpType.INSERT) {
    items.push(element);
  
    if(items.length === 10) {
      console.log(items);

      subscription.unsubscribe();
    }
  }
});
```

BTW, this is an issue we are aware of and we are working on it, you'll be able to listen for DataStore events to, e.g. defer querying until the sync is done. You can follow progress on that here: https://github.com/aws-amplify/amplify-js/issues/5077

---------------

---------------

# Angular Amplify Authentication - Can't get session to persist

---------------

Author: @yonnyviz
Upvotes: 1
Comments: 0

👋  Hi Guys

I'm trying to implement the amplify auth on an angular project, I'm following [the Sign up, Sign in & Sign out documentation from Amplify](https://docs.amplify.aws/lib/auth/emailpassword/q/platform/js) but I can't get the authenticated user session to persists. When I perform the Auth.currentAuthenticatedUser() function I get that user is not authenticated 😭. 

Would like to know your thoughts on what is the best approach to implement amplify auth on angular. Do I need to store sessions tokens on local storage or that is not necessary?.

---------------

---------------

# How to invoke SageMaker endpoint from AmplifyJS

---------------

Author: @OElesin
Upvotes: 1
Comments: 0

How do I invoke a SageMaker endpoint using AmplifyJS? Is there any documentation about this?

---------------

---------------

# Two user type Sign up

---------------

Author: @myfairshare
Upvotes: 1
Comments: 0

Lets say I'm developing an app like Uber where I have 2 types of user, I want **drivers** to register and I want **customers** to register.  

So I understand I will need 2 user groups in my user pool, one for drivers and one for customers.

Would both user types register with cognito and then after registering and sign in they are presented with another screen where they select their use case and then a lambda function is used to put the user in the correct group based on their selection.  

I'm a little bit unsure of this step so any thoughts welcome, thank you!

---------------

---------------

# TypeError: Cannot read property 'type' of undefined

---------------

Author: @zerox92
Upvotes: 1
Comments: 0

Hello,

I have updated the schema.graphql file and I am trying to complie it but I am getting the following error:

TypeError: Cannot read property 'type' of undefined

I am trying to implement many-to-many using two 1-M @connections, an @key, and a joining @model as explained [here](https://docs.amplify.aws/cli/graphql-transformer/directives#many-to-many-connections):

Below is my schema:

```
type User @model {
  email: String!
  firstName: String!
  lastName: String!
  isJobSeeker: Boolean
  age: Int
  mobile: String
  address: String
  userJobList: [UserJobs] @connection(keyName: "byUserJobs", fields: ["email"] )
}

type UserJobs 
  @model(queries: null)
  @key(name: "byUserJobs", fields:["emailID", "jobsID"])
  @key(name: "byJob", fields:["jobsID", "emailID"]) {
	id:ID!
	emailID: String!
	jobsID: String!
	user: User! @connection(fields: ["emailID"])
	job: Job! @connection(fields: ["jobsID"])
}

type Job @model {
	jobID: String!
	isVolunteerJob: Boolean!
	orgName: String
	jobType: String
	startDate: String
	endDate: String
	noOfHours: Int
	startTime: String
	endTime: String
	description: String
	amount: Int
	address: String
	userList: [UserJobs] @connection(keyName: "byJob", fields: ["jobID"])
}
```


---------------

---------------

# Amplify SSR Progress

---------------

Author: @michaelmerrill
Upvotes: 1
Comments: 1

I wanted to check in about the SSR work happening on this library. I know @ericclemmons has been making a lot of progress lately and I just wanted to say thank you for all your hard work!

I'm curious how getting the current session will work with SSR. Since the server doesn't have access to the cookie storage it will need to get the cookie from the request header. Do you plan on having the `getCurrentUser()` method take a request argument? Something like this maybe?

```(javascript)
const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);
const cognitoUser = userPool.getCurrentUser({ req });
```

I think it's helpful to see how the end user might be using this so here is an example using NextJS. 

```(javascript)
// auth.js
export const getCurrentSession = async ({ req }) => {
  const cognitoUser = userPool.getCurrentUser({ req });

  if (cognitoUser != null) {
    return new Promise((resolve, reject) => {
      cognitoUser.getSession((err, session) => {
        if (err) return reject(err);
        if (!session.isValid()) {
          resolve(null);
        }
        resolve(session);
      });
    });
  }
  return null;
};
```
```(javascript)
// SomePage.js
export async function getServerSideProps({ req, res }) {
  const session = await getCurrentSession({ req });

  if (!session) {
    res.writeHead(302, {
      Location: "/signin",
    });
    
    res.end();
  }

  return {
    props: {},
  };
}
```
## Comment

---------------

Author: @ericclemmons

We haven't settled on the API usage yet, but we'll be documenting it in https://github.com/aws-amplify/amplify-js/issues/5435 once we're done identifying how our APIs will need to accommodate the `req` (or even the `res`) objects.

---------------

---------------

# JWT with AppSync & Cognito

---------------

Author: @tcodes0
Upvotes: 1
Comments: 0

I'm stuck in an authentication problem to hit my graphql API using AppSync. API is set to default authorization of cognito userpools. Basically I want to support third party login (facebook/apple) which return me a JWT. Sending this JWT as `Authorization` header doesn't work and results in a 401, every single time I tried. Tried digging docs and setting API to OpenId Connect default authentication, nothing works.

I'm currently exploring how to get a cognito JWT from a third party JWT.

```ts
const cognitoUser = new Cognito.CognitoUser(userData)
const session = await new Promise<Cognito.CognitoUserSession>((resolve, reject) => {
  cognitoUser?.authenticateUser(authenticationDetails, {
    onSuccess: function (result) {
      AWS.config.region = config.region
      AWS.config.credentials = new AWS.CognitoIdentityCredentials({
        IdentityPoolId: `${config.region}:${config.identityPoolId}`,
        Logins: {
          [config.identityPoolLoginKey]: result.getIdToken().getJwtToken(),
        },
      })
// This works
const jwt = session.getAccessToken().getJwtToken()

//But this does not
const facebookJwt = /* login with facebook, get JWT */
 AWS.config.credentials = new AWS.CognitoIdentityCredentials({
  IdentityPoolId: 'IDENTITY_POOL_ID',
  Logins: {
    'graph.facebook.com': facebookJwt
  }
});
AWS.config.credentials.get(function(){
  //How to get a cognito.session with this info? I want to call session.getAccessToken().getJwtToken()
});
```


---------------

---------------

# Have anyone tried using AWS Lambda Proxy with RDS

---------------

Author: @muriloSanto
Upvotes: 1
Comments: 0

Have anyone tried using AWS Lambda Proxy with RDS to reuse connections?

I'm not able to select any RDS instance when trying to add new Proxy to lambda function.

Already tried launching RDS instaces from multiple versions, instance types, engines, and nothing.

---------------

---------------

# Return only some information in graphqlOperation operation.

---------------

Author: @ajitgoel
Upvotes: 1
Comments: 1

I have the following working  code that return all the information related to user profile. How can I change the code to return only including  id, userId, vocabularies(since the Vocabulary screen only requires Vocabulary related information)? 

**~\src\views\pages\Vocabulary.vue:**
```
const userId='AWS_Cognito_Guid';
const listUserProfilesFilter={userId:{eq:userId}};
const result = await API.graphql(graphqlOperation(listUserProfiles, {filter: listUserProfilesFilter}));
```

**~\src\graphql\queries.js**

```
export const listUserProfiles = /* GraphQL */ `
  query ListUserProfiles(
    $filter: ModelUserProfileFilterInput
    $limit: Int
    $nextToken: String
  ) {
    listUserProfiles(filter: $filter, limit: $limit, nextToken: $nextToken) {
      items {
        id
        userId
        fullName
        billingAddress
        country
        vatNumber
        notificationTranscriptsCompleted
        notificationTranscriptsError
        vocabularies
        owner
      }
      nextToken
    }
  }
`;
```
## Comment

---------------

Author: @ajitgoel

I was able to fix this issue by duplicating the query, rename exported const name ONLY, adjust content, use new one

---------------

---------------

# Aws table structure

---------------

Author: @BryceAMcDaniel
Upvotes: 1
Comments: 1

Recently read that DynamoDB suggests a Single Table schema. Should this be implemented with Amplify? Does Amplify do anything under the hood to improve my multi table schema?

Just getting into NoSQL and DynamoDB, so forgive the uneducated questions.
## Comment

---------------

Author: @aaronfay

This has been discussed a bit, you can [find the discussion here](https://github.com/aws-amplify/amplify-cli/issues/431#issuecomment-444303514).

---------------

---------------

# Updating Amplify Auth Redirect URIs?

---------------

Author: @fireflysemantics
Upvotes: 1
Comments: 4

When typing `amplify update auth` it used to ask if I wanted to update the redirect URIs.

However now it only gives these options:

```
Using service: Cognito, provided by: awscloudformation
 What do you want to do? 
  Apply default configuration with Social Provider (Federation) 
  Walkthrough all the auth configurations 
  Create or update Cognito user pool groups 
❯ Create or update Admin queries API 

```

How do we get it to update the redirect URLs only? Can we just edit the configuration directly and run `amplify push`?

## Comment

---------------

Author: @Johnniexson

@fireflysemantics What version of amplify cli are you using?
## Comment

---------------

Author: @fireflysemantics

```
ole@mkt:~/Github/slice$ amplify --version
4.18.0

```
## Comment

---------------

Author: @fireflysemantics

So I had no choice but to select the option:

> Apply default configuration with Social Provider (Federation)

After that I had to go and change the Google authorized Javascript Origins and Authorized Redirect URIs and the app worked.

Now It's giving me all the options again:

```
Using service: Cognito, provided by: awscloudformation
 What do you want to do? (Use arrow keys)
❯ Apply default configuration without Social Provider (Federation) 
  Walkthrough all the auth configurations 
  Add/Edit signin and signout redirect URIs 
  Update OAuth social providers 
  Create or update Cognito user pool groups 
  Create or update Admin queries API 

```

Which is good, but seems like there is a bug here ...
## Comment

---------------

Author: @fireflysemantics

I think there's a bug here.  If I complete update auth then I get all the options.  However if I hit `ctrl-c` to exit, and do `amplify update auth` again, I no longer get the option to change the redirect URIs.

---------------

---------------

# Fields with @connection directives returns undefined when dataStore is queried.

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 1

Hello guys, i'm having some issues with datastore query as all my fields with `@connection` directives are missing when data is been queried. 

Here is my schema:

```
type User @model {
  id: ID!
  cognitoId: ID!
  user_name: String!
  institution: Institution @connection(name: "userInstitution")
  createdAt: String
}

type Institution @model {
  id: ID!
  institutionUserId: ID!
  user: User! @connection(name: "userInstitution", keyField: "institutionUserId")
  tertiary: [Tertiary] @connection(name: "tertiaryInstitution")
}

type Tertiary @model {
  id: ID!
  userId: ID!
  institutionId: ID!
  institution: Institution @connection(name: "tertiaryInstitution", keyField: "institutionId")
  name: String!
  department: String!
}
```

PS: institutionUserId field disapear from the generated model once i run `amplify codegen models`

I added new user, institution and tertiary like this with dataStore:

```
async createData(data) {
  const newUser = await DataStore.save(
        new User({
          cognitoId: data.cognitoId,
          user_name: data.user_name,
        })
      );

      const newInstitution = await DataStore.save(
        new Institution({
          user: newUser,
        })
      );

     const newTertiary = await DataStore.save(
            new Tertiary({
              userId: newUser.id,
              institutionId: newInstitution.id,
              name: data.institution.name,
              department: data.institution.department
            })
          );
}
```

The problem now is with querying data like:

```
async getData(uid, instID, tertID) {
    const user = await DataStore.query<User>(User, uid);

    console.log(user.institution)          //output: undefined
   
    const institution= await DataStore.query<Institution>(Institution, instID);

    console.log(institution.user)           //output: undefined
    console.log(institution.tertiary)       //output: []


    const tertiary= await DataStore.query<Tertiary>(Tertiary, tertID);

    console.log(tertiary.institution)        //output: undefined
  }
```

Pls any help with this issue will be appriciated or am i doing something wrong in the data access and structure pattern? Thanks
## Comment

---------------

Author: @iartemiev

Hey @Johnniexson. Bi-directional relations are not currently supported in DataStore, so you should be able to get `institution.user` but not `user.institution`. 

When creating a Tertiary record, pass it `newInstitution` instead of the `id`, i.e.
```js
const newTertiary = await DataStore.save(
  new Tertiary({
    userId: newUser.id,
    institution: newInstitution,
    name: data.institution.name,
    department: data.institution.department
  })
);
```
Then you'll be able to get the institution with:
```js
const tertiary = await DataStore.query<Tertiary>(Tertiary, tertID);
console.log(tertiary.institution)
```

If you would like to return an array of all tertiary institutions linked to an institution, I would go with this approach: https://docs.amplify.aws/lib/datastore/relational/q/platform/js#querying-relations

So in your case, it would be:
```js
const tertiaryByInstitution = (await DataStore.query<Tertiary>(Tertiary)).filter((t) => t.institution.id === tertID);
```

Similarly for getting an institution by user:
```js
const userInstitution = (await DataStore.query<Institution>(Institution)).find((i) => i.user.id === uid);
```

---------------

---------------

# One-to-one mapping between API model and Cognito User?

---------------

Author: @lukeramsden
Upvotes: 1
Comments: 2

I'm using the GraphQL API and Cognito User Pools, and I'd like to have a "UserProfile" model to store all user-related data that does not fit in to the standard OIDC claims (things like S3 objects and complex one-to-many relationships), so obviously I start with this:

```gql
type UserProfile @model @auth(rules: [{allow: owner}]) {
  id: ID!
  profilePicture: S3Object
}
```

Which works but is a one-to-many relationship - I could just _not do that_, at the client level, but that's just morally wrong. So my question is - what would be the idiomatic way to achieve a one-to-one mapping with a Cognito user?

My initial assumption was to make the "owner" field unique, but it seems there is no directive for unique fields, only obscure StackOverflow answers talking about pipeline resolvers etc. but that seems like a lot of unnecessary overhead and code to maintain, as well as the CLI seemingly not supporting pipeline resolvers just yet (#1055), making me even less inclined to go down that route considering it would mean manually configuring Cloudformation (I think?).

An alternative thought would be to have a "ProfilePicture" model that is owned by a user, and then various other models for specific things that they own, but then that still begs the question of **how to enforce a user can only have one row of a model?** This may be a solved issue but I have not been able to find an answer thus far.
## Comment

---------------

Author: @lukeramsden

I must've been tired yesterday as I somehow didn't consider making the owner the primary key. I did try that, but this error message must've thrown me off:
```
Failed to start API Mock endpoint Attempting to edit the key schema of the UserProfileTable table in the UserProfile stack. 
Cause: Adding a primary @key directive to an existing @model. 
How to fix: Remove the @key directive or provide a name e.g @key(name: "ByStatus", fields: ["status"]).
```
I sort-of have my answer because that is a one-to-one with the Cognito use, but it's not an ideal solution, and I am absolutely astounded that there's no way to make a field unique - that seems like a core requirement for a database... but from what I can tell, the reason for this is making a field unique in DynamoDB is non-trivial due to it not being a "real" database, which really begs the question as to why on earth anybody would consider using DynamoDB to power the core API of their project if you can't do something as simple as a unique field (I say that while using this DynamoDB-backed API for my production app at work, but that's work I guess!). Hopefully anybody trying to do what I did with a UserProfile model stumbles across this and they don't have to waste time trying to figure it out, so here's my model, waiting to have actual data added to it:

```gql
type UserProfile
  @model(queries: {list: "profile"}, subscriptions: null)
  @key(fields: ["owner"])
  @auth(rules: [{allow: owner}]) {
  owner: String!
  createdAt: AWSDate! @auto # @auto directive is from graphql-auto-transformer
  updatedAt: AWSDate! @auto
}
```
## Comment

---------------

Author: @lukeramsden

Also interesting to note is that with the above model, a create and an update seemingly become the same thing, the only difference being which xAt date field is changed.

---------------

---------------

# How to match Cognito userpool userId to Cognito identityPool IdentityId?

---------------

Author: @tomeraz
Upvotes: 1
Comments: 2

Is there a way to know the signup email or userpool userId from an cognito identity id?
Or perhaps getting cognito identity id from a userpool userId ?
## Comment

---------------

Author: @kannieWeesNie

will any of the Auth class functions help? see them here https://aws-amplify.github.io/amplify-js/api/classes/authclass.html#currentauthenticateduser
## Comment

---------------

Author: @mrichman

If you call `Auth.currentUserInfo()` the response contains both the cognito identity id and user pool id:

```
Auth.currentUserInfo().then(info => {
  // info contains both the identity id and user pool id
  console.log(JSON.stringify(info));
});
```

---------------

---------------

# Deferring user verification

---------------

Author: @camilobern
Upvotes: 1
Comments: 1

Hi,

Is it possible to defer user verification post sign up?

Currently we have set verification to "No Verification" in the corresponding user pool, but it looks like this still puts the user in the confirmSignUp state; unable to authenticate or to verify (did not receive SMS code).

Our thought was that by disabling verification a user can auto-login after sign up, and can then verify their email or phone number in the future.
## Comment

---------------

Author: @camilobern

We have set up a pre-signup lambda trigger that auto verifies user email/phone number in order to let users sign in without required verification, which is not ideal. We would prefer to defer verification until after a user has signed in.

The other problem though is that we are still taken to the confirmSignUp state right after sign up, even though there is a lambda trigger confirming the user. This is due to the fact that the sign up implementation always directs the user to the confirmSignUp state:

 ```
Auth.signUp(signup_info)
 .then(function (data) {
 _this.setState({ requestPending: false });
 // @ts-ignore
 _this.changeState('confirmSignUp', data.user.username);
 })
```

So now a user would need to hit cancel on the verify code page (or hit refresh) to get directed to the signin page, where we were expecting auto sign-in to occur instead.

---------------

---------------

# PubSub -how to use cognito authorized subscribe and publish to IoT

---------------

Author: @kannieWeesNie
Upvotes: 1
Comments: 0

i want a cognito authorized user to be able to publish and subscribe to AWS IoT using Amplify PubSub but am having difficulty doing so.

i use javascript (inside a Vue app)

i have successfully managed to publish and subscribe to AWS IoT using the aws-iot-device-sdk so all the policies, etc are working.

here's the code i'm using with PubSub:

const region = "eu-west-1";
const endpoint = "blahBlah-ats.iot.eu-west-1.amazonaws.com";
const currentlySubscribedTopic = "myTopic";


// Apply plugin with configuration
Amplify.addPluggable(
  new AWSIoTProvider({
    aws_pubsub_region: region,
    // aws_pubsub_endpoint: "blahBlah-ats.iot.eu-west-1.amazonaws.com"
    // aws_pubsub_endpoint: 'wss://xxxxxxxxxxxxx.iot.<YOUR-IOT-REGION>.amazonaws.com/mqtt',
    aws_pubsub_endpoint: "wss://" + endpoint + "/mqtt"
  })
);

to subscribe:

PubSub.subscribe(currentlySubscribedTopic).subscribe({
            next: data => console.log("Message received", data),
            error: error => console.error(error),
            close: () => console.log("Done")
          });
		  
to publish I call this method:

async publishMessage() {
      console.log("publishing message...");
      await PubSub.publish(currentlySubscribedTopic, {
        msg: "Hello to all subscribers!"
      });
      console.log("published..");
    }
	
unfortunately nothing happens (not even errors), so I am obviously doing something wrong.

how do i actually make the connection? is there a connect() function?

how do i incorporate the cognito credentials? i have tried this inside Auth.currentSession():

AWS.config.update({
          region: "eu-west-1",
          credentials: new AWS.CognitoIdentityCredentials({
            IdentityPoolId: "eu-west-1:blahBlah87a-9e0b-blahdf976e",
            Logins: {
              // optional tokens, used for authenticated login
              "cognito-idp.eu-west-1.amazonaws.com/eu-west-1_blahBlahBlah
                session.idToken.jwtToken
            }
          })
        });
		
and can use AWS.config.credentials.get() to get the credentials but don't know how to use them to make the connection. 

i'd appreciate some help as to how to do this.

thanks


---------------

---------------

# Amplify Libraries (API module): centrally configure Amplify for modularized imports

---------------

Author: @azizur
Upvotes: 1
Comments: 0

I am trying to find some docs on how to configuring AWS Amplify for modularized imports.

How do I configure Amplify centrally, so that modules can pick up the configuration later in React App?

**Expected:**
Configure Amplify via the `@aws-amplify/core` module. 
```
// index.js

import { Amplify } from '@aws-amplify/core';
...
const AmplifyConfig = {API:{...}, Auth:{...}}
Amplify.configure(AmplifyConfig); 
``` 

Then use modules like this:
```
// component.js

import { API } from '@aws-amplify/api';
...
// inside an async function
const data = await API.get(API_NAME, path, EXTRA_PARAMS); // returns "API not configured"
```

**Actual:**
I am getting `API not configured` error.

**Workaround:**
If I change my code in `index.js` to the following it works.
```diff
// index.js

- import { Amplify } from '@aws-amplify/core';
+ import { API } from '@aws-amplify/api';
...
const AmplifyConfig = {API:{...}, Auth:{...}}
- Amplify.configure(AmplifyConfig);
+ API.configure(AmplifyConfig);
```
I am wondering why the first approach is not working.

I tried the using only the `@aws-amplify/auth` module using central configuration in `@aws-amplify/core` and it works fine. Not sure if I should be raising this as a bug with the `@aws-amplify/api` module.

Interested to hear your thoughts @mbahar @wlee221 @dabit3 since you thought about how [AWS Amplify Modularization](https://github.com/aws-amplify/amplify-js/wiki/Amplify-Modularization) would work.

---------------

---------------

# Questions on verifying password, syncing CurrentAuthenticatedUser

---------------

Author: @ajitgoel
Upvotes: 1
Comments: 1

** Which Category is your question related to? **
Auth and credentials

** What AWS Services are you utilizing? **
Cognito

** Provide additional details e.g. code snippets **
Hi!
I want to give my users the ability to change their password. They will have to enter their old password and their new desired password. 
a. What is the recommended way to verify his old password? 
b. After the user has changed his password, does the system need to do something to sync the Auth.CurrentAuthenticatedUser()? I am asking as the code below works the first time and then fails with the error `{"code":"NotAuthorizedException","name":"NotAuthorizedException","message":"Incorrect username or password."}`

```
async changePassword() 
    {
      try 
      {
        const user=await Auth.currentAuthenticatedUser();
        //ToDo: check if old password is valid or not. 
        const result=await Auth.changePassword(user, this.oldPassword, this.newPassword);
        this.$router.push('/user-settings').catch(() => {});  
      } 
      catch (error) 
      {
        console.log(`error: ${JSON.stringify(error)}`);
      };
```
## Comment

---------------

Author: @kimfucious

Hi @ajitgoel 

Have you made sure that when you're submitting the second time, that `this.oldPassword` is actually the new password from the initial change?

---------------

---------------

# How to Create "Account > Users" Authorization Rules in Schema?

---------------

Author: @victoryurkin
Upvotes: 1
Comments: 0

Let say I have the following schema.graphql:

```
type Account @model {
  id: ID!
  title: String!
  users: [User] @connection(name: "AccountUsers")
}

type User @model {
  id: ID!
  name: String!
  account: Account @connection(name: "AccountUsers")
}
```

The goal is to allow each User from the Account to have access to this Account entity and to the other users from that Account using **Amazon Cognito User Pools**.

For example, I have a Settings screen where I'd like to show the account title and the list of users from your account.

Pretty common case, I assume, but didn't find much information... Thanks in advance for any help!

---------------

---------------

# graphQL operations do not always result in equivalent subscription events

---------------

Author: @kimfucious
Upvotes: 1
Comments: 1

The below describes the functionality of a toy React app, created with Amplify:
- API (graphQL/AppSync)
- Lambda trigger function that receives a stream from a DynamoDB table
- DynamoDB table created during API creation.

**tl;dr:** I've answered this [below](https://github.com/aws-amplify/amplify-js/discussions/5667#discussioncomment-8612).

The app looks kinda like this:

![cloud-arch](https://user-images.githubusercontent.com/26792769/80924075-3c61ed80-8db1-11ea-8697-2f67bd297207.png)

The drawing is actually wrong, because the return from the Lambda now goes through AppSync, not directly to DynamoDB, so that I can pickup `update` events that are delivered to subscribers.  I've lost the original drawing, and I'm too lazy to recreate it right now.

In short, here's what happens:
- A user will enter a value in the UI of a React App
- That value is part of a `Thing` that gets created with a mutation
- DynamoDB sends `Things` to a Lambda via a stream
- The Lambda uses the initial value `Thing` (`event.dynamodb.NewImage.value`) to perform a calculation and update another property in that `Thing`.
- It then performs an update mutation, which AppSync uses to update the `Thing` in the DynamoDB table.
- I've setup subscriptions in the client app for create, update, and deletion of `Thing`.
- When a new `Thing` is created, it's displayed in the UI of the owner, and the create subscription populates that on other clients as well
- After the lambda finishes, the update subscriptions populate clients with the updated `Thing`
- A deletions work the same.

**Problem 1**
All of this works as expected, most of the time on single one-at-a-time operations, except every once in a while, update subscriptions do not come through.  

I check the Lambda, and there are no errors.  And the expected result value (after Lambda has run) is correctly stored in DynamoDB.

The update subscription event, is just not received.  Sometimes not only on some clients; other times, on all clients.  

Creation and deletion subscriptions appear to work 100% of the time by all clients (except in the scenario described in Problem 2).

**Question 1**
Is this simply the nature of how things work and I should somehow program around this, or is there something I can do to improve the "deliverability" of update subscriptions.  Where can I look to see what might be causing the problem.

**Problem 2**
This is similar to problem one, but the issue seems to be exacerbated when things speed up.

In other words, If I perform multiple operations rapidly, I don't receive a one-to-one subscription for every operation.

For example, in the below code, all `Things` are deleted in rapid succession:
```js
  const handleClearPersistedData = async () => {
    const deleteItem = async (id) => {
      try {
        const response = await API.graphql(
          graphqlOperation(mutations.deleteThing, {
            input: { id }
          })
        );
        return response;
      } catch (e) {
        console.log(e);
      }
    };

    const pendingDelete = things.map((item) => deleteItem(item.id));
    console.log("Awaiting deletion promises...");
    const deletePromises = await Promise.all(pendingDelete);
    console.log("Promises fulfilled!", deletePromises);
    setThings([]);
  };
```
On the initiating client everything looks okay, because, the local state array that is holding the `Things` is emptied, if the function runs w/o an error.

On other clients, a single deletion subscription event is received, leaving the client out of sync with what's in the DynamoDB table, which is empty at this point.

**Question 2**
Similar to Question 1, though I've also read about the "new" real-time endpoint [here](https://aws.amazon.com/blogs/mobile/appsync-realtime/), which seems like overkill for a tiny little demo app.

The thing is that this app is doing really small stuff.  The max deletions has been ten, so my assumption is that I'm doing something dumb or missing some key point.

Where can I look, read about, learn more about how to get subscriptions to work consistently?

Thanks in advance for any insights on this.
## Comment

---------------

Author: @kimfucious

Okay, answering my own question here:

The idea of using `[things]` as the second argument in the `useEffect` hooks is flawed.

The key here is to use `useReducer` to manage things in state, and create the subscription only once, using `[]` as the second argument.

I learned this from an excellent write-up by @dabit3 found [here](https://medium.com/open-graphql/react-hooks-for-graphql-3fa8ebdd6c62) (see Subscriptions section).

Ironically, I was initially doing `[things]` based on an earlier gist: [here](https://gist.github.com/dabit3/ee8f489ebc208502ab9351809e96e70d)

Regardless, implementing the custom React hook as described, completely resolved all of the issues that I described above.

Here's the custom React hook should anyone be interested:
```js
import { useEffect, useReducer } from "react";
import * as queries from "../graphql/queries";
import * as subscriptions from "../graphql/subscriptions";
import API, { graphqlOperation } from "@aws-amplify/api";

const initialState = { things: [] };

const reducer = (state, action) => {
  switch (action.type) {
    case "SET_THINGS":
      return { things: action.payload };

    case "ADD_THINGS":
      return { things: [...state.things, action.payload] };

    case "DELETE_THINGS":
      return {
        things: state.things.filter((item) => item.id !== action.payload.id)
      };

    case "UPDATE_THING":
      console.log(action.payload);
      return {
        things: state.things.map((item) => {
          if (item.id === action.payload.id) {
            // TODO:  This is a hack because, for some reason, owner is lost when receiving a subscription fix when you figure it out!
            return { ...action.payload, owner: item.owner };
          } else {
            return item;
          }
        })
      };

    default:
      break;
  }
};

export const useSubscription = () => {
  const [state, dispatch] = useReducer(reducer, initialState);

  useEffect(() => {
    API.graphql(graphqlOperation(queries.listThings)).then(
      (thingData) => {
        dispatch({
          type: "SET_THINGS",
          payload: thingData.data.listThings.items
        });
      }
    );
  }, []);

  useEffect(() => {
    const subscription = API.graphql(
      graphqlOperation(subscriptions.onCreateThing)
    ).subscribe({
      next: (data) => {
        const {
          value: {
            data: { onCreateThing }
          }
        } = data;
        dispatch({ type: "ADD_THING", payload: onCreateThing });
      }
    });
    return () => subscription.unsubscribe();
  }, []);

  useEffect(() => {
    const subscription = API.graphql(
      graphqlOperation(subscriptions.onDeleteThing)
    ).subscribe({
      next: (data) => {
        const {
          value: {
            data: { onDeleteThing }
          }
        } = data;
        dispatch({ type: "DELETE_THING", payload: onDeleteThing });
      }
    });
    return () => subscription.unsubscribe();
  }, []);

  useEffect(() => {
    const subscription = API.graphql(
      graphqlOperation(subscriptions.onUpdateThing)
    ).subscribe({
      next: (data) => {
        const {
          value: {
            data: { onUpdateThing }
          }
        } = data;
        dispatch({ type: "UPDATE_THING", payload: onUpdateThing });
      }
    });
    return () => subscription.unsubscribe();
  }, []);

  return state.things;
};
```

---------------

---------------

# Storage.put and Cognito identity confusion

---------------

Author: @mrichman
Upvotes: 1
Comments: 1

I’m trying to understand why, with a Cognito-authenticated ID, `Storage.put` is uploading to `/private/<identityid>/foo.txt`. I guess I’m expecting it to go to `/private/<cognito:sub>/foo.txt`.

(I have `Storage.configure({ level: 'private', track: true });` in my `main.js`).

In other words, I see this in S3:

`/private/us-east-1:c1ecd265-dead-beef-cafe-fa0cffa42ff1/foo.txt`

but I was expecting:

`/private/688746f8-dead-beef-cafe-0c3de99fff98/foo.txt`

Where the latter is the Cognito user pool user's `sub` attribute.

Perhaps I don't quite understand the magic mapping between user pool id and identity id.
## Comment

---------------

Author: @undefobj

Fine grained IAM policies (which is what S3 uses) are only supported for Identity Pool IDs right now. The Cognito team is looking at supporting User Pool subs in the future but until that happens we must use IdentityIDs.

---------------

---------------

# Can not connect to AWS Amplify PubSub -> Socket error:undefined

---------------

Author: @dittmarconsulting
Upvotes: 1
Comments: 1

I've been trying out all ways to get the **Amplify/PubSub** working without any luck. It seems all the documentation are rather outdated.

Here is what I have done so far. Please note all hashes are made up ;-)

1. Created a fresh React Native app
2. Installed amplify packages
3. Installed Amplify CLI
4. Invoked `$ amplify configure`
5. Invoked `$ amplify init`
6. Invoked `$ amplify add auth`
7. Invoked `$ amplify push`, which created the `aws-exports.js` object
8. Created a super simple component
```
    import React from 'react';
    import { View } from 'react-native';

    import Amplify, { PubSub } from 'aws-amplify';
    import { AWSIoTProvider } from '@aws-amplify/pubsub/lib/Providers';

    import awsmobile from './aws-exports';

    Amplify.configure({
      Auth: {
        mandatorySignIn: false,
        region: awsmobile.aws_cognito_region,
        userPoolId: awsmobile.aws_user_pools_id,
        identityPoolId: awsmobile.aws_cognito_identity_pool_id,
        userPoolWebClientId: awsmobile.aws_user_pools_web_client_id,
      },
      Analytics: {
        disabled: true,
      },
    });

    Amplify.addPluggable(
      new AWSIoTProvider({
        aws_pubsub_region: 'ap-southeast-2',
        aws_pubsub_endpoint:
      'wss://a123456789d-ats.iot.ap-southeast-2.amazonaws.com/mqtt',
      })
    );

    Amplify.Logger.LOG_LEVEL = 'DEBUG';

    function _subscribe() {
      PubSub.subscribe('topic1').subscribe({
        next: (data) => console.log(JSON.stringify(data, null, 2)),
        error: (error) => console.log(JSON.stringify(error, null, 2)),
        close: () => console.log('Done'),
      });
    }

    function App() {
      _subscribe();
      return <View />;
    }

    export default App;
```

9. I attached AWS root certificate to my iPhone (see below)

<img src="https://i.stack.imgur.com/uJiqs.jpg" width="300" />

10.Create a IAM policy for AWS IoT

 - `IoTAppPolicy`
 - `iot:*`
 - `arn:aws:iot:ap-southeast-2:1234567890:*`

11.Attach the `aws_cognito_identity_pool_id` to the policy
```
aws iot attach-principal-policy --policy-name IoTAppPolicy --principal ap-southeast-2:db4567bc-1234-5678-9876-543ae2e123b2
```

12.Attach Policies to `Auth Role`

 - `AWSIoTDataAccess`
 - `AWSIoTConfigAccess`

Yet, when I run the app I get the following error log

```
    [DEBUG] 17:43.434 PubSub - subscribe options undefined
    [DEBUG] 17:43.435 MqttOverWSProvider - Subscribing to topic(s) topic1
    [DEBUG] 17:43.436 Credentials - getting credentials
    [DEBUG] 17:43.436 Credentials - picking up credentials
    [DEBUG] 17:43.437 Credentials - getting new cred promise
    [DEBUG] 17:43.437 Credentials - checking if credentials exists and not expired
    [DEBUG] 17:43.438 Credentials - need to get a new credential or refresh the existing one
    [DEBUG] 17:43.438 AuthClass - Getting current user credentials
    [DEBUG] 17:43.466 AuthClass - failed to get or parse item aws-amplify-federatedInfo SyntaxError: Unexpected token u in JSON at position 0
        at JSON.parse (<anonymous>)
        at AuthClass.<anonymous> (Auth.js:1233)
        at step (tslib.js:139)
        at Object.next (tslib.js:120)
        at fulfilled (tslib.js:110)
        at tryCallOne (core.js:37)
        at core.js:123
        at JSTimers.js:277
        at _callTimer (JSTimers.js:135)
        at _callImmediatesPass (JSTimers.js:183)
    [DEBUG] 17:43.466 AuthClass - Getting current session
    [DEBUG] 17:43.467 AuthClass - Failed to get user from user pool
    [DEBUG] 17:43.467 AuthClass - Failed to get the current user No current user
    [DEBUG] 17:43.467 AuthClass - getting session failed No current user
    [DEBUG] 17:43.467 Credentials - setting credentials for guest
    [DEBUG] 17:43.785 Credentials - Failed to load credentials Promise {_40: 1, _65: 3, _55:   Promise, _72: null}
    [DEBUG] 17:43.788 Signer {region: "ap-southeast-2", service: "iotdevicegateway"}
    [DEBUG] 17:43.796 MqttOverWSProvider - Creating new MQTT client 38da11d8-ba08-47c8-a6de-9e739ab4c14f
    SocketRocket: In debug mode.  Allowing connection to any root cert
    {
      "provider": {
        "_config": {
          "Auth": {
            ...
          },
          "Analytics": {
            ...
          },
          "aws_pubsub_region": "ap-southeast-2",
          "aws_pubsub_endpoint": "wss://a123456789d-ats.iot.ap-southeast-2.amazonaws.com/mqtt",
          "clientId": "..."
        },
        "_clientsQueue": {
          "promises": {}
        },
        "_topicObservers": {},
        "_clientIdObservers": {}
      },
      "error": {
        "errorCode": 7,
        "errorMessage": "AMQJS0007E Socket error:undefined."
      }
    }
    [DEBUG] 17:44.453 MqttOverWSProvider - Unsubscribing from topic(s) topic1
```

Any idea why I can't connect to the topic?
## Comment

---------------

Author: @dittmarconsulting

I finally figured it out. [Here the solution](https://stackoverflow.com/questions/61501005/can-not-connect-to-aws-amplify-pubsub-socket-errorundefined/61555722)

---------------

---------------

# AppSync subscriptions vs Pinpoint sendUsersMessages

---------------

Author: @avlonder
Upvotes: 1
Comments: 0

Hello everyone,
I'm working on a social app where users can send group and event invitations to each other. I use Cognito user pools, DynamoDB tables and AppSync queries/mutations. But I'm somewhat confused whether I should use AppSync subscriptions, a dynamoDB data stream that triggers a Lambda function that emits Pinpoint push notifications, or even a combination of both to send the invitations... What do you think is the best approach for my use case?

---------------

---------------

# How to use Predictions with bytes type

---------------

Author: @mlafo
Upvotes: 1
Comments: 0

I try to use Predictions with bytes type source but I can't provide the good type.

Image is coming from react-native-camera.

`      const image = await camera.takePictureAsync({
        quality: 1,
        fixOrientation: true,
        forceUpOrientation: true,
        base64: true,
      });
`

Image has in return uri or base64.
I need to pass image to Prediction but I always get an "Input source is not configured correctly" error.
bytes param accept Buffer, arrayBuffer ,Blob or string
I tried a lot of things... 

`      await Predictions.identify({
        text: {
          source : {
          bytes: myBytesImage,
         },
        },
      })
        .then((res) => this.setState({ res: res }))
        .catch((err) => this.setState({ err: err }));`

Does anyone know how to do that, or is there a bug ?

---------------

---------------

# Identity provider (Facebook) does not show on hosted Cognito UI

---------------

Author: @devth
Upvotes: 1
Comments: 0

I originally setup auth via `amplify auth add` and went through the process to configure "Login with Amazon" and Google. These both worked, and both showed up. 

I then used `amplify auth update` to add Facebook and remove the others. **The problem is, Facebook login does not show up on my hosted UI:**

![image](https://user-images.githubusercontent.com/86107/80811262-c1b38b00-8b82-11ea-874e-f93effe91223.png)

I then used `amplify auth update` to add Amazon and Google back in:

![image](https://user-images.githubusercontent.com/86107/80811346-ec054880-8b82-11ea-9f5d-19fbdb872449.png)

So I now have all 3 configured. The hosted UI updated:

![image](https://user-images.githubusercontent.com/86107/80811651-90878a80-8b83-11ea-8e3f-ee041e148238.png)


but it does not include Facebook. I am able to force Facebook login with:

```typescript
            <Button
              className={cx(classes.brandButton)}
              onClick={() => Auth.federatedSignIn({provider: 'Facebook'})}
            >
              Continue with Facebook
            </Button>
```

this works. It takes me to Facebook's authorize screen, redirects back to my app, and allows me to get the user's email provided by FB.

I ran `amplify push` after each change, and committed changes in git and pushed to master, causing an amplify deploy.

How do I get FB to show up on the hosted UI? 🤔 

---------------

---------------

# How to set awscloudformation provider lambda runtime?

---------------

Author: @Hideman85
Upvotes: 1
Comments: 2

I try to find any doc to configure awscloudformation provider with no success.

My issue is when I want to deploy a GraphQl api I have the issue:
```
The runtime parameter of nodejs8.10 is no longer supported for creating or updating AWS Lambda functions. We recommend you use the new runtime (nodejs12.x) while creating or updating functions.
```

After figure out where this is set I try to replace it by node12 but when I push this is overwritten...
This value is in the file `amplify/backend/awscloudformation/nested-cloudformation-stack.yml` so I presume awscloudformation provider is responsible of.
No where else in the app this value is set. 
## Comment

---------------

Author: @RossWilliams

There is a guide [here](https://aws-amplify.github.io/docs/cli/lambda-node-version-update) to resolve your issue.
## Comment

---------------

Author: @Hideman85

According to the guide you referred to me this is fix with the version 4.10.0.
I checked my version and was 3.17.0 and it's appear that's because the package name changed from aws-amplify to @aws-amplify/cli
Removing the old one and installing the new one effectively sole my issue.
Thank you.

---------------

---------------

# Amplify - Chatbot UI Component - voice interaction - response playback

---------------

Author: @kkrzyzek
Upvotes: 1
Comments: 0

Hi all,

I am working on a react-native app integrated with Amplify where I have setup Chatbot UI component, based on following tutorial: https://docs.amplify.aws/ui/interactions/chatbot/q/framework/react-native

My bot works fine with text input, but I have an issue with voice interaction. 
The postContent method of AWS Lex (which Amplify uses) gets processed properly, but the bot audio output is not being played: I am getting following warning: 

```
TypeError: The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type object
TypeError: The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type object
    at from (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:400183:11)
    at Function.Buffer.from (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:400187:12)
    at ChatBot.submit$ (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:399637:31)
    at tryCatch (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:29884:19)
    at Generator.invoke [as _invoke] (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:30060:24)
    at Generator.prototype.<computed> [as next] (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:29927:23)
    at tryCatch (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:29884:19)
    at invoke (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:29960:22)
    at http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:29970:15
    at tryCallOne (http://192.168.1.3:8081/index.bundle?platform=ios&dev=true&minify=false:3859:14)
```
which is caused by the incorrect format of audioStream object I am getting in response from Lex:

**audioStream":{"_data":{"size":21831,"blobId":"9EA11F3F-EF21-46E8-9742-169E1F1AE1B5","offset":0,"type":"audio/mpeg","name":"content.mp3","__collector":null}}**

It does not contain the content of audioStream and Amplify Chatbot UI component tries to read it in:
**node_modules/aws-amplify-react-native/dist/Interactions/ChatBot.js**
line187: `const data = Buffer.from(response.audioStream).toString('base64');`

Full response payload from Lex PostContent method:
`{"$metadata":{"httpStatusCode":200,"httpHeaders":{"x-amz-lex-message":"You successfully entered following problem description: I don't know","x-amz-lex-session-id":"2020-04-30T11:35:44.009Z-dzXNTxpD","connection":"keep-alive","content-type":"audio/mpeg","date":"Thu, 30 Apr 2020 11:38:56 GMT","x-amz-lex-slots":"eyJQcm9ibGVtRGVzY3JpcHRpb24iOiJJIGRvbid0IGtub3cifQ==","transfer-encoding":"Identity","x-amz-lex-dialog-state":"Fulfilled","x-amzn-requestid":"9085d91c-d985-4b9e-9539-39a8f65ce4a0","x-amz-lex-intent-name":"ProblemDesc"},"requestId":"9085d91c-d985-4b9e-9539-39a8f65ce4a0","retries":0,"totalRetryDelay":0},"__type":"PostContentResponse","audioStream":{"_data":{"size":21831,"blobId":"9EA11F3F-EF21-46E8-9742-169E1F1AE1B5","offset":0,"type":"audio/mpeg","name":"content.mp3","__collector":null}},"contentType":"audio/mpeg","dialogState":"Fulfilled","intentName":"ProblemDesc","message":"You successfully entered following problem description: I don't know","sessionId":"2020-04-30T11:35:44.009Z-dzXNTxpD","slots":"eyJQcm9ibGVtRGVzY3JpcHRpb24iOiJJIGRvbid0IGtub3cifQ=="}`

Why am I not getting the encoded audioStream file content in response from Lex and only metadata about audio file?

---------------

---------------

# How to automatically convert empty strings to null when saving data to DynamoDB

---------------

Author: @Nutriadmin
Upvotes: 1
Comments: 1

When I run a mutation like:

```
mutation {
  updateClient(input: {
    id: "7f7ca844-e030-4e2d-9561-5e23a5911d38",
    name: ""
  }) {
    id
    name
  }
}
```

I get an error message because the string for `name` is empty:

```One or more parameter values were invalid: An AttributeValue may not contain an empty string```

It seems DynamoDB cannot store empty strings, but it can store the value `null`. My question is, do we have a way of automatically converting empty strings passed to AppSync as part of a mutation from the app into `null` values?

Apparently there is an option: `convertEmptyValues: true` for the DynamoDB client: 
[reference link](https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html) - do we have the same option when using Amplify/AppSync?

I've been searching over the web for hours and couldn't find this mentioned anywhere in the Amplify Docs or in the issues reported in the repo. Any help is appreciated. I hope there is a better solution other than manually processing the data from the forms in our app before executing each mutation.
## Comment

---------------

Author: @Nutriadmin

I think the solution would be to write a custom resolver. The resolver would do the same as the default resolver, but additionally cast empty strings to null values. I'm learning about resolvers from [this page](https://docs.amplify.aws/cli/graphql-transformer/resolvers) and will write my own over the next few days. If someone has had my same issue and has a better or alternative solution it would be great to hear.

---------------

---------------

# Clarification: Can I able to navigate inside the app after successfull signUp in aws-amplify-react-native

---------------

Author: @nihp
Upvotes: 1
Comments: 1

I have customized my UI screens and using Auth.SignUp for signIn. Here I need to navigate inside the screen.

How can I change the state after signUp. 

Now, for the signedIn it allows the user inside the app, but how can I change this for success signUp?

```
  Auth.confirmSignUp(users, confirmationCode, {
  }).then(data => {
    this.props.onStateChange('signIn',{})
    console.log(data)
  })
  .catch(err => {
 
}
```
## Comment

---------------

Author: @rpostulart

We have create a base app, maybe you can look into that: 
https://github.com/alowa-apps/baseApp

You can use the hub.listen, you can see it here:
https://github.com/alowa-apps/baseApp/blob/master/App.js

---------------

---------------

# How to trigger lambda function on user request.

---------------

Author: @ernestostifano
Upvotes: 1
Comments: 0

Hi! I can’t find any reference in docs about how to access user requests/responses (like with CloudFront lambda@edge triggers).

I need to dynamically set some headers and change resources representations.

Is there some way to do that? Can I use a custom CloudFront distribution and therefore be able to set triggers on requests?

---------------

---------------

# React Native Typescript Issues

---------------

Author: @jts-mjanda
Upvotes: 1
Comments: 3

I've recently begun a new react native project. Following standard documentation:

npx react-native init MyApp --template react-native-template-typescript

The project compiles via TSC command without any issues

After successful setup I add the amplify package via:

npm install aws-amplify

I add exactly 1 line of code to the index.js:

import {Auth} from "aws-amplify";

Compile now has 3 sets of issues:

1. error TS2304: Cannot find name 'xxxxx' where xxxxx is ServiceWorker, File, Cache, and Storage
2. error TS2580: Cannot find name 'Buffer'. Do you need to install type definitions for node? Try `npm i @types/node`
3. TS2688: Cannot find type definition file for 'node'.

Adding the @types/node to the project clears up 2 and 3 above which 1 still remaining an issue

What is the recommended solution for 1? A custom type file?
## Comment

---------------

Author: @jts-mjanda

tcconfig:


{
  "compilerOptions": {
    /* Basic Options */
    "target": "esnext",                       /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017','ES2018' or 'ESNEXT'. */
    "module": "commonjs",                     /* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', or 'ESNext'. */
    "lib": ["es6"],                           /* Specify library files to be included in the compilation. */
    "allowJs": true,                          /* Allow javascript files to be compiled. */
    // "checkJs": true,                       /* Report errors in .js files. */
    "jsx": "react-native",                    /* Specify JSX code generation: 'preserve', 'react-native', or 'react'. */
    // "declaration": true,                   /* Generates corresponding '.d.ts' file. */
    // "sourceMap": true,                     /* Generates corresponding '.map' file. */
    // "outFile": "./",                       /* Concatenate and emit output to single file. */
    // "outDir": "./",                        /* Redirect output structure to the directory. */
    // "rootDir": "./",                       /* Specify the root directory of input files. Use to control the output directory structure with --outDir. */
    // "removeComments": true,                /* Do not emit comments to output. */
    "noEmit": true,                           /* Do not emit outputs. */
    // "incremental": true,                   /* Enable incremental compilation */
    // "importHelpers": true,                 /* Import emit helpers from 'tslib'. */
    // "downlevelIteration": true,            /* Provide full support for iterables in 'for-of', spread, and destructuring when targeting 'ES5' or 'ES3'. */
    "isolatedModules": true,                  /* Transpile each file as a separate module (similar to 'ts.transpileModule'). */

    /* Strict Type-Checking Options */
    "strict": true,                           /* Enable all strict type-checking options. */
    // "noImplicitAny": true,                 /* Raise error on expressions and declarations with an implied 'any' type. */
    // "strictNullChecks": true,              /* Enable strict null checks. */
    // "strictFunctionTypes": true,           /* Enable strict checking of function types. */
    // "strictPropertyInitialization": true,  /* Enable strict checking of property initialization in classes. */
    // "noImplicitThis": true,                /* Raise error on 'this' expressions with an implied 'any' type. */
    // "alwaysStrict": true,                  /* Parse in strict mode and emit "use strict" for each source file. */

    /* Additional Checks */
    // "noUnusedLocals": true,                /* Report errors on unused locals. */
    // "noUnusedParameters": true,            /* Report errors on unused parameters. */
    // "noImplicitReturns": true,             /* Report error when not all code paths in function return a value. */
    // "noFallthroughCasesInSwitch": true,    /* Report errors for fallthrough cases in switch statement. */

    /* Module Resolution Options */
    "moduleResolution": "node",               /* Specify module resolution strategy: 'node' (Node.js) or 'classic' (TypeScript pre-1.6). */
    "baseUrl": "./",                          /* Base directory to resolve non-absolute module names. */
    // "paths": {},                           /* A series of entries which re-map imports to lookup locations relative to the 'baseUrl'. */
    // "rootDirs": [],                        /* List of root folders whose combined content represents the structure of the project at runtime. */
    // "typeRoots": [],                       /* List of folders to include type definitions from. */
    // "types": [],                           /* Type declaration files to be included in compilation. */
    "allowSyntheticDefaultImports": true,     /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */
    "esModuleInterop": true                   /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies 'allowSyntheticDefaultImports'. */
    // "preserveSymlinks": true,              /* Do not resolve the real path of symlinks. */

    /* Source Map Options */
    // "sourceRoot": "./",                    /* Specify the location where debugger should locate TypeScript files instead of source locations. */
    // "mapRoot": "./",                       /* Specify the location where debugger should locate map files instead of generated locations. */
    // "inlineSourceMap": true,               /* Emit a single file with source maps instead of having a separate file. */
    // "inlineSources": true,                 /* Emit the source alongside the sourcemaps within a single file; requires '--inlineSourceMap' or '--sourceMap' to be set. */

    /* Experimental Options */
    // "experimentalDecorators": true,        /* Enables experimental support for ES7 decorators. */
    // "emitDecoratorMetadata": true,         /* Enables experimental support for emitting type metadata for decorators. */
  },
  "exclude": [
    "node_modules", "babel.config.js", "metro.config.js", "jest.config.js"
  ]
}
## Comment

---------------

Author: @jts-mjanda

node version 12.16.2
## Comment

---------------

Author: @jts-mjanda

Issue #976 does not really address this issue

---------------

---------------

# Multiple Frontends Multiple Environments Workflow

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 0

Is there any good documentation on a realistic workflow using multiple frontends in multiple environments? I have a react app with all of the amplify files in one repo, and I'm starting a new react native app in another repo. I understand how to pull the exports file and do codegen in the react native repo, but I don't understand how I can have different branches hooked up to different environments at the same time.
For instance, I want my project structure to look like this:
```
react-repo (master branch) -> amplify master env
react-repo (dev branch) -> amplify dev env
react-repo (feature branch) -> amplify feature env

react-native-repo (master branch) -> amplify master env
react-native-repo (dev branch) -> amplify dev env
react-native-repo (feature branch) -> amplify feature env
```

I won't talk about the react repo now, because I have multi-env down to this end, but how can I make sure my dev branch on the RN repo is connected to the dev env when I merge changes from a feature branch? Do I have to run amplify pull <env> in order for the RN app to be connected to the proper amplify environment? How are y'all handling this on your teams?

---------------

---------------

# AmplifyAuthenticator customize validation modal positioning and width

---------------

Author: @sri7vasu
Upvotes: 1
Comments: 1

Im using SignUp form like this using React (Typescript) and AmplifyAuthenticator like this below:

```
import React from "react";
import {AuthState} from "@aws-amplify/ui-components"
import {
  AmplifySignUp,
  AmplifyAuthenticator,
  AmplifySignOut,
} from "@aws-amplify/ui-react";

function SignUp() {
  return (
    <AmplifyAuthenticator initialAuthState={AuthState.SignUp}>
      <AmplifySignUp
        headerText="Sign Up"
        usernameAlias="email"
        slot="sign-up"
        ></AmplifySignUp>
      <div>
        My App
        <AmplifySignOut></AmplifySignOut>
      </div>
    </AmplifyAuthenticator>
  );
}
export default SignUp;
```
The functionality and validations are working fine , i placed the signup forum in middle right of my page and still when there is a validation error it shows on top of the page and that too wide as shown in the figure. 
<img width="1440" alt="Screen Shot 2020-04-21 at 3 36 26 PM" src="https://user-images.githubusercontent.com/5733652/79911721-6cd77e00-83e6-11ea-9ea3-7c4aa4ac781e.png">

How can i customize the position of the validation error and then also reduce the width ?
## Comment

---------------

Author: @ashika01

@sri7vasu : The component might not be completely possible right now. What are your thoughts here? what is your expectation? 

---------------

---------------

# @key in graphQL not working properly

---------------

Author: @24jr
Upvotes: 1
Comments: 5

If I add `@key( fields: ["id", "username"])` the getUser requires both id and username rather than require id and have username be used like eq or gt like it used to. Like this

```
getUser(id: ID!, username: String!): User
```

Also when I add `@key(name: "byUsername", fields: ["username", "createdAt"])` no query byUsername gets added to my schema like used to happen on previous versions.
## Comment

---------------

Author: @RossWilliams

If you don’t give a key a name, that key is used on the primary table. If you want to access a model using a key, you need to specify the “queryField” property, not the name property.

Working as intended.
## Comment

---------------

Author: @24jr

Oh ok you're right I was thinking “queryField” only needed to be provided if you wanted a custom name. 

But my question on the no name one still remains. The second field is just a sort key right but it generates `getUser(id: ID! username: String!): User` and I wouldn't think the sort field would be a requirement for getUser. Expected just  `getUser(id: ID!): User` 

Perhaps this usage is more of like a non-unique two part id. Like` id: cloudy time: 15049494` and `id: cloudy time: 16049494` or something

So this is with both. Figured I would only need one but no big deal. I don't really need the createdAt just threw that on cause I could
```
@key(fields: ["id", "username"])
@key(name: "byUsername", fields: ["username", "createdAt"], queryField: "usersByUsername")
```
<img width="342" alt="Screen Shot 2020-04-27 at 7 25 55 PM" src="https://user-images.githubusercontent.com/34662182/80430590-03abab00-88bd-11ea-983f-1f42882a535e.png">
## Comment

---------------

Author: @24jr

Also for named @key's can you not just remove those and add new ones. I keep having errors and just deleting entire api and pushing new from start to get new changes. Its fine now with no users but of course I can't delete all the users in a year if I want to change a named key

I see how the primary key shouldn't be changed but the named ones are just extras and seem like they should be changeable 
## Comment

---------------

Author: @RossWilliams

You are trying to access a single item. If you specify a sort key on a table, to access a unique value you must specify the partition key and the sort key. Otherwise you could have multiple users with the same ID field. Not a bug.

For your latest question, you cannot change a @key that specifies the key structure for the primary table (includes LSIs). You can remove and add named keys (one at a time) that create GSIs. If you try to do more than one GSI operation (add or remove at once on a table, (unless you are creating a fresh table) the operation will fail.
## Comment

---------------

Author: @24jr

Okay I was initially thinking sort key was strictly for listing data and still required unique ids but makes sense. Thanks for your clarification on all this!

---------------

---------------

# Cannot effectively style Chatbot Component in react

---------------

Author: @tabrza
Upvotes: 1
Comments: 2

**Describe the bug**
I am unable to style the chatbot component to the point of targeting to the granular point of input styling and response styling.

**I tried two approaches:**

**Approach one**
Use and override amplifytheme. I tried playing around with different sections but only ever affect the overall styling. And not to the point where i could for example create a border around the input and response text.
```
const myTheme = {
  ...AmplifyTheme,
  container:{
    ...AmplifyTheme.container
  },
  sectionHeader: {
    ...AmplifyTheme.sectionHeader,
    padding: '1%',
    /*border-radius: 5px 5px 0' 0',*/
    backgroundColor:'white',
    color: '#000',
    fontSize: '120%',
    position:'fixed',
    top: '0',
    height: '7%',
    // // width: '100%',
    zIndex: '10001',
    borderBottom: '0.5px solid #e6e6e6',
  },
  input:{
    ...AmplifyTheme.input,
    display: 'block',
    width: '100%',
    padding: '16px',
    fontSize: '14px',
    fontFamily: `"Amazon Ember", Arial`,
    color: '#152939',
    backgroundColor: '#fff',
    backgroundImage: 'none',
    border: '1px solid #C4C4C4',
    borderRadius: '3px',
    boxSizing: 'border-box',
    marginBottom: '10px',
  },
  button:{
    ...AmplifyTheme.button,
    backgroundColor:'green',
    color: 'blue'

  },
  navButton:{
    ...AmplifyTheme.navButton,
    backgroundColor:'green',

  },
  formSection:{
    width: '100%',
    // itemMe: 'blue',
    itemBot: 'red',
    listItemsRed:'green'
  },
  sectionBody: {
    // ...AmplifyTheme.sectionBody,
    itemBot: 'red',
    marginTop:'2%',
    marginLeft:'4%',
    marginBottom:'15%',
    input:'red',
    itemMe:'green',
    m:'blue',
    color:'orange',
  },
  sectionFooter: {
    padding: '.5% 1%',
    /*border-radius: 0 0 5px 5px;*/
    backgroundColor: 'white',
    color: '#FB2700',
    fontSize: '120%',
    // position: 'fixed',
    bottom: '0',
    width: '99%',
    height: '5%',
    zIndex: '10002',
    button: 'blue'
    // boxShadow: '0 16px 24px 2px rgba(0, 0, 0, 0.14), 0 8px 10px -5px rgba(0, 0, 0, 0.2)'
  }
};
```


**approach two**
in approach two, i tried importing through scss but to no avail - no effect on the styling at all:

```

.amplify-authenticator {
  width: 400px;
  padding: 1em;
  margin: 0 auto;
}

.amplify-form-input {
  width: 40%;
  margin: 0.5em;
  padding: 0.5em;
  font-size: 15px;
}

.amplify-form-body {
  padding: 1.5em;
}

.amplify-form-row {
  display: 'flex';
}

.amplify-form-cell-left {
  float: left;
  margin: 8px 0 8px 8px;
}

.amplify-form-cell-right {
  float:right;
  margin: 8px 8px 8px 0;
}

.amplify-form-link {
  cursor: pointer;
}

.amplify-form-link:hover {
  color: darkorange;
}

.amplify-form-button {
  margin: 0.4em 0 0 0.5em;
  padding: 0.5em;
  border: 1px solid silver;
  background-color: #FEFEFE;
  cursor: pointer;
}

.amplify-form-button:hover {
  color: darkorange;
}

.amplify-greeting-sign-out {}

.amplify-footer {
  clear: both;
}

.amplify-form-message-error {
  margin: 0.5em 0 0.5em 2em;
  clear: both;
  color: orangered;
}

/** Storage Components **/

.amplify-photo-picker-container {
  width: 400px;
  margin: 0 auto;
  padding: 1em;
}

.amplify-photo-picker-preview {
  width: 90%;
}

.amplify-album-container {
  width: 400px;
  margin: 0 auto;
  padding: 1em;
}

.amplify-image-container {
  width:80px;
}

.amplify-image {
  width:80px;
  transition: width 0.5s;
  cursor: pointer;
}

.amplify-image:hover {
  width:128px;
}

.amplify-interactions-input{
  font-size: 20px;
  color: #3498db;
}

.amplify-interactions-response{
  font-size: 20px;
  color: #e74c3c;
}

img{
  width: 43%;
}
```

render looks like this:
```
  render() {
    return (
    <div className="App">
      <div class="row">

        <div id="chat-header">
          <span id="chat-text">TestBot</span>
        </div>

        <div id="webchat"role="main">
        <ChatBot
          title="Bot"
          botName="flowerbot_dev"
          // theme={myTheme}
          welcomeMessage="Welcome, how can I help you today?"
          clearOnComplete={true}
          conversationModeOn={true}
        />
        </div>

        <div id="chat-footer" >
          <span id="chat-link">
            <a href=""> Lex bot</a>
          </span>
        </div>

      </div>

    </div>
    );
  }
```


**Looks like this**

![image](https://user-images.githubusercontent.com/21217850/79328762-05c25100-7f30-11ea-8e91-9a1f001be44b.png)
## Comment

---------------

Author: @tabrza

essentially, it would be nice to know how to style the Chatbot component to the point where i could style the button, the input container, the messages, show an icon, time message was sent etc. to make it look like the way it does on this page: https://aws-amplify.github.io/media/ui_library
## Comment

---------------

Author: @ericclemmons

@jordanranz With `aws-amplify-react` being in maintenance mode, how should we address overriding styles for those projects?

Potential solutions:

- Port `ChatBot` to `@aws-amplify/ui-components` (including `@aws-amplify/ui-react`)
- Remove hashes from CSS modules, so that `Section__container___3YYTG` becomes `Section__container`.  This would allow customers to override classes after including `import '@aws-amplify/ui/dist/style.css';`.

	Yes, this can [pose a problem for semver](https://twitter.com/ericclemmons/status/1255196146202370049), but with components being in maintenance mode, this can reduce backwards-compatibility work for us.

    > https://github.com/aws-amplify/amplify-js/blob/a53f3510ca2a3d48a9fa5c1937fe5b748b934be2/packages/amplify-ui/webpack.config.js#L47-L52

---------------

---------------

# How to show multiple upload progress in React?

---------------

Author: @ctlai95
Upvotes: 1
Comments: 1

I have a component that uploads files using `Storage.put()` on submit. I can see its progress in the `progressCallback` parameter. I also have a state hook that keeps track of the ongoing uploads.

```typescript
const [uploads, setUploads] = useState();

const onSubmit = (file: File) => {
  Storage.put(file.name, file, {
    progressCallback: (progress: any) => {
      console.log(uploads); // always empty
      setUploads({
        ...uploads,
        [filename]: (progress.loaded / progress.total) * 100
      });
    }
  });
}
```

The issue I'm having is trying to accumulate the uploads into a state variable so that I can render some progress bars with that information. But the `progressCallback` function doesn't seem to have context to know about the current state of the component, and always tries to append the current progress to an empty object `{}`. Are there any workarounds for this?
## Comment

---------------

Author: @jordanranz

Hey @ctlai95,

Can you provide either a sample application or `App` code to provide context on how you are using this inside of a functional component?

---------------

---------------

# Client Logging

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 1

In my React app there are times when it would be nice to be able to send error logs to the cloud for mining later on. Does anyone know how to send errors to an aws service (cloudwatch?) instead of just logging it to the console?
## Comment

---------------

Author: @jordanranz

Hey @karrettgelley,

There has been discussion and a tracked feature request for this functionality here:
https://github.com/aws-amplify/amplify-js/issues/3524

Though this is not directly supported out of the box for the Logger, you may be able to extend the Logger and implement the functionality.

---------------

---------------

# Graphql nested nextToken query

---------------

Author: @ambriglia
Upvotes: 2
Comments: 1

I am trying to write one query, as opposed to many, to get some information I need utilizing graphql. Here is an example query I am working with... 

```
getLibrary(id: $libraryId) {
      id
      shelves (limit: $shelfLimit, nextToken: $shelfNextToken) {
        items {
          id
          books(limit: $bookLimit, nextToken: $bookNextToken) {
            items {
              id
              title
              author
            }
            nextToken
          }
        }
        nextToken
      }
    }
```

I am trying to get all books for a specific library. Can I use a query like the one I have above and make multiple api calls with different nested next tokens? Or do I have to create multiple graphql queries like so...

```
getLibrary(id: $libraryId) {
      id
      shelves (limit: $shelfLimit, nextToken: $shelfNextToken) {
        items {
          id
        }
        nextToken
      }
    }
```

Get all shelves for the library and then get all books per shelf...

```
getShelf(id: $shelfId) {
      id
      books(limit: $bookLimit, nextToken: $bookNextToken) {
          items {
            id
            title
            author
          }
          nextToken
       }
    }
```

## Comment

---------------

Author: @RossWilliams

Option 1 works.

---------------

---------------

# What is the difference between Auth.currentCredentials and Auth.currentUserCredentials

---------------

Author: @cdm430
Upvotes: 2
Comments: 0

I assume that `Auth.currentUserCredentials` returns tokens that correspond to the authenticated role? 

What happens when the default auth mode is not userpools, but IAM. Will `Auth.currentUserCredentials` still return authenticated credentials and `Auth.currentCredentials` still return unauthenticated credentials?

When making calls like `storage.get()`, will the credentials for the pre-signed url always be the ones returned from `Auth.currentUserCredentials`? Or is there a fallback to the unauthenticated credentials?

Thanks!

---------------

---------------

# Multi tab login/logout implementation?

---------------

Author: @hiroyukinuri
Upvotes: 1
Comments: 1

I was wondering if there's a way or plans to integrate multi-tab login/logout like Firebase Auth?
## Comment

---------------

Author: @RossWilliams

you can do it yourself in a few lines of code using BroadcastChannel, or you can pass messages between tabs using localstorage event listeners.

---------------

---------------

# Auth.currentAuthenticatedUser() returns null after SignIn

---------------

Author: @Tamanko
Upvotes: 1
Comments: 2

I have an app that I have no issue signing into but after it signs in successfully, running the Auth.currentAuthenticatedUser() returns null.

What I am I doing wrong? 

Here is the current code I am using
`
async function handleSubmit(event) {
    event.preventDefault();
    
    try {
      await Auth.signIn({
        username: (getFieldValue('email')),
        password: (getFieldValue('password'))
      }).then(user => console.log(user))
      
      Auth.currentAuthenticatedUser({
        bypassCache: false
      })
      .then(user=> alert(JSON.stringify(user)));
      
      validateFields((err, values) => {
        if(err)
        {
          notification.error({
            message: 'Error',
            description: Object.values(err)[0].errors[0].message,          
          });
        }
`
## Comment

---------------

Author: @Tamanko

Is anyone able to help me with this? I posted 6 days ago and have not gotten any response
## Comment

---------------

Author: @antikvarBE

Recently upgraded all versions of aforementioned modules but am still getting the same error. Any thoughts anyone? Bumping this up a bit.

---------------

---------------

# Change/Update source repo

---------------

Author: @keponk
Upvotes: 1
Comments: 1

I've renamed the source repo my aplify project was connected to. I can't seem to find a way to update this on the project.

There is no configuration change whatsoever other than the repo name in CodeCommit. Is there a way to update the project or do I need to create one from scratch?
## Comment

---------------

Author: @keponk

Lonjg story short we created a new project for the newly renamed git repo.

Also we needed to recreate the amplify envs but this may have had more to do with my limited knowledge of the tool. In any case, a project from scratch seems like a good idea given that the configs are already saved. It took only 5mins to recreate the envs.

---------------

---------------

# Can Amplify 'manual setup' override or change the Cognito configuration on AWS console?

---------------

Author: @syang
Upvotes: 1
Comments: 0

I am using Amplify's manual setup https://aws-amplify.github.io/docs/js/authentication#manual-setup:

        ......
        oauth: {
            domain: 'your_cognito_domain',
            scope: ['phone', 'email', 'profile', 'openid', 'aws.cognito.signin.user.admin'],
            redirectSignIn: 'http://localhost:3000/',
            redirectSignOut: 'http://localhost:3000/',
            responseType: 'code'
        }

And my Cognito User Pool Console was configured as follows:

![Screen Shot 2020-04-26 at 7 38 35 AM](https://user-images.githubusercontent.com/188004/80310775-47a19180-8791-11ea-8a58-4e2b59a395fb.png)

So we can see _**responseType: 'code'**_ in the Amplify manual setup config is conflicting to the User Pool Console configuration. What behavior would the result in? Will my app get a 'code' or 'token' response type?


I also see my app's scope             **_scope: ['phone', 'email', 'profile', 'openid', 'aws.cognito.signin.user.admin'],_** is conflicting my User Pool Console configuration, what scope will my app get?

I think the question is boiled down to which one will be the ultimate truth for my app, Amplify configure (in the client code) or my User Pool configure (in the AWS console).


---------------

---------------

# Greetings header in withAuthenticator is taking unnecessary space

---------------

Author: @nuthankumarhr
Upvotes: 1
Comments: 0


![WhatsApp Image 2020-04-25 at 10 24 56 PM](https://user-images.githubusercontent.com/64323880/80285678-2d8d9200-8744-11ea-92b6-4e7134a03a90.jpeg)


is there any solution to this problem??? 

---------------

---------------

# AWS Pubsub Publish no internet case

---------------

Author: @rahulje9
Upvotes: 1
Comments: 0

Hi,

I have created a React Native IOT application which uses pubsub to publish the changes made in the app. I have an issue when I try to update the value while I don't have internet reachability the pubsub is getting publish success rather than publish fail. to recreate my issue while using the app, just remove the network cable from modem so that you won't get internet connectivity while the wifi is still on. I tried to get the success message from the method and I'm getting `[undefined]`.

---------------

---------------

# Latest version of @aws-amplify causes The required JS dependency "http2" is not available

---------------

Author: @rberger
Upvotes: 1
Comments: 1

With my package.json having something like:
```
{
    "dependencies": {
        "aws-amplify": "^3.0.8",
        "aws-amplify-react": "^4.1.7",
        "highlight.js": "9.15.10",
        "react": "16.9.0",
        "react-dom": "16.9.0",
        "react-highlight.js": "1.0.7"
}
```

I get the following when the program is built:
```
The required JS dependency "http2" is not available, it was required by "node_modules/@aws-sdk/node-http-handler/build/node-http2-handler.js".
```

If I switch back to an earlier version:
```
{
    "dependencies": {
        "aws-amplify": "^2.2.7",
        "aws-amplify-react": "^3.1.0",
        "highlight.js": "9.15.10",
        "react": "16.9.0",
        "react-dom": "16.9.0",
        "react-highlight.js": "1.0.7"
    }
```

Everything works right.

* node --version: v14.0.0
* npm --version 6.14.4

I am running this with [shadow-cljs](http://shadow-cljs.org), but I hope that is not the issue.

Also with the latest version I get a bunch of npm warns when first doing `npm install`:
```
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/analytics@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/api@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/auth@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/core@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/interactions@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/storage@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN aws-amplify-react@4.1.7 requires a peer of @aws-amplify/xr@1.1.5 but none is installed. You must install peer dependencies yourself.
npm WARN @aws-amplify/api@3.1.7 requires a peer of @aws-amplify/pubsub@^2.1.1 but none is installed. You must install peer dependencies yourself.
npm WARN @aws-amplify/core@3.2.4 requires a peer of @react-native-community/netinfo@^5.5.0 but none is installed. You must install peer dependencies yourself.
npm WARN @aws-amplify/api-graphql@1.0.9 requires a peer of @aws-amplify/pubsub@^2.1.1 but none is installed. You must install peer dependencies yourself.
```

With the older versions of aws-amplify and was-amplify-react I get only a few. I have no idea what to do about these ether.
```
npm WARN aws-amplify-react@3.1.9 requires a peer of @aws-amplify/ui@^2.0.0 but none is installed. You must install peer dependencies yourself.
npm WARN @aws-amplify/api@2.2.1 requires a peer of @aws-amplify/pubsub@^1.2.4 but none is installed. You must install peer dependencies yourself.
npm WARN @aws-amplify/core@2.3.0 requires a peer of @react-native-community/netinfo@^5.5.0 but none is installed. You must install peer dependencies yourself.
```

Any help would be appreciated!!!
Thanks
## Comment

---------------

Author: @rberger

With the help Thomas Heller (author of shadow-cljs). Seems that a node require in `@aws-sdk/node-http-handler/build/node-http2-handler.js` was leaking into the npm requires (or something like that, I didn't completely understand the relationship)

I was able to fix the issue of http2 require leaking out by adding `:js-options {:resolve {"http2" false}}` to the shadow-cljs.edn build block. (Heres a snippet of the fixed shadow-cljs.edn):

```
{:deps   true

 :nrepl {:port 8777}

  :builds** {:app {:target          :browser
                :output-dir      "resources/public/js/compiled"
                :asset-path      "/js/compiled"
                :modules         {:app {:init-fn omnyway.mock-checkout-page.core/init
                                        :preloads [devtools.preload
                                                   day8.re-frame-10x.preload]}}
                :dev             {:compiler-options {:closure-defines {re-frame.trace.trace-enabled?        true
                                                                       day8.re-frame.tracing.trace-enabled? true}}}
                :devtools        {:http-root    "resources/public"
                                  :http-port    8280
                                  }
                :js-options {:resolve {"http2" false}}}}}
```


---------------

---------------

# Customizing input and button font family in authenticator web components

---------------

Author: @vaclav-slavik
Upvotes: 1
Comments: 0

I'm struggling to find a way to customize `Authenticator` components to use desired font for form inputs and buttons.

I'm using `--amplify-font-family` css property to set the font family for `Authenticator` component. However, as inputs and buttons do not have explicitly defined font-family in css, I end up with those using default client font (apple system font in my case).

<img width="1680" alt="obrazek" src="https://user-images.githubusercontent.com/14313898/80210105-73a70080-8633-11ea-9132-c2cfa0d33e68.png">

The proposed solution would be to set the `font-family` in `AmplifyInput` and `AmplifyButton` web components to `inherit` or explicitly use `--amplify-font-family` css property so it uses the same fonts all over the `Authenticator` component.

![obrazek](https://user-images.githubusercontent.com/14313898/80210397-ff209180-8633-11ea-85e5-47b4958976ab.png)

Would this make any sense?

Thanks for you time and effort and for Amplify initiative

---------------

---------------

# The Network is Not Reliable: Auth Retry approach?

---------------

Author: @danrivett
Upvotes: 2
Comments: 0

I'm trying to understand two things:

1. Does this Amplify JS library handle request retries automatically for certain classes of transient errors such as network errors?
    1. If so, I'd love to know more details so I can avoid duplicating handling (and likely in a much worse manner)
    2. If not, why not? Genuinely. For example the `Auth.signUp()` function abstracts a lot of the underlying network requests away, so I would think that for non-application, network errors, it would be its responsibility to retry, supporting some optional configuration to tune that if desired.
    3. As a big class of usage of this library is from mobile apps which are notorious for having spotty connectivity, I think it would be a big win to have some automatic retry capability built in if not already present.

2. If the requestor is on the hook to determine which errors to retry and retry all retryable errors, does anyone have any strategy recommendations on what errors to retry, and what errors to not retry etc.?
    1. From browsing this repo, it appears that network errors - going off [here](https://github.com/aws-amplify/amplify-js/blob/master/packages/amazon-cognito-identity-js/src/Client.js#L92-L94) at least - are reported with a `code: 'NetworkError'` field on the error returned.
    2. So my naive thoughts would be to retry for errors returned with that particular `code` value, and not retry others, but I'm not sure if that is sufficient for all network errors, or if there are other error codes that are also retryable; if there's any documentation around this that would be helpful.

Specifically I'm looking at retry approaches to the `Auth` methods such as:

- `Auth.signUp()`
- `Auth.signIn()`
- `Auth.signOut()`
- etc...

But of course it applies to many other service calls.

---------------

---------------

# The new @aws-amplify/ui-vue has features missing

---------------

Author: @albertbenitez
Upvotes: 1
Comments: 2

I've been playing with the **amplify-authenticator** and **amplify-sign-in** components but the Properties like: 
- federated
- formFields
- handleAuthStateChange
- handleSubmit

They are not working or they lack documentation to make it work.
Anyone having the same issues with the **Vue** components?
## Comment

---------------

Author: @albertbenitez

This seems to fix the issue, for almost all of them
https://github.com/aws-amplify/amplify-js/issues/5363#issuecomment-618627713

- federated
- ~~formFields~~
- ~~handleAuthStateChange~~
- ~~handleSubmit~~
## Comment

---------------

Author: @albertbenitez

Federated issue solved in the new docs:
https://github.com/aws-amplify/amplify-js/tree/master/packages/amplify-ui-components#amplify-authenticator-federated

---------------

---------------

# Is there a page that lists what need to be done when updating?

---------------

Author: @Jun711
Upvotes: 1
Comments: 1

I am using aws-amplify 1.1.24. 
I just checked today. It is now aws-amplify@3.0.8 and it was aws-amplify@2.3.0 23 days ago and it was aws-amplify@1.3.3 on Jan 10

Is there any breaking changes? 
How do I check? 
## Comment

---------------

Author: @mauerbac

@Jun711 - Hello! Good question. Breaking changes for 3.X.X are listed here: https://github.com/aws-amplify/amplify-js#notice

---------------

---------------

# How to refresh credentials after 50 minutes?

---------------

Author: @justinneff
Upvotes: 1
Comments: 0

In the recent PR #4205, it indicates that it should refresh the credentials 50 minute after they were issued. However, I'm having difficulties actually getting this to happen. My AWSAppSyncClient is configured to set the auth header following the [Cognito User Pool example in the docs](https://docs.amplify.aws/lib/graphqlapi/authz/q/platform/js#cognito-user-pools).

Based on what I am seeing `Auth.currentSession()` isn't refreshing the token until after they expire not 10 minutes before as I would have expected based on the PR change.

Am I missing something here?

---------------

---------------

# Problems with callback url being on different domain than SPA

---------------

Author: @Groot90
Upvotes: 1
Comments: 3

** Which Category is your question related to? **
Auth
** What AWS Services are you utilizing? **
Cognito
** Provide additional details e.g. code snippets **
I'm trying to have a single Cognito User Pools auth sign in callback url ( redirectSignIn in Amplify's terms). However, the app I'm building needs to be able to run from multiple (many) domains.

I'm not sure why it doesn't seem to be possible to have Amplify.Auth.oAuth.redirectSignIn url hosted on a different domain than  the React application (SPA)? 

What if the React app needs to be run from multiple domains? I see that customState parameter can be used to identify the actual domain sending the login request, but I'm having issues when trying that approach. Any time I get a redirect back from the central callback url to the React App, React app fails with the following JS error:

EVENT AUTH HUB: index.js:115
Object { event: "customOAuthState", data: "http__colon____forward____forward__localhost__colon__3001", message: "State for user Google_111083168159815163414" }
index.js:116
[DEBUG] 25:10.750 AuthClass - Error in cognito hosted auth response DOMException: "The operation is insecure."

It seems to be generated by replaceState() in this file
https://github.com/aws-amplify/amplify-js/blob/cf8738ac5e7961a163ce158a7383bc27f693475f/packages/auth/src/Auth.ts

(line 1886),  function _handleAuthResponse
## Comment

---------------

Author: @Groot90

To add some more context here:
I'm trying to implement "State" parameters redirection, described here, using Amplify + Cognito User Pools:
https://auth0.com/docs/users/guides/redirect-users-after-login#keep-reading

This replaceState() call seems to be added on April 8, 2019, here:
https://github.com/aws-amplify/amplify-js/blob/76cde598c30ee8049798e5988261db9165cc775e/packages/auth/src/Auth.ts

This issue could be related as well:
https://github.com/aws-amplify/amplify-js/issues/4388

BTW, I'm using federatedSign() with Google as IdP, and I'm also sending customState string.
The login seems to work when I disable Hub.listener() and window.LOG_LEVEL.

Overall, this replaceState() call seems to be forcing callback url (redirectSignIn) to be on the very same domain as the React app itself. Is there any workaround for this limitation? 
## Comment

---------------

Author: @Groot90

The code change in PR #5062 seems to be working - callback url on another domain can be used this way. However, I'd like to hear your comments on this issue. I'm wondering why this is needed? Was this intended behavior or a bug? Thank you!
## Comment

---------------

Author: @AntonioAngelino

We have exactly the same use case and issue described by @Groot90 !
We need to redirect the user to a route that is not `oauth.redirectSignIn`.

I'd suggest implementing the solution explained by @hotgazpacho here: https://github.com/aws-amplify/amplify-js/issues/3391 
> I would expect that the location would not be replaced on successful federated sign in, OR, allow consumers to configure (preferably at call time) the URL to redirect to after successful sign in, keeping it separate from the callback URL.



---------------

---------------

# I'm trying to fetch row from the dynamodb table

---------------

Author: @
Upvotes: 1
Comments: 0

Here is my lambda function for get request


app.get(path + hashKeyPath + sortKeyPath, function(req, res) {
  var params = {};
  if (userIdPresent && req.apiGateway) {
    params[partitionKeyName] = req.apiGateway.event.requestContext.identity.cognitoIdentityId || UNAUTH;
  } else {
    params[partitionKeyName] = req.params[partitionKeyName];
    try {
      params[partitionKeyName] = convertUrlType(req.params[partitionKeyName], partitionKeyType);
    } catch(err) {
      res.statusCode = 500;
      res.json({error: 'Wrong column type ' + err});
    }
  }
  if (hasSortKey) {
    try {
      params[sortKeyName] = convertUrlType(req.params[sortKeyName], sortKeyType);
    } catch(err) {
      res.statusCode = 500;
      res.json({error: 'Wrong column type ' + err});
    }
  }

  let getItemParams = {
    TableName: tableName,
    Key: params
  }

  dynamodb.get(getItemParams,(err, data) => {
    if(err) {
      res.statusCode = 500;
      res.json({error: 'Could not load items: ' + err.message});
    } else {
      if (data.Item) {
        res.json(data.Item);
      } else {
        res.json(data) ;
      }
    }
  });
});


Here is my code :
in app.js
 async componentDidMount(){
    Auth.currentAuthenticatedUser()
      .then(user => {
        
        const details = user.attributes;
        this.setState({name: details.name})
        this.setState({email: details.email})
        this.setState({phone: details.phone_number})
        this.setState({id: details.sub})
        console.log(this.state.id)

        const hashkeypath = '/:' +this.state.id;
        API.get('applicantprofessionaldetails', `/details` + hashkeypath  )
          .then( response => {
            console.log('response from db', response)
          })
      })
  }

with the above code I get 304 (a empty array)

---------------

---------------

# When using Amplify JS, how does the "Do you want to remember your user's devices?" in Cognito dashboard function?

---------------

Author: @kennand
Upvotes: 1
Comments: 0

Hi - when using Amplify JS, how does the "Do you want to remember your user's devices?" in Cognito dashboard function? Should I leave it off? It seems like my localstorage persists either way...

---------------

---------------

# Authenticator component customisation

---------------

Author: @thesmeexperts
Upvotes: 1
Comments: 0

Hello,

I've decided to upgrade aws-amplify to the lastest version and remove soon deprecated aws-amplify-react library from my project. 

The problem that I ran into is that I am no longer able to pass a list of auth components.

**Before the upgrade I could simply do this:** 
export default withAuthenticator(App, false, [
  SignIn ,
  ConfirmSignIn ,
  VerifyContact ,
  ForgotPassword ,
  RequireNewPassword ,
  ConfirmSignUp ,
  Loading ,
]);

After the upgrade, this no longer works. I tried to find something in the documentation but miserably failed. Could anyone help me out with an example of how to configure withAuthenticator with only components that I need? 

Many thanks


---------------

---------------

# Accessing unprotected data from the DynamoDB table with DataStore.

---------------

Author: @Johnniexson
Upvotes: 1
Comments: 1

Hello, In one of my amplify projects, i'm using cognito user pool for authentication and it seems the user must be authenticated to access any of the AWS service such as reading from the DynamoDB table. But on my landing page, i need to retrieve some public data from the database before authenticating the user, also i have a protected route that can only be accessed based on the data provided by an unauthenticated user, i use this data to query the DynamoDB table to grant access to the route. But AWS deny access (see screenshot below)
![amplify error](https://user-images.githubusercontent.com/33484116/79339400-bcb6d080-7f20-11ea-8b1c-ae9b98efca00.jpg)
. Any way i can fix this? Kind regards.
## Comment

---------------

Author: @dabit3

Hey John,

You can create a public REST API & connected Lambda function that you can give read access to the DynamoDB table if you'd like, or if you are using GraphQL / AppSync, you can use multi-auth (authenticated + unauthenticated access).

https://docs.amplify.aws/lib/graphqlapi/query-data?platform=js#custom-authorization-mode

---------------

---------------

# Storage Configuration with Modular Imports

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 1

How do I configure the Storage module if I'm using modular imports? I keep getting this weird error 'No Credentials' whenever I tried to call Storage.put(). My issue seems to be related to a few old issues (#3744, #5354), but I can't get my app to work with any of the solutions. It seems like the new modular imports require me to configure Storage in some particular way, but I can't find any documentation on it. 

Can any one help? I provided some pictures of my current setup below

Debug Logs (while calling Storage.put)
![Screen Shot 2020-04-11 at 4 23 51 AM](https://user-images.githubusercontent.com/31458115/79040282-129c1900-7bad-11ea-9185-5d9021e9ad49.png)

index.js (at root of app)
![Screen Shot 2020-04-11 at 4 30 25 AM](https://user-images.githubusercontent.com/31458115/79040311-2f385100-7bad-11ea-977b-5f43ac1bc1c7.png)

package.json
![Screen Shot 2020-04-11 at 4 32 31 AM](https://user-images.githubusercontent.com/31458115/79040365-80484500-7bad-11ea-9e87-6b92a6279aef.png)

The call to Storage.put looks something like this:
import Storage from '@aws-amplify/storage';
...
async function uploadPic() {
    await Storage.put('/pictures/testpic', <an image file>, { level: 'protected', contentType: <image file type>});
}
## Comment

---------------

Author: @karrettgelley

I solved this by uninstalling the storage module and reinstalling.

---------------

---------------

# API (GraphQL) - How do you create many connections to one Photo schema object?

---------------

Author: @VicFrolov
Upvotes: 1
Comments: 1

Let's say you have a Product and a Brand. Product has an array of photos, and brand has both a "cover" photo, and then also another array of photos:
```
type Product {
  id: ID!
  photos: [Photo] @connection(name: "ProductPhotos")
}

type Brand {
  id: ID!
  coverPhoto: Photo @connection(name: "BrandCoverPhoto")
  photos: [Photo] @connection(name: "BrandPhotos")
}

type Photo {
  id: ID!
  bucket: String!
  fullsize: PhotoS3Info!
  thumbnail: PhotoS3Info!
  brandCoverPhoto: Brand @connection(name: "BrandCoverPhoto")
  brandPhotos: Brand @connection(name: "BrandPhotos")
  productPhotos: Product @connection(name: "ProductPhotos")
}
```

If this is correct, this feels like Photo will become pretty bloated, especially if you have a bunch of other models that require photos, but perhaps this is the best practice approach?

If this is not correct, how would you make one type of Photo, that can be shared by a large list of types, e.g. Product, Brand, User, Seller, Buyer, etc, that only have access to their respective photos in the schema?
## Comment

---------------

Author: @mauerbac

Hi @VicFrolov - this seems like a great GraphQL general question. I'll convert this to a discussion. 

---------------

---------------

# AppSync Javascript PWA client not persisting queued mutations after close

---------------

Author: @JohnAtFenestra
Upvotes: 1
Comments: 2

I am opening this question after a discussion with AWS Premium Support.

# Background

This is proof-of-concept demonstration of a design solution which uses the following:

- Quasar/Vue PWA client app
- AppSync endpoint
- Lambda resolvers
- Resolvers communicate via HTTPS with REST API used to talk to an on-premises SQL Server database

There is one query and one mutation:

```javascript
export const getSchool = /* GraphQL */ `
  query GetSchool($schoolId: ID!) {
    getSchool(schoolId: $schoolId) {
      schoolId
      schoolName
      schoolAddress1
      schoolCity
      schoolState
      schoolZipcode
    }
  }
`;

export const updateSchool = /* GraphQL */ `
  mutation UpdateSchool($input: SchoolInput) {
    updateSchool(input: $input) {
      schoolId
      schoolName
      schoolAddress1
      schoolCity
      schoolState
      schoolZipcode
    }
  }
`;
```
We are using the Amplify SDK to support offline mode. AppSync is configured for offline:

```javascript
...
const options = {
  defaultOptions: {
    watchQuery: {
      fetchPolicy: 'cache-and-network'
    },
    connectToDevTools: true, // Remove this for production use
    disableOffline: false
  }
}

const client = new AWSAppSyncClient(config, options)
...
```

The mutation is being wrapped in ```buildMutation```

```javascript
    updateSchool() {
      this.$apollo.mutate(buildMutation(
        this.$apollo,
        gql(updateSchool),
        {
          inputType: gql(inputSchool),
          variables: {
            input: this.buildSchoolUpdatesInput()
          }
        },
      )).then(data => console.log(data))
      this.commitSchoolUpdates()
    }
```
# The Problem

There are 5 scenarios we are testing:

1. When the app is connected to the Internet, changing a field value and clicking update (calls updateSchool) updates the database. **This works**
2. If the app is disconnected from the Internet, changing a field value and clicking update updates the current state of the app. The mutation is queued and sent when the network connection is reenabled. **This works**
3. If the app is started with the Internet disconnected, the data should load from the local store. **This works**
4. If the app is disconnected from the Internet, changing a field value and clicking update updates the current state of the app. If the app is then closed and reopened, with the network disconnected, the state should include the queued mutation. **This does not work**

5. If the app is disconnected from the Internet, changing a field value and clicking update updates the current state of the app. If the app is then closed, the network reconnected, and the app reopened the mutation queue should update the database. **Blocked by 4**

# What I have done so far

In addition to the support call with AWS Premium, I have reviewed the documentation at:

https://aws-amplify.github.io/docs/js/api#client-architecture

This documentation appears to suggest that step 4 should work.

# The Question

Is the failure of scenario 4 working as designed? Is there some additional configuration necessary to persist the mutation queue? Am I missing something obvious?

Thank you
## Comment

---------------

Author: @JohnAtFenestra

For the record, I resolved this at least partially by abandoning ```buildMutation``` and implementing my own ```optimisticResponse``` and update routines. It turns out that, at least in my application (see above), ```buildMutation``` returns a ```null``` for ```optimisticResponse```.

The next issue I am dealing with is an apparent race condition where if one follows this sequence, the display shows the previous state rather than the mutated, even though the mutation is executed correctly. A refresh displays the correct information from the server.

1. Disconnect from network
0. Enter an update and save it. The saved update is recorded as an enqueued mutation
0. Shut down the machine (in this case a VM)
0. Reconnect the network
0. Restart the machine
0. Reopen the app

Because of the current design of the app, the main page shows immediately. As I follow the sequence, the ```getSchool``` query fires off on page load **_before_** the enqueued mutation is sent to the server. Therefore, the reactive elements display the stale data from the server even as the same application is sending an update. I'll be investigating this one tomorrow.
## Comment

---------------

Author: @JohnAtFenestra

For the historical record, I've opened a new support case with AWS Premium Support, Amplify Framework, to address this issue. From what I can tell, I have uncovered an edge case bug.

---------------

---------------

# How do I get the 'id' of a database entry from a userName field?

---------------

Author: @chai86
Upvotes: 1
Comments: 0

@iartemiev I'm using AWS Amplify on my react native app, DynamoDB through GraphQL

I want to do something seemingly so simple, but i am a bit lost as to how to do it: I have a table with user information already in it. Here's the Schema:


    type Users @model {
      id: ID!
      userName: String
      firstname: String
      weblink: String
      email: String
      mobileNum: String
     .
     .
     .
    }
    
    
    //**Here's my current Query.js**
    export const getUsers = `query GetUsers($id: ID!) {
      getUsers(id: $id) {
        id
        userName
        firstname
        weblink
        email
        .
        .
        .
      }
    }
    `;

This table is populated in DynamoDB when i check my AWS console. What i need is to be able to get the id from the table using the userName (not vice versa). The id is generated when i createUser() and it's used throughout my app to get all my user's information. However when a user signs in on a new phone, this id isn't available anymore. So when they sign in via Cognito, i do know the userName and all i need to do is retrieve this id. Because there's only one unique **userName**, it should only return one **id**

Here's what i'm thinking so far: use a GSI (global secondary index). So change my schema to: 


    type Users @model
        @key(
           name: "ByUsername"
           fields: ["userName"]
           queryField: "getIdFromUserName"
        )  
    {
      id: ID!
      userName: String
      firstname: String
      weblink: String
      email: String
      mobileNum: String
     .
     .
     .
    }


Then call in my app:

    const data = await API.graphql(graphqlOperation(getIdFromUserName, { userName }));


5 questions: 

1) Is there a simpler way than GSI? e.g. create a Mutation to query getUsers by userName instead of id

2) Is that how you add the GSI? Or is it more robust to do it in the AWS console?

3) What should my **Query.js** then look like?

4) Do i need to make a custom resolver, or is this sufficient?

5) Am i missing anything else, or can i just 

    amplify push  ?


---------------

---------------

# DataStore observe for connected objects returns shallow objects

---------------

Author: @saevarb
Upvotes: 1
Comments: 0

I have a model which serves as a M-M model with two connections. `Foo`, `Bar` and the M-M model `FooBar` which is roughly

```graphql
type FooBar @model {
   id: ID!
   foo: Foo @connection
   bar: Bar @connection
}
```

When I create a new connection, the subscription receives an `INSERT` and then an `UPDATE` with timestamps and such, but both times, the object only contains `fooId` and `barId` with the respective IDs, but not the actual nested objects. This is problematic because when I then filter `fooBars.filter(fb => fb.foo.id === someFoo.id)`, the object that I just added to my local state from the subscription event is not included because its nested object isn't there. 

I have noticed that when I call `DataStore.save`, the returned object does contain the nested objects, and I have found that I can likewise do `DataStore.query(FooBar, msg.element.id)` to retrieve it. If I do the latter, can I be relatively sure that I'm hitting the data store cache instead of performing a network request? 

---------------

---------------

# Does DataSture in React app have to be run in a browser or can it be run under jest in tests.

---------------

Author: @bregan
Upvotes: 1
Comments: 2

Summary:
Does DataStore have to be run in an actual browser?  I am trying to run it under jest in a create-react-app project and it is not working. Just in the tests.  The app itself is working fine.  Also using the API.graphql also works fine in the tests.

Longer description with examples:
I have a Amplify React app setup using DataStore.  The app is working fine and when running the server I am get a list of Expenses from the datastore.  But when I try to set up automated tests in jest, the DataStore will not work.

In the automated tests the API.graphql fetches the same data successfully.

I spent some time googling for examples and found nothing showing DataStore being run in jest automated test. Either directly or rendering the dom using @testing-library/react.

I have attached two example of my tests below

Example 1 : API.graphql (works fine),  DataSture (fails with Node not supported see below test for output.)
-------------------------------------------------------------------------------------
import React from "react";
import Amplify, {API, graphqlOperation} from "aws-amplify";
import '@testing-library/jest-dom/extend-expect'

import awsExports from "../aws-exports.js";
import {DataStore} from "@aws-amplify/datastore";
import {Expense} from '../models';

import { listExpenses} from "../graphql/queries";

Amplify.configure(awsExports);

test('test API  ', async () => {

	const expenses = await API.graphql(graphqlOperation(listExpenses, {limit: 100}))

	expect(expenses.data.listExpenses.items.length).toBe(2);

});

test('should load expenses directly', async () =>{

		const expenses = await DataStore.query(Expense);

		expect(expenses.length).toBe(2);
	}
)

Output:
  ● should load expenses directly

    Node is not supported

      21 | test('should load expenses directly', async () =>{
      22 | 
    > 23 |              const expenses = await DataStore.query(Expense);
         |                                               ^
      24 | 
      25 |              expect(expenses.length).toBe(2);
      26 |      }

--------------------------  ● should load expenses directly

    Node is not supported

      21 | test('should load expenses directly', async () =>{
      22 | 
    > 23 |              const expenses = await DataStore.query(Expense);
         |                                               ^
      24 | 
      25 |              expect(expenses.length).toBe(2);
      26 |      }
  ● should load expenses directly

    Node is not supported

      21 | test('should load expenses directly', async () =>{
      22 | 
    > 23 |              const expenses = await DataStore.query(Expense);
         |                                               ^
      24 | 
      25 |              expect(expenses.length).toBe(2);
      26 |      }
  ● should load expenses directly

    Node is not supported

      21 | test('should load expenses directly', async () =>{
      22 | 
    > 23 |              const expenses = await DataStore.query(Expense);
         |                                               ^
      24 | 
      25 |              expect(expenses.length).toBe(2);
      26 |      }

--------------------------------------------------------------------------------------------------------

Example 2  @testing-library/react

import React from "react";
import Amplify from "aws-amplify";
import { render, fireEvent, waitFor, screen } from '@testing-library/react'
import '@testing-library/jest-dom/extend-expect'

import awsExports from "../aws-exports.js";
import DisplayExpense from './DisplayExpenses.js';

Amplify.configure(awsExports);


test('should load expenses', async () => {

	const {getByText} = render(<DisplayExpense />)

	const text = getByText('Loading expenses!');  // this is found

	// the data query is automatically called and then the proper page gets rendered
	// But this times out.  In the app once the data is fetched this will be display
	await waitFor(() => getByText('Expenses'), {timeout: 8000});

});

## Comment

---------------

Author: @iartemiev

We're actively working on Node/SSR support for Datastore.

In the mean time, you should be able to get unblocked by adding this: https://github.com/dumbmatter/fakeIndexedDB#with-jest to your jest config.
## Comment

---------------

Author: @bregan

Yes, adding in the fakeIndexedDB worked well.

thank you for your quick response.

---------------

---------------

# Attempting to use Datastore from Node.js command line app which results in "Error: Node is not supported"

---------------

Author: @Tom-RulesCube
Upvotes: 1
Comments: 1

Attempting to use Datastore from Node.js command line app which results in "Error: Node is not supported" 

That seems pretty clear, but, is there any way to hack around this?
## Comment

---------------

Author: @iartemiev

We're aware of this issue and are actively looking into it. Please track the progress here: https://github.com/aws-amplify/amplify-js/issues/1613#issuecomment-609053106

---------------

---------------

# Multiple Environments Workflow

---------------

Author: @karrettgelley
Upvotes: 2
Comments: 0

I have been using multiple environments with amplify for a while now and there's one thing that bugs me. I'll illustrate this point with an example:
Suppose you have a master and dev environment with amplify and a dev and master branch on git. The environments have both been initialized properly and do not have any resources associated with them. Now suppose I want to add an Auth resource on the dev branch/env with `amplify add auth, amplify push`. I test it out locally and then I want to merge these changes to master. So I `git checkout master, git merge dev, amplify env checkout master, amplify push`. Great, now the master environment has an auth resource. However, now my master branch on git has new changes! More specifically, the team-provider-info.json file has added a few lines indicating that the master environment has an auth resource now. If I simply amend these changes to the merge `git commit --amend`, my master branch will be updated properly, but now my dev branch is 1 commit behind master. I can fix this (probably by merging master into dev `git checkout dev, git merge master, git push`), but my git history is very odd now. And what if someone else pushed to dev before I can make this hotfix? This is a situation I face every time I want to add Storage, API, Auth, etc. to my app. It's wastes build minutes, introduces synchronization errors, and it's very annoying. Has anyone else noticed this, and if so, how did you fix it?

tldr How do you iteratively add aws resources without messing up team-provider-info.json?

---------------

---------------

# Does anyone have any samples that they like for Amplify JS?

---------------

Author: @sammartinez
Upvotes: 1
Comments: 1

I was curious what others are using for samples of Amplify JS.
## Comment

---------------

Author: @mauerbac

Hey @sammartinez - we have resources on our [community site](https://amplify.aws/community/resources). I'm also a fan of Nader's [repo](https://github.com/dabit3/awesome-aws-amplify). Let me know if this helps! 

---------------

---------------

# Social Federation with Custom Domain

---------------

Author: @karrettgelley
Upvotes: 1
Comments: 1

Does anyone know how to set up social federation with my own custom domain? I followed @dabit3 's great tutorial about [amplify authentication](https://dev.to/dabit3/the-complete-guide-to-user-authentication-with-the-amplify-framework-2inh), but it doesn't mention how to hook up a custom domain. In my master env, when I run amplify status I get an oauth endpoint like http://XXX.master.auth.us-west.cognito.com. That endpoint is then supposed to be entered into the google/facebook app. But how do I tell amplify and the google/facebook apps to use my custom domain instead? By the way, my custom domain is registered in Route 53 and set up in the amplify console.
## Comment

---------------

Author: @karrettgelley

Nevermind, I figured it out: Register a domain with aws and then create a hosted zone. Finally, go to the amplify console and configure the domain in the 'domain management tab'. Here's the tutorial I found for [linking a custom domain to aws amplify](https://dev.to/dabit3/how-to-deploy-a-custom-domain-name-with-the-amplify-console-in-under-two-minutes-jhh).

---------------

---------------

# How to create REST API at different AWS region from Graphql API?

---------------

Author: @apoorvmote
Upvotes: 1
Comments: 0

** Which Category is your question related to? **
Lambda Function
** What AWS Services are you utilizing? **
Cognito, AppSync, Rest API, Lambda
** Provide additional details e.g. code snippets **
I want to send SMS notificiation via AWS SNS but my region doesn't support SMS notifications via SNS. I need to create lambda at different region. 

How do I create REST API via amplify and specify different region from my graphql API?

---------------

---------------

